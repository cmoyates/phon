<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<opgraph xmlns="https://www.phon.ca/ns/opgraph" xmlns:nes="https://www.phon.ca/ns/node_editor" xmlns:oga="https://www.phon.ca/ns/opgraph-app" xmlns:ogcn="https://www.phon.ca/ns/opgraph-common-nodes" xmlns:opqry="https://phon.ca/ns/opgraph_query" xmlns:qry="http://phon.ling.mun.ca/ns/query">
    <graph id="root">
        <node id="1d6fc11b" name="Project" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey"><![CDATA[_project]]></oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.project.Project]]></oga:property>
                </oga:settings>
                <oga:meta x="45" y="67"/>
            </extensions>
        </node>
        <node id="5e629711" name="Selected Sessions" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey"><![CDATA[_selectedSessions]]></oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.ArrayList]]></oga:property>
                </oga:settings>
                <oga:meta x="45" y="348"/>
            </extensions>
        </node>
        <node id="6b8dfd59" name="Selected Participants" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey"><![CDATA[_selectedParticipants]]></oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.ArrayList]]></oga:property>
                </oga:settings>
                <oga:meta x="45" y="449"/>
            </extensions>
        </node>
        <node id="dc4dad38c60648c1" name="Parameters" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <extensions>
                <oga:settings>
                    <oga:property key="filters.searchBy.searchBy"><![CDATA[Word]]></oga:property>
                    <oga:property key="filters.ppc.pattern.filter"><![CDATA[\w]]></oga:property>
                    <oga:property key="__script"><![CDATA[var GroupFilter = require("lib/GroupFilter").GroupFilter;
var AlignedGroupFilter = require("lib/TierFilter").TierFilter;
var WordFilter = require("lib/WordFilter").WordFilter;
var TierList = require("lib/TierList").TierList;
var AlignedWordFilter = require("lib/TierFilter").TierFilter;
var PatternFilter = require("lib/PatternFilter").PatternFilter;
var PatternType = require("lib/PatternFilter").PatternType;
var PPC = require("lib/PPC").PPC;
var PPCOptions = require("lib/PPC").PPCOptions;
var ResultType = require("lib/PhonScriptConstants").ResultType;
var SyllableFilter = require("lib/SyllableFilter").SyllableFilter;
var SearchByOptions = require("lib/SearchByOptions").SearchByOptions;


/********************************
 * Setup params
 *******************************/
var filters = {
	"ppc": new PPCOptions("filters.ppc"),
	"searchBy": new SearchByOptions("filters.searchBy"),
	"group": new GroupFilter("filters.group"),
	"groupTiers": new TierList("filters.groupTiers"),
	"groupPattern": new PatternFilter("filters.groupPattern"),
	"alignedGroup": new AlignedGroupFilter("filters.alignedGroup"),
	"word": new WordFilter("filters.word"),
	"wordTiers": new TierList("filters.wordTiers"),
	"wordPattern": new PatternFilter("filters.wordPattern"),
	"alignedWord": new AlignedWordFilter("filters.alignedWord"),
	"syllable": new SyllableFilter("filters.syllable")
};

var reportTitleParamInfo = {
	"id": "reportTitle",
	"title": "Report Title",
	"def": "Percent Phones Correct (PPC)",
	"prompt": "Enter report title"
};
var reportTitleParam;
var reportTitle = reportTitleParamInfo.def;

function setup_params(params) {
	reportTitleParam = new StringScriptParam(
			reportTitleParamInfo.id,
			reportTitleParamInfo.title,
			reportTitleParamInfo.def);
	reportTitleParam.setPrompt(reportTitleParamInfo.prompt);
	params.add(reportTitleParam);

	filters.ppc.param_setup(params);
	
	var insertIdx = params.size();

	filters.group.param_setup(params);
	filters.groupPattern.param_setup(params);

	var sep2 = new LabelScriptParam("", "<html><b>Aligned Group Filter</b></html>");
	params.add(sep2);
	filters.alignedGroup.param_setup(params);

	filters.word.searchByWordEnabled = true;
	filters.word.param_setup(params);
	filters.wordPattern.param_setup(params);

	var wordsep2 = new LabelScriptParam("", "<html><b>Aligned Word Filter</b></html>");
	params.add(wordsep2);
	filters.alignedWord.param_setup(params);
	var searchByWordListener = new java.beans.PropertyChangeListener {
		propertyChange: function (e) {
			var enabled = e.source.getValue(e.source.paramId);
			filters.wordPattern.setEnabled(enabled);
			filters.alignedWord.setEnabled(enabled);
			filters.wordTiers.setEnabled(enabled);
		}
	};
	filters.word.searchByWordParam.addPropertyChangeListener(filters.word.searchByWordParam.paramId, searchByWordListener);
	var enabled = filters.word.searchByWordParam.getValue(filters.word.searchByWordParam.paramId);
	filters.wordPattern.setEnabled(enabled);
	filters.alignedWord.setEnabled(enabled);

	filters.syllable.param_setup(params);

	filters.searchBy.includeSyllableOption = true;
	filters.searchBy.param_setup(params, filters.word.searchByWordParam, filters.syllable.searchBySyllableParam, insertIdx);

	var otherDataHeader = new SeparatorScriptParam("otherDataHeader", "Additional Tier Data", true);
	params.add(otherDataHeader);
	var sep = new LabelScriptParam("", "<html><b>Add aligned groups</b></html>");
	params.add(sep);
	filters.groupTiers.param_setup(params);
	var wordsep = new LabelScriptParam("", "<html><b>Add aligned words</b></html>");
	params.add(wordsep);
	filters.wordTiers.param_setup(params);
	filters.wordTiers.setEnabled(enabled);
}]]></oga:property>
                </oga:settings>
                <oga:meta x="68" y="642"/>
            </extensions>
        </node>
        <opqry:queryNode id="5b1f4477" name="Query : Aligned IPA" type="ca.phon.app.opgraph.nodes.query.QueryNode">
            <qry:query xmlns="http://phon.ling.mun.ca/ns/query" date="2020-10-30T09:55:58.355-02:30" name="Aligned IPA" uuid="49aceb2d-c4b9-4d68-add6-13411d3995dc">
                <script>
                    <url ref="Aligned IPA" rel="stock"/>
                    <param id="filters.actualResultFilter.filterType">Phonex</param>
                    <param id="filters.alignedGroup.patternFilter.filterType">Plain text</param>
                    <param id="filters.alignedWord.patternFilter.filterType">Plain text</param>
                    <param id="filters.groupPattern.filterType">Plain text</param>
                    <param id="filters.searchBy.searchBy">Word</param>
                    <param id="filters.speaker.age1Comparator">equal to</param>
                    <param id="filters.speaker.age2Comparator">equal to</param>
                    <param id="filters.speaker.ageOperator">(select operator)</param>
                    <param id="filters.speaker.participantRole">(select role)</param>
                    <param id="filters.syllable.otherSyllTypePattern.filterType">Plain text</param>
                    <param id="filters.syllable.syllableType">Any syllable</param>
                    <param id="filters.targetResultFilter.filterType">Phonex</param>
                    <param id="filters.wordPattern.filterType">Plain text</param>
                    <param id="searchTier">IPA Target</param>
                </script>
            </qry:query>
            <extensions>
                <oga:settings/>
                <oga:meta x="422" y="117"/>
            </extensions>
        </opqry:queryNode>
        <ogcn:macro id="207136ae" name="Get Report Title" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="3a35c641">
                <node id="1c51967a" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="752" y="525"/>
                    </extensions>
                </node>
                <node id="4af0dd15" type="class:ca.phon.opgraph.nodes.general.TextNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.general.TextNode.text"><![CDATA[reportTitle]]></oga:property>
                        </oga:settings>
                        <oga:meta x="429" y="708"/>
                    </extensions>
                </node>
                <node id="1d741999" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="430" y="615"/>
                    </extensions>
                </node>
                <node id="20106c70" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="621" y="617"/>
                    </extensions>
                </node>
                <node id="613cd7b6" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                        </oga:settings>
                        <oga:meta x="818" y="622"/>
                    </extensions>
                </node>
                <link dest="20106c70" destField="obj" source="1d741999" sourceField="obj"/>
                <link dest="613cd7b6" destField="obj" source="20106c70" sourceField="value"/>
                <link dest="1d741999" destField="obj" source="1c51967a" sourceField="obj"/>
                <link dest="20106c70" destField="arg1" source="4af0dd15" sourceField="value"/>
            </graph>
            <ogcn:published_input field="obj" name="obj" ref="1c51967a"/>
            <ogcn:published_output field="value" name="value" ref="613cd7b6"/>
            <extensions>
                <oga:meta x="372" y="613"/>
            </extensions>
        </ogcn:macro>
        <ogcn:macro id="23aa4be6b4214b66" name="includePPCNoEpen" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="3c5bd21e">
                <node id="31d879b4a5f49ed" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="716" y="666"/>
                    </extensions>
                </node>
                <node id="12d29660d5dd402a" type="class:ca.phon.opgraph.nodes.general.TextNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.general.TextNode.text"><![CDATA[filters.ppc.includePPCNoEpen]]></oga:property>
                        </oga:settings>
                        <oga:meta x="482" y="1110"/>
                    </extensions>
                </node>
                <node id="c1d7cb456130498f" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="481" y="1010"/>
                    </extensions>
                </node>
                <node id="27029aab93324f93" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="701" y="1029"/>
                    </extensions>
                </node>
                <node id="b5160ae421504eef" name="Object" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                        </oga:settings>
                        <oga:meta x="897" y="1038"/>
                    </extensions>
                </node>
                <node id="db67575f263d486e" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                        </oga:settings>
                        <oga:meta x="1089" y="1051"/>
                    </extensions>
                </node>
                <link dest="27029aab93324f93" destField="obj" source="c1d7cb456130498f" sourceField="obj"/>
                <link dest="b5160ae421504eef" destField="obj" source="27029aab93324f93" sourceField="value"/>
                <link dest="db67575f263d486e" destField="obj" source="b5160ae421504eef" sourceField="obj"/>
                <link dest="c1d7cb456130498f" destField="obj" source="31d879b4a5f49ed" sourceField="obj"/>
                <link dest="27029aab93324f93" destField="arg1" source="12d29660d5dd402a" sourceField="value"/>
            </graph>
            <ogcn:published_input field="obj" name="obj" ref="31d879b4a5f49ed"/>
            <ogcn:published_output field="obj" name="includePPCNoEpen" ref="db67575f263d486e"/>
            <extensions>
                <oga:meta x="358" y="748"/>
            </extensions>
        </ogcn:macro>
        <node id="788f7598" name="Extract Diacritic Options" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <output name="ignoreDiacritics" type="java.lang.Boolean"/>
            <output name="onlyOrExcept" type="java.lang.Boolean"/>
            <output name="selectedDiacritics" type="java.util.Collection"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[importClass(Packages.ca.phon.query.script.params.DiacriticOptionsScriptParam)

var diacriticOptionsParamInfo = {
	"id": "filters.ppc.diacriticOptions",
	"desc": "Diacritic Options",
	"def": false,
	"retainDia": new java.util.ArrayList()
};
var diacriticOptionsParam;

var filters = {
	"ppc": {
		"diacriticOptions": {}
	}
};

function setup_params(params) {
	diacriticOptionsParam = new DiacriticOptionsScriptParam(
		diacriticOptionsParamInfo.id,
		diacriticOptionsParamInfo.desc,
		diacriticOptionsParamInfo.def,
		diacriticOptionsParamInfo.retainDia
	);
	params.add(diacriticOptionsParam);	
}

function init(inputs, outputs) {
	outputs.add("ignoreDiacritics", "", false, java.lang.Boolean);
	outputs.add("onlyOrExcept", "", false, java.lang.Boolean);
	outputs.add("selectedDiacritics", "", false, java.util.Collection);
}

function run(context) {
	var ignoreDiacritics = java.lang.Boolean.valueOf(
		filters.ppc.diacriticOptions.ignoreDiacritics || false);
	context.put("ignoreDiacritics", ignoreDiacritics);


	var onlyOrExcept = false;
	if(filters.ppc.diacriticOptions.selectionMode) {
		onlyOrExcept = (filters.ppc.diacriticOptions.selectionMode == "Only");
	}
		
	context.put("onlyOrExcept", onlyOrExcept);

	var selectedDiacritics = filters.ppc.diacriticOptions.selectedDiacritics || new java.util.List();
	context.put("selectedDiacritics", selectedDiacritics);
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="45" y="821"/>
            </extensions>
        </node>
        <node id="4df37e74" name="Get Listing Title" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <output name="title" type="java.lang.String"/>
            <extensions>
                <oga:settings>
                    <oga:property key="filters.syllable.otherSyllTypePattern.filterType"><![CDATA[Plain text]]></oga:property>
                    <oga:property key="filters.syllable.syllableType"><![CDATA[Any syllable]]></oga:property>
                    <oga:property key="__script"><![CDATA[var GroupFilter = require("lib/GroupFilter").GroupFilter;
var WordFilter = require("lib/WordFilter").WordFilter;
var SyllableFilter = require("lib/SyllableFilter").SyllableFilter;

var filters = {
	"group": new GroupFilter("filters.group"),
	"word": new WordFilter("filters.word"),
	"syllable": new SyllableFilter("filters.syllable")
};

function init(intput, outputs) {
	outputs.add("title", "", false, java.lang.String);
}

function setup_params(params) {
	filters.group.param_setup(params);
	filters.word.param_setup(params);
	filters.syllable.param_setup(params);
}

function run(context) {
	var title = "PPC by ";
	var domain = "Group";

	if(filters.syllable.isUseFilter()) {
		domain = "Syllable";
	} else if(filters.word.isUseFilter()) {
		domain = "Word";
	}

	context.put("title", title + domain);
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="366" y="882"/>
            </extensions>
        </node>
        <node id="556b9255" type="class:ca.phon.app.opgraph.nodes.table.ResultsToTableNode">
            <extensions>
                <oga:settings>
                    <oga:property key="includeSessionInfo"><![CDATA[true]]></oga:property>
                    <oga:property key="includeSpeakerInfo"><![CDATA[true]]></oga:property>
                    <oga:property key="includeMetadata"><![CDATA[true]]></oga:property>
                    <oga:property key="includeTierInfo"><![CDATA[true]]></oga:property>
                </oga:settings>
                <oga:meta x="676" y="106"/>
            </extensions>
        </node>
        <node id="72b7332f33144273" name="Setup Summary Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="includePPCNoEpen" optional="false"/>
            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("includePPCNoEpen", "", false, false);
	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = new DefaultTableDataSource();
	var includePPCNoEpen = context.get("includePPCNoEpen");
	
	var col = 0;
	table.setColumnTitle(col++, "Speaker");
	table.setColumnTitle(col++, "# Target");
	table.setColumnTitle(col++, "# Actual");
	table.setColumnTitle(col++, "# Correct");
	table.setColumnTitle(col++, "# Substituted");
	table.setColumnTitle(col++, "# Deleted");
	table.setColumnTitle(col++, "# Epenthesized");
	table.setColumnTitle(col++, "PPC");

	if(includePPCNoEpen == true) {
		table.setColumnTitle(col++, "PPC (NoEpen)");
	}

	context.put("table", table);
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="1171" y="633"/>
            </extensions>
        </node>
        <node id="52411a13" type="class:ca.phon.app.opgraph.nodes.report.NewReportNode">
            <extensions>
                <oga:settings/>
                <oga:meta x="696" y="644"/>
            </extensions>
        </node>
        <node id="4820f2b261e74cd8" name="PPC" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <output name="ppc" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <output name="resultsByPhone" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="filters.ppc.onsetType"><![CDATA[All onsets]]></oga:property>
                    <oga:property key="filters.ppc.nucleusType"><![CDATA[All nuclei]]></oga:property>
                    <oga:property key="filters.ppc.codaType"><![CDATA[All codas]]></oga:property>
                    <oga:property key="filters.ppc.clusterType"><![CDATA[All clusters]]></oga:property>
                    <oga:property key="filters.ppc.ppcType"><![CDATA[Percent phones correct]]></oga:property>
                    <oga:property key="filters.ppc.pattern.filter"><![CDATA[\w]]></oga:property>
                    <oga:property key="__script"><![CDATA[importPackage(Packages.ca.phon.ipa.alignment)

var PPC = require("lib/PPC").PPC;
var PPCOptions = require("lib/PPC").PPCOptions;

var filters = {
	"ppc": new PPCOptions("filters.ppc")
};

function init(inputs, outputs) {
	inputs.add("table", "", false,  false);
	
	outputs.add("ppc", "", false, DefaultTableDataSource);
	outputs.add("resultsByPhone", "", false, DefaultTableDataSource);
}

function setup_params(params) {
	filters.ppc.param_setup(params);
}

function setupColumns(table, inputTable) {
	var col = 0;

	for(var ic = 0; ic < inputTable.columnCount; ic++) {
		table.setColumnTitle(col++, inputTable.getColumnTitle(ic));
	}

	table.setColumnTitle(col++, "# Target");
	table.setColumnTitle(col++, "# Actual");
	table.setColumnTitle(col++, "# Correct");
	table.setColumnTitle(col++, "# Substituted");
	table.setColumnTitle(col++, "# Deleted");
	table.setColumnTitle(col++, "# Epenthesized");
	table.setColumnTitle(col++, "PPC");
}

function copyRow(inputTable, rowIdx) {
	var row = new Array();
	var col = 0;
	for(var cidx = 0; cidx < inputTable.columnCount; cidx++) {
		row[col++] = inputTable.getValueAt(rowIdx, cidx);
	}
	return row;
}

function run(context) {
	var table = context.get("table");

	var ppc = new DefaultTableDataSource();
	var resultsByPhone = new DefaultTableDataSource();
	
	// setup pdc columns
	setupColumns(ppc, table);
	
	var expCol = 0;
	resultsByPhone.setColumnTitle(expCol++, "Session");
	resultsByPhone.setColumnTitle(expCol++, "Date");
	resultsByPhone.setColumnTitle(expCol++, "Speaker");
	resultsByPhone.setColumnTitle(expCol++, "Age");
	resultsByPhone.setColumnTitle(expCol++, "Record #");
	resultsByPhone.setColumnTitle(expCol++, "Group #");
	resultsByPhone.setColumnTitle(expCol++, "IPA Target");
	resultsByPhone.setColumnTitle(expCol++, "IPA Actual");
	resultsByPhone.setColumnTitle(expCol++, "# Correct");
	resultsByPhone.setColumnTitle(expCol++, "# Substituted");
	resultsByPhone.setColumnTitle(expCol++, "# Deleted");
	resultsByPhone.setColumnTitle(expCol++, "# Epenthesized");

	for(var row = 0; row < table.rowCount; row++) {
		var ipaT = table.getValueAt(row, "IPA Target");
		var ipaA = table.getValueAt(row, "IPA Actual");
		var alignment = table.getValueAt(row, "Alignment");

		if(ipaT == null || ipaA == null || alignment == null) continue;
		if(alignment.length() == 0) continue;

		var phoneMap = PhoneMap.fromString(ipaT.audiblePhones(), 
			ipaA.audiblePhones(), alignment);

		var group = {
			getIPATarget: function() { return ipaT; },
			getIPAActual: function() { return ipaA; },
			getPhoneAlignment: function() { return phoneMap; }
		};

		var ppcData = PPC.calc_ppc_aligned(group, filters.ppc.pattern, filters.ppc.diacriticOptions, filters.ppc.ignoreDistortedDiacritic);

		var ppcRow = copyRow(table, row);
		ppcRow.push(ppcData.target);
		ppcRow.push(ppcData.actual);
		ppcRow.push(ppcData.correct);
		ppcRow.push(ppcData.substituted);
		ppcRow.push(ppcData.deleted);
		ppcRow.push(ppcData.epen);

		if(ppcData.correct + ppcData.substituted 
		  + ppcData.deleted + ppcData.epen > 0) {
			var ppcVal = (ppcData.correct) /
				(ppcData.correct + ppcData.substituted 
		 			 + ppcData.deleted + ppcData.epen);
		 	ppcRow.push(java.lang.Float.valueOf(ppcVal * 100.0));
		} else {
			ppcRow.push(java.lang.Float.valueOf(0.0));
		}
		
		ppc.addRow(ppcRow);

		for(var i = 0; i < ppcData.expanded_results.length; i++) {
			var expResult = ppcData.expanded_results[i];
			var expRow = new Array();
			expCol = 0;
			expRow[expCol++] = table.getValueAt(row, "Session");
			expRow[expCol++] = table.getValueAt(row, "Date");
			expRow[expCol++] = table.getValueAt(row, "Speaker");
			expRow[expCol++] = table.getValueAt(row, "Age");
			expRow[expCol++] = table.getValueAt(row, "Record #");
			expRow[expCol++] = table.getValueAt(row, "Group #");
			expRow[expCol++] = (expResult.target >= 0 ? ipaT.elementAt(expResult.target) : new IPATranscript());
			expRow[expCol++] = (expResult.actual >= 0 ? ipaA.elementAt(expResult.actual) : new IPATranscript());
			expRow[expCol++] = expResult.correct;
			expRow[expCol++] = expResult.substituted;
			expRow[expCol++] = expResult.deleted;
			expRow[expCol++] = expResult.epen;

			resultsByPhone.addRow(expRow);
		}
	}

	context.put("ppc", ppc);
	context.put("resultsByPhone", resultsByPhone);
}]]></oga:property>
                </oga:settings>
                <oga:meta x="984" y="93"/>
            </extensions>
        </node>
        <node id="438ace663bbc4ce9" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
            <extensions>
                <oga:meta x="920" y="632">
                    <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="54db75a0" name="Split Table by Speaker" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
            <extensions>
                <oga:settings>
                    <oga:property key="__scriptName"><![CDATA[Split Table]]></oga:property>
                    <oga:property key="columnName"><![CDATA[Speaker]]></oga:property>
                </oga:settings>
                <oga:meta x="1265" y="99"/>
            </extensions>
        </node>
        <node id="b77ef3a25c544205" name="Split Table by Speaker" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
            <extensions>
                <oga:settings>
                    <oga:property key="__scriptName"><![CDATA[Split Table]]></oga:property>
                    <oga:property key="columnName"><![CDATA[Speaker]]></oga:property>
                </oga:settings>
                <oga:meta x="1267" y="257"/>
            </extensions>
        </node>
        <node id="6902fdcf64fb4e1a" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
            <extensions>
                <opqry:inventoryoptions>
                    <opqry:automaticConfiguration configureAutomatically="false">
                        <opqry:autoGrouping column="Session" grouping="true"/>
                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                    </opqry:automaticConfiguration>
                    <opqry:groupBy caseSensitive="true" column="Session"/>
                    <opqry:column caseSensitive="true" column="IPA Target"/>
                    <opqry:column caseSensitive="true" column="IPA Actual"/>
                    <opqry:sumColumns>
                        <opqry:columnName># Correct</opqry:columnName>
                        <opqry:columnName># Substituted</opqry:columnName>
                        <opqry:columnName># Deleted</opqry:columnName>
                        <opqry:columnName># Epenthesized</opqry:columnName>
                    </opqry:sumColumns>
                </opqry:inventoryoptions>
                <oga:settings/>
                <oga:meta x="937" y="938"/>
            </extensions>
        </node>
        <ogcn:macro id="d6eb54e5383f44b7" name="For Each Participant" type="ca.phon.opgraph.nodes.reflect.IterableClassNode">
            <graph id="75b92026">
                <node id="cc87e3415bc44035" name="Current  Speaker" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key"><![CDATA[currentValue]]></oga:property>
                        </oga:settings>
                        <oga:meta x="20" y="27"/>
                    </extensions>
                </node>
                <node id="d26961af7290446c" name="PPC Table Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="49" y="197"/>
                    </extensions>
                </node>
                <node id="5369910dcce94aef" name="By Phone Table Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="50" y="316"/>
                    </extensions>
                </node>
                <ogcn:macro id="1fdb304153aa4455" name="Report Node" type="ca.phon.opgraph.nodes.reflect.IterableClassNode">
                    <graph id="7cb88fed">
                        <node id="74e89447367042f5" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass"><![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]></oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key"><![CDATA[currentValue]]></oga:property>
                                </oga:settings>
                                <oga:meta x="772" y="535"/>
                            </extensions>
                        </node>
                    </graph>
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.IterableClassNode.className"><![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]></oga:property>
                        </oga:settings>
                        <oga:meta x="50" y="433"/>
                    </extensions>
                </ogcn:macro>
                <node id="407566a6b7484732" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                        </oga:settings>
                        <oga:meta x="80" y="682"/>
                    </extensions>
                </node>
                <node id="296bf6a4e9349fc" name="includePPCNoEpen" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                        </oga:settings>
                        <oga:meta x="82" y="859"/>
                    </extensions>
                </node>
                <node id="8ea33bb3bbee4541" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                        </oga:settings>
                        <oga:meta x="205" y="27"/>
                    </extensions>
                </node>
                <node id="1cd5f59092d04776" name="Global Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                        </oga:settings>
                        <oga:meta x="1301" y="699"/>
                    </extensions>
                </node>
                <ogcn:macro id="fbbac83d507343e3" name="Get Table of Results For Speaker" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="4b1626fa">
                        <node id="db46e4ca7ad84a34" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                                </oga:settings>
                                <oga:meta x="105" y="70"/>
                            </extensions>
                        </node>
                        <node id="9ae78a72d5474d71" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                </oga:settings>
                                <oga:meta x="296" y="73"/>
                            </extensions>
                        </node>
                        <node id="95c6144a6a764e9c" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                            <input name="table" optional="false"/>
                            <output name="exists" type="java.lang.Boolean">does table exist</output>
                            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource">table if exists, undefined otherwise</output>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script"><![CDATA[
// setup input/output fields
function init(inputFields, outputFields) {
	inputFields.add("table", "");
	outputFields.add("exists", "does table exist", false, java.lang.Boolean);
	outputFields.add("table", "table if exists, undefined otherwise", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var table = context.get("table");
	var tableExists =
		(context.containsKey("table") && table != null && table.rowCount > 0);
	context.put("exists", tableExists);
	context.put("table", context.get("table"));
}
]]></oga:property>
                                </oga:settings>
                                <oga:meta x="514" y="94"/>
                            </extensions>
                        </node>
                        <link dest="9ae78a72d5474d71" destField="arg1" source="db46e4ca7ad84a34" sourceField="value"/>
                        <link dest="95c6144a6a764e9c" destField="table" source="9ae78a72d5474d71" sourceField="value"/>
                        <extensions>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="speaker" ref="db46e4ca7ad84a34"/>
                    <ogcn:published_input field="obj" name="tableMap" ref="9ae78a72d5474d71"/>
                    <ogcn:published_output field="exists" name="exists" ref="95c6144a6a764e9c"/>
                    <ogcn:published_output field="table" name="table" ref="95c6144a6a764e9c"/>
                    <extensions>
                        <oga:meta x="551" y="115"/>
                    </extensions>
                </ogcn:macro>
                <ogcn:macro id="83a128d56baa4161" name="If Speaker Has Results" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="1edfac77">
                        <node id="7d6c1937f07b40fc" name="globalSummary" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                </oga:settings>
                                <oga:meta x="28" y="52"/>
                            </extensions>
                        </node>
                        <node id="dd9da81e23db4b02" name="parent" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]></oga:property>
                                </oga:settings>
                                <oga:meta x="28" y="213"/>
                            </extensions>
                        </node>
                        <node id="665cc93d58149bd" name="speaker" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                                </oga:settings>
                                <oga:meta x="28" y="433"/>
                            </extensions>
                        </node>
                        <node id="50fb1814107f4c2f" name="includePPCNoEpen" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                                </oga:settings>
                                <oga:meta x="31" y="538"/>
                            </extensions>
                        </node>
                        <node id="14561c8115f1481b" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                </oga:settings>
                                <oga:meta x="34" y="645"/>
                            </extensions>
                        </node>
                        <node id="d2ca8ee4346e470c" name="tableMap" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                </oga:settings>
                                <oga:meta x="30" y="829"/>
                            </extensions>
                        </node>
                        <node id="18798b6238914c4d" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                                </oga:settings>
                                <oga:meta x="227" y="436"/>
                            </extensions>
                        </node>
                        <node id="ace5908aa4654763" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                            <extensions>
                                <opqry:inventoryoptions>
                                    <opqry:automaticConfiguration configureAutomatically="false">
                                        <opqry:autoGrouping column="Session" grouping="true"/>
                                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                    </opqry:automaticConfiguration>
                                    <opqry:column caseSensitive="true" column="Session"/>
                                    <opqry:sumColumns>
                                        <opqry:columnName># Target</opqry:columnName>
                                        <opqry:columnName># Actual</opqry:columnName>
                                        <opqry:columnName># Correct</opqry:columnName>
                                        <opqry:columnName># Substituted</opqry:columnName>
                                        <opqry:columnName># Deleted</opqry:columnName>
                                        <opqry:columnName># Epenthesized</opqry:columnName>
                                    </opqry:sumColumns>
                                </opqry:inventoryoptions>
                                <oga:settings/>
                                <oga:meta x="495" y="650"/>
                            </extensions>
                        </node>
                        <node id="d203c2915ad24c30" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                            <extensions>
                                <oga:meta x="869" y="104"/>
                            </extensions>
                        </node>
                        <node id="7e12600f4eed40b9" type="class:ca.phon.app.opgraph.nodes.table.ColumnSumNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="columns"><![CDATA[# Target
# Actual
# Correct
# Substituted
# Deleted
# Epenthesized]]></oga:property>
                                </oga:settings>
                                <oga:meta x="692" y="650"/>
                            </extensions>
                        </node>
                        <ogcn:macro id="86926ad138c84356" name="Get Table For Speaker (By Phone)" type="ca.phon.opgraph.nodes.general.MacroNode">
                            <graph id="6a215a6c">
                                <node id="a174d02431dd4d63" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                        </oga:settings>
                                        <oga:meta x="132" y="116"/>
                                    </extensions>
                                </node>
                                <node id="2e6c12d1bd8245a2" name="arg1" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                                        </oga:settings>
                                        <oga:meta x="129" y="241"/>
                                    </extensions>
                                </node>
                                <node id="e464397a2194447" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                        </oga:settings>
                                        <oga:meta x="452" y="143"/>
                                    </extensions>
                                </node>
                                <node id="701170af31ec4354" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                        </oga:settings>
                                        <oga:meta x="656" y="139"/>
                                    </extensions>
                                </node>
                                <node id="842696138d884d83" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                        </oga:settings>
                                        <oga:meta x="874" y="148"/>
                                    </extensions>
                                </node>
                                <link dest="701170af31ec4354" destField="arg1" source="2e6c12d1bd8245a2" sourceField="obj"/>
                                <link dest="e464397a2194447" destField="obj" source="a174d02431dd4d63" sourceField="obj"/>
                                <link dest="842696138d884d83" destField="obj" source="701170af31ec4354" sourceField="value"/>
                                <link dest="701170af31ec4354" destField="obj" source="e464397a2194447" sourceField="obj"/>
                                <extensions>
                                    <oga:notes>
                                        <oga:note color="0xffff96" height="351" title="Inputs" width="340" x="47" y="55"/>
                                    </oga:notes>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="speaker" ref="2e6c12d1bd8245a2"/>
                            <ogcn:published_input field="obj" name="tableMap" ref="a174d02431dd4d63"/>
                            <ogcn:published_output field="obj" name="table" ref="842696138d884d83"/>
                            <extensions>
                                <oga:meta x="485" y="843"/>
                            </extensions>
                        </ogcn:macro>
                        <node id="5298fae2" name="Add PCC Columns" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                            <input name="table" optional="false"/>
                            <input name="includePPCNoEpen" optional="false"/>
                            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("table", "", false, false);
	inputs.add("includePPCNoEpen", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = context.get("table");
	var includePPCNoEpen = context.get("includePPCNoEpen");

	table.setColumnTitle(table.columnCount, "PPC");
	if(includePPCNoEpen == true)
		table.setColumnTitle(table.columnCount, "PPC (NoEpen)");

	for(var row = 0; row < table.rowCount; row++) {
		var correct = table.getValueAt(row, "# Correct").floatValue();
		var sub = table.getValueAt(row, "# Substituted").floatValue();
		var del = table.getValueAt(row, "# Deleted").floatValue();
		var epen = table.getValueAt(row, "# Epenthesized").floatValue();
	
		var ppc = 0.0;
		if(correct + sub + del + epen > 0) {
			ppc = (correct) / (correct + sub + del + epen);
			ppc *= 100.0;
		}
		table.setValueAt(row, table.getColumnIndex("PPC"), ppc);

		if(includePPCNoEpen == true) {
			var ppcNoEpen = 0.0;
			if(correct + sub + del > 0) {
				ppcNoEpen = (correct) / (correct + sub + del);
				ppcNoEpen *= 100.0;
			}
			table.setValueAt(row, table.getColumnIndex("PPC (NoEpen)"), ppcNoEpen);
		}
	}
}
]]></oga:property>
                                </oga:settings>
                                <oga:meta x="950" y="631"/>
                            </extensions>
                        </node>
                        <node id="5124ae57e7314840" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                            <extensions>
                                <opqry:inventoryoptions>
                                    <opqry:automaticConfiguration configureAutomatically="false">
                                        <opqry:autoGrouping column="Session" grouping="true"/>
                                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                    </opqry:automaticConfiguration>
                                    <opqry:groupBy caseSensitive="true" column="Session"/>
                                    <opqry:column caseSensitive="true" column="IPA Target"/>
                                    <opqry:column caseSensitive="true" column="IPA Actual"/>
                                    <opqry:sumColumns>
                                        <opqry:columnName># Correct</opqry:columnName>
                                        <opqry:columnName># Substituted</opqry:columnName>
                                        <opqry:columnName># Deleted</opqry:columnName>
                                        <opqry:columnName># Epenthesized</opqry:columnName>
                                    </opqry:sumColumns>
                                </opqry:inventoryoptions>
                                <oga:settings/>
                                <oga:meta x="773" y="828"/>
                            </extensions>
                        </node>
                        <node id="43ef14dbd6c64822" name="Summary Table" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[false]]></oga:property>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"><![CDATA[Total]]></oga:property>
                                </oga:settings>
                                <oga:meta x="1120" y="107">
                                    <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                                </oga:meta>
                            </extensions>
                        </node>
                        <node id="ff0b0a57f775493d" name="Add to Global Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                            <input name="speaker" optional="false"/>
                            <input name="globalSummary" optional="false"/>
                            <input name="speakerSummary" optional="false"/>
                            <input name="includePPCNoEpen" optional="false"/>
                            <output name="globalSummary" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("speaker", "", false, false);
	inputs.add("globalSummary", "", false, false);
	inputs.add("speakerSummary", "", false, false);
	inputs.add("includePPCNoEpen", "", false, false);

	outputs.add("globalSummary", "", false, DefaultTableDataSource);
}

function run(context) {
	var speaker = context.get("speaker");
	var globalSummary = context.get("globalSummary");
	var speakerSummary = context.get("speakerSummary");
	var includePPCNoEpen = context.get("includePPCNoEpen");
	var speakerRow = speakerSummary.rowCount-1;

	var rowData = [];
	var col = 0;
	rowData[col++] = speaker;
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Target");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Actual");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Correct");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Substituted");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Deleted");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Epenthesized");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "PPC");
	if(includePPCNoEpen == true)
		rowData[col++] = speakerSummary.getValueAt(speakerRow, "PPC (NoEpen)");
	globalSummary.addRow(rowData);
}
]]></oga:property>
                                </oga:settings>
                                <oga:meta x="1493" y="636"/>
                            </extensions>
                        </node>
                        <node id="962b54af98a84140" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                            <extensions>
                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false" likeOnTop="true">
                                    <opqry:sortBy column="IPA Target" order="ascending" type="ipa"/>
                                    <opqry:sortBy column="IPA Actual" order="ascending" type="ipa"/>
                                </opqry:sortoptions>
                                <oga:settings/>
                                <oga:meta x="969" y="828"/>
                            </extensions>
                        </node>
                        <node id="f16b07572b024d87" name="IPA Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                </oga:settings>
                                <oga:meta x="1371" y="108">
                                    <oga:default for="sectionName" type="java.lang.String">IPA Patterns</oga:default>
                                </oga:meta>
                            </extensions>
                        </node>
                        <link dest="f16b07572b024d87" destField="parent" source="43ef14dbd6c64822" sourceField="parent"/>
                        <link dest="d203c2915ad24c30" destField="parent" source="dd9da81e23db4b02" sourceField="obj"/>
                        <link dest="86926ad138c84356" destField="tableMap" source="d2ca8ee4346e470c" sourceField="obj"/>
                        <link dest="ff0b0a57f775493d" destField="speaker" source="665cc93d58149bd" sourceField="obj"/>
                        <link dest="ff0b0a57f775493d" destField="globalSummary" source="7d6c1937f07b40fc" sourceField="obj"/>
                        <link dest="5124ae57e7314840" destField="table" source="86926ad138c84356" sourceField="table"/>
                        <link dest="962b54af98a84140" destField="table" source="5124ae57e7314840" sourceField="table"/>
                        <link dest="43ef14dbd6c64822" destField="parent" source="d203c2915ad24c30" sourceField="section"/>
                        <link dest="ace5908aa4654763" destField="table" source="14561c8115f1481b" sourceField="obj"/>
                        <link dest="18798b6238914c4d" destField="obj" source="665cc93d58149bd" sourceField="obj"/>
                        <link dest="86926ad138c84356" destField="speaker" source="18798b6238914c4d" sourceField="value"/>
                        <link dest="d203c2915ad24c30" destField="sectionName" source="18798b6238914c4d" sourceField="value"/>
                        <link dest="f16b07572b024d87" destField="table" source="962b54af98a84140" sourceField="table"/>
                        <link dest="ff0b0a57f775493d" destField="includePPCNoEpen" source="50fb1814107f4c2f" sourceField="obj"/>
                        <link dest="7e12600f4eed40b9" destField="table" source="ace5908aa4654763" sourceField="table"/>
                        <link dest="5298fae2" destField="table" source="7e12600f4eed40b9" sourceField="table"/>
                        <link dest="5298fae2" destField="includePPCNoEpen" source="50fb1814107f4c2f" sourceField="obj"/>
                        <link dest="ff0b0a57f775493d" destField="speakerSummary" source="5298fae2" sourceField="table"/>
                        <link dest="43ef14dbd6c64822" destField="table" source="5298fae2" sourceField="table"/>
                        <extensions>
                            <oga:notes>
                                <oga:note color="0xffff96" height="1003" title="Inputs" width="418" x="17" y="12"/>
                                <oga:note color="0xffc864" height="415" title="Report" width="878" x="795" y="26"/>
                                <oga:note color="0xffff96" height="244" title="Note" width="792" x="454" y="771"/>
                            </oga:notes>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="table" ref="14561c8115f1481b"/>
                    <ogcn:published_input field="obj" name="parent" ref="dd9da81e23db4b02"/>
                    <ogcn:published_input field="obj" name="tableMap" ref="d2ca8ee4346e470c"/>
                    <ogcn:published_input field="obj" name="speaker" ref="665cc93d58149bd"/>
                    <ogcn:published_input field="obj" name="globalSummary" ref="7d6c1937f07b40fc"/>
                    <ogcn:published_input field="obj" name="includePPCNoEpen" ref="50fb1814107f4c2f"/>
                    <extensions>
                        <oga:meta x="976" y="120"/>
                    </extensions>
                </ogcn:macro>
                <node id="338140c381654f16" type="class:ca.phon.opgraph.nodes.logic.LogicalNotNode">
                    <extensions>
                        <oga:meta x="670" y="351"/>
                    </extensions>
                </node>
                <node id="7e33cb78203e4fde" name="Add to Global Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                    <input name="speaker" optional="false"/>
                    <input name="globalSummary" optional="false"/>
                    <input name="includePPCNoEpen" optional="false"/>
                    <output name="globalSummary" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                    <extensions>
                        <oga:settings>
                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("speaker", "", false, false);
	inputs.add("globalSummary", "", false, false);
	inputs.add("includePPCNoEpen", "", false, false);

	outputs.add("globalSummary", "", false, DefaultTableDataSource);
}

function run(context) {
	var speaker = context.get("speaker");
	var globalSummary = context.get("globalSummary");
	var includePPCNoEpen = context.get("includePPCNoEpen");

	var rowData = [];
	var col = 0;
	rowData[col++] = speaker;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0.0;
	if(includePPCNoEpen == true)
		rowData[col++] = 0.0;
	globalSummary.addRow(rowData);
}
]]></oga:property>
                        </oga:settings>
                        <oga:meta x="943" y="343"/>
                    </extensions>
                </node>
                <link dest="8ea33bb3bbee4541" destField="obj" source="cc87e3415bc44035" sourceField="obj"/>
                <link dest="fbbac83d507343e3" destField="tableMap" source="d26961af7290446c" sourceField="obj"/>
                <link dest="fbbac83d507343e3" destField="speaker" source="8ea33bb3bbee4541" sourceField="value"/>
                <link dest="83a128d56baa4161" destField="parent" source="1fdb304153aa4455" sourceField="collection"/>
                <link dest="83a128d56baa4161" destField="globalSummary" source="407566a6b7484732" sourceField="obj"/>
                <link dest="83a128d56baa4161" destField="speaker" source="cc87e3415bc44035" sourceField="obj"/>
                <link dest="83a128d56baa4161" destField="table" source="fbbac83d507343e3" sourceField="table"/>
                <link dest="83a128d56baa4161" destField="tableMap" source="5369910dcce94aef" sourceField="obj"/>
                <link dest="83a128d56baa4161" destField="enabled" source="fbbac83d507343e3" sourceField="exists"/>
                <link dest="1cd5f59092d04776" destField="obj" source="407566a6b7484732" sourceField="obj"/>
                <link dest="338140c381654f16" destField="x" source="fbbac83d507343e3" sourceField="exists"/>
                <link dest="7e33cb78203e4fde" destField="enabled" source="338140c381654f16" sourceField="result"/>
                <link dest="7e33cb78203e4fde" destField="globalSummary" source="407566a6b7484732" sourceField="obj"/>
                <link dest="7e33cb78203e4fde" destField="speaker" source="8ea33bb3bbee4541" sourceField="value"/>
                <link dest="83a128d56baa4161" destField="includePPCNoEpen" source="296bf6a4e9349fc" sourceField="obj"/>
                <link dest="7e33cb78203e4fde" destField="includePPCNoEpen" source="296bf6a4e9349fc" sourceField="obj"/>
                <extensions>
                    <oga:notes>
                        <oga:note color="0xffff96" height="863" title="Inputs" width="372" x="17" y="129"/>
                        <oga:note color="0xffff96" height="279" title="Outputs" width="304" x="1238" y="623"/>
                    </oga:notes>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <ogcn:published_input field="obj" name="ppcTableMap" ref="d26961af7290446c"/>
            <ogcn:published_input field="collection" name="reportSection" ref="1fdb304153aa4455"/>
            <ogcn:published_input field="obj" name="byPhoneTableMap" ref="5369910dcce94aef"/>
            <ogcn:published_input field="obj" name="summaryTable" ref="407566a6b7484732"/>
            <ogcn:published_input field="obj" name="includePPCNoEpen" ref="296bf6a4e9349fc"/>
            <ogcn:published_output field="obj" name="summaryTable" ref="1cd5f59092d04776"/>
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.IterableClassNode.className"><![CDATA[java.util.ArrayList]]></oga:property>
                </oga:settings>
                <oga:meta x="1537" y="163"/>
            </extensions>
        </ogcn:macro>
        <node id="2c2a54ec3c0449c0" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
            <extensions>
                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false" likeOnTop="true">
                    <opqry:sortBy column="IPA Target" order="ascending" type="ipa"/>
                    <opqry:sortBy column="IPA Actual" order="ascending" type="ipa"/>
                </opqry:sortoptions>
                <oga:settings/>
                <oga:meta x="1244" y="938"/>
            </extensions>
        </node>
        <node id="6645a41401ae45e7" type="class:ca.phon.app.opgraph.nodes.table.ColumnSumNode">
            <extensions>
                <oga:settings>
                    <oga:property key="columns"><![CDATA[# Target
# Actual
# Correct
# Substituted
# Deleted
# Epenthesized]]></oga:property>
                </oga:settings>
                <oga:meta x="987" y="781"/>
            </extensions>
        </node>
        <node id="4b473b32" name="Listing" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[false]]></oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"><![CDATA[Date
Tier
Range
Result
Alignment]]></oga:property>
                </oga:settings>
                <oga:meta x="942" y="1089">
                    <oga:default for="sectionName" type="java.lang.String">Listing</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="999ad56bd34a4e92" name="Calc PPC" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <input name="includePPCNoEpen" optional="false"/>
            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("table", "", false, false);
	inputs.add("includePPCNoEpen", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = context.get("table");
	var row = table.rowCount -1;
	var includePPCNoEpen = context.get("includePPCNoEpen");
	
	if(row >= 0) {
		var correct = table.getValueAt(row, "# Correct");
		var sub = table.getValueAt(row, "# Substituted");
		var del = table.getValueAt(row, "# Deleted");
		var epen = table.getValueAt(row, "# Epenthesized");

		var ppcCol = table.getColumnIndex("PPC");

		var ppc = 0.0;
		if(correct + sub + del + epen > 0) {
			var ppc = (correct) / (correct + sub + del + epen);
			ppc *= 100.0;
		}
		table.setValueAt(row, ppcCol, java.lang.Float.valueOf(ppc));

		if(includePPCNoEpen == true) {
			var ppcNoEpen = 0.0;
			var ppcNoEpenCol = table.getColumnIndex("PPC (NoEpen)");

			if(correct + sub + del > 0) {
				var ppcNoEpen = (correct) / (correct + sub + del);
				ppcNoEpen *= 100.0;
			}
			table.setValueAt(row, ppcNoEpenCol, java.lang.Float.valueOf(ppcNoEpen));
		}
	}
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="1186" y="786"/>
            </extensions>
        </node>
        <node id="b5388b855429419c" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1469" y="625">
                    <oga:default for="sectionName" type="java.lang.String">All Participants</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="5559087faeb84cb3" name="Diacritic Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1490" y="926">
                    <oga:default for="sectionName" type="java.lang.String">IPA Patterns</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <link dest="207136ae" destField="obj" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="4820f2b261e74cd8" destField="table" source="556b9255" sourceField="table"/>
        <link dest="4820f2b261e74cd8" destField="parameters" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="52411a13" destField="reportName" source="207136ae" sourceField="value"/>
        <link dest="54db75a0" destField="table" source="4820f2b261e74cd8" sourceField="ppc"/>
        <link dest="b77ef3a25c544205" destField="table" source="4820f2b261e74cd8" sourceField="resultsByPhone"/>
        <link dest="d6eb54e5383f44b7" destField="ppcTableMap" source="54db75a0" sourceField="tableMap"/>
        <link dest="d6eb54e5383f44b7" destField="byPhoneTableMap" source="b77ef3a25c544205" sourceField="tableMap"/>
        <link dest="d6eb54e5383f44b7" destField="collection" source="6b8dfd59" sourceField="obj"/>
        <link dest="b5388b855429419c" destField="parent" source="438ace663bbc4ce9" sourceField="section"/>
        <link dest="999ad56bd34a4e92" destField="table" source="6645a41401ae45e7" sourceField="table"/>
        <link dest="b5388b855429419c" destField="table" source="999ad56bd34a4e92" sourceField="table"/>
        <link dest="438ace663bbc4ce9" destField="parent" source="52411a13" sourceField="root"/>
        <link dest="6645a41401ae45e7" destField="table" source="d6eb54e5383f44b7" sourceField="summaryTable"/>
        <link dest="d6eb54e5383f44b7" destField="summaryTable" source="72b7332f33144273" sourceField="table"/>
        <link dest="d6eb54e5383f44b7" destField="reportSection" source="438ace663bbc4ce9" sourceField="parent"/>
        <link dest="2c2a54ec3c0449c0" destField="table" source="6902fdcf64fb4e1a" sourceField="table"/>
        <link dest="5559087faeb84cb3" destField="table" source="2c2a54ec3c0449c0" sourceField="table"/>
        <link dest="6902fdcf64fb4e1a" destField="table" source="4820f2b261e74cd8" sourceField="resultsByPhone"/>
        <link dest="5559087faeb84cb3" destField="parent" source="b5388b855429419c" sourceField="section"/>
        <link dest="23aa4be6b4214b66" destField="obj" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="72b7332f33144273" destField="includePPCNoEpen" source="23aa4be6b4214b66" sourceField="includePPCNoEpen"/>
        <link dest="999ad56bd34a4e92" destField="includePPCNoEpen" source="23aa4be6b4214b66" sourceField="includePPCNoEpen"/>
        <link dest="d6eb54e5383f44b7" destField="includePPCNoEpen" source="23aa4be6b4214b66" sourceField="includePPCNoEpen"/>
        <link dest="4b473b32" destField="table" source="4820f2b261e74cd8" sourceField="ppc"/>
        <link dest="4b473b32" destField="parent" source="52411a13" sourceField="root"/>
        <link dest="4df37e74" destField="parameters" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="4b473b32" destField="sectionName" source="4df37e74" sourceField="title"/>
        <link dest="4b473b32" destField="enabled" source="d6eb54e5383f44b7" sourceField="finished"/>
        <link dest="5b1f4477" destField="parameters" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="5b1f4477" destField="project" source="1d6fc11b" sourceField="obj"/>
        <link dest="5b1f4477" destField="sessions" source="5e629711" sourceField="obj"/>
        <link dest="556b9255" destField="project" source="5b1f4477" sourceField="project"/>
        <link dest="556b9255" destField="results" source="5b1f4477" sourceField="results"/>
        <link dest="788f7598" destField="parameters" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="556b9255" destField="ignoreDiacritics" source="788f7598" sourceField="ignoreDiacritics"/>
        <link dest="556b9255" destField="onlyOrExcept" source="788f7598" sourceField="onlyOrExcept"/>
        <link dest="556b9255" destField="selectedDiacritics" source="788f7598" sourceField="selectedDiacritics"/>
        <extensions>
            <opqry:nodewizard type="ca.phon.app.opgraph.analysis.AnalysisWizardExtension">
                <opqry:info format="html" title="Percent Phones Correct">
                    <opqry:message/>
                </opqry:info>
                <opqry:node ref="dc4dad38c60648c1" showAsStep="true">
                    <opqry:info format="html" title="Parameters">
                        <opqry:message/>
                    </opqry:info>
                </opqry:node>
            </opqry:nodewizard>
            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
            <oga:notes>
                <oga:note color="0xffff96" height="542" title="Inputs" width="365" x="26" y="11">Default inputs for all Analysis documents</oga:note>
                <oga:note color="0x9696ff" height="536" title="Query and PPC Analysis" width="546" x="405" y="11">Use phones query to define a set of IPA Target+IPA Actual pairs for analysis.</oga:note>
                <oga:note color="0xffff96" height="523" title="Params" width="647" x="27" y="561"/>
                <oga:note color="0x96ff96" height="540" title="PPC Analysis" width="907" x="964" y="13">Run PPC analysis on selected IPA pairs.</oga:note>
                <oga:note color="0xffc864" height="725" title="Report" width="1089" x="690" y="565">Basic report with Summary and Breakdown sections.  Summary contains totals for the PCC columns created in Query stage</oga:note>
            </oga:notes>
        </extensions>
    </graph>
</opgraph>
