<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<opgraph xmlns="https://www.phon.ca/ns/opgraph" xmlns:nes="https://www.phon.ca/ns/node_editor" xmlns:oga="https://www.phon.ca/ns/opgraph-app" xmlns:ogcn="https://www.phon.ca/ns/opgraph-common-nodes" xmlns:opqry="https://phon.ca/ns/opgraph_query" xmlns:qry="http://phon.ling.mun.ca/ns/query">
    <graph id="root">
        <node id="1d6fc11b" name="Project" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey"><![CDATA[_project]]></oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.project.Project]]></oga:property>
                </oga:settings>
                <oga:meta x="45" y="67"/>
            </extensions>
        </node>
        <node id="5e629711" name="Selected Sessions" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey"><![CDATA[_selectedSessions]]></oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.ArrayList]]></oga:property>
                </oga:settings>
                <oga:meta x="45" y="348"/>
            </extensions>
        </node>
        <node id="dc4dad38c60648c1" name="Parameters" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <extensions>
                <oga:settings>
                    <oga:property key="filters.searchBy.searchBy"><![CDATA[Word]]></oga:property>
                    <oga:property key="filters.wordTiers.tiers"><![CDATA[Orthography,IPA Target,IPA Actual]]></oga:property>
                    <oga:property key="filters.ppc.pattern.filter"><![CDATA[\w]]></oga:property>
                    <oga:property key="__script"><![CDATA[var GroupFilter = require("lib/GroupFilter").GroupFilter;
var AlignedGroupFilter = require("lib/TierFilter").TierFilter;
var WordFilter = require("lib/WordFilter").WordFilter;
var TierList = require("lib/TierList").TierList;
var AlignedWordFilter = require("lib/TierFilter").TierFilter;
var PatternFilter = require("lib/PatternFilter").PatternFilter;
var PatternType = require("lib/PatternFilter").PatternType;
var PPC = require("lib/PPC").PPC;
var PPCOptions = require("lib/PPC").PPCOptions;
var ResultType = require("lib/PhonScriptConstants").ResultType;
var SyllableFilter = require("lib/SyllableFilter").SyllableFilter;
var SearchByOptions = require("lib/SearchByOptions").SearchByOptions;


/********************************
 * Setup params
 *******************************/
var filters = {
	"ppc": new PPCOptions("filters.ppc"),
	"searchBy": new SearchByOptions("filters.searchBy"),
	"group": new GroupFilter("filters.group"),
	"groupTiers": new TierList("filters.groupTiers"),
	"groupPattern": new PatternFilter("filters.groupPattern"),
	"alignedGroup": new AlignedGroupFilter("filters.alignedGroup"),
	"word": new WordFilter("filters.word"),
	"wordTiers": new TierList("filters.wordTiers"),
	"wordPattern": new PatternFilter("filters.wordPattern"),
	"alignedWord": new AlignedWordFilter("filters.alignedWord"),
	"syllable": new SyllableFilter("filters.syllable")
};

var reportTitleParamInfo = {
	"id": "reportTitle",
	"title": "Report Title",
	"def": "Percent Phones Correct (PPC)",
	"prompt": "Enter report title"
};
var reportTitleParam;
var reportTitle = reportTitleParamInfo.def;

var combineParticipantsParamInfo = {
	"id": "combineParticipants",
	"title": "Combine results",
	"desc": "Combine results for all selected participants",
	"def": false
};
var combineParticipantsParam;
var combineParticipants = combineParticipantsParamInfo.def;

function setup_params(params) {
	reportTitleParam = new StringScriptParam(
			reportTitleParamInfo.id,
			reportTitleParamInfo.title,
			reportTitleParamInfo.def);
	reportTitleParam.setPrompt(reportTitleParamInfo.prompt);
	params.add(reportTitleParam);

	combineParticipantsParam = new BooleanScriptParam(
		combineParticipantsParamInfo.id,
		combineParticipantsParamInfo.desc,
		combineParticipantsParamInfo.title,
		combineParticipantsParamInfo.def);
	params.add(combineParticipantsParam);

	var optionsSep = new SeparatorScriptParam("Options", false);
	params.add(optionsSep);

	filters.ppc.param_setup(params);
	
	var insertIdx = params.size();

	filters.group.param_setup(params);
	filters.groupPattern.param_setup(params);

	var sep2 = new LabelScriptParam("", "<html><b>Aligned Group Filter</b></html>");
	params.add(sep2);
	filters.alignedGroup.param_setup(params);

	filters.word.searchByWordEnabled = true;
	filters.word.param_setup(params);
	filters.wordPattern.param_setup(params);

	var wordsep2 = new LabelScriptParam("", "<html><b>Aligned Word Filter</b></html>");
	params.add(wordsep2);
	filters.alignedWord.param_setup(params);
	var searchByWordListener = new java.beans.PropertyChangeListener {
		propertyChange: function (e) {
			var enabled = e.source.getValue(e.source.paramId);
			filters.wordPattern.setEnabled(enabled);
			filters.alignedWord.setEnabled(enabled);
			filters.wordTiers.setEnabled(enabled);
		}
	};
	filters.word.searchByWordParam.addPropertyChangeListener(filters.word.searchByWordParam.paramId, searchByWordListener);
	var enabled = filters.word.searchByWordParam.getValue(filters.word.searchByWordParam.paramId);
	filters.wordPattern.setEnabled(enabled);
	filters.alignedWord.setEnabled(enabled);

	filters.syllable.param_setup(params);

	filters.searchBy.includeSyllableOption = true;
	filters.searchBy.param_setup(params, filters.word.searchByWordParam, filters.syllable.searchBySyllableParam, insertIdx);

	var otherDataHeader = new SeparatorScriptParam("otherDataHeader", "Additional Tier Data", true);
	params.add(otherDataHeader);
	var sep = new LabelScriptParam("", "<html><b>Add aligned groups</b></html>");
	params.add(sep);
	filters.groupTiers.param_setup(params);
	var wordsep = new LabelScriptParam("", "<html><b>Add aligned words</b></html>");
	params.add(wordsep);
	filters.wordTiers.param_setup(params);
	filters.wordTiers.setEnabled(enabled);
}]]></oga:property>
                </oga:settings>
                <oga:meta x="68" y="642"/>
            </extensions>
        </node>
        <opqry:queryNode id="5b1f4477" name="Query : Aligned IPA Domains" type="ca.phon.app.opgraph.nodes.query.QueryNode">
            <qry:query xmlns="http://phon.ling.mun.ca/ns/query" date="2021-02-03T10:06:41.526-03:30" name="Aligned IPA Domains" uuid="007c6fbf-f043-40a0-908e-cb30469e00d0">
                <script>
                    <url ref="Aligned IPA Domains" rel="stock"/>
                    <param id="filters.actualResultFilter.filterType">Phonex</param>
                    <param id="filters.alignedGroup.patternFilter.filterType">Plain text</param>
                    <param id="filters.alignedWord.patternFilter.filterType">Plain text</param>
                    <param id="filters.groupPattern.filterType">Plain text</param>
                    <param id="filters.searchBy.searchBy">Word</param>
                    <param id="filters.speaker.age1Comparator">equal to</param>
                    <param id="filters.speaker.age2Comparator">equal to</param>
                    <param id="filters.speaker.ageOperator">(select operator)</param>
                    <param id="filters.speaker.participantRole">(select role)</param>
                    <param id="filters.syllable.otherSyllTypePattern.filterType">Plain text</param>
                    <param id="filters.syllable.syllableType">Any syllable</param>
                    <param id="filters.targetResultFilter.filterType">Phonex</param>
                    <param id="filters.wordPattern.filterType">Plain text</param>
                    <param id="filters.wordTiers.tiers">Orthography,IPA Target,IPA Actual</param>
                    <param id="searchTier">IPA Target</param>
                </script>
            </qry:query>
            <extensions>
                <oga:settings/>
                <oga:meta x="422" y="117"/>
            </extensions>
        </opqry:queryNode>
        <ogcn:macro id="207136ae" name="Get Report Title" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="1e8e1684">
                <node id="1c51967a" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="752" y="525"/>
                    </extensions>
                </node>
                <node id="4af0dd15" type="class:ca.phon.opgraph.nodes.general.TextNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.general.TextNode.text"><![CDATA[reportTitle]]></oga:property>
                        </oga:settings>
                        <oga:meta x="429" y="708"/>
                    </extensions>
                </node>
                <node id="1d741999" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="430" y="615"/>
                    </extensions>
                </node>
                <node id="20106c70" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="621" y="617"/>
                    </extensions>
                </node>
                <node id="613cd7b6" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                        </oga:settings>
                        <oga:meta x="818" y="622"/>
                    </extensions>
                </node>
                <link dest="20106c70" destField="obj" source="1d741999" sourceField="obj"/>
                <link dest="613cd7b6" destField="obj" source="20106c70" sourceField="value"/>
                <link dest="1d741999" destField="obj" source="1c51967a" sourceField="obj"/>
                <link dest="20106c70" destField="arg1" source="4af0dd15" sourceField="value"/>
            </graph>
            <ogcn:published_input field="obj" name="obj" ref="1c51967a"/>
            <ogcn:published_output field="value" name="value" ref="613cd7b6"/>
            <extensions>
                <oga:meta x="372" y="613"/>
            </extensions>
        </ogcn:macro>
        <ogcn:macro id="26c8137d438248e5" name="combineParticipants" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="326db2b">
                <node id="a40e7a48c9fd42cd" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="271" y="993"/>
                    </extensions>
                </node>
                <node id="16549fce921447ee" type="class:ca.phon.opgraph.nodes.general.TextNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.general.TextNode.text"/>
                        </oga:settings>
                        <oga:meta x="482" y="1110"/>
                    </extensions>
                </node>
                <node id="4cae4de40a354a28" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="481" y="1010"/>
                    </extensions>
                </node>
                <node id="dcd50d6c29d74759" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="701" y="1029"/>
                    </extensions>
                </node>
                <node id="212cdf7b82db49bd" name="Object" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                        </oga:settings>
                        <oga:meta x="897" y="1038"/>
                    </extensions>
                </node>
                <node id="6655fb5e2048437a" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                        </oga:settings>
                        <oga:meta x="1089" y="1051"/>
                    </extensions>
                </node>
                <link dest="dcd50d6c29d74759" destField="obj" source="4cae4de40a354a28" sourceField="obj"/>
                <link dest="212cdf7b82db49bd" destField="obj" source="dcd50d6c29d74759" sourceField="value"/>
                <link dest="6655fb5e2048437a" destField="obj" source="212cdf7b82db49bd" sourceField="obj"/>
                <link dest="4cae4de40a354a28" destField="obj" source="a40e7a48c9fd42cd" sourceField="obj"/>
                <link dest="dcd50d6c29d74759" destField="arg1" source="16549fce921447ee" sourceField="value"/>
                <extensions>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <ogcn:published_input field="obj" name="obj" ref="a40e7a48c9fd42cd"/>
            <ogcn:published_input field="format" name="format" ref="16549fce921447ee"/>
            <ogcn:published_output field="obj" name="value" ref="6655fb5e2048437a"/>
            <extensions>
                <oga:meta x="366" y="713">
                    <oga:default for="format" type="java.lang.String">combineParticipants</oga:default>
                </oga:meta>
            </extensions>
        </ogcn:macro>
        <ogcn:macro id="23aa4be6b4214b66" name="includePPCNoEpen" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="2afd890d">
                <node id="31d879b4a5f49ed" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="716" y="666"/>
                    </extensions>
                </node>
                <node id="12d29660d5dd402a" type="class:ca.phon.opgraph.nodes.general.TextNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.general.TextNode.text"><![CDATA[filters.ppc.includePPCNoEpen]]></oga:property>
                        </oga:settings>
                        <oga:meta x="482" y="1110"/>
                    </extensions>
                </node>
                <node id="c1d7cb456130498f" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="481" y="1010"/>
                    </extensions>
                </node>
                <node id="27029aab93324f93" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="701" y="1029"/>
                    </extensions>
                </node>
                <node id="b5160ae421504eef" name="Object" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                        </oga:settings>
                        <oga:meta x="897" y="1038"/>
                    </extensions>
                </node>
                <node id="db67575f263d486e" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                        </oga:settings>
                        <oga:meta x="1089" y="1051"/>
                    </extensions>
                </node>
                <link dest="27029aab93324f93" destField="obj" source="c1d7cb456130498f" sourceField="obj"/>
                <link dest="b5160ae421504eef" destField="obj" source="27029aab93324f93" sourceField="value"/>
                <link dest="db67575f263d486e" destField="obj" source="b5160ae421504eef" sourceField="obj"/>
                <link dest="c1d7cb456130498f" destField="obj" source="31d879b4a5f49ed" sourceField="obj"/>
                <link dest="27029aab93324f93" destField="arg1" source="12d29660d5dd402a" sourceField="value"/>
            </graph>
            <ogcn:published_input field="obj" name="obj" ref="31d879b4a5f49ed"/>
            <ogcn:published_output field="obj" name="includePPCNoEpen" ref="db67575f263d486e"/>
            <extensions>
                <oga:meta x="360" y="819"/>
            </extensions>
        </ogcn:macro>
        <node id="788f7598" name="Extract Diacritic Options" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <output name="ignoreDiacritics" type="java.lang.Boolean"/>
            <output name="onlyOrExcept" type="java.lang.Boolean"/>
            <output name="selectedDiacritics" type="java.util.Collection"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[importClass(Packages.ca.phon.query.script.params.DiacriticOptionsScriptParam)

var diacriticOptionsParamInfo = {
	"id": "filters.ppc.diacriticOptions",
	"desc": "Diacritic Options",
	"def": false,
	"retainDia": new java.util.ArrayList()
};
var diacriticOptionsParam;

var filters = {
	"ppc": {
		"diacriticOptions": {}
	}
};

function setup_params(params) {
	diacriticOptionsParam = new DiacriticOptionsScriptParam(
		diacriticOptionsParamInfo.id,
		diacriticOptionsParamInfo.desc,
		diacriticOptionsParamInfo.def,
		diacriticOptionsParamInfo.retainDia
	);
	params.add(diacriticOptionsParam);	
}

function init(inputs, outputs) {
	outputs.add("ignoreDiacritics", "", false, java.lang.Boolean);
	outputs.add("onlyOrExcept", "", false, java.lang.Boolean);
	outputs.add("selectedDiacritics", "", false, java.util.Collection);
}

function run(context) {
	var ignoreDiacritics = java.lang.Boolean.valueOf(
		filters.ppc.diacriticOptions.ignoreDiacritics || false);
	context.put("ignoreDiacritics", ignoreDiacritics);


	var onlyOrExcept = false;
	if(filters.ppc.diacriticOptions.selectionMode) {
		onlyOrExcept = (filters.ppc.diacriticOptions.selectionMode == "Only");
	}
		
	context.put("onlyOrExcept", onlyOrExcept);

	var selectedDiacritics = filters.ppc.diacriticOptions.selectedDiacritics || new java.util.List();
	context.put("selectedDiacritics", selectedDiacritics);
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="45" y="821"/>
            </extensions>
        </node>
        <node id="4df37e74" name="Get Listing Title" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <output name="title" type="java.lang.String"/>
            <extensions>
                <oga:settings>
                    <oga:property key="filters.syllable.otherSyllTypePattern.filterType"><![CDATA[Plain text]]></oga:property>
                    <oga:property key="filters.syllable.syllableType"><![CDATA[Any syllable]]></oga:property>
                    <oga:property key="__script"><![CDATA[var GroupFilter = require("lib/GroupFilter").GroupFilter;
var WordFilter = require("lib/WordFilter").WordFilter;
var SyllableFilter = require("lib/SyllableFilter").SyllableFilter;

var filters = {
	"group": new GroupFilter("filters.group"),
	"word": new WordFilter("filters.word"),
	"syllable": new SyllableFilter("filters.syllable")
};

function init(intput, outputs) {
	outputs.add("title", "", false, java.lang.String);
}

function setup_params(params) {
	filters.group.param_setup(params);
	filters.word.param_setup(params);
	filters.syllable.param_setup(params);
}

function run(context) {
	var title = "PPC by ";
	var domain = "Group";

	if(filters.syllable.isUseFilter()) {
		domain = "Syllable";
	} else if(filters.word.isUseFilter()) {
		domain = "Word";
	}

	context.put("title", title + domain);
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="355" y="954"/>
            </extensions>
        </node>
        <node id="556b9255" type="class:ca.phon.app.opgraph.nodes.table.ResultsToTableNode">
            <extensions>
                <oga:settings>
                    <oga:property key="includeSessionInfo"><![CDATA[true]]></oga:property>
                    <oga:property key="includeSpeakerInfo"><![CDATA[true]]></oga:property>
                    <oga:property key="includeMetadata"><![CDATA[true]]></oga:property>
                    <oga:property key="includeTierInfo"><![CDATA[true]]></oga:property>
                </oga:settings>
                <oga:meta x="676" y="106"/>
            </extensions>
        </node>
        <node id="2732b358" type="class:ca.phon.app.opgraph.nodes.SelectedParticipantsNode">
            <extensions>
                <oga:meta x="55" y="449"/>
            </extensions>
        </node>
        <node id="72b7332f33144273" name="Setup Summary Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="includePPCNoEpen" optional="false"/>
            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("includePPCNoEpen", "", false, false);
	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = new DefaultTableDataSource();
	var includePPCNoEpen = context.get("includePPCNoEpen");
	
	var col = 0;
	table.setColumnTitle(col++, "Speaker");
	table.setColumnTitle(col++, "# Target");
	table.setColumnTitle(col++, "# Actual");
	table.setColumnTitle(col++, "# Correct");
	table.setColumnTitle(col++, "# Substituted");
	table.setColumnTitle(col++, "# Deleted");
	table.setColumnTitle(col++, "# Epenthesized");
	table.setColumnTitle(col++, "PPC");

	if(includePPCNoEpen == true) {
		table.setColumnTitle(col++, "PPC (NoEpen)");
	}

	context.put("table", table);
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="1171" y="633"/>
            </extensions>
        </node>
        <node id="52411a13" type="class:ca.phon.app.opgraph.nodes.report.NewReportNode">
            <extensions>
                <oga:settings/>
                <oga:meta x="696" y="644"/>
            </extensions>
        </node>
        <node id="68204310" name="Boolean" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                </oga:settings>
                <oga:meta x="1312" y="752"/>
            </extensions>
        </node>
        <node id="4820f2b261e74cd8" name="PPC" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <output name="ppc" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <output name="resultsByPhone" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="filters.ppc.onsetType"><![CDATA[All onsets]]></oga:property>
                    <oga:property key="filters.ppc.nucleusType"><![CDATA[All nuclei]]></oga:property>
                    <oga:property key="filters.ppc.codaType"><![CDATA[All codas]]></oga:property>
                    <oga:property key="filters.ppc.clusterType"><![CDATA[All clusters]]></oga:property>
                    <oga:property key="filters.ppc.ppcType"><![CDATA[Percent phones correct]]></oga:property>
                    <oga:property key="filters.ppc.pattern.filter"><![CDATA[\w]]></oga:property>
                    <oga:property key="__script"><![CDATA[importPackage(Packages.ca.phon.ipa.alignment)

var PPC = require("lib/PPC").PPC;
var PPCOptions = require("lib/PPC").PPCOptions;

var filters = {
	"ppc": new PPCOptions("filters.ppc")
};

function init(inputs, outputs) {
	inputs.add("table", "", false,  false);
	
	outputs.add("ppc", "", false, DefaultTableDataSource);
	outputs.add("resultsByPhone", "", false, DefaultTableDataSource);
}

function setup_params(params) {
	filters.ppc.param_setup(params);
}

function setupColumns(table, inputTable) {
	var col = 0;

	for(var ic = 0; ic < inputTable.columnCount; ic++) {
		table.setColumnTitle(col++, inputTable.getColumnTitle(ic));
	}

	table.setColumnTitle(col++, "# Target");
	table.setColumnTitle(col++, "# Actual");
	table.setColumnTitle(col++, "# Correct");
	table.setColumnTitle(col++, "# Substituted");
	table.setColumnTitle(col++, "# Deleted");
	table.setColumnTitle(col++, "# Epenthesized");
	table.setColumnTitle(col++, "PPC");
}

function copyRow(inputTable, rowIdx) {
	var row = new Array();
	var col = 0;
	for(var cidx = 0; cidx < inputTable.columnCount; cidx++) {
		row[col++] = inputTable.getValueAt(rowIdx, cidx);
	}
	return row;
}

function run(context) {
	var table = context.get("table");

	var ppc = new DefaultTableDataSource();
	var resultsByPhone = new DefaultTableDataSource();
	
	// setup pdc columns
	setupColumns(ppc, table);
	
	var expCol = 0;
	resultsByPhone.setColumnTitle(expCol++, "Session");
	resultsByPhone.setColumnTitle(expCol++, "Date");
	resultsByPhone.setColumnTitle(expCol++, "Speaker");
	resultsByPhone.setColumnTitle(expCol++, "Age");
	resultsByPhone.setColumnTitle(expCol++, "Record #");
	resultsByPhone.setColumnTitle(expCol++, "Group #");
	resultsByPhone.setColumnTitle(expCol++, "IPA Target");
	resultsByPhone.setColumnTitle(expCol++, "IPA Actual");
	resultsByPhone.setColumnTitle(expCol++, "# Correct");
	resultsByPhone.setColumnTitle(expCol++, "# Substituted");
	resultsByPhone.setColumnTitle(expCol++, "# Deleted");
	resultsByPhone.setColumnTitle(expCol++, "# Epenthesized");

	for(var row = 0; row < table.rowCount; row++) {
		var ipaT = table.getValueAt(row, "IPA Target");
		var ipaA = table.getValueAt(row, "IPA Actual");
		var alignment = table.getValueAt(row, "Alignment");

		if(ipaT == null || ipaA == null || alignment == null) continue;
		if(alignment.length() == 0) continue;

		var phoneMap = PhoneMap.fromString(ipaT.audiblePhones(), 
			ipaA.audiblePhones(), alignment);

		var group = {
			getIPATarget: function() { return ipaT; },
			getIPAActual: function() { return ipaA; },
			getPhoneAlignment: function() { return phoneMap; }
		};

		var ppcData = PPC.calc_ppc_aligned(group, filters.ppc.pattern, filters.ppc.diacriticOptions, filters.ppc.ignoreDistortedDiacritic);

		var ppcRow = copyRow(table, row);
		ppcRow.push(ppcData.target);
		ppcRow.push(ppcData.actual);
		ppcRow.push(ppcData.correct);
		ppcRow.push(ppcData.substituted);
		ppcRow.push(ppcData.deleted);
		ppcRow.push(ppcData.epen);

		if(ppcData.correct + ppcData.substituted 
		  + ppcData.deleted + ppcData.epen > 0) {
			var ppcVal = (ppcData.correct) /
				(ppcData.correct + ppcData.substituted 
		 			 + ppcData.deleted + ppcData.epen);
		 	ppcRow.push(java.lang.Float.valueOf(ppcVal * 100.0));
		} else {
			ppcRow.push(java.lang.Float.valueOf(0.0));
		}
		
		ppc.addRow(ppcRow);

		for(var i = 0; i < ppcData.expanded_results.length; i++) {
			var expResult = ppcData.expanded_results[i];
			var expRow = new Array();
			expCol = 0;
			expRow[expCol++] = table.getValueAt(row, "Session");
			expRow[expCol++] = table.getValueAt(row, "Date");
			expRow[expCol++] = table.getValueAt(row, "Speaker");
			expRow[expCol++] = table.getValueAt(row, "Age");
			expRow[expCol++] = table.getValueAt(row, "Record #");
			expRow[expCol++] = table.getValueAt(row, "Group #");
			expRow[expCol++] = (expResult.target >= 0 ? ipaT.elementAt(expResult.target) : new IPATranscript());
			expRow[expCol++] = (expResult.actual >= 0 ? ipaA.elementAt(expResult.actual) : new IPATranscript());
			expRow[expCol++] = expResult.correct;
			expRow[expCol++] = expResult.substituted;
			expRow[expCol++] = expResult.deleted;
			expRow[expCol++] = expResult.epen;

			resultsByPhone.addRow(expRow);
		}
	}

	context.put("ppc", ppc);
	context.put("resultsByPhone", resultsByPhone);
}]]></oga:property>
                </oga:settings>
                <oga:meta x="1031" y="135"/>
            </extensions>
        </node>
        <node id="438ace663bbc4ce9" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
            <extensions>
                <oga:meta x="920" y="632">
                    <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <ogcn:macro id="d6eb54e5383f44b7" type="ca.phon.app.opgraph.nodes.ForEachParticipant">
            <graph id="3064f1e2">
                <node id="17c24bf2343d42c4" name="Current Speaker" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key"><![CDATA[_currentSpeaker]]></oga:property>
                        </oga:settings>
                        <oga:meta x="123" y="52"/>
                    </extensions>
                </node>
                <node id="e1f229bdb204dec" name="Speaker tables" type="class:ca.phon.app.opgraph.nodes.ForEachParticipant$ParticipantTableNode">
                    <output name="_tableExists1" type="java.lang.Boolean">Does Table #1 have data</output>
                    <output name="_speakerTable1" type="ca.phon.query.report.datasource.TableDataSource">Table #1</output>
                    <output name="_tableExists2" type="java.lang.Boolean">Does Table #2 have data</output>
                    <output name="_speakerTable2" type="ca.phon.query.report.datasource.TableDataSource">Table #2</output>
                    <extensions>
                        <oga:meta x="108" y="327"/>
                    </extensions>
                </node>
                <ogcn:macro id="1fdb304153aa4455" name="Report Node" type="ca.phon.opgraph.nodes.reflect.IterableClassNode">
                    <graph id="13678820">
                        <node id="74e89447367042f5" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass"><![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]></oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key"><![CDATA[currentValue]]></oga:property>
                                </oga:settings>
                                <oga:meta x="772" y="535"/>
                            </extensions>
                        </node>
                    </graph>
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.IterableClassNode.className"><![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]></oga:property>
                        </oga:settings>
                        <oga:meta x="124" y="529"/>
                    </extensions>
                </ogcn:macro>
                <node id="407566a6b7484732" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                        </oga:settings>
                        <oga:meta x="154" y="778"/>
                    </extensions>
                </node>
                <node id="296bf6a4e9349fc" name="includePPCNoEpen" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                        </oga:settings>
                        <oga:meta x="156" y="955"/>
                    </extensions>
                </node>
                <node id="cae63d738e6c43a0" name="ignoreDiacritics" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="contextKey"/>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                        </oga:settings>
                        <oga:meta x="160" y="1076"/>
                    </extensions>
                </node>
                <node id="e35d3b8525f94529" name="onlyOrExcept" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="contextKey"/>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                        </oga:settings>
                        <oga:meta x="162" y="1173"/>
                    </extensions>
                </node>
                <node id="221fc4cc" name="selectedDiacritics" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="contextKey"/>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Collection]]></oga:property>
                        </oga:settings>
                        <oga:meta x="164" y="1274"/>
                    </extensions>
                </node>
                <ogcn:macro id="83a128d56baa4161" name="If Speaker Has Results" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="158e2995">
                        <node id="7d6c1937f07b40fc" name="globalSummary" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                </oga:settings>
                                <oga:meta x="28" y="52"/>
                            </extensions>
                        </node>
                        <node id="dd9da81e23db4b02" name="parent" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]></oga:property>
                                </oga:settings>
                                <oga:meta x="28" y="213"/>
                            </extensions>
                        </node>
                        <node id="50fb1814107f4c2f" name="includePPCNoEpen" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                                </oga:settings>
                                <oga:meta x="40" y="438"/>
                            </extensions>
                        </node>
                        <node id="55f1ccf0" name="Participant" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                </oga:settings>
                                <oga:meta x="37" y="524"/>
                            </extensions>
                        </node>
                        <node id="656aaaf" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.TableDataSource]]></oga:property>
                                </oga:settings>
                                <oga:meta x="44" y="822"/>
                            </extensions>
                        </node>
                        <node id="27795750e0874fbe" name="table by phone" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.TableDataSource]]></oga:property>
                                </oga:settings>
                                <oga:meta x="49" y="943"/>
                            </extensions>
                        </node>
                        <node id="2aec03509f7746a4" name="ignoreDiacritics" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="contextKey"/>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                                </oga:settings>
                                <oga:meta x="57" y="1075"/>
                            </extensions>
                        </node>
                        <node id="e393fad1fb07453a" name="onlyOrExcept" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="contextKey"/>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                                </oga:settings>
                                <oga:meta x="59" y="1172"/>
                            </extensions>
                        </node>
                        <node id="eefaa5daea5142ea" name="selectedDiacritics" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="contextKey"/>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Collection]]></oga:property>
                                </oga:settings>
                                <oga:meta x="61" y="1273"/>
                            </extensions>
                        </node>
                        <node id="77fe3d25" name="Participant#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                </oga:settings>
                                <oga:meta x="235" y="547"/>
                            </extensions>
                        </node>
                        <node id="ace5908aa4654763" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                            <extensions>
                                <opqry:inventoryoptions>
                                    <opqry:automaticConfiguration configureAutomatically="false">
                                        <opqry:autoGrouping column="Session" grouping="true"/>
                                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                    </opqry:automaticConfiguration>
                                    <opqry:column caseSensitive="true" column="Session"/>
                                    <opqry:sumColumns>
                                        <opqry:columnName># Target</opqry:columnName>
                                        <opqry:columnName># Actual</opqry:columnName>
                                        <opqry:columnName># Correct</opqry:columnName>
                                        <opqry:columnName># Substituted</opqry:columnName>
                                        <opqry:columnName># Deleted</opqry:columnName>
                                        <opqry:columnName># Epenthesized</opqry:columnName>
                                    </opqry:sumColumns>
                                </opqry:inventoryoptions>
                                <oga:settings/>
                                <oga:meta x="495" y="650"/>
                            </extensions>
                        </node>
                        <node id="5124ae57e7314840" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                            <extensions>
                                <opqry:inventoryoptions>
                                    <opqry:automaticConfiguration configureAutomatically="false">
                                        <opqry:autoGrouping column="Session" grouping="true"/>
                                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                    </opqry:automaticConfiguration>
                                    <opqry:groupBy caseSensitive="true" column="Session"/>
                                    <opqry:column caseSensitive="true" column="IPA Target"/>
                                    <opqry:column caseSensitive="true" column="IPA Actual"/>
                                    <opqry:sumColumns>
                                        <opqry:columnName># Correct</opqry:columnName>
                                        <opqry:columnName># Substituted</opqry:columnName>
                                        <opqry:columnName># Deleted</opqry:columnName>
                                        <opqry:columnName># Epenthesized</opqry:columnName>
                                    </opqry:sumColumns>
                                </opqry:inventoryoptions>
                                <oga:settings/>
                                <oga:meta x="773" y="828"/>
                            </extensions>
                        </node>
                        <node id="d203c2915ad24c30" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                            <extensions>
                                <oga:meta x="869" y="104"/>
                            </extensions>
                        </node>
                        <node id="7e12600f4eed40b9" type="class:ca.phon.app.opgraph.nodes.table.ColumnSumNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="columns"><![CDATA[# Target
# Actual
# Correct
# Substituted
# Deleted
# Epenthesized]]></oga:property>
                                </oga:settings>
                                <oga:meta x="692" y="650"/>
                            </extensions>
                        </node>
                        <node id="962b54af98a84140" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                            <extensions>
                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false" likeOnTop="true">
                                    <opqry:sortBy column="IPA Target" order="ascending" type="ipa"/>
                                    <opqry:sortBy column="IPA Actual" order="ascending" type="ipa"/>
                                </opqry:sortoptions>
                                <oga:settings/>
                                <oga:meta x="969" y="828"/>
                            </extensions>
                        </node>
                        <node id="5298fae2" name="Add PCC Columns" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                            <input name="table" optional="false"/>
                            <input name="includePPCNoEpen" optional="false"/>
                            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("table", "", false, false);
	inputs.add("includePPCNoEpen", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = context.get("table");
	var includePPCNoEpen = context.get("includePPCNoEpen");

	table.setColumnTitle(table.columnCount, "PPC");
	if(includePPCNoEpen == true)
		table.setColumnTitle(table.columnCount, "PPC (NoEpen)");

	for(var row = 0; row < table.rowCount; row++) {
		var correct = table.getValueAt(row, "# Correct").floatValue();
		var sub = table.getValueAt(row, "# Substituted").floatValue();
		var del = table.getValueAt(row, "# Deleted").floatValue();
		var epen = table.getValueAt(row, "# Epenthesized").floatValue();
	
		var ppc = 0.0;
		if(correct + sub + del + epen > 0) {
			ppc = (correct) / (correct + sub + del + epen);
			ppc *= 100.0;
		}
		table.setValueAt(row, table.getColumnIndex("PPC"), ppc);

		if(includePPCNoEpen == true) {
			var ppcNoEpen = 0.0;
			if(correct + sub + del > 0) {
				ppcNoEpen = (correct) / (correct + sub + del);
				ppcNoEpen *= 100.0;
			}
			table.setValueAt(row, table.getColumnIndex("PPC (NoEpen)"), ppcNoEpen);
		}
	}
}
]]></oga:property>
                                </oga:settings>
                                <oga:meta x="950" y="631"/>
                            </extensions>
                        </node>
                        <node id="43ef14dbd6c64822" name="Summary Table" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[false]]></oga:property>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"><![CDATA[Total]]></oga:property>
                                </oga:settings>
                                <oga:meta x="1120" y="107">
                                    <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                                </oga:meta>
                            </extensions>
                        </node>
                        <node id="ff0b0a57f775493d" name="Add to Global Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                            <input name="speaker" optional="false"/>
                            <input name="globalSummary" optional="false"/>
                            <input name="speakerSummary" optional="false"/>
                            <input name="includePPCNoEpen" optional="false"/>
                            <output name="globalSummary" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("speaker", "", false, false);
	inputs.add("globalSummary", "", false, false);
	inputs.add("speakerSummary", "", false, false);
	inputs.add("includePPCNoEpen", "", false, false);

	outputs.add("globalSummary", "", false, DefaultTableDataSource);
}

function run(context) {
	var speaker = context.get("speaker");
	var globalSummary = context.get("globalSummary");
	var speakerSummary = context.get("speakerSummary");
	var includePPCNoEpen = context.get("includePPCNoEpen");
	var speakerRow = speakerSummary.rowCount-1;

	var rowData = [];
	var col = 0;
	rowData[col++] = speaker;
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Target");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Actual");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Correct");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Substituted");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Deleted");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Epenthesized");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "PPC");
	if(includePPCNoEpen == true)
		rowData[col++] = speakerSummary.getValueAt(speakerRow, "PPC (NoEpen)");
	globalSummary.addRow(rowData);
}
]]></oga:property>
                                </oga:settings>
                                <oga:meta x="1493" y="636"/>
                            </extensions>
                        </node>
                        <node id="f16b07572b024d87" name="IPA Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                </oga:settings>
                                <oga:meta x="1371" y="108">
                                    <oga:default for="sectionName" type="java.lang.String">IPA Patterns</oga:default>
                                </oga:meta>
                            </extensions>
                        </node>
                        <link dest="f16b07572b024d87" destField="parent" source="43ef14dbd6c64822" sourceField="parent"/>
                        <link dest="d203c2915ad24c30" destField="parent" source="dd9da81e23db4b02" sourceField="obj"/>
                        <link dest="ff0b0a57f775493d" destField="globalSummary" source="7d6c1937f07b40fc" sourceField="obj"/>
                        <link dest="962b54af98a84140" destField="table" source="5124ae57e7314840" sourceField="table"/>
                        <link dest="43ef14dbd6c64822" destField="parent" source="d203c2915ad24c30" sourceField="section"/>
                        <link dest="f16b07572b024d87" destField="table" source="962b54af98a84140" sourceField="table"/>
                        <link dest="ff0b0a57f775493d" destField="includePPCNoEpen" source="50fb1814107f4c2f" sourceField="obj"/>
                        <link dest="7e12600f4eed40b9" destField="table" source="ace5908aa4654763" sourceField="table"/>
                        <link dest="5298fae2" destField="table" source="7e12600f4eed40b9" sourceField="table"/>
                        <link dest="5298fae2" destField="includePPCNoEpen" source="50fb1814107f4c2f" sourceField="obj"/>
                        <link dest="ff0b0a57f775493d" destField="speakerSummary" source="5298fae2" sourceField="table"/>
                        <link dest="43ef14dbd6c64822" destField="table" source="5298fae2" sourceField="table"/>
                        <link dest="77fe3d25" destField="obj" source="55f1ccf0" sourceField="obj"/>
                        <link dest="d203c2915ad24c30" destField="sectionName" source="77fe3d25" sourceField="value"/>
                        <link dest="ff0b0a57f775493d" destField="speaker" source="55f1ccf0" sourceField="obj"/>
                        <link dest="5124ae57e7314840" destField="table" source="27795750e0874fbe" sourceField="obj"/>
                        <link dest="ace5908aa4654763" destField="table" source="656aaaf" sourceField="obj"/>
                        <link dest="5124ae57e7314840" destField="ignoreDiacritics" source="2aec03509f7746a4" sourceField="obj"/>
                        <link dest="5124ae57e7314840" destField="onlyOrExcept" source="e393fad1fb07453a" sourceField="obj"/>
                        <link dest="5124ae57e7314840" destField="selectedDiacritics" source="eefaa5daea5142ea" sourceField="obj"/>
                        <extensions>
                            <oga:notes>
                                <oga:note color="0xffff96" height="1382" title="Inputs" width="430" x="17" y="12"/>
                                <oga:note color="0xffc864" height="415" title="Report" width="878" x="795" y="26"/>
                                <oga:note color="0xffff96" height="244" title="Note" width="792" x="454" y="771"/>
                            </oga:notes>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="parent" ref="dd9da81e23db4b02"/>
                    <ogcn:published_input field="obj" name="globalSummary" ref="7d6c1937f07b40fc"/>
                    <ogcn:published_input field="obj" name="includePPCNoEpen" ref="50fb1814107f4c2f"/>
                    <ogcn:published_input field="obj" name="speaker" ref="55f1ccf0"/>
                    <ogcn:published_input field="obj" name="table" ref="656aaaf"/>
                    <ogcn:published_input field="obj" name="tableByPhone" ref="27795750e0874fbe"/>
                    <ogcn:published_input field="obj" name="ignoreDiacritics" ref="2aec03509f7746a4"/>
                    <ogcn:published_input field="obj" name="onlyOrExcept" ref="e393fad1fb07453a"/>
                    <ogcn:published_input field="obj" name="selectedDiacritics" ref="eefaa5daea5142ea"/>
                    <extensions>
                        <oga:meta x="845" y="88"/>
                    </extensions>
                </ogcn:macro>
                <node id="338140c381654f16" type="class:ca.phon.opgraph.nodes.logic.LogicalNotNode">
                    <extensions>
                        <oga:meta x="539" y="319"/>
                    </extensions>
                </node>
                <node id="1cd5f59092d04776" name="Global Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                        </oga:settings>
                        <oga:meta x="777" y="813"/>
                    </extensions>
                </node>
                <node id="7e33cb78203e4fde" name="Add to Global Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                    <input name="speaker" optional="false"/>
                    <input name="globalSummary" optional="false"/>
                    <input name="includePPCNoEpen" optional="false"/>
                    <output name="globalSummary" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                    <extensions>
                        <oga:settings>
                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("speaker", "", false, false);
	inputs.add("globalSummary", "", false, false);
	inputs.add("includePPCNoEpen", "", false, false);

	outputs.add("globalSummary", "", false, DefaultTableDataSource);
}

function run(context) {
	var speaker = context.get("speaker");
	var globalSummary = context.get("globalSummary");
	var includePPCNoEpen = context.get("includePPCNoEpen");

	var rowData = [];
	var col = 0;
	rowData[col++] = speaker;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0.0;
	if(includePPCNoEpen == true)
		rowData[col++] = 0.0;
	globalSummary.addRow(rowData);
}
]]></oga:property>
                        </oga:settings>
                        <oga:meta x="817" y="337"/>
                    </extensions>
                </node>
                <link dest="83a128d56baa4161" destField="parent" source="1fdb304153aa4455" sourceField="collection"/>
                <link dest="83a128d56baa4161" destField="globalSummary" source="407566a6b7484732" sourceField="obj"/>
                <link dest="1cd5f59092d04776" destField="obj" source="407566a6b7484732" sourceField="obj"/>
                <link dest="7e33cb78203e4fde" destField="enabled" source="338140c381654f16" sourceField="result"/>
                <link dest="7e33cb78203e4fde" destField="globalSummary" source="407566a6b7484732" sourceField="obj"/>
                <link dest="83a128d56baa4161" destField="includePPCNoEpen" source="296bf6a4e9349fc" sourceField="obj"/>
                <link dest="7e33cb78203e4fde" destField="includePPCNoEpen" source="296bf6a4e9349fc" sourceField="obj"/>
                <link dest="7e33cb78203e4fde" destField="speaker" source="17c24bf2343d42c4" sourceField="obj"/>
                <link dest="338140c381654f16" destField="x" source="e1f229bdb204dec" sourceField="_tableExists1"/>
                <link dest="83a128d56baa4161" destField="enabled" source="e1f229bdb204dec" sourceField="_tableExists1"/>
                <link dest="83a128d56baa4161" destField="speaker" source="17c24bf2343d42c4" sourceField="obj"/>
                <link dest="83a128d56baa4161" destField="table" source="e1f229bdb204dec" sourceField="_speakerTable1"/>
                <link dest="83a128d56baa4161" destField="tableByPhone" source="e1f229bdb204dec" sourceField="_speakerTable2"/>
                <link dest="83a128d56baa4161" destField="ignoreDiacritics" source="cae63d738e6c43a0" sourceField="obj"/>
                <link dest="83a128d56baa4161" destField="onlyOrExcept" source="e35d3b8525f94529" sourceField="obj"/>
                <link dest="83a128d56baa4161" destField="selectedDiacritics" source="221fc4cc" sourceField="obj"/>
                <extensions>
                    <oga:notes>
                        <oga:note color="0xffff96" height="1048" title="Inputs" width="361" x="65" y="464"/>
                        <oga:note color="0xffff96" height="279" title="Outputs" width="304" x="699" y="740"/>
                        <oga:note color="0xffff96" height="450" title="Iteration" width="386" x="67" y="7"/>
                    </oga:notes>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <input name="_inputTable1" optional="true">Input table # 1</input>
            <input name="_inputTable2" optional="true">Input table # 2</input>
            <ogcn:published_input field="collection" name="reportSection" ref="1fdb304153aa4455"/>
            <ogcn:published_input field="obj" name="summaryTable" ref="407566a6b7484732"/>
            <ogcn:published_input field="obj" name="includePPCNoEpen" ref="296bf6a4e9349fc"/>
            <ogcn:published_input field="obj" name="ignoreDiacritics" ref="cae63d738e6c43a0"/>
            <ogcn:published_input field="obj" name="onlyOrExcept" ref="e35d3b8525f94529"/>
            <ogcn:published_input field="obj" name="selectedDiacritics" ref="221fc4cc"/>
            <ogcn:published_output field="obj" name="summaryTable" ref="1cd5f59092d04776"/>
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.ForEachParticipant.numTables"><![CDATA[2]]></oga:property>
                </oga:settings>
                <oga:meta x="1537" y="163"/>
            </extensions>
        </ogcn:macro>
        <node id="6902fdcf64fb4e1a" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
            <extensions>
                <opqry:inventoryoptions>
                    <opqry:automaticConfiguration configureAutomatically="false">
                        <opqry:autoGrouping column="Session" grouping="true"/>
                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                    </opqry:automaticConfiguration>
                    <opqry:groupBy caseSensitive="true" column="Session"/>
                    <opqry:column caseSensitive="true" column="IPA Target"/>
                    <opqry:column caseSensitive="true" column="IPA Actual"/>
                    <opqry:sumColumns>
                        <opqry:columnName># Correct</opqry:columnName>
                        <opqry:columnName># Substituted</opqry:columnName>
                        <opqry:columnName># Deleted</opqry:columnName>
                        <opqry:columnName># Epenthesized</opqry:columnName>
                    </opqry:sumColumns>
                </opqry:inventoryoptions>
                <oga:settings/>
                <oga:meta x="937" y="938"/>
            </extensions>
        </node>
        <node id="6645a41401ae45e7" type="class:ca.phon.app.opgraph.nodes.table.ColumnSumNode">
            <extensions>
                <oga:settings>
                    <oga:property key="columns"><![CDATA[# Target
# Actual
# Correct
# Substituted
# Deleted
# Epenthesized]]></oga:property>
                </oga:settings>
                <oga:meta x="987" y="781"/>
            </extensions>
        </node>
        <node id="2c2a54ec3c0449c0" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
            <extensions>
                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false" likeOnTop="true">
                    <opqry:sortBy column="IPA Target" order="ascending" type="ipa"/>
                    <opqry:sortBy column="IPA Actual" order="ascending" type="ipa"/>
                </opqry:sortoptions>
                <oga:settings/>
                <oga:meta x="1244" y="938"/>
            </extensions>
        </node>
        <node id="4b473b32" name="Listing" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[false]]></oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"><![CDATA[Date
Tier
Range
Result
Alignment]]></oga:property>
                </oga:settings>
                <oga:meta x="942" y="1089">
                    <oga:default for="sectionName" type="java.lang.String">Listing</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="999ad56bd34a4e92" name="Calc PPC" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <input name="includePPCNoEpen" optional="false"/>
            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("table", "", false, false);
	inputs.add("includePPCNoEpen", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = context.get("table");
	var row = table.rowCount -1;
	var includePPCNoEpen = context.get("includePPCNoEpen");
	
	if(row >= 0) {
		var correct = table.getValueAt(row, "# Correct");
		var sub = table.getValueAt(row, "# Substituted");
		var del = table.getValueAt(row, "# Deleted");
		var epen = table.getValueAt(row, "# Epenthesized");

		var ppcCol = table.getColumnIndex("PPC");

		var ppc = 0.0;
		if(correct + sub + del + epen > 0) {
			var ppc = (correct) / (correct + sub + del + epen);
			ppc *= 100.0;
		}
		table.setValueAt(row, ppcCol, java.lang.Float.valueOf(ppc));

		if(includePPCNoEpen == true) {
			var ppcNoEpen = 0.0;
			var ppcNoEpenCol = table.getColumnIndex("PPC (NoEpen)");

			if(correct + sub + del > 0) {
				var ppcNoEpen = (correct) / (correct + sub + del);
				ppcNoEpen *= 100.0;
			}
			table.setValueAt(row, ppcNoEpenCol, java.lang.Float.valueOf(ppcNoEpen));
		}
	}
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="1186" y="786"/>
            </extensions>
        </node>
        <node id="b5388b855429419c" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1469" y="625">
                    <oga:default for="sectionName" type="java.lang.String">All Participants</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="5559087faeb84cb3" name="Diacritic Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1490" y="926">
                    <oga:default for="sectionName" type="java.lang.String">IPA Patterns</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <link dest="207136ae" destField="obj" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="4820f2b261e74cd8" destField="table" source="556b9255" sourceField="table"/>
        <link dest="4820f2b261e74cd8" destField="parameters" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="52411a13" destField="reportName" source="207136ae" sourceField="value"/>
        <link dest="b5388b855429419c" destField="parent" source="438ace663bbc4ce9" sourceField="section"/>
        <link dest="999ad56bd34a4e92" destField="table" source="6645a41401ae45e7" sourceField="table"/>
        <link dest="b5388b855429419c" destField="table" source="999ad56bd34a4e92" sourceField="table"/>
        <link dest="438ace663bbc4ce9" destField="parent" source="52411a13" sourceField="root"/>
        <link dest="6645a41401ae45e7" destField="table" source="d6eb54e5383f44b7" sourceField="summaryTable"/>
        <link dest="d6eb54e5383f44b7" destField="summaryTable" source="72b7332f33144273" sourceField="table"/>
        <link dest="d6eb54e5383f44b7" destField="reportSection" source="438ace663bbc4ce9" sourceField="parent"/>
        <link dest="2c2a54ec3c0449c0" destField="table" source="6902fdcf64fb4e1a" sourceField="table"/>
        <link dest="5559087faeb84cb3" destField="table" source="2c2a54ec3c0449c0" sourceField="table"/>
        <link dest="6902fdcf64fb4e1a" destField="table" source="4820f2b261e74cd8" sourceField="resultsByPhone"/>
        <link dest="5559087faeb84cb3" destField="parent" source="b5388b855429419c" sourceField="section"/>
        <link dest="23aa4be6b4214b66" destField="obj" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="72b7332f33144273" destField="includePPCNoEpen" source="23aa4be6b4214b66" sourceField="includePPCNoEpen"/>
        <link dest="999ad56bd34a4e92" destField="includePPCNoEpen" source="23aa4be6b4214b66" sourceField="includePPCNoEpen"/>
        <link dest="d6eb54e5383f44b7" destField="includePPCNoEpen" source="23aa4be6b4214b66" sourceField="includePPCNoEpen"/>
        <link dest="4b473b32" destField="table" source="4820f2b261e74cd8" sourceField="ppc"/>
        <link dest="4b473b32" destField="parent" source="52411a13" sourceField="root"/>
        <link dest="4df37e74" destField="parameters" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="4b473b32" destField="sectionName" source="4df37e74" sourceField="title"/>
        <link dest="4b473b32" destField="enabled" source="d6eb54e5383f44b7" sourceField="finished"/>
        <link dest="5b1f4477" destField="parameters" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="5b1f4477" destField="project" source="1d6fc11b" sourceField="obj"/>
        <link dest="5b1f4477" destField="sessions" source="5e629711" sourceField="obj"/>
        <link dest="556b9255" destField="project" source="5b1f4477" sourceField="project"/>
        <link dest="556b9255" destField="results" source="5b1f4477" sourceField="results"/>
        <link dest="788f7598" destField="parameters" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="26c8137d438248e5" destField="obj" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="2732b358" destField="combine" source="26c8137d438248e5" sourceField="value"/>
        <link dest="d6eb54e5383f44b7" destField="participants" source="2732b358" sourceField="participants"/>
        <link dest="d6eb54e5383f44b7" destField="_inputTable1" source="4820f2b261e74cd8" sourceField="ppc"/>
        <link dest="d6eb54e5383f44b7" destField="_inputTable2" source="4820f2b261e74cd8" sourceField="resultsByPhone"/>
        <link dest="6902fdcf64fb4e1a" destField="ignoreDiacritics" source="788f7598" sourceField="ignoreDiacritics"/>
        <link dest="6902fdcf64fb4e1a" destField="onlyOrExcept" source="788f7598" sourceField="onlyOrExcept"/>
        <link dest="6902fdcf64fb4e1a" destField="selectedDiacritics" source="788f7598" sourceField="selectedDiacritics"/>
        <link dest="68204310" destField="obj" source="788f7598" sourceField="ignoreDiacritics"/>
        <link dest="d6eb54e5383f44b7" destField="ignoreDiacritics" source="788f7598" sourceField="ignoreDiacritics"/>
        <link dest="d6eb54e5383f44b7" destField="onlyOrExcept" source="788f7598" sourceField="onlyOrExcept"/>
        <link dest="d6eb54e5383f44b7" destField="selectedDiacritics" source="788f7598" sourceField="selectedDiacritics"/>
        <extensions>
            <opqry:nodewizard type="ca.phon.app.opgraph.analysis.AnalysisWizardExtension">
                <opqry:info format="html" title="Percent Phones Correct">
                    <opqry:message/>
                </opqry:info>
                <opqry:node ref="dc4dad38c60648c1" showAsStep="true">
                    <opqry:info format="html" title="Parameters">
                        <opqry:message/>
                    </opqry:info>
                </opqry:node>
            </opqry:nodewizard>
            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
            <oga:notes>
                <oga:note color="0xffff96" height="542" title="Inputs" width="365" x="26" y="11">Default inputs for all Analysis documents</oga:note>
                <oga:note color="0x9696ff" height="536" title="Query and PPC Analysis" width="546" x="405" y="11">Use phones query to define a set of IPA Target+IPA Actual pairs for analysis.</oga:note>
                <oga:note color="0xffff96" height="523" title="Params" width="647" x="27" y="561"/>
                <oga:note color="0x96ff96" height="540" title="PPC Analysis" width="907" x="964" y="13">Run PPC analysis on selected IPA pairs.</oga:note>
                <oga:note color="0xffc864" height="725" title="Report" width="1089" x="690" y="565">Basic report with Summary and Breakdown sections.  Summary contains totals for the PCC columns created in Query stage</oga:note>
            </oga:notes>
        </extensions>
    </graph>
</opgraph>
