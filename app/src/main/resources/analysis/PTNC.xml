<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<opgraph xmlns="https://www.phon.ca/ns/opgraph" xmlns:nes="https://www.phon.ca/ns/node_editor" xmlns:oga="https://www.phon.ca/ns/opgraph-app" xmlns:ogcn="https://www.phon.ca/ns/opgraph-common-nodes" xmlns:opqry="https://phon.ca/ns/opgraph_query" xmlns:qry="http://phon.ling.mun.ca/ns/query">
    <graph id="root">
        <node id="7328a40688194f0f" name="Project" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_project]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[ca.phon.project.Project]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="20" y="60"/>
            </extensions>
        </node>
        <node id="23502a3bdf76403f" name="Selected Sessions" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_selectedSessions]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="20" y="341"/>
            </extensions>
        </node>
        <node id="6933cb7db3c14099" name="Selected Participants" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_selectedParticipants]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="20" y="442"/>
            </extensions>
        </node>
        <node id="41c2d52c05f54592" name="Parameters" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <extensions>
                <oga:settings>
                    <oga:property key="reportTitle">
                        <![CDATA[Percent Tone Numbers Correct (PTNC)]]>
                    </oga:property>
                    <oga:property key="__script">
                        <![CDATA[var reportTitleParamInfo = {
	"id": "reportTitle",
	"title": "Report Title",
	"def": "Report",
	"prompt": "Enter report title"
};
var reportTitleParam;
var reportTitle = reportTitleParamInfo.def;

function setup_params(params) {
	reportTitleParam = new StringScriptParam(
			reportTitleParamInfo.id,
			reportTitleParamInfo.title,
			reportTitleParamInfo.def);
     reportTitleParam.setPrompt(reportTitleParamInfo.prompt);
	params.add(reportTitleParam);
}
]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="21" y="624"/>
            </extensions>
        </node>
        <opqry:queryNode id="5ef5f16b" name="Query : PTNC" type="ca.phon.app.opgraph.nodes.query.QueryNode">
            <qry:query xmlns="http://phon.ling.mun.ca/ns/query" date="2020-07-14T12:21:22.918-02:30" name="PTNC" uuid="a4ff16a3-a125-4bb2-920e-93bbcf9460a0">
                <script>
                    <url ref="PTNC" rel="stock"/>
                    <param id="filters.alignedGroup.patternFilter.filterType">Plain text</param>
                    <param id="filters.alignedWord.patternFilter.filterType">Plain text</param>
                    <param id="filters.groupPattern.filterType">Plain text</param>
                    <param id="filters.searchBy.searchBy">Word</param>
                    <param id="filters.speaker.age1Comparator">equal to</param>
                    <param id="filters.speaker.age2Comparator">equal to</param>
                    <param id="filters.speaker.ageOperator">(select operator)</param>
                    <param id="filters.speaker.participantRole">(select role)</param>
                    <param id="filters.syllable.otherSyllTypePattern.filterType">Plain text</param>
                    <param id="filters.syllable.syllableType">Any syllable</param>
                    <param id="filters.word.sectionHeader.collapsed">false</param>
                    <param id="filters.wordPattern.filterType">Plain text</param>
                    <param id="filters.wordTiers.tiers">Target Syllabification, Actual Syllabification, Alignment</param>
                </script>
            </qry:query>
            <extensions>
                <oga:settings/>
                <oga:meta x="423" y="132"/>
            </extensions>
        </opqry:queryNode>
        <ogcn:macro id="7486fc0611ca4abb" name="Get Report Title" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="5a979a58">
                <node id="a9eac15f05d9404a" name="String#&lt;init&gt;(String)" type="class:ca.phon.opgraph.nodes.reflect.ConstructorNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.classMember">
                                <![CDATA[<init>(java.lang.String)]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.declaredClass">
                                <![CDATA[java.lang.String]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="15" y="15">
                            <oga:default for="arg1" type="java.lang.String">reportTitle</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="de9b7e61072844f3" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[get(java.lang.Object)]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.util.Map]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="215" y="15"/>
                    </extensions>
                </node>
                <node id="1771c90d512d494f" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[toString()]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="392" y="15"/>
                    </extensions>
                </node>
                <link dest="de9b7e61072844f3" destField="arg1" source="a9eac15f05d9404a" sourceField="value"/>
                <link dest="1771c90d512d494f" destField="obj" source="de9b7e61072844f3" sourceField="value"/>
            </graph>
            <ogcn:published_input field="obj" name="parameters" ref="de9b7e61072844f3"/>
            <ogcn:published_output field="value" name="reportTitle" ref="1771c90d512d494f"/>
            <extensions>
                <oga:meta x="258" y="624"/>
            </extensions>
        </ogcn:macro>
        <node id="4d1cdaa729e34875" type="class:ca.phon.app.opgraph.nodes.table.ResultsToTableNode">
            <extensions>
                <oga:settings>
                    <oga:property key="includeSessionInfo">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeSpeakerInfo">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeMetadata">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeTierInfo">
                        <![CDATA[true]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="723" y="118"/>
            </extensions>
        </node>
        <node id="ad540f2c84c343cc" type="class:ca.phon.app.opgraph.nodes.report.NewReportNode">
            <extensions>
                <oga:settings/>
                <oga:meta x="503" y="606"/>
            </extensions>
        </node>
        <node id="5bf1378b" name="Shape Data" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <output name="sylltable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script">
                        <![CDATA[
importPackage(Packages.ca.phon.ipa.alignment)
importClass(Packages.ca.phon.syllable.SyllabificationInfo)

function init(inputs, outputs) {
	inputs.add("table", "", false, false);

	outputs.add("sylltable", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = context.get("table");

	var sylltable = new DefaultTableDataSource();
	context.put("sylltable", sylltable);
	var col = 0;
	sylltable.setColumnTitle(col++, "Session");
	sylltable.setColumnTitle(col++, "Speaker");
	sylltable.setColumnTitle(col++, "Age");
	sylltable.setColumnTitle(col++, "IPA Target");
	sylltable.setColumnTitle(col++, "IPA Actual");
	sylltable.setColumnTitle(col++, "# Target");
	sylltable.setColumnTitle(col++, "# Actual");
	sylltable.setColumnTitle(col++, "Syllables deleted");
	sylltable.setColumnTitle(col++, "Syllables epenthesized");
	sylltable.setColumnTitle(col++, "# Correct");
	sylltable.setColumnTitle(col++, "# Substituted");
	sylltable.setColumnTitle(col++, "# Deleted");
	sylltable.setColumnTitle(col++, "Target Tone Number");
	sylltable.setColumnTitle(col++, "Actual Tone Number");
	
	var syllableAligner = new SyllableAligner();

	for(var row = 0; row < table.rowCount; row++) {
		var targetData = table.getValueAt(row, "Target Syllabification (Word)");
		var actualData = table.getValueAt(row, "Actual Syllabification (Word)");
		var alignmentData = table.getValueAt(row, "Alignment (Word)");

		var ipaT = IPATranscript.parseIPATranscript(targetData);
		SyllabificationInfo.setupSyllabificationInfo(ipaT);
		var ipaA = IPATranscript.parseIPATranscript(actualData);
		SyllabificationInfo.setupSyllabificationInfo(ipaA);
		var alignment = PhoneMap.fromString(ipaT, ipaA, alignmentData);
		var syllAlignment = syllableAligner.calculateSyllableAlignment(ipaT, ipaA, alignment);

		for(var alignIdx = 0; alignIdx < syllAlignment.alignmentLength; alignIdx++) {
			var alignedEles = syllAlignment.getAlignedElements(alignIdx);

			var targetSyll = alignedEles.get(0);
			var targetToneNumber = (targetSyll != null && targetSyll.length() > 0 ? 
				targetSyll.elementAt(0).getExtension(SyllabificationInfo).toneNumber : new java.lang.String());
			var actualSyll = alignedEles.get(1);
			var actualToneNumber = (actualSyll != null && actualSyll.length() > 0 ? 
				actualSyll.elementAt(0).getExtension(SyllabificationInfo).toneNumber : new java.lang.String());
			
			// create row
			var rowData = [];
			col = 0;
			rowData[col++] = table.getValueAt(row, "Session");
			rowData[col++] = table.getValueAt(row, "Speaker");
			rowData[col++] = table.getValueAt(row, "Age");
			rowData[col++] = targetSyll;
			rowData[col++] = actualSyll;
			rowData[col++] = (targetSyll == null ? 0 : 1);
			rowData[col++] = (actualSyll == null ? 0 : 1);
			rowData[col++] = (actualSyll == null ? 1 : 0);
			rowData[col++] = (targetSyll == null ? 1 : 0);
			rowData[col++] = (targetToneNumber.equals(actualToneNumber) ? 1 : 0);
			rowData[col++] = (targetToneNumber.length() > 0 && actualToneNumber.length() > 0 && !targetToneNumber.equals(actualToneNumber) ? 1 : 0);
			rowData[col++] = (targetToneNumber.length() > 0 && actualToneNumber.length() == 0 ? 1 : 0);
			rowData[col++] = targetToneNumber;
			rowData[col++] = actualToneNumber;
			sylltable.addRow(rowData);
		}
	}
}
]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="155" y="906"/>
            </extensions>
        </node>
        <node id="74498387" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
            <extensions>
                <oga:settings>
                    <oga:property key="__scriptName">
                        <![CDATA[Split Table]]>
                    </oga:property>
                    <oga:property key="columnName">
                        <![CDATA[Speaker]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="1054" y="953"/>
            </extensions>
        </node>
        <node id="5ea2047e" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
            <extensions>
                <opqry:inventoryoptions>
                    <opqry:automaticConfiguration configureAutomatically="false">
                        <opqry:autoGrouping column="Session" grouping="true"/>
                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                    </opqry:automaticConfiguration>
                    <opqry:column caseSensitive="true" column="Target Tone Number"/>
                    <opqry:column caseSensitive="true" column="Actual Tone Number"/>
                    <opqry:sumColumns>
                        <opqry:columnName># Correct</opqry:columnName>
                        <opqry:columnName># Substituted</opqry:columnName>
                        <opqry:columnName># Deleted</opqry:columnName>
                    </opqry:sumColumns>
                </opqry:inventoryoptions>
                <oga:settings/>
                <oga:meta x="841" y="799"/>
            </extensions>
        </node>
        <node id="e610bf8b98aa4f44" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
            <extensions>
                <oga:settings>
                    <oga:property key="__scriptName">
                        <![CDATA[Split Table]]>
                    </oga:property>
                    <oga:property key="columnName">
                        <![CDATA[Speaker]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="1058" y="1113"/>
            </extensions>
        </node>
        <node id="60e2578b" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
            <extensions>
                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="true">
                    <opqry:sortBy column="Target Tone Number" order="ascending" type="plain"/>
                    <opqry:sortBy column="Actual Tone Number" order="ascending" type="plain"/>
                </opqry:sortoptions>
                <oga:settings/>
                <oga:meta x="1045" y="825"/>
            </extensions>
        </node>
        <ogcn:macro id="681a6fc6" name="For Each Participant" type="ca.phon.opgraph.nodes.reflect.IterableClassNode">
            <graph id="383ea3fd">
                <node id="4b83622d" name="Current Speaker" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key">
                                <![CDATA[currentValue]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="20" y="23"/>
                    </extensions>
                </node>
                <node id="7a41c15384344645" name="Table Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[java.util.Map]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="55" y="179"/>
                    </extensions>
                </node>
                <ogcn:macro id="5c65cf0e7c264777" name="Report Node" type="ca.phon.opgraph.nodes.reflect.IterableClassNode">
                    <graph id="54e3af0e">
                        <node id="add1c2eb853b4d81" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass">
                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                    </oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key">
                                        <![CDATA[currentValue]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="772" y="535"/>
                            </extensions>
                        </node>
                    </graph>
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.IterableClassNode.className">
                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="46" y="356"/>
                    </extensions>
                </ogcn:macro>
                <node id="c51cf5f706bb41b7" name="Syllable Table Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[java.util.Map]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="43" y="603"/>
                    </extensions>
                </node>
                <ogcn:macro id="23fca464" name="Get Table For Speaker" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="4980311b">
                        <node id="7e546470" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="132" y="116"/>
                            </extensions>
                        </node>
                        <node id="4b37db7" name="arg1" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.lang.Object]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="129" y="241"/>
                            </extensions>
                        </node>
                        <node id="42bc12ef" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="452" y="143"/>
                            </extensions>
                        </node>
                        <node id="250d626c" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                        <![CDATA[get(java.lang.Object)]]>
                                    </oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="656" y="139"/>
                            </extensions>
                        </node>
                        <node id="46b8e48f" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="874" y="148"/>
                            </extensions>
                        </node>
                        <link dest="250d626c" destField="arg1" source="4b37db7" sourceField="obj"/>
                        <link dest="42bc12ef" destField="obj" source="7e546470" sourceField="obj"/>
                        <link dest="46b8e48f" destField="obj" source="250d626c" sourceField="value"/>
                        <link dest="250d626c" destField="obj" source="42bc12ef" sourceField="obj"/>
                        <extensions>
                            <oga:notes>
                                <oga:note color="0xffff96" height="351" title="Inputs" width="340" x="47" y="55"/>
                            </oga:notes>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="speaker" ref="4b37db7"/>
                    <ogcn:published_input field="obj" name="tableMap" ref="7e546470"/>
                    <ogcn:published_output field="obj" name="table" ref="46b8e48f"/>
                    <extensions>
                        <oga:meta x="471" y="192"/>
                    </extensions>
                </ogcn:macro>
                <ogcn:macro id="83ec2af6d61241e9" name="Get Table For Speaker" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="4183a1d0">
                        <node id="a305e397b0e648ed" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="132" y="116"/>
                            </extensions>
                        </node>
                        <node id="7a8cb41752f4d80" name="arg1" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.lang.Object]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="129" y="241"/>
                            </extensions>
                        </node>
                        <node id="112698cacefd4ba6" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="452" y="143"/>
                            </extensions>
                        </node>
                        <node id="5dcba57e8eed449f" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                        <![CDATA[get(java.lang.Object)]]>
                                    </oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="656" y="139"/>
                            </extensions>
                        </node>
                        <node id="bd8d3812cede4ce1" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="874" y="148"/>
                            </extensions>
                        </node>
                        <link dest="5dcba57e8eed449f" destField="arg1" source="7a8cb41752f4d80" sourceField="obj"/>
                        <link dest="112698cacefd4ba6" destField="obj" source="a305e397b0e648ed" sourceField="obj"/>
                        <link dest="bd8d3812cede4ce1" destField="obj" source="5dcba57e8eed449f" sourceField="value"/>
                        <link dest="5dcba57e8eed449f" destField="obj" source="112698cacefd4ba6" sourceField="obj"/>
                        <extensions>
                            <oga:notes>
                                <oga:note color="0xffff96" height="351" title="Inputs" width="340" x="47" y="55"/>
                            </oga:notes>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="speaker" ref="7a8cb41752f4d80"/>
                    <ogcn:published_input field="obj" name="tableMap" ref="a305e397b0e648ed"/>
                    <ogcn:published_output field="obj" name="table" ref="bd8d3812cede4ce1"/>
                    <extensions>
                        <oga:meta x="468" y="330"/>
                    </extensions>
                </ogcn:macro>
                <node id="736fc054" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[toString()]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="474" y="664"/>
                    </extensions>
                </node>
                <node id="7bd212c6" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                    <extensions>
                        <opqry:inventoryoptions>
                            <opqry:automaticConfiguration configureAutomatically="false">
                                <opqry:autoGrouping column="Session" grouping="true"/>
                                <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                            </opqry:automaticConfiguration>
                            <opqry:column caseSensitive="true" column="Session"/>
                            <opqry:sumColumns>
                                <opqry:columnName># Target</opqry:columnName>
                                <opqry:columnName># Actual</opqry:columnName>
                                <opqry:columnName>Syllables deleted</opqry:columnName>
                                <opqry:columnName>Syllables epenthesized</opqry:columnName>
                                <opqry:columnName># Correct</opqry:columnName>
                                <opqry:columnName># Substituted</opqry:columnName>
                                <opqry:columnName># Deleted</opqry:columnName>
                            </opqry:sumColumns>
                        </opqry:inventoryoptions>
                        <oga:settings/>
                        <oga:meta x="847" y="203"/>
                    </extensions>
                </node>
                <node id="3443622b797849b7" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                    <extensions>
                        <opqry:inventoryoptions>
                            <opqry:automaticConfiguration configureAutomatically="false">
                                <opqry:autoGrouping column="Session" grouping="true"/>
                                <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                            </opqry:automaticConfiguration>
                            <opqry:column caseSensitive="true" column="Target Tone Number"/>
                            <opqry:column caseSensitive="true" column="Actual Tone Number"/>
                            <opqry:sumColumns>
                                <opqry:columnName># Correct</opqry:columnName>
                                <opqry:columnName># Substituted</opqry:columnName>
                                <opqry:columnName># Deleted</opqry:columnName>
                            </opqry:sumColumns>
                        </opqry:inventoryoptions>
                        <oga:settings/>
                        <oga:meta x="721" y="365"/>
                    </extensions>
                </node>
                <node id="b84815bcd13f4c94" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                    <extensions>
                        <opqry:inventoryoptions>
                            <opqry:automaticConfiguration configureAutomatically="false">
                                <opqry:autoGrouping column="Session" grouping="true"/>
                                <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                            </opqry:automaticConfiguration>
                            <opqry:column caseSensitive="true" column="IPA Target"/>
                            <opqry:column caseSensitive="true" column="IPA Actual"/>
                            <opqry:sumColumns>
                                <opqry:columnName># Correct</opqry:columnName>
                                <opqry:columnName># Substituted</opqry:columnName>
                                <opqry:columnName># Deleted</opqry:columnName>
                            </opqry:sumColumns>
                        </opqry:inventoryoptions>
                        <oga:settings/>
                        <oga:meta x="723" y="477"/>
                    </extensions>
                </node>
                <node id="6ffb9b04" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                    <extensions>
                        <oga:meta x="698" y="658"/>
                    </extensions>
                </node>
                <node id="6f90f2bf" type="class:ca.phon.app.opgraph.nodes.table.ColumnSumNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="columns">
                                <![CDATA[# Target
# Actual
Syllables deleted
Syllables epenthesized
# Correct
# Substituted
# Deleted]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="1101" y="237"/>
                    </extensions>
                </node>
                <node id="b8b37e891bb64ef9" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                    <extensions>
                        <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="true">
                            <opqry:sortBy column="Target Tone Number" order="ascending" type="plain"/>
                            <opqry:sortBy column="Actual Tone Number" order="ascending" type="plain"/>
                        </opqry:sortoptions>
                        <oga:settings/>
                        <oga:meta x="925" y="391"/>
                    </extensions>
                </node>
                <node id="d481721e32ec4da7" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                    <extensions>
                        <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="true">
                            <opqry:sortBy column="Target Tone Number" order="ascending" type="plain"/>
                            <opqry:sortBy column="Actual Tone Number" order="ascending" type="plain"/>
                        </opqry:sortoptions>
                        <oga:settings/>
                        <oga:meta x="927" y="503"/>
                    </extensions>
                </node>
                <node id="eba11963e9784475" type="class:ca.phon.app.opgraph.nodes.table.AddColumnNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="column">
                                <![CDATA[PTNC]]>
                            </oga:property>
                            <oga:property key="columnIndex">
                                <![CDATA[-1]]>
                            </oga:property>
                            <oga:property key="__script">
                                <![CDATA[/*
params = {label, "Add a new column to the input table using javascript.", "<html><b>Add column to table</b></html>"}
;
*/

function getRowValue(table, row) {
	var correct = table.getValueAt(row, "# Correct").floatValue();
	var sub = table.getValueAt(row, "# Substituted").floatValue();
	var del = table.getValueAt(row, "# Deleted").floatValue();

	var ptnc = (correct) / (correct + sub + del);
	ptnc *= 100.0;
	return java.lang.Float.valueOf(ptnc);
}
]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="1302" y="242"/>
                    </extensions>
                </node>
                <node id="1e6465f7" name="Summary Table" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[false]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                <![CDATA[Total]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="985" y="659">
                            <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="f4ef58cc84464f9a" name="IPA Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                        </oga:settings>
                        <oga:meta x="984" y="825">
                            <oga:default for="sectionName" type="java.lang.String">IPA Patterns</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="523a2f07" name="Tonal Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                        </oga:settings>
                        <oga:meta x="979" y="988">
                            <oga:default for="sectionName" type="java.lang.String">Tonal Patterns</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="663e007e" name="LIsting (by word)" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[false]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                <![CDATA[Date
Speaker
Tier
Range
Result
Target Syllabification (Word)
Actual Syllabification (Word)
Alignment (Word)]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="994" y="1169">
                            <oga:default for="sectionName" type="java.lang.String">Listing</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <link dest="23fca464" destField="speaker" source="4b83622d" sourceField="obj"/>
                <link dest="23fca464" destField="tableMap" source="7a41c15384344645" sourceField="obj"/>
                <link dest="736fc054" destField="obj" source="4b83622d" sourceField="obj"/>
                <link dest="6ffb9b04" destField="sectionName" source="736fc054" sourceField="value"/>
                <link dest="1e6465f7" destField="parent" source="6ffb9b04" sourceField="section"/>
                <link dest="7bd212c6" destField="table" source="23fca464" sourceField="table"/>
                <link dest="663e007e" destField="table" source="23fca464" sourceField="table"/>
                <link dest="6ffb9b04" destField="parent" source="5c65cf0e7c264777" sourceField="collection"/>
                <link dest="b8b37e891bb64ef9" destField="table" source="3443622b797849b7" sourceField="table"/>
                <link dest="3443622b797849b7" destField="table" source="83ec2af6d61241e9" sourceField="table"/>
                <link dest="523a2f07" destField="table" source="b8b37e891bb64ef9" sourceField="table"/>
                <link dest="83ec2af6d61241e9" destField="tableMap" source="c51cf5f706bb41b7" sourceField="obj"/>
                <link dest="83ec2af6d61241e9" destField="speaker" source="4b83622d" sourceField="obj"/>
                <link dest="d481721e32ec4da7" destField="table" source="b84815bcd13f4c94" sourceField="table"/>
                <link dest="b84815bcd13f4c94" destField="table" source="83ec2af6d61241e9" sourceField="table"/>
                <link dest="f4ef58cc84464f9a" destField="table" source="d481721e32ec4da7" sourceField="table"/>
                <link dest="6f90f2bf" destField="table" source="7bd212c6" sourceField="table"/>
                <link dest="eba11963e9784475" destField="table" source="6f90f2bf" sourceField="table"/>
                <link dest="1e6465f7" destField="table" source="eba11963e9784475" sourceField="table"/>
                <link dest="f4ef58cc84464f9a" destField="parent" source="1e6465f7" sourceField="parent"/>
                <link dest="663e007e" destField="parent" source="523a2f07" sourceField="parent"/>
                <link dest="523a2f07" destField="parent" source="f4ef58cc84464f9a" sourceField="parent"/>
                <extensions>
                    <oga:notes>
                        <oga:note color="0xffff96" height="1094" title="Inputs" width="421" x="8" y="137"/>
                        <oga:note color="0xffc864" height="713" title="Report" width="1156" x="438" y="624"/>
                    </oga:notes>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <ogcn:published_input field="obj" name="tableMap" ref="7a41c15384344645"/>
            <ogcn:published_input field="collection" name="reportNode" ref="5c65cf0e7c264777"/>
            <ogcn:published_input field="obj" name="sylltableMap" ref="c51cf5f706bb41b7"/>
            <ogcn:published_output field="section" name="section" ref="6ffb9b04"/>
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.IterableClassNode.className">
                        <![CDATA[java.util.Set]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="1347" y="971"/>
            </extensions>
        </ogcn:macro>
        <node id="1c9bf97e" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1085" y="589">
                    <oga:default for="sectionName" type="java.lang.String">Tonal Patterns</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <link dest="7486fc0611ca4abb" destField="parameters" source="41c2d52c05f54592" sourceField="parameters"/>
        <link dest="ad540f2c84c343cc" destField="reportName" source="7486fc0611ca4abb" sourceField="reportTitle"/>
        <link dest="60e2578b" destField="table" source="5ea2047e" sourceField="table"/>
        <link dest="1c9bf97e" destField="table" source="60e2578b" sourceField="table"/>
        <link dest="1c9bf97e" destField="parent" source="ad540f2c84c343cc" sourceField="root"/>
        <link dest="5bf1378b" destField="table" source="4d1cdaa729e34875" sourceField="table"/>
        <link dest="681a6fc6" destField="tableMap" source="74498387" sourceField="tableMap"/>
        <link dest="74498387" destField="table" source="4d1cdaa729e34875" sourceField="table"/>
        <link dest="5ef5f16b" destField="project" source="7328a40688194f0f" sourceField="obj"/>
        <link dest="5ef5f16b" destField="sessions" source="23502a3bdf76403f" sourceField="obj"/>
        <link dest="681a6fc6" destField="collection" source="74498387" sourceField="keySet"/>
        <link dest="4d1cdaa729e34875" destField="results" source="5ef5f16b" sourceField="results"/>
        <link dest="4d1cdaa729e34875" destField="project" source="5ef5f16b" sourceField="project"/>
        <link dest="681a6fc6" destField="reportNode" source="ad540f2c84c343cc" sourceField="root"/>
        <link dest="e610bf8b98aa4f44" destField="table" source="5bf1378b" sourceField="sylltable"/>
        <link dest="681a6fc6" destField="sylltableMap" source="e610bf8b98aa4f44" sourceField="tableMap"/>
        <link dest="5ea2047e" destField="table" source="5bf1378b" sourceField="sylltable"/>
        <extensions>
            <opqry:nodewizard type="ca.phon.app.opgraph.analysis.AnalysisWizardExtension">
                <opqry:info format="html" title="PTNC">
                    <opqry:message/>
                </opqry:info>
            </opqry:nodewizard>
            <oga:notes>
                <oga:note color="0xffff96" height="537" title="Analysis Inputs" width="379" x="10" y="10">These inputs are provided to all analyses.</oga:note>
                <oga:note color="0xffc864" height="198" title="Start Report" width="734" x="10" y="560">Reports are created in a tree structure. When combined using the Analysis Composer the report tree created by the 'New Report' node will be added as a subtree to the larger report.</oga:note>
                <oga:note color="0x9696ff" height="547" title="Query" width="940" x="401" y="7">Execute query and generate a query report using the Report Composer.  The report output from the 'Query Report' node should be added to the report created by the 'New Report' node below. To 'chain' queries, add a new query node using the Library view. Connect the 'project' and 'results' outputs from one query node to the 'project' and 'sessions' inputs of the next query.</oga:note>
                <oga:note color="0xffc864" height="200" title="Add to Report" width="586" x="759" y="561"/>
                <oga:note color="0xff96ff" height="349" title="Shape data" width="510" x="41" y="779">Break data into syllables and add Target/Actual Tone number columns.</oga:note>
            </oga:notes>
            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
        </extensions>
    </graph>
</opgraph>
