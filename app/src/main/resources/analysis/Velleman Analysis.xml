<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<opgraph xmlns="http://gedge.ca/ns/opgraph" xmlns:nes="https://www.phon.ca/ns/node_editor" xmlns:oga="http://gedge.ca/ns/opgraph-app" xmlns:ogcn="http://gedge.ca/ns/opgraph-common-nodes" xmlns:opqry="https://phon.ca/ns/opgraph_query" xmlns:qry="http://phon.ling.mun.ca/ns/query">
    <graph id="root">
        <node id="55f4fba4" name="Project" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.project.Project]]></oga:property>
                    <oga:property key="contextKey"><![CDATA[_project]]></oga:property>
                </oga:settings>
                <oga:meta x="15" y="15"/>
            </extensions>
        </node>
        <node id="1ae2322c" name="Selected Sessions" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.ArrayList]]></oga:property>
                    <oga:property key="contextKey"><![CDATA[_selectedSessions]]></oga:property>
                </oga:settings>
                <oga:meta x="15" y="236"/>
            </extensions>
        </node>
        <node id="3da0e5db" name="Selected Participants" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.ArrayList]]></oga:property>
                    <oga:property key="contextKey"><![CDATA[_selectedParticipants]]></oga:property>
                </oga:settings>
                <oga:meta x="16" y="331"/>
            </extensions>
        </node>
        <node id="dc596f57c3774064" name="Parameters" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[var reportTitleParamInfo = {
	"id": "reportTitle",
	"title": "Report Title",
	"def": "Report",
	"prompt": "Enter report title"
};
var reportTitleParam;
var reportTitle = reportTitleParamInfo.def;

function setup_params(params) {
	reportTitleParam = new StringScriptParam(
			reportTitleParamInfo.id,
			reportTitleParamInfo.title,
			reportTitleParamInfo.def);
     reportTitleParam.setPrompt(reportTitleParamInfo.prompt);
	params.add(reportTitleParam);
}
]]></oga:property>
                    <oga:property key="reportTitle"><![CDATA[Velleman Analysis]]></oga:property>
                </oga:settings>
                <oga:meta x="23" y="437"/>
            </extensions>
        </node>
        <opqry:queryNode id="29ac654b" name="Query : Data Tiers" type="ca.phon.app.opgraph.nodes.query.QueryNode">
            <qry:query xmlns="http://phon.ling.mun.ca/ns/query" date="2017-05-31T07:37:21.920-02:30" name="Data Tiers" uuid="fa91a2a1-da15-4f44-b57a-d1273d0dd7d1">
                <script>
                    <url ref="Data Tiers" rel="stock"/>
                    <param id="filters.primary.patternFilter.filter">.+</param>
                    <param id="filters.primary.patternFilter.filterType">Regular expression</param>
                    <param id="filters.primary.tier">Orthography</param>
                    <param id="filters.word.searchByWord">true</param>
                    <param id="filters.wordTiers.tiers">IPA Actual, Actual Syllabification</param>
                </script>
            </qry:query>
            <extensions>
                <oga:settings/>
                <oga:meta x="318" y="102"/>
            </extensions>
        </opqry:queryNode>
        <ogcn:macro id="41a5af28" name="Print Report Title" type="ca.gedge.opgraph.nodes.general.MacroNode">
            <graph id="fc574aa">
                <node id="444d7ec1" name="parameters" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                    </extensions>
                </node>
                <ogcn:macro id="6be9cf3f68b64e43" name="Get Report Title" type="ca.gedge.opgraph.nodes.general.MacroNode">
                    <graph id="314324dc">
                        <node id="496aae2d8c5f45ee" name="String#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.String]]></oga:property>
                                </oga:settings>
                                <oga:meta x="15" y="15">
                                    <oga:default for="arg1" type="java.lang.String">reportTitle</oga:default>
                                </oga:meta>
                            </extensions>
                        </node>
                        <node id="7b1133368cbf4c65" name="Map#get(Object)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                </oga:settings>
                                <oga:meta x="218" y="16"/>
                            </extensions>
                        </node>
                        <node id="9c8aa94acf7f4599" name="Object#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                                </oga:settings>
                                <oga:meta x="392" y="15"/>
                            </extensions>
                        </node>
                        <link dest="7b1133368cbf4c65" destField="arg1" source="496aae2d8c5f45ee" sourceField="value"/>
                        <link dest="9c8aa94acf7f4599" destField="obj" source="7b1133368cbf4c65" sourceField="value"/>
                    </graph>
                    <ogcn:published_input field="obj" name="parameters" ref="7b1133368cbf4c65"/>
                    <ogcn:published_output field="value" name="reportTitle" ref="9c8aa94acf7f4599"/>
                    <extensions>
                        <oga:meta x="258" y="437"/>
                    </extensions>
                </ogcn:macro>
                <node id="16a1b6aa" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                    <input name="data" optional="false">Data to print</input>
                    <extensions>
                        <oga:settings>
                            <oga:property key="dataTemplate"><![CDATA[
#h1("$DATA")
]]></oga:property>
                            <oga:property key="showText"><![CDATA[true]]></oga:property>
                            <oga:property key="showTable"><![CDATA[false]]></oga:property>
                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                        </oga:settings>
                        <oga:meta x="481" y="437">
                            <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                            <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <link dest="6be9cf3f68b64e43" destField="parameters" source="444d7ec1" sourceField="obj"/>
                <link dest="16a1b6aa" destField="data" source="6be9cf3f68b64e43" sourceField="reportTitle"/>
            </graph>
            <ogcn:published_input field="obj" name="parameters" ref="444d7ec1"/>
            <extensions>
                <oga:meta x="250" y="433"/>
            </extensions>
        </ogcn:macro>
        <node id="61e6ae5ee8ed4084" type="class:ca.phon.app.opgraph.nodes.table.ResultsToTableNode">
            <extensions>
                <oga:settings>
                    <oga:property key="includeMetadata"><![CDATA[true]]></oga:property>
                    <oga:property key="includeTierInfo"><![CDATA[true]]></oga:property>
                    <oga:property key="includeSpeakerInfo"><![CDATA[true]]></oga:property>
                    <oga:property key="includeSessionInfo"><![CDATA[true]]></oga:property>
                </oga:settings>
                <oga:meta x="526" y="130"/>
            </extensions>
        </node>
        <node id="46ae9c22" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
            <extensions>
                <oga:settings>
                    <oga:property key="filters.column.exactMatch"><![CDATA[true]]></oga:property>
                    <oga:property key="filters.column.filterType"><![CDATA[Plain text]]></oga:property>
                    <oga:property key="columnName"><![CDATA[Orthography]]></oga:property>
                    <oga:property key="__script"><![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 
 /**
  * Partition Table.js
  * 
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  * 
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
	
	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0) 
		return; // column not found
	
	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}
	
	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);
		
		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}
	
	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;
	
	return filters.column.check_filter(value);
}
]]></oga:property>
                    <oga:property key="filters.column.allowOverlap"><![CDATA[false]]></oga:property>
                    <oga:property key="filters.column.caseSensitive"><![CDATA[false]]></oga:property>
                    <oga:property key="filters.column.filter"><![CDATA[yyy]]></oga:property>
                </oga:settings>
                <oga:meta x="672" y="125"/>
            </extensions>
        </node>
        <node id="d3211092b5054a20" name="Split Table by Speaker" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
            <extensions>
                <oga:settings>
                    <oga:property key="columnName"><![CDATA[Speaker]]></oga:property>
                    <oga:property key="__script"><![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="878" y="120"/>
            </extensions>
        </node>
        <ogcn:macro id="61208600" name="Vocalizations" type="ca.gedge.opgraph.nodes.reflect.IterableClassNode">
            <graph id="370b3896">
                <node id="282a70f9" name="Current Object" type="class:ca.gedge.opgraph.nodes.reflect.ContextualItemClassNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ContextualItemClassNode.key"><![CDATA[currentValue]]></oga:property>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                        </oga:settings>
                        <oga:meta x="41" y="39"/>
                    </extensions>
                </node>
                <node id="af4cdc9a1efb4b6e" name="Table Map" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="49" y="199"/>
                    </extensions>
                </node>
                <node id="64386b17" name="String#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.String]]></oga:property>
                        </oga:settings>
                        <oga:meta x="271" y="298">
                            <oga:default for="arg1" type="java.lang.String">Vocalizations</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="5fc29abaa09040c1" name="To Participant Object" type="class:ca.gedge.opgraph.nodes.reflect.ObjectCastNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectCastNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                        </oga:settings>
                        <oga:meta x="237" y="45"/>
                    </extensions>
                </node>
                <node id="f9aea4b" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                    <input name="data" optional="false">Data to print</input>
                    <extensions>
                        <oga:settings>
                            <oga:property key="dataTemplate"><![CDATA[
#h2("$DATA")
]]></oga:property>
                            <oga:property key="showText"><![CDATA[true]]></oga:property>
                            <oga:property key="showTable"><![CDATA[false]]></oga:property>
                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                        </oga:settings>
                        <oga:meta x="464" y="283">
                            <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                            <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <ogcn:macro id="bbf482c5a66541f7" name="Get Table of Results For Speaker" type="ca.gedge.opgraph.nodes.general.MacroNode">
                    <graph id="37d9d1dc">
                        <node id="5642bea05e5c4b06" name="Object#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                                </oga:settings>
                                <oga:meta x="105" y="70"/>
                            </extensions>
                        </node>
                        <node id="57334ef9ad744f65" name="Map#get(Object)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                </oga:settings>
                                <oga:meta x="296" y="73"/>
                            </extensions>
                        </node>
                        <node id="4df6ff3399a848c7" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                            <output name="exists" type="java.lang.Boolean">does table exist</output>
                            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource">table if exists, undefined otherwise</output>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script"><![CDATA[
// setup input/output fields
function init(inputFields, outputFields) {
	inputFields.add("table", "");
	outputFields.add("exists", "does table exist", false, java.lang.Boolean);
	outputFields.add("table", "table if exists, undefined otherwise", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableExists =
		(context.containsKey("table") && context.get("table") != null);
	context.put("exists", tableExists);
	context.put("table", context.get("table"));
}
]]></oga:property>
                                </oga:settings>
                                <oga:meta x="514" y="94"/>
                            </extensions>
                        </node>
                        <link dest="57334ef9ad744f65" destField="arg1" source="5642bea05e5c4b06" sourceField="value"/>
                        <link dest="4df6ff3399a848c7" destField="table" source="57334ef9ad744f65" sourceField="value"/>
                        <extensions>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="speaker" ref="5642bea05e5c4b06"/>
                    <ogcn:published_input field="obj" name="tableMap" ref="57334ef9ad744f65"/>
                    <ogcn:published_output field="exists" name="exists" ref="4df6ff3399a848c7"/>
                    <ogcn:published_output field="table" name="table" ref="4df6ff3399a848c7"/>
                    <extensions>
                        <oga:meta x="477" y="101"/>
                    </extensions>
                </ogcn:macro>
                <ogcn:macro id="350c5a14" name="If Speaker Has Results" type="ca.gedge.opgraph.nodes.general.MacroNode">
                    <graph id="66e55b9d">
                        <node id="60a76f15" name="Table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                </oga:settings>
                                <oga:meta x="47" y="126"/>
                            </extensions>
                        </node>
                        <node id="68d90fd6bd914ea2" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                </oga:settings>
                                <oga:meta x="48" y="335"/>
                            </extensions>
                        </node>
                        <node id="7f149b7d" name="Split Table by Session" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="columnName"><![CDATA[Session]]></oga:property>
                                    <oga:property key="__script"><![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 
 /**
  * Split Table.js
  * 
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  * 
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a 
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/* 
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	
	if(col < 0) 
		return; // column not found
	
	var tableMap = new java.util.LinkedHashMap();
	
	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));
		
		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}
	
	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]></oga:property>
                                </oga:settings>
                                <oga:meta x="350" y="37"/>
                            </extensions>
                        </node>
                        <ogcn:macro id="5aee518f" name="Velleman Analysis" type="ca.gedge.opgraph.nodes.general.MacroNode">
                            <graph id="31876271">
                                <node id="c81dda4" name="result total" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Integer]]></oga:property>
                                        </oga:settings>
                                        <oga:meta x="15" y="15"/>
                                    </extensions>
                                </node>
                                <node id="45508fae" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                        </oga:settings>
                                        <oga:meta x="13" y="105"/>
                                    </extensions>
                                </node>
                                <node id="578fcaef" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                        </oga:settings>
                                        <oga:meta x="15" y="403"/>
                                    </extensions>
                                </node>
                                <node id="7cbf1d09" name="tableMap" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                        </oga:settings>
                                        <oga:meta x="15" y="534"/>
                                    </extensions>
                                </node>
                                <ogcn:macro id="71606628" name="Total" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                    <graph id="4fce77cd">
                                        <node id="61761de3" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="15"/>
                                            </extensions>
                                        </node>
                                        <node id="4413c5e1" name="tableMap" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="308"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="9fb837e3dd39441b" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="496642f6">
                                                <node id="890e53f198643a0" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15">
                                                            <oga:default for="arg1" type="java.lang.String"/>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="48913680b4364ec0" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="146"/>
                                                    </extensions>
                                                </node>
                                                <node id="e39e414a958c430d" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="256" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="8e39f3647eb3497f" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="507" y="15"/>
                                                    </extensions>
                                                </node>
                                                <link dest="8e39f3647eb3497f" destField="obj" source="e39e414a958c430d" sourceField="value"/>
                                                <link dest="e39e414a958c430d" destField="obj" source="890e53f198643a0" sourceField="value"/>
                                                <link dest="e39e414a958c430d" destField="arg1" source="48913680b4364ec0" sourceField="name"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="48913680b4364ec0"/>
                                            <ogcn:published_input field="arg1" name="arg1" ref="890e53f198643a0"/>
                                            <ogcn:published_output field="value" name="value" ref="8e39f3647eb3497f"/>
                                            <extensions>
                                                <oga:meta x="205" y="15">
                                                    <oga:default for="arg1" type="java.lang.String">Total</oga:default>
                                                </oga:meta>
                                            </extensions>
                                        </ogcn:macro>
                                        <node id="4584344a" name="Create Totals Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                            <input name="tableMap" optional="false"/>
                                            <output name="totalsTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);
	
	outputs.add("totalsTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);	
}

function run(context) {
	var tableMap = context.get("tableMap");
	var totalsTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	totalsTable.setColumnTitle(0, "Session");
	totalsTable.setColumnTitle(1, "Count");

	var keySet = tableMap.keySet();
	var itr = keySet.iterator();
	var total = 0;
	while(itr.hasNext()) {
		var session = itr.next();
		var count = tableMap.get(session).rowCount;
		total += count;
		
		var rowData = [];
		rowData[0] = session;
		rowData[1] = new java.lang.Integer(count);

		totalsTable.addRow(rowData);
	}

	var rowData = [ "Total", new java.lang.Integer(total) ];
	totalsTable.addRow(rowData);

	context.put("totalsTable", totalsTable);
}
]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="159" y="308"/>
                                            </extensions>
                                        </node>
                                        <node id="5f701d30" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                            <input name="data" optional="false">Data to print</input>
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                    <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                    <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="369" y="15"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="1db19bc0aaed4791" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="7f2585a1">
                                                <node id="d3163ab74e8e4042" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Total : $DATA</h3>")
]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="51" y="48">
                                                            <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                            <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="fb614350bf4b4317" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="54" y="177">
                                                            <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                            <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="data" name="speaker" ref="d3163ab74e8e4042"/>
                                            <ogcn:published_input field="data" name="bufferName" ref="fb614350bf4b4317"/>
                                            <extensions>
                                                <oga:meta x="528" y="15"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="4584344a" destField="tableMap" source="4413c5e1" sourceField="obj"/>
                                        <link dest="5f701d30" destField="data" source="4584344a" sourceField="totalsTable"/>
                                        <link dest="1db19bc0aaed4791" destField="bufferName" source="5f701d30" sourceField="buffer"/>
                                        <link dest="5f701d30" destField="buffer" source="9fb837e3dd39441b" sourceField="value"/>
                                        <link dest="1db19bc0aaed4791" destField="speaker" source="61761de3" sourceField="obj"/>
                                        <link dest="9fb837e3dd39441b" destField="speaker" source="61761de3" sourceField="obj"/>
                                        <extensions>
                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                        </extensions>
                                    </graph>
                                    <ogcn:published_input field="obj" name="tableMap" ref="4413c5e1"/>
                                    <ogcn:published_input field="obj" name="speaker" ref="61761de3"/>
                                    <extensions>
                                        <oga:meta x="262" y="24"/>
                                    </extensions>
                                </ogcn:macro>
                                <ogcn:macro id="5c298b00" name="Listing" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                    <graph id="5d5aa57">
                                        <node id="77fcdc08" name="data" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="711" y="439"/>
                                            </extensions>
                                        </node>
                                        <node id="6907e174" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="711" y="439"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="2b7f7797b438469c" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="1bf58aa9">
                                                <node id="1246289b498f4209" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15">
                                                            <oga:default for="arg1" type="java.lang.String"/>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="9da44f96f0248dc" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="146"/>
                                                    </extensions>
                                                </node>
                                                <node id="53da17768cd7475c" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="256" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="f622e05eda0e468f" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="507" y="15"/>
                                                    </extensions>
                                                </node>
                                                <link dest="f622e05eda0e468f" destField="obj" source="53da17768cd7475c" sourceField="value"/>
                                                <link dest="53da17768cd7475c" destField="obj" source="1246289b498f4209" sourceField="value"/>
                                                <link dest="53da17768cd7475c" destField="arg1" source="9da44f96f0248dc" sourceField="name"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="9da44f96f0248dc"/>
                                            <ogcn:published_input field="arg1" name="arg1" ref="1246289b498f4209"/>
                                            <ogcn:published_output field="value" name="value" ref="f622e05eda0e468f"/>
                                            <extensions>
                                                <oga:meta x="228" y="144">
                                                    <oga:default for="arg1" type="java.lang.String">Listing_</oga:default>
                                                </oga:meta>
                                            </extensions>
                                        </ogcn:macro>
                                        <node id="23037170" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                            <input name="data" optional="false">Data to print</input>
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                    <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                    <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="398" y="145"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="984965bd195941b7" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="3e8e5ea7">
                                                <node id="d53cd18625e14d06" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Listing : $DATA</h3>")
]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="50" y="48">
                                                            <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                            <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="ad051d7bf6a741bd" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption ["Session", "Record #", "IPA Actual (Word)"] )
#else
$caption

No Results
#end
]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="54" y="177">
                                                            <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                            <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="data" name="speaker" ref="d53cd18625e14d06"/>
                                            <ogcn:published_input field="data" name="bufferName" ref="ad051d7bf6a741bd"/>
                                            <extensions>
                                                <oga:meta x="577" y="165"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="23037170" destField="buffer" source="2b7f7797b438469c" sourceField="value"/>
                                        <link dest="23037170" destField="data" source="77fcdc08" sourceField="obj"/>
                                        <link dest="2b7f7797b438469c" destField="speaker" source="6907e174" sourceField="obj"/>
                                        <link dest="984965bd195941b7" destField="bufferName" source="23037170" sourceField="buffer"/>
                                        <link dest="984965bd195941b7" destField="speaker" source="6907e174" sourceField="obj"/>
                                    </graph>
                                    <ogcn:published_input field="obj" name="data" ref="77fcdc08"/>
                                    <ogcn:published_input field="obj" name="speaker" ref="6907e174"/>
                                    <extensions>
                                        <oga:meta x="262" y="147"/>
                                    </extensions>
                                </ogcn:macro>
                                <ogcn:macro id="39f91ef7" name="Initial Consonants" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                    <graph id="19437f76">
                                        <node id="2c5f289" name="result total" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Integer]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="15"/>
                                            </extensions>
                                        </node>
                                        <node id="1c7877d" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="146"/>
                                            </extensions>
                                        </node>
                                        <node id="4ceebc1" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="439"/>
                                            </extensions>
                                        </node>
                                        <node id="1bff2726" name="tableMap" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="570"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="3fd5be49" name="Initial Consonants" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="3406307d">
                                                <node id="57fbc98f" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="4582b1f9" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="308"/>
                                                    </extensions>
                                                </node>
                                                <node id="9cbcfc54f26c4cfa" name="Result Total" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Integer]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="45" y="443"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="d0e4e5315d954c27" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="1d33de9f">
                                                        <node id="2bad1d607024dae" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15">
                                                                    <oga:default for="arg1" type="java.lang.String"/>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="15db6653a6294c18" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="146"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d674f76e48834437" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="256" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="353dcf36533c4ef9" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="507" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <link dest="353dcf36533c4ef9" destField="obj" source="d674f76e48834437" sourceField="value"/>
                                                        <link dest="d674f76e48834437" destField="obj" source="2bad1d607024dae" sourceField="value"/>
                                                        <link dest="d674f76e48834437" destField="arg1" source="15db6653a6294c18" sourceField="name"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="speaker" ref="15db6653a6294c18"/>
                                                    <ogcn:published_input field="arg1" name="arg1" ref="2bad1d607024dae"/>
                                                    <ogcn:published_output field="value" name="value" ref="353dcf36533c4ef9"/>
                                                    <extensions>
                                                        <oga:meta x="321" y="68">
                                                            <oga:default for="arg1" type="java.lang.String">Initial Consonants_</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="1e4b8d36" name="Add Initial Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	
}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Initial C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var initialC = "";
		if(ipa.matches("^\\c.*")) {
			initialC = (new IPATranscriptBuilder()).append(ipa.elementAt(0)).toIPATranscript();
		}

		rowData[colIdx] = initialC;
	}
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="300" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="26edcb08" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                    <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="filters.column.filterType"><![CDATA[Regular expression]]></oga:property>
                                                            <oga:property key="columnName"><![CDATA[Initial C]]></oga:property>
                                                            <oga:property key="__script"><![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 
 /**
  * Partition Table.js
  * 
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  * 
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
	
	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0) 
		return; // column not found
	
	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}
	
	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);
		
		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}
	
	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;
	
	return filters.column.check_filter(value);
}
]]></oga:property>
                                                            <oga:property key="filters.column.filter"><![CDATA[.+]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="520" y="237"/>
                                                    </extensions>
                                                </node>
                                                <node id="157e22dd" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                    <extensions>
                                                        <opqry:inventoryoptions>
                                                            <opqry:column caseSensitive="false" column="Initial C" ignoreDiacritics="true"/>
                                                        </opqry:inventoryoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="726" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="5142a794" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="total" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = count / total;

		rowData[2] = freq;
	}
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="684" y="449"/>
                                                    </extensions>
                                                </node>
                                                <node id="397afdf3" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                    <extensions>
                                                        <opqry:sortoptions>
                                                            <opqry:sortBy column="Initial C" order="ascending" type="ipa"/>
                                                        </opqry:sortoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="879" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="7235e753" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="715" y="75"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="2ce1efd1b9734758" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="189e8974">
                                                        <node id="e2df1b41e4cd4602" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Initial Consonants : $DATA</h3>")
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="51" y="48">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="15480cdd4d7c44ef" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="54" y="177">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="data" name="speaker" ref="e2df1b41e4cd4602"/>
                                                    <ogcn:published_input field="data" name="bufferName" ref="15480cdd4d7c44ef"/>
                                                    <extensions>
                                                        <oga:meta x="874" y="75"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <link dest="26edcb08" destField="table" source="1e4b8d36" sourceField="table"/>
                                                <link dest="d0e4e5315d954c27" destField="speaker" source="57fbc98f" sourceField="obj"/>
                                                <link dest="2ce1efd1b9734758" destField="speaker" source="57fbc98f" sourceField="obj"/>
                                                <link dest="7235e753" destField="data" source="397afdf3" sourceField="table"/>
                                                <link dest="2ce1efd1b9734758" destField="bufferName" source="7235e753" sourceField="buffer"/>
                                                <link dest="7235e753" destField="buffer" source="d0e4e5315d954c27" sourceField="value"/>
                                                <link dest="1e4b8d36" destField="table" source="4582b1f9" sourceField="obj"/>
                                                <link dest="5142a794" destField="total" source="9cbcfc54f26c4cfa" sourceField="obj"/>
                                                <link dest="157e22dd" destField="table" source="26edcb08" sourceField="trueTable"/>
                                                <link dest="5142a794" destField="table" source="157e22dd" sourceField="table"/>
                                                <link dest="397afdf3" destField="table" source="5142a794" sourceField="table"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="57fbc98f"/>
                                            <ogcn:published_input field="obj" name="table" ref="4582b1f9"/>
                                            <ogcn:published_input field="obj" name="result total" ref="9cbcfc54f26c4cfa"/>
                                            <extensions>
                                                <oga:meta x="273" y="29"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="37993d4121c64985" name="Initial Consonants (by Session)" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="643a547b">
                                                <node id="cba87bdb9f4473f" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="1fe296e468a143cc" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="308"/>
                                                    </extensions>
                                                </node>
                                                <node id="46f9c492e22b45b5" name="Map" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="45" y="460"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="3e38c47bc57c4820" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="388b0a1">
                                                        <node id="36141faa30144b28" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15">
                                                                    <oga:default for="arg1" type="java.lang.String"/>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="75b169e16a0b4649" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="146"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d02558744eeb4bd9" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="256" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="15a1e71b2584c30" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="507" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <link dest="15a1e71b2584c30" destField="obj" source="d02558744eeb4bd9" sourceField="value"/>
                                                        <link dest="d02558744eeb4bd9" destField="obj" source="36141faa30144b28" sourceField="value"/>
                                                        <link dest="d02558744eeb4bd9" destField="arg1" source="75b169e16a0b4649" sourceField="name"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="speaker" ref="75b169e16a0b4649"/>
                                                    <ogcn:published_input field="arg1" name="arg1" ref="36141faa30144b28"/>
                                                    <ogcn:published_output field="value" name="value" ref="15a1e71b2584c30"/>
                                                    <extensions>
                                                        <oga:meta x="321" y="68">
                                                            <oga:default for="arg1" type="java.lang.String">Initial Consonants (by Session)_</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="575dcc9dac31425d" name="Add Initial Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	
}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Initial C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var initialC = "";
		if(ipa.matches("^\\c.*")) {
			initialC = (new IPATranscriptBuilder()).append(ipa.elementAt(0)).toIPATranscript();
		}

		rowData[colIdx] = initialC;
	}
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="300" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="d2d0e4adf72b455b" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                    <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="filters.column.filterType"><![CDATA[Regular expression]]></oga:property>
                                                            <oga:property key="columnName"><![CDATA[Initial C]]></oga:property>
                                                            <oga:property key="__script"><![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 
 /**
  * Partition Table.js
  * 
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  * 
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
	
	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0) 
		return; // column not found
	
	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}
	
	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);
		
		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}
	
	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;
	
	return filters.column.check_filter(value);
}
]]></oga:property>
                                                            <oga:property key="filters.column.filter"><![CDATA[.+]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="520" y="237"/>
                                                    </extensions>
                                                </node>
                                                <node id="e4b60d5da7634e1c" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                    <extensions>
                                                        <opqry:inventoryoptions>
                                                            <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                            <opqry:column caseSensitive="false" column="Initial C" ignoreDiacritics="true"/>
                                                        </opqry:inventoryoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="726" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="41dceaee2c4a46ae" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="tableMap" optional="false"/>
                                                    <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	
	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;
		
		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = count / total;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}
	
	context.put("freqTable", freqTable);
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="684" y="449"/>
                                                    </extensions>
                                                </node>
                                                <node id="da71e3439700466e" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                    <extensions>
                                                        <opqry:sortoptions>
                                                            <opqry:sortBy column="Initial C" order="ascending" type="ipa"/>
                                                        </opqry:sortoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="879" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="6965f08f0a4b4299" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="715" y="75"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="2757403bb10d4c6a" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="118f6c40">
                                                        <node id="23fa7ff5b4ea43b2" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Initial Consonants (by Session) : $DATA</h3>")
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="51" y="48">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="d59a8cafd1654e11" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="54" y="177">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="data" name="speaker" ref="23fa7ff5b4ea43b2"/>
                                                    <ogcn:published_input field="data" name="bufferName" ref="d59a8cafd1654e11"/>
                                                    <extensions>
                                                        <oga:meta x="874" y="75"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <link dest="d2d0e4adf72b455b" destField="table" source="575dcc9dac31425d" sourceField="table"/>
                                                <link dest="3e38c47bc57c4820" destField="speaker" source="cba87bdb9f4473f" sourceField="obj"/>
                                                <link dest="2757403bb10d4c6a" destField="speaker" source="cba87bdb9f4473f" sourceField="obj"/>
                                                <link dest="6965f08f0a4b4299" destField="data" source="da71e3439700466e" sourceField="table"/>
                                                <link dest="2757403bb10d4c6a" destField="bufferName" source="6965f08f0a4b4299" sourceField="buffer"/>
                                                <link dest="6965f08f0a4b4299" destField="buffer" source="3e38c47bc57c4820" sourceField="value"/>
                                                <link dest="575dcc9dac31425d" destField="table" source="1fe296e468a143cc" sourceField="obj"/>
                                                <link dest="e4b60d5da7634e1c" destField="table" source="d2d0e4adf72b455b" sourceField="trueTable"/>
                                                <link dest="41dceaee2c4a46ae" destField="table" source="e4b60d5da7634e1c" sourceField="table"/>
                                                <link dest="da71e3439700466e" destField="table" source="41dceaee2c4a46ae" sourceField="freqTable"/>
                                                <link dest="41dceaee2c4a46ae" destField="tableMap" source="46f9c492e22b45b5" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="cba87bdb9f4473f"/>
                                            <ogcn:published_input field="obj" name="table" ref="1fe296e468a143cc"/>
                                            <ogcn:published_input field="obj" name="tableMap" ref="46f9c492e22b45b5"/>
                                            <extensions>
                                                <oga:meta x="269" y="156"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="37993d4121c64985" destField="tableMap" source="1bff2726" sourceField="obj"/>
                                        <link dest="37993d4121c64985" destField="speaker" source="1c7877d" sourceField="obj"/>
                                        <link dest="3fd5be49" destField="table" source="4ceebc1" sourceField="obj"/>
                                        <link dest="3fd5be49" destField="result total" source="2c5f289" sourceField="obj"/>
                                        <link dest="3fd5be49" destField="speaker" source="1c7877d" sourceField="obj"/>
                                        <link dest="37993d4121c64985" destField="table" source="4ceebc1" sourceField="obj"/>
                                    </graph>
                                    <ogcn:published_input field="obj" name="tableMap" ref="1bff2726"/>
                                    <ogcn:published_input field="obj" name="speaker" ref="1c7877d"/>
                                    <ogcn:published_input field="obj" name="table" ref="4ceebc1"/>
                                    <ogcn:published_input field="obj" name="result total" ref="2c5f289"/>
                                    <extensions>
                                        <oga:meta x="262" y="266"/>
                                    </extensions>
                                </ogcn:macro>
                                <ogcn:macro id="9bee85a827324705" name="Final Consonants" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                    <graph id="19aed3a9">
                                        <node id="8b7626cd0a4a445b" name="result total" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Integer]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="15"/>
                                            </extensions>
                                        </node>
                                        <node id="dcaa3f64052e4667" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="146"/>
                                            </extensions>
                                        </node>
                                        <node id="be648f920a40a0" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="439"/>
                                            </extensions>
                                        </node>
                                        <node id="1e990fb5c17c4f92" name="tableMap" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="570"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="47ab9f734c8d4a3b" name="Final Consonants" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="36060010">
                                                <node id="80e97d2a3c2241e1" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="390d058f9a044b28" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="308"/>
                                                    </extensions>
                                                </node>
                                                <node id="d66b03aeddfb4c5c" name="Result Total" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Integer]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="45" y="443"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="9652772da905453d" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="378b180f">
                                                        <node id="6920880660024a22" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15">
                                                                    <oga:default for="arg1" type="java.lang.String"/>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="76b46236243a45a9" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="146"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="bb746653c425459c" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="256" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="4da5c016f6f0427a" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="507" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <link dest="4da5c016f6f0427a" destField="obj" source="bb746653c425459c" sourceField="value"/>
                                                        <link dest="bb746653c425459c" destField="obj" source="6920880660024a22" sourceField="value"/>
                                                        <link dest="bb746653c425459c" destField="arg1" source="76b46236243a45a9" sourceField="name"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="speaker" ref="76b46236243a45a9"/>
                                                    <ogcn:published_input field="arg1" name="arg1" ref="6920880660024a22"/>
                                                    <ogcn:published_output field="value" name="value" ref="4da5c016f6f0427a"/>
                                                    <extensions>
                                                        <oga:meta x="322" y="71">
                                                            <oga:default for="arg1" type="java.lang.String">Final Consonants_</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="83392f37c32b4f47" name="Add Final Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	
}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Final C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var finalC = "";
		if(ipa.matches(".*\\c$")) {
			finalC = (new IPATranscriptBuilder()).append(ipa.elementAt(ipa.length()-1)).toIPATranscript();
		}

		rowData[colIdx] = finalC;
	}
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="300" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="c8d9bf6512514970" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                    <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="filters.column.exactMatch"><![CDATA[true]]></oga:property>
                                                            <oga:property key="filters.column.filterType"><![CDATA[Regular expression]]></oga:property>
                                                            <oga:property key="columnName"><![CDATA[Final C]]></oga:property>
                                                            <oga:property key="__script"><![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 
 /**
  * Partition Table.js
  * 
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  * 
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
	
	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0) 
		return; // column not found
	
	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}
	
	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);
		
		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}
	
	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;
	
	return filters.column.check_filter(value);
}
]]></oga:property>
                                                            <oga:property key="filters.column.allowOverlap"><![CDATA[false]]></oga:property>
                                                            <oga:property key="filters.column.caseSensitive"><![CDATA[false]]></oga:property>
                                                            <oga:property key="filters.column.filter"><![CDATA[.+]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="519" y="234"/>
                                                    </extensions>
                                                </node>
                                                <node id="19c21fe28f584032" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                    <extensions>
                                                        <opqry:inventoryoptions>
                                                            <opqry:column caseSensitive="false" column="Final C" ignoreDiacritics="true"/>
                                                        </opqry:inventoryoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="726" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="140e94fe8d404799" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="total" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = count / total;

		rowData[2] = freq;
	}
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="684" y="449"/>
                                                    </extensions>
                                                </node>
                                                <node id="af085cd0ea414e90" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                    <extensions>
                                                        <opqry:sortoptions>
                                                            <opqry:sortBy column="Final C" order="ascending" type="ipa"/>
                                                        </opqry:sortoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="879" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="941aba68558e4eda" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="715" y="75"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="967e25fed06a45d5" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="1f5b481f">
                                                        <node id="32755b70291d4792" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Final Consonants : $DATA</h3>")
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="51" y="48">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="79475fce80924888" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="54" y="177">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="data" name="speaker" ref="32755b70291d4792"/>
                                                    <ogcn:published_input field="data" name="bufferName" ref="79475fce80924888"/>
                                                    <extensions>
                                                        <oga:meta x="874" y="75"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <link dest="9652772da905453d" destField="speaker" source="80e97d2a3c2241e1" sourceField="obj"/>
                                                <link dest="967e25fed06a45d5" destField="speaker" source="80e97d2a3c2241e1" sourceField="obj"/>
                                                <link dest="941aba68558e4eda" destField="data" source="af085cd0ea414e90" sourceField="table"/>
                                                <link dest="967e25fed06a45d5" destField="bufferName" source="941aba68558e4eda" sourceField="buffer"/>
                                                <link dest="941aba68558e4eda" destField="buffer" source="9652772da905453d" sourceField="value"/>
                                                <link dest="83392f37c32b4f47" destField="table" source="390d058f9a044b28" sourceField="obj"/>
                                                <link dest="140e94fe8d404799" destField="total" source="d66b03aeddfb4c5c" sourceField="obj"/>
                                                <link dest="140e94fe8d404799" destField="table" source="19c21fe28f584032" sourceField="table"/>
                                                <link dest="af085cd0ea414e90" destField="table" source="140e94fe8d404799" sourceField="table"/>
                                                <link dest="c8d9bf6512514970" destField="table" source="83392f37c32b4f47" sourceField="table"/>
                                                <link dest="19c21fe28f584032" destField="table" source="c8d9bf6512514970" sourceField="trueTable"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="80e97d2a3c2241e1"/>
                                            <ogcn:published_input field="obj" name="table" ref="390d058f9a044b28"/>
                                            <ogcn:published_input field="obj" name="result total" ref="d66b03aeddfb4c5c"/>
                                            <extensions>
                                                <oga:meta x="236" y="42"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="a2bb4201f25d43e2" name="Final Consonants (by Session)" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="53773ea9">
                                                <node id="16d6d864e68f4401" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="36f52067ce1f4419" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="308"/>
                                                    </extensions>
                                                </node>
                                                <node id="22cef0b692324782" name="Map" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="45" y="460"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="f95553da65fe4df7" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="64b6304e">
                                                        <node id="2649c5d0d2574530" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15">
                                                                    <oga:default for="arg1" type="java.lang.String"/>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="45d523a15fdf4a20" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="146"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="8898987594734735" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="256" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f3f0737d626d42b2" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="507" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <link dest="f3f0737d626d42b2" destField="obj" source="8898987594734735" sourceField="value"/>
                                                        <link dest="8898987594734735" destField="obj" source="2649c5d0d2574530" sourceField="value"/>
                                                        <link dest="8898987594734735" destField="arg1" source="45d523a15fdf4a20" sourceField="name"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="speaker" ref="45d523a15fdf4a20"/>
                                                    <ogcn:published_input field="arg1" name="arg1" ref="2649c5d0d2574530"/>
                                                    <ogcn:published_output field="value" name="value" ref="f3f0737d626d42b2"/>
                                                    <extensions>
                                                        <oga:meta x="321" y="68">
                                                            <oga:default for="arg1" type="java.lang.String">Final Consonants (by Session)_</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="a2fc327ba656458f" name="Add Final Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	
}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Final C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var finalC = "";
		if(ipa.matches(".*\\c$")) {
			finalC = (new IPATranscriptBuilder()).append(ipa.elementAt(ipa.length()-1)).toIPATranscript();
		}

		rowData[colIdx] = finalC;
	}
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="300" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="eb8416e76b304213" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                    <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="filters.column.exactMatch"><![CDATA[true]]></oga:property>
                                                            <oga:property key="filters.column.filterType"><![CDATA[Regular expression]]></oga:property>
                                                            <oga:property key="columnName"><![CDATA[Final C]]></oga:property>
                                                            <oga:property key="__script"><![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 
 /**
  * Partition Table.js
  * 
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  * 
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
	
	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0) 
		return; // column not found
	
	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}
	
	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);
		
		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}
	
	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;
	
	return filters.column.check_filter(value);
}
]]></oga:property>
                                                            <oga:property key="filters.column.allowOverlap"><![CDATA[false]]></oga:property>
                                                            <oga:property key="filters.column.caseSensitive"><![CDATA[false]]></oga:property>
                                                            <oga:property key="filters.column.filter"><![CDATA[.+]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="519" y="242"/>
                                                    </extensions>
                                                </node>
                                                <node id="93d898e7d3974832" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                    <extensions>
                                                        <opqry:inventoryoptions>
                                                            <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                            <opqry:column caseSensitive="false" column="Final C" ignoreDiacritics="true"/>
                                                        </opqry:inventoryoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="726" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="2f70db5025ff4e1c" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="tableMap" optional="false"/>
                                                    <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	
	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;
		
		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = count / total;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}
	
	context.put("freqTable", freqTable);
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="684" y="449"/>
                                                    </extensions>
                                                </node>
                                                <node id="a41037cab06c49d9" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                    <extensions>
                                                        <opqry:sortoptions>
                                                            <opqry:sortBy column="Final C" order="ascending" type="ipa"/>
                                                        </opqry:sortoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="879" y="238"/>
                                                    </extensions>
                                                </node>
                                                <node id="21dcf03bfb1149fa" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="715" y="75"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="84bcd69765fa42b7" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="1caa03fb">
                                                        <node id="5cf269c3c60d42fe" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Final Consonants (by Session) : $DATA</h3>")
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="51" y="48">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="5eafac57c0664949" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="54" y="177">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="data" name="speaker" ref="5cf269c3c60d42fe"/>
                                                    <ogcn:published_input field="data" name="bufferName" ref="5eafac57c0664949"/>
                                                    <extensions>
                                                        <oga:meta x="874" y="75"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <link dest="f95553da65fe4df7" destField="speaker" source="16d6d864e68f4401" sourceField="obj"/>
                                                <link dest="84bcd69765fa42b7" destField="speaker" source="16d6d864e68f4401" sourceField="obj"/>
                                                <link dest="21dcf03bfb1149fa" destField="data" source="a41037cab06c49d9" sourceField="table"/>
                                                <link dest="84bcd69765fa42b7" destField="bufferName" source="21dcf03bfb1149fa" sourceField="buffer"/>
                                                <link dest="21dcf03bfb1149fa" destField="buffer" source="f95553da65fe4df7" sourceField="value"/>
                                                <link dest="a2fc327ba656458f" destField="table" source="36f52067ce1f4419" sourceField="obj"/>
                                                <link dest="2f70db5025ff4e1c" destField="table" source="93d898e7d3974832" sourceField="table"/>
                                                <link dest="a41037cab06c49d9" destField="table" source="2f70db5025ff4e1c" sourceField="freqTable"/>
                                                <link dest="2f70db5025ff4e1c" destField="tableMap" source="22cef0b692324782" sourceField="obj"/>
                                                <link dest="eb8416e76b304213" destField="table" source="a2fc327ba656458f" sourceField="table"/>
                                                <link dest="93d898e7d3974832" destField="table" source="eb8416e76b304213" sourceField="trueTable"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="16d6d864e68f4401"/>
                                            <ogcn:published_input field="obj" name="table" ref="36f52067ce1f4419"/>
                                            <ogcn:published_input field="obj" name="tableMap" ref="22cef0b692324782"/>
                                            <extensions>
                                                <oga:meta x="245" y="184"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="a2bb4201f25d43e2" destField="tableMap" source="1e990fb5c17c4f92" sourceField="obj"/>
                                        <link dest="a2bb4201f25d43e2" destField="speaker" source="dcaa3f64052e4667" sourceField="obj"/>
                                        <link dest="47ab9f734c8d4a3b" destField="table" source="be648f920a40a0" sourceField="obj"/>
                                        <link dest="47ab9f734c8d4a3b" destField="result total" source="8b7626cd0a4a445b" sourceField="obj"/>
                                        <link dest="47ab9f734c8d4a3b" destField="speaker" source="dcaa3f64052e4667" sourceField="obj"/>
                                        <link dest="a2bb4201f25d43e2" destField="table" source="be648f920a40a0" sourceField="obj"/>
                                        <extensions>
                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                        </extensions>
                                    </graph>
                                    <ogcn:published_input field="obj" name="tableMap" ref="1e990fb5c17c4f92"/>
                                    <ogcn:published_input field="obj" name="speaker" ref="dcaa3f64052e4667"/>
                                    <ogcn:published_input field="obj" name="table" ref="be648f920a40a0"/>
                                    <ogcn:published_input field="obj" name="result total" ref="8b7626cd0a4a445b"/>
                                    <extensions>
                                        <oga:meta x="262" y="414"/>
                                    </extensions>
                                </ogcn:macro>
                                <ogcn:macro id="9dee81f2bd624468" name="Vowels" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                    <graph id="1759709e">
                                        <node id="4286091421414cd3" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="15"/>
                                            </extensions>
                                        </node>
                                        <node id="f69bce99bd234bf6" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="160"/>
                                            </extensions>
                                        </node>
                                        <node id="6ac5430e4a2a4274" name="Create Vowel Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                            <output name="vowelTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="__script"><![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	outputs.add("vowelTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var vowelTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	vowelTable.setColumnTitle(0, "Session");
	vowelTable.setColumnTitle(1, "Record");
	vowelTable.setColumnTitle(2, "Vowel");
	vowelTable.setColumnTitle(3, "Actual Syllabification (Word)");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var actualSyllabification = table.getValueAt(row, "Actual Syllabification (Word)");
		var ipa = (new IPATranscriptBuilder()).append(actualSyllabification).toIPATranscript();
		var sylls = ipa.syllables();

		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var syll = sylls.get(syllIdx);
			var phonexPattern = Packages.ca.phon.phonex.PhonexPattern.compile(".:N+");
			var matcher = phonexPattern.matcher(syll);
			if(matcher.find()) {
				var nucleus = (new IPATranscriptBuilder()).append(matcher.group()).toIPATranscript();

				var rowData = [];
				rowData[0] = table.getValueAt(row, 0);
				rowData[1] = table.getValueAt(row, "Record #");
				rowData[2] = nucleus;
				rowData[3] = actualSyllabification;
				vowelTable.addRow(rowData);
			}
		}
	}

	context.put("vowelTable", vowelTable);
}
]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="209" y="48"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="b22af37adc0e4a9b" name="Vowels (Total)" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="39eae2f7">
                                                <node id="598e44aa449b4309" name="obj" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="30ce4f66bf8f4c6c" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="277"/>
                                                    </extensions>
                                                </node>
                                                <node id="cd1c7130d14a4351" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                    <extensions>
                                                        <opqry:inventoryoptions>
                                                            <opqry:column caseSensitive="false" column="Vowel" ignoreDiacritics="true"/>
                                                        </opqry:inventoryoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="204" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="10ea9b12e8f049b9" name="DefaultTableDataSource" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="204" y="146"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="733c98b32c2e4d2d" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="72fd273">
                                                        <node id="7a87f8d8852147eb" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15">
                                                                    <oga:default for="arg1" type="java.lang.String"/>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="59be75fa8daa44d2" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="146"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="52bd63948b164fab" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="256" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d986160dcbcf4d7e" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="507" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <link dest="d986160dcbcf4d7e" destField="obj" source="52bd63948b164fab" sourceField="value"/>
                                                        <link dest="52bd63948b164fab" destField="obj" source="7a87f8d8852147eb" sourceField="value"/>
                                                        <link dest="52bd63948b164fab" destField="arg1" source="59be75fa8daa44d2" sourceField="name"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="speaker" ref="59be75fa8daa44d2"/>
                                                    <ogcn:published_input field="arg1" name="arg1" ref="7a87f8d8852147eb"/>
                                                    <ogcn:published_output field="value" name="value" ref="d986160dcbcf4d7e"/>
                                                    <extensions>
                                                        <oga:meta x="205" y="277">
                                                            <oga:default for="arg1" type="java.lang.String">Vowel Inventory_</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="1232952ac10d4297" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="total" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = count / total;

		rowData[2] = freq;
	}
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="357" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="ba92fb2d0d3844d9" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                    <extensions>
                                                        <opqry:sortoptions>
                                                            <opqry:sortBy column="Vowel" order="ascending" type="plain"/>
                                                        </opqry:sortoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="558" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="b7ae094ebc7a48f4" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="711" y="15"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="7b2d6525577d4b08" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="cb4c258">
                                                        <node id="6c838b5323d24987" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Vowel Inventory : $DATA</h3>")
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="51" y="48">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="bd289cc636ca423f" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="54" y="177">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="data" name="speaker" ref="6c838b5323d24987"/>
                                                    <ogcn:published_input field="data" name="bufferName" ref="bd289cc636ca423f"/>
                                                    <extensions>
                                                        <oga:meta x="868" y="14"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <link dest="ba92fb2d0d3844d9" destField="table" source="1232952ac10d4297" sourceField="table"/>
                                                <link dest="b7ae094ebc7a48f4" destField="data" source="ba92fb2d0d3844d9" sourceField="table"/>
                                                <link dest="733c98b32c2e4d2d" destField="speaker" source="30ce4f66bf8f4c6c" sourceField="obj"/>
                                                <link dest="7b2d6525577d4b08" destField="speaker" source="30ce4f66bf8f4c6c" sourceField="obj"/>
                                                <link dest="1232952ac10d4297" destField="total" source="10ea9b12e8f049b9" sourceField="rowCount"/>
                                                <link dest="10ea9b12e8f049b9" destField="obj" source="598e44aa449b4309" sourceField="obj"/>
                                                <link dest="b7ae094ebc7a48f4" destField="buffer" source="733c98b32c2e4d2d" sourceField="value"/>
                                                <link dest="7b2d6525577d4b08" destField="bufferName" source="b7ae094ebc7a48f4" sourceField="buffer"/>
                                                <link dest="1232952ac10d4297" destField="table" source="cd1c7130d14a4351" sourceField="table"/>
                                                <link dest="cd1c7130d14a4351" destField="table" source="598e44aa449b4309" sourceField="obj"/>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="30ce4f66bf8f4c6c"/>
                                            <ogcn:published_input field="obj" name="obj" ref="598e44aa449b4309"/>
                                            <extensions>
                                                <oga:meta x="445" y="50"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="65bf101fb2f14ead" name="Vowels (by Session)" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="6d4fec51">
                                                <node id="76e8171f93824e4d" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="453fc2350efc478e" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="277"/>
                                                    </extensions>
                                                </node>
                                                <node id="e8096b1c415d4b71" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                    <extensions>
                                                        <opqry:inventoryoptions>
                                                            <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                            <opqry:column caseSensitive="false" column="Vowel" ignoreDiacritics="true"/>
                                                        </opqry:inventoryoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="204" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="b65dd07081f94f95" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                    <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="columnName"><![CDATA[Session]]></oga:property>
                                                            <oga:property key="__script"><![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 
 /**
  * Split Table.js
  * 
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  * 
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a 
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/* 
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	
	if(col < 0) 
		return; // column not found
	
	var tableMap = new java.util.LinkedHashMap();
	
	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));
		
		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}
	
	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="204" y="146"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="a84edd9fd9184180" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="22b0ab5e">
                                                        <node id="d9ed09013a49449c" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15">
                                                                    <oga:default for="arg1" type="java.lang.String"/>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="23d7e1fdd6874eb9" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="146"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="fab81f0030e3406b" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="256" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ae004a49d79a4085" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="507" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <link dest="ae004a49d79a4085" destField="obj" source="fab81f0030e3406b" sourceField="value"/>
                                                        <link dest="fab81f0030e3406b" destField="obj" source="d9ed09013a49449c" sourceField="value"/>
                                                        <link dest="fab81f0030e3406b" destField="arg1" source="23d7e1fdd6874eb9" sourceField="name"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="speaker" ref="23d7e1fdd6874eb9"/>
                                                    <ogcn:published_input field="arg1" name="arg1" ref="d9ed09013a49449c"/>
                                                    <ogcn:published_output field="value" name="value" ref="ae004a49d79a4085"/>
                                                    <extensions>
                                                        <oga:meta x="205" y="277">
                                                            <oga:default for="arg1" type="java.lang.String">Vowel Inventory (by Session)_</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="35abd40b9b9f4fb0" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="tableMap" optional="false"/>
                                                    <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	
	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;
		
		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = count / total;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}
	
	context.put("freqTable", freqTable);
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="362" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="f25fd64007f74beb" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                    <extensions>
                                                        <opqry:sortoptions>
                                                            <opqry:sortBy column="Vowel" order="ascending" type="plain"/>
                                                        </opqry:sortoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="558" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="a7876fffb3de4666" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="711" y="15"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="2e9d54b2ee794331" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="37dfe0f3">
                                                        <node id="62e290107bd64979" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Vowel Inventory (by Session) : $DATA</h3>")
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="51" y="48">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="426b2500e544331" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="54" y="177">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="data" name="speaker" ref="62e290107bd64979"/>
                                                    <ogcn:published_input field="data" name="bufferName" ref="426b2500e544331"/>
                                                    <extensions>
                                                        <oga:meta x="870" y="15"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <link dest="a7876fffb3de4666" destField="data" source="f25fd64007f74beb" sourceField="table"/>
                                                <link dest="a84edd9fd9184180" destField="speaker" source="453fc2350efc478e" sourceField="obj"/>
                                                <link dest="2e9d54b2ee794331" destField="speaker" source="453fc2350efc478e" sourceField="obj"/>
                                                <link dest="a7876fffb3de4666" destField="buffer" source="a84edd9fd9184180" sourceField="value"/>
                                                <link dest="2e9d54b2ee794331" destField="bufferName" source="a7876fffb3de4666" sourceField="buffer"/>
                                                <link dest="e8096b1c415d4b71" destField="table" source="76e8171f93824e4d" sourceField="obj"/>
                                                <link dest="b65dd07081f94f95" destField="table" source="76e8171f93824e4d" sourceField="obj"/>
                                                <link dest="35abd40b9b9f4fb0" destField="tableMap" source="b65dd07081f94f95" sourceField="tableMap"/>
                                                <link dest="35abd40b9b9f4fb0" destField="table" source="e8096b1c415d4b71" sourceField="table"/>
                                                <link dest="f25fd64007f74beb" destField="table" source="35abd40b9b9f4fb0" sourceField="freqTable"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="453fc2350efc478e"/>
                                            <ogcn:published_input field="obj" name="obj" ref="76e8171f93824e4d"/>
                                            <extensions>
                                                <oga:meta x="450" y="173"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="6ac5430e4a2a4274" destField="table" source="4286091421414cd3" sourceField="obj"/>
                                        <link dest="b22af37adc0e4a9b" destField="speaker" source="f69bce99bd234bf6" sourceField="obj"/>
                                        <link dest="65bf101fb2f14ead" destField="speaker" source="f69bce99bd234bf6" sourceField="obj"/>
                                        <link dest="65bf101fb2f14ead" destField="obj" source="6ac5430e4a2a4274" sourceField="vowelTable"/>
                                        <link dest="b22af37adc0e4a9b" destField="obj" source="6ac5430e4a2a4274" sourceField="vowelTable"/>
                                        <extensions>
                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                        </extensions>
                                    </graph>
                                    <ogcn:published_input field="obj" name="table" ref="4286091421414cd3"/>
                                    <ogcn:published_input field="obj" name="obj" ref="f69bce99bd234bf6"/>
                                    <extensions>
                                        <oga:meta x="262" y="568"/>
                                    </extensions>
                                </ogcn:macro>
                                <ogcn:macro id="fbb7c1ceae774d2a" name="Vocalization Structure" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                    <graph id="18ab6ff7">
                                        <node id="82c3c022a6c244ba" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="15"/>
                                            </extensions>
                                        </node>
                                        <node id="d3c301bd634242c2" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="160"/>
                                            </extensions>
                                        </node>
                                        <node id="9c5ea98b7d7541ee" name="Add Structure Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="__script"><![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
}

function getStructure(ipa) {
	var structure = "";

	for(var i = 0; i < ipa.length(); i++) {
		var ele = ipa.elementAt(i);

		if(ele.featureSet.hasFeature("glottal")) {
			structure += "H";
		} else if(ele.featureSet.hasFeature("glide")) {
			structure += "G";
		} else if(ele.featureSet.hasFeature("c")) {
			structure += "C";
		} else if(ele.featureSet.hasFeature("v")) {
			structure += "V";
		} else {
			structure += ele.toString();
		}
	}
	
	return structure;
}

function tableOp(context, table) {
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "Structure");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var actualSyllabification = table.getValueAt(row, "Actual Syllabification (Word)");
		var ipa = (new IPATranscriptBuilder()).append(actualSyllabification).toIPATranscript();

		tableData[colIdx] = getStructure(ipa);
	}
}
]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="209" y="48"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="d6dcaea1e62046f7" name="Strucutres (Total)" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="2d6ff6">
                                                <node id="7d0ef2fe71254e04" name="TableDataSource" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.TableDataSource]]></oga:property>
                                                            <oga:property key="contextKey"/>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="17"/>
                                                    </extensions>
                                                </node>
                                                <node id="5c8fc34cf2af4389" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="277"/>
                                                    </extensions>
                                                </node>
                                                <node id="a12598f7c4e34dcc" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                    <extensions>
                                                        <opqry:inventoryoptions>
                                                            <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="true"/>
                                                        </opqry:inventoryoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="204" y="15"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="771d9807b4946a1" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="3ccc0f47">
                                                        <node id="2d3cee440e084941" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15">
                                                                    <oga:default for="arg1" type="java.lang.String"/>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="b2076b125f5f46e9" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="146"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3d6454dbd8164002" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="256" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="eea155121c344e5b" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="507" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <link dest="eea155121c344e5b" destField="obj" source="3d6454dbd8164002" sourceField="value"/>
                                                        <link dest="3d6454dbd8164002" destField="obj" source="2d3cee440e084941" sourceField="value"/>
                                                        <link dest="3d6454dbd8164002" destField="arg1" source="b2076b125f5f46e9" sourceField="name"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="speaker" ref="b2076b125f5f46e9"/>
                                                    <ogcn:published_input field="arg1" name="arg1" ref="2d3cee440e084941"/>
                                                    <ogcn:published_output field="value" name="value" ref="eea155121c344e5b"/>
                                                    <extensions>
                                                        <oga:meta x="205" y="277">
                                                            <oga:default for="arg1" type="java.lang.String">Vocalization Structure_</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="8ecf968b16c24594" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="total" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = count / total;

		rowData[2] = freq;
	}
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="357" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="33ee13c79ef4cc3" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                    <extensions>
                                                        <opqry:sortoptions>
                                                            <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                        </opqry:sortoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="558" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="177756b09f2c4e9c" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="711" y="15"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="6083f3b1fec0421a" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="602d7175">
                                                        <node id="fc87f3a92fe4bdf" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Vocalization Structure : $DATA</h3>")
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="51" y="48">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="ca9f4a047b4c47aa" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="54" y="177">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="data" name="speaker" ref="fc87f3a92fe4bdf"/>
                                                    <ogcn:published_input field="data" name="bufferName" ref="ca9f4a047b4c47aa"/>
                                                    <extensions>
                                                        <oga:meta x="868" y="14"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <link dest="33ee13c79ef4cc3" destField="table" source="8ecf968b16c24594" sourceField="table"/>
                                                <link dest="177756b09f2c4e9c" destField="data" source="33ee13c79ef4cc3" sourceField="table"/>
                                                <link dest="771d9807b4946a1" destField="speaker" source="5c8fc34cf2af4389" sourceField="obj"/>
                                                <link dest="6083f3b1fec0421a" destField="speaker" source="5c8fc34cf2af4389" sourceField="obj"/>
                                                <link dest="177756b09f2c4e9c" destField="buffer" source="771d9807b4946a1" sourceField="value"/>
                                                <link dest="6083f3b1fec0421a" destField="bufferName" source="177756b09f2c4e9c" sourceField="buffer"/>
                                                <link dest="8ecf968b16c24594" destField="table" source="a12598f7c4e34dcc" sourceField="table"/>
                                                <link dest="8ecf968b16c24594" destField="total" source="7d0ef2fe71254e04" sourceField="rowCount"/>
                                                <link dest="a12598f7c4e34dcc" destField="table" source="7d0ef2fe71254e04" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="5c8fc34cf2af4389"/>
                                            <ogcn:published_input field="obj" name="obj" ref="7d0ef2fe71254e04"/>
                                            <extensions>
                                                <oga:meta x="445" y="50"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="458fd744de5a4a6a" name="Strucutres (by Session)" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="70870619">
                                                <node id="b1a785f5231a4cf2" name="TableDataSource" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.TableDataSource]]></oga:property>
                                                            <oga:property key="contextKey"/>
                                                        </oga:settings>
                                                        <oga:meta x="7" y="26"/>
                                                    </extensions>
                                                </node>
                                                <node id="9b93f7a2752f43bd" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="277"/>
                                                    </extensions>
                                                </node>
                                                <node id="d622557e1ee74372" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                    <extensions>
                                                        <opqry:inventoryoptions>
                                                            <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                            <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="true"/>
                                                        </opqry:inventoryoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="204" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="cc5ba6cc895f4fec" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                    <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="columnName"><![CDATA[Session]]></oga:property>
                                                            <oga:property key="__script"><![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 
 /**
  * Split Table.js
  * 
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  * 
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a 
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/* 
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	
	if(col < 0) 
		return; // column not found
	
	var tableMap = new java.util.LinkedHashMap();
	
	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));
		
		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}
	
	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="204" y="146"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="ce3a7de449dd4232" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="5d4ac872">
                                                        <node id="c61173250dd4a3d" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15">
                                                                    <oga:default for="arg1" type="java.lang.String"/>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="d9b6501b1e694091" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="146"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d5562c4a97484642" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="256" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d2b59e7842d247e4" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="507" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <link dest="d2b59e7842d247e4" destField="obj" source="d5562c4a97484642" sourceField="value"/>
                                                        <link dest="d5562c4a97484642" destField="obj" source="c61173250dd4a3d" sourceField="value"/>
                                                        <link dest="d5562c4a97484642" destField="arg1" source="d9b6501b1e694091" sourceField="name"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="speaker" ref="d9b6501b1e694091"/>
                                                    <ogcn:published_input field="arg1" name="arg1" ref="c61173250dd4a3d"/>
                                                    <ogcn:published_output field="value" name="value" ref="d2b59e7842d247e4"/>
                                                    <extensions>
                                                        <oga:meta x="205" y="277">
                                                            <oga:default for="arg1" type="java.lang.String">Vocalization Structure (by Session)_</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="d579bb6fd1f1483a" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="tableMap" optional="false"/>
                                                    <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	
	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;
		
		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = count / total;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}
	
	context.put("freqTable", freqTable);
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="362" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="c7bf51c1114b4074" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                    <extensions>
                                                        <opqry:sortoptions>
                                                            <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                        </opqry:sortoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="558" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="7237bf01dd524687" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="711" y="15"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="56a985fdb892459c" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="36f471b8">
                                                        <node id="2d6b3fb1015c40b3" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Vocalization Structure (by Session) : $DATA</h3>")
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="51" y="48">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="cb868c6669664f33" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="54" y="177">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="data" name="speaker" ref="2d6b3fb1015c40b3"/>
                                                    <ogcn:published_input field="data" name="bufferName" ref="cb868c6669664f33"/>
                                                    <extensions>
                                                        <oga:meta x="870" y="15"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <link dest="7237bf01dd524687" destField="data" source="c7bf51c1114b4074" sourceField="table"/>
                                                <link dest="ce3a7de449dd4232" destField="speaker" source="9b93f7a2752f43bd" sourceField="obj"/>
                                                <link dest="56a985fdb892459c" destField="speaker" source="9b93f7a2752f43bd" sourceField="obj"/>
                                                <link dest="7237bf01dd524687" destField="buffer" source="ce3a7de449dd4232" sourceField="value"/>
                                                <link dest="56a985fdb892459c" destField="bufferName" source="7237bf01dd524687" sourceField="buffer"/>
                                                <link dest="d579bb6fd1f1483a" destField="tableMap" source="cc5ba6cc895f4fec" sourceField="tableMap"/>
                                                <link dest="d579bb6fd1f1483a" destField="table" source="d622557e1ee74372" sourceField="table"/>
                                                <link dest="c7bf51c1114b4074" destField="table" source="d579bb6fd1f1483a" sourceField="freqTable"/>
                                                <link dest="d622557e1ee74372" destField="table" source="b1a785f5231a4cf2" sourceField="obj"/>
                                                <link dest="cc5ba6cc895f4fec" destField="table" source="b1a785f5231a4cf2" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="9b93f7a2752f43bd"/>
                                            <ogcn:published_input field="obj" name="obj" ref="b1a785f5231a4cf2"/>
                                            <extensions>
                                                <oga:meta x="450" y="173"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="9c5ea98b7d7541ee" destField="table" source="82c3c022a6c244ba" sourceField="obj"/>
                                        <link dest="d6dcaea1e62046f7" destField="speaker" source="d3c301bd634242c2" sourceField="obj"/>
                                        <link dest="458fd744de5a4a6a" destField="speaker" source="d3c301bd634242c2" sourceField="obj"/>
                                        <link dest="d6dcaea1e62046f7" destField="obj" source="9c5ea98b7d7541ee" sourceField="table"/>
                                        <link dest="458fd744de5a4a6a" destField="obj" source="9c5ea98b7d7541ee" sourceField="table"/>
                                        <extensions>
                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                        </extensions>
                                    </graph>
                                    <ogcn:published_input field="obj" name="table" ref="82c3c022a6c244ba"/>
                                    <ogcn:published_input field="obj" name="obj" ref="d3c301bd634242c2"/>
                                    <extensions>
                                        <oga:meta x="268" y="698"/>
                                    </extensions>
                                </ogcn:macro>
                                <ogcn:macro id="35376622" name="Syllable Structure" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                    <graph id="2c246911">
                                        <node id="47c22615" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="15"/>
                                            </extensions>
                                        </node>
                                        <node id="cf6050cb379e46e4" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="15" y="160"/>
                                            </extensions>
                                        </node>
                                        <node id="45faec77" name="Create Syllable Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                            <output name="syllTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="__script"><![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	outputs.add("syllTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function getStructure(ipa) {
	var structure = "";

	for(var i = 0; i < ipa.length(); i++) {
		var ele = ipa.elementAt(i);

		if(ele.featureSet.hasFeature("glottal")) {
			structure += "H";
		} else if(ele.featureSet.hasFeature("glide")) {
			structure += "G";
		} else if(ele.featureSet.hasFeature("c")) {
			structure += "C";
		} else if(ele.featureSet.hasFeature("v")) {
			structure += "V";
		} else {
			structure += ele.toString();
		}
	}
	
	return structure;
}

function tableOp(context, table) {
	var syllTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	syllTable.setColumnTitle(0, "Session");
	syllTable.setColumnTitle(1, "Record");
	syllTable.setColumnTitle(2, "Syllable");
	syllTable.setColumnTitle(3, "Structure");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "Actual Syllabification (Word)")).toIPATranscript();
		var sylls = ipa.syllables();


		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var syll = sylls.get(syllIdx);

			var rowData = [];
			rowData[0] = table.getValueAt(row, 0);
			rowData[1] = table.getValueAt(row, "Record #");
			rowData[2] = syll;
			rowData[3] = getStructure(syll);
			syllTable.addRow(rowData);
		}
	}

	context.put("syllTable", syllTable);
}
]]></oga:property>
                                                </oga:settings>
                                                <oga:meta x="204" y="15"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="3c1623ed" name="Syllable Strucutre (Total)" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="797e0f03">
                                                <node id="77c929c0" name="obj" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="455" y="439"/>
                                                    </extensions>
                                                </node>
                                                <node id="1f50f0d1" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="455" y="439"/>
                                                    </extensions>
                                                </node>
                                                <node id="197b49e3" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                    <extensions>
                                                        <opqry:inventoryoptions>
                                                            <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="true"/>
                                                        </opqry:inventoryoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="405" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="1a8e8504" name="DefaultTableDataSource" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="397" y="147"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="22295b99a85b41d8" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="127b4e56">
                                                        <node id="a42d55557e4145d9" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15">
                                                                    <oga:default for="arg1" type="java.lang.String"/>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="4cda613c85bf4515" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="146"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="fd5d7ffcb2f24ee9" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="256" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="c2912363c64643ec" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="507" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <link dest="c2912363c64643ec" destField="obj" source="fd5d7ffcb2f24ee9" sourceField="value"/>
                                                        <link dest="fd5d7ffcb2f24ee9" destField="obj" source="a42d55557e4145d9" sourceField="value"/>
                                                        <link dest="fd5d7ffcb2f24ee9" destField="arg1" source="4cda613c85bf4515" sourceField="name"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="speaker" ref="4cda613c85bf4515"/>
                                                    <ogcn:published_input field="arg1" name="arg1" ref="a42d55557e4145d9"/>
                                                    <ogcn:published_output field="value" name="value" ref="c2912363c64643ec"/>
                                                    <extensions>
                                                        <oga:meta x="640" y="227">
                                                            <oga:default for="arg1" type="java.lang.String">Syllable Structure_</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="a8e35bac8bd74fce" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="total" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = count / total;

		rowData[2] = freq;
	}
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="558" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="784b6f83" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                    <extensions>
                                                        <opqry:sortoptions>
                                                            <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                        </opqry:sortoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="759" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="11874384" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="858" y="127"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="7808a1862cb14e24" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="4cb28d0d">
                                                        <node id="e78ab7126a704199" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Syllable Structure : $DATA</h3>")
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="51" y="48">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="f9e6b51722254bc9" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="54" y="177">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="data" name="speaker" ref="e78ab7126a704199"/>
                                                    <ogcn:published_input field="data" name="bufferName" ref="f9e6b51722254bc9"/>
                                                    <extensions>
                                                        <oga:meta x="1025" y="141"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <link dest="784b6f83" destField="table" source="a8e35bac8bd74fce" sourceField="table"/>
                                                <link dest="11874384" destField="data" source="784b6f83" sourceField="table"/>
                                                <link dest="22295b99a85b41d8" destField="speaker" source="1f50f0d1" sourceField="obj"/>
                                                <link dest="7808a1862cb14e24" destField="speaker" source="1f50f0d1" sourceField="obj"/>
                                                <link dest="a8e35bac8bd74fce" destField="total" source="1a8e8504" sourceField="rowCount"/>
                                                <link dest="1a8e8504" destField="obj" source="77c929c0" sourceField="obj"/>
                                                <link dest="11874384" destField="buffer" source="22295b99a85b41d8" sourceField="value"/>
                                                <link dest="7808a1862cb14e24" destField="bufferName" source="11874384" sourceField="buffer"/>
                                                <link dest="a8e35bac8bd74fce" destField="table" source="197b49e3" sourceField="table"/>
                                                <link dest="197b49e3" destField="table" source="77c929c0" sourceField="obj"/>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="1f50f0d1"/>
                                            <ogcn:published_input field="obj" name="obj" ref="77c929c0"/>
                                            <extensions>
                                                <oga:meta x="419" y="47"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="304f07bd533d4538" name="Syllable Strucutre (by Session)" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="409be1ae">
                                                <node id="4c22960fe18b4e7c" name="table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="34a75653eea64d15" name="speaker" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="390"/>
                                                    </extensions>
                                                </node>
                                                <node id="9b7b38075b0b44fc" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                    <extensions>
                                                        <opqry:inventoryoptions>
                                                            <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                            <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="true"/>
                                                        </opqry:inventoryoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="204" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="7c90b8bc" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                    <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="columnName"><![CDATA[Session]]></oga:property>
                                                            <oga:property key="__script"><![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 
 /**
  * Split Table.js
  * 
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  * 
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a 
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/* 
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	
	if(col < 0) 
		return; // column not found
	
	var tableMap = new java.util.LinkedHashMap();
	
	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));
		
		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}
	
	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="148" y="168"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="a2012897bda44f8" name="Setup Buffer Name" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="382a6f19">
                                                        <node id="e0004fc6644d405e" name="StringBuffer#&lt;init&gt;(String)" type="class:ca.gedge.opgraph.nodes.reflect.ConstructorNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15">
                                                                    <oga:default for="arg1" type="java.lang.String"/>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="15291fa43e874202" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="146"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d95498c8bf064f1e" name="StringBuffer#append(String)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[append(java.lang.String)]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="256" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3c933f56c09043ef" name="StringBuffer#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.StringBuffer]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="507" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <link dest="3c933f56c09043ef" destField="obj" source="d95498c8bf064f1e" sourceField="value"/>
                                                        <link dest="d95498c8bf064f1e" destField="obj" source="e0004fc6644d405e" sourceField="value"/>
                                                        <link dest="d95498c8bf064f1e" destField="arg1" source="15291fa43e874202" sourceField="name"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="speaker" ref="15291fa43e874202"/>
                                                    <ogcn:published_input field="arg1" name="arg1" ref="e0004fc6644d405e"/>
                                                    <ogcn:published_output field="value" name="value" ref="3c933f56c09043ef"/>
                                                    <extensions>
                                                        <oga:meta x="205" y="390">
                                                            <oga:default for="arg1" type="java.lang.String">Syllable Structure (by Session)_</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="c37e4ce7fc204887" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="tableMap" optional="false"/>
                                                    <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	
	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;
		
		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = count / total;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}
	
	context.put("freqTable", freqTable);
}
]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="357" y="36"/>
                                                    </extensions>
                                                </node>
                                                <node id="9df2519ebf114209" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                    <extensions>
                                                        <opqry:sortoptions>
                                                            <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                        </opqry:sortoptions>
                                                        <oga:settings/>
                                                        <oga:meta x="558" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="46e57ad97cd24932" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                    <input name="data" optional="false">Data to print</input>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="dataTemplate"><![CDATA[$DATA]]></oga:property>
                                                            <oga:property key="showText"><![CDATA[false]]></oga:property>
                                                            <oga:property key="showTable"><![CDATA[true]]></oga:property>
                                                            <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="711" y="15"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="361d5011baab480f" name="Add to Report Template" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                                    <graph id="2e6a7271">
                                                        <node id="4c45fbec63184847" name="Set Caption" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($caption = "<h3>Syllable Structure (by Session) : $DATA</h3>")
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="51" y="48">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <node id="7bb1cf0a3fe54122" name="Add to Template" type="class:ca.phon.app.opgraph.nodes.log.PrintBufferNode">
                                                            <input name="data" optional="false">Data to print</input>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="dataTemplate"><![CDATA[
#set($tableName = "$DATA")
#if($tables.containsKey($tableName))
#set($table = $tables.get($tableName))
#printTableWithCaption( $table $caption [] )
#else
$caption

No Results
#end
]]></oga:property>
                                                                    <oga:property key="showText"><![CDATA[true]]></oga:property>
                                                                    <oga:property key="showTable"><![CDATA[false]]></oga:property>
                                                                    <oga:property key="showHTML"><![CDATA[false]]></oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="54" y="177">
                                                                    <oga:default for="buffer" type="java.lang.String">Report Template</oga:default>
                                                                    <oga:default for="append" type="java.lang.Boolean">true</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="data" name="speaker" ref="4c45fbec63184847"/>
                                                    <ogcn:published_input field="data" name="bufferName" ref="7bb1cf0a3fe54122"/>
                                                    <extensions>
                                                        <oga:meta x="791" y="203"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <link dest="46e57ad97cd24932" destField="data" source="9df2519ebf114209" sourceField="table"/>
                                                <link dest="a2012897bda44f8" destField="speaker" source="34a75653eea64d15" sourceField="obj"/>
                                                <link dest="361d5011baab480f" destField="speaker" source="34a75653eea64d15" sourceField="obj"/>
                                                <link dest="46e57ad97cd24932" destField="buffer" source="a2012897bda44f8" sourceField="value"/>
                                                <link dest="361d5011baab480f" destField="bufferName" source="46e57ad97cd24932" sourceField="buffer"/>
                                                <link dest="9b7b38075b0b44fc" destField="table" source="4c22960fe18b4e7c" sourceField="obj"/>
                                                <link dest="7c90b8bc" destField="table" source="4c22960fe18b4e7c" sourceField="obj"/>
                                                <link dest="c37e4ce7fc204887" destField="tableMap" source="7c90b8bc" sourceField="tableMap"/>
                                                <link dest="c37e4ce7fc204887" destField="table" source="9b7b38075b0b44fc" sourceField="table"/>
                                                <link dest="9df2519ebf114209" destField="table" source="c37e4ce7fc204887" sourceField="freqTable"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="speaker" ref="34a75653eea64d15"/>
                                            <ogcn:published_input field="obj" name="obj" ref="4c22960fe18b4e7c"/>
                                            <extensions>
                                                <oga:meta x="423" y="170"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="45faec77" destField="table" source="47c22615" sourceField="obj"/>
                                        <link dest="3c1623ed" destField="obj" source="45faec77" sourceField="syllTable"/>
                                        <link dest="3c1623ed" destField="speaker" source="cf6050cb379e46e4" sourceField="obj"/>
                                        <link dest="304f07bd533d4538" destField="obj" source="45faec77" sourceField="syllTable"/>
                                        <link dest="304f07bd533d4538" destField="speaker" source="cf6050cb379e46e4" sourceField="obj"/>
                                        <extensions>
                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                        </extensions>
                                    </graph>
                                    <ogcn:published_input field="obj" name="table" ref="47c22615"/>
                                    <ogcn:published_input field="obj" name="obj" ref="cf6050cb379e46e4"/>
                                    <extensions>
                                        <oga:meta x="262" y="836"/>
                                    </extensions>
                                </ogcn:macro>
                                <link dest="39f91ef7" destField="speaker" source="45508fae" sourceField="obj"/>
                                <link dest="71606628" destField="tableMap" source="7cbf1d09" sourceField="obj"/>
                                <link dest="39f91ef7" destField="result total" source="c81dda4" sourceField="obj"/>
                                <link dest="39f91ef7" destField="table" source="578fcaef" sourceField="obj"/>
                                <link dest="71606628" destField="speaker" source="45508fae" sourceField="obj"/>
                                <link dest="39f91ef7" destField="tableMap" source="7cbf1d09" sourceField="obj"/>
                                <link dest="35376622" destField="obj" source="45508fae" sourceField="obj"/>
                                <link dest="35376622" destField="table" source="578fcaef" sourceField="obj"/>
                                <link dest="5c298b00" destField="speaker" source="45508fae" sourceField="obj"/>
                                <link dest="5c298b00" destField="data" source="578fcaef" sourceField="obj"/>
                                <link dest="9bee85a827324705" destField="tableMap" source="7cbf1d09" sourceField="obj"/>
                                <link dest="9bee85a827324705" destField="speaker" source="45508fae" sourceField="obj"/>
                                <link dest="9bee85a827324705" destField="table" source="578fcaef" sourceField="obj"/>
                                <link dest="9bee85a827324705" destField="result total" source="578fcaef" sourceField="rowCount"/>
                                <link dest="9dee81f2bd624468" destField="table" source="578fcaef" sourceField="obj"/>
                                <link dest="9dee81f2bd624468" destField="obj" source="45508fae" sourceField="obj"/>
                                <link dest="fbb7c1ceae774d2a" destField="table" source="578fcaef" sourceField="obj"/>
                                <link dest="fbb7c1ceae774d2a" destField="obj" source="45508fae" sourceField="obj"/>
                                <extensions>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="speaker" ref="45508fae"/>
                            <ogcn:published_input field="obj" name="table" ref="578fcaef"/>
                            <ogcn:published_input field="obj" name="tableMap" ref="7cbf1d09"/>
                            <ogcn:published_input field="obj" name="result total" ref="c81dda4"/>
                            <extensions>
                                <oga:meta x="625" y="65"/>
                            </extensions>
                        </ogcn:macro>
                        <link dest="7f149b7d" destField="table" source="60a76f15" sourceField="obj"/>
                        <link dest="5aee518f" destField="tableMap" source="7f149b7d" sourceField="tableMap"/>
                        <link dest="5aee518f" destField="result total" source="60a76f15" sourceField="rowCount"/>
                        <link dest="5aee518f" destField="table" source="60a76f15" sourceField="obj"/>
                        <link dest="5aee518f" destField="speaker" source="68d90fd6bd914ea2" sourceField="obj"/>
                        <extensions>
                            <oga:notes>
                                <oga:note color="0xffff96" height="795" title="Inputs" width="303" x="6" y="19"/>
                            </oga:notes>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="tableMap" ref="60a76f15"/>
                    <ogcn:published_input field="obj" name="speaker" ref="68d90fd6bd914ea2"/>
                    <extensions>
                        <oga:meta x="775" y="115"/>
                    </extensions>
                </ogcn:macro>
                <link dest="bbf482c5a66541f7" destField="speaker" source="5fc29abaa09040c1" sourceField="obj"/>
                <link dest="bbf482c5a66541f7" destField="tableMap" source="af4cdc9a1efb4b6e" sourceField="obj"/>
                <link dest="5fc29abaa09040c1" destField="obj" source="282a70f9" sourceField="obj"/>
                <link dest="350c5a14" destField="tableMap" source="bbf482c5a66541f7" sourceField="table"/>
                <link dest="350c5a14" destField="enabled" source="bbf482c5a66541f7" sourceField="exists"/>
                <link dest="350c5a14" destField="speaker" source="5fc29abaa09040c1" sourceField="obj"/>
                <link dest="f9aea4b" destField="data" source="64386b17" sourceField="value"/>
                <extensions>
                    <oga:notes>
                        <oga:note color="0xffff96" height="673" title="Inputs" width="255" x="22" y="139"/>
                    </oga:notes>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <ogcn:published_input field="obj" name="obj" ref="af4cdc9a1efb4b6e"/>
            <extensions>
                <oga:settings>
                    <oga:property key="ca.gedge.opgraph.nodes.reflect.IterableClassNode.className"><![CDATA[java.util.ArrayList]]></oga:property>
                </oga:settings>
                <oga:meta x="1081" y="131"/>
            </extensions>
        </ogcn:macro>
        <link dest="29ac654b" destField="project" source="55f4fba4" sourceField="obj"/>
        <link dest="29ac654b" destField="sessions" source="1ae2322c" sourceField="obj"/>
        <link dest="61e6ae5ee8ed4084" destField="project" source="29ac654b" sourceField="project"/>
        <link dest="d3211092b5054a20" destField="table" source="46ae9c22" sourceField="trueTable"/>
        <link dest="61208600" destField="collection" source="3da0e5db" sourceField="obj"/>
        <link dest="61208600" destField="obj" source="d3211092b5054a20" sourceField="tableMap"/>
        <link dest="61e6ae5ee8ed4084" destField="results" source="29ac654b" sourceField="results"/>
        <link dest="41a5af28" destField="parameters" source="dc596f57c3774064" sourceField="parameters"/>
        <link dest="46ae9c22" destField="table" source="61e6ae5ee8ed4084" sourceField="table"/>
        <extensions>
            <opqry:nodewizard type="ca.phon.app.opgraph.analysis.AnalysisWizardExtension">
                <opqry:info format="html" title="Velleman Analysis">
                    <opqry:message/>
                </opqry:info>
                <opqry:report-template name="Report Prefix"/>
                <opqry:report-template name="Report Suffix"/>
            </opqry:nodewizard>
            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
        </extensions>
    </graph>
</opgraph>
