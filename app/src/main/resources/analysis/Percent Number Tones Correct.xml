<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<opgraph xmlns="https://www.phon.ca/ns/opgraph" xmlns:nes="https://www.phon.ca/ns/node_editor" xmlns:oga="https://www.phon.ca/ns/opgraph-app" xmlns:ogcn="https://www.phon.ca/ns/opgraph-common-nodes" xmlns:opqry="https://phon.ca/ns/opgraph_query" xmlns:qry="http://phon.ling.mun.ca/ns/query">
    <graph id="root">
        <node id="7328a40688194f0f" name="Project" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey"><![CDATA[_project]]></oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.project.Project]]></oga:property>
                </oga:settings>
                <oga:meta x="20" y="60"/>
            </extensions>
        </node>
        <node id="23502a3bdf76403f" name="Selected Sessions" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey"><![CDATA[_selectedSessions]]></oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.ArrayList]]></oga:property>
                </oga:settings>
                <oga:meta x="20" y="341"/>
            </extensions>
        </node>
        <node id="687692fc" name="Setup Summary Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = new DefaultTableDataSource();
	var col = 0;
	table.setColumnTitle(col++, "Speaker");
	table.setColumnTitle(col++, "# Target");
	table.setColumnTitle(col++, "# Actual");
	table.setColumnTitle(col++, "Syllables Deleted");
	table.setColumnTitle(col++, "Syllables Epenthesized");
	table.setColumnTitle(col++, "# Correct");
	table.setColumnTitle(col++, "# Substituted");
	table.setColumnTitle(col++, "# Deleted");
	table.setColumnTitle(col++, "PNTC");

	context.put("table", table);
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="835" y="649"/>
            </extensions>
        </node>
        <node id="41c2d52c05f54592" name="Parameters" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <extensions>
                <oga:settings>
                    <oga:property key="filters.searchBy.searchBy"><![CDATA[Word]]></oga:property>
                    <oga:property key="filters.wordTiers.tiers"><![CDATA[Orthography,IPA Target,IPA Actual]]></oga:property>
                    <oga:property key="__script"><![CDATA[var GroupFilter = require("lib/GroupFilter").GroupFilter;
var AlignedGroupFilter = require("lib/TierFilter").TierFilter;
var WordFilter = require("lib/WordFilter").WordFilter;
var TierList = require("lib/TierList").TierList;
var AlignedWordFilter = require("lib/TierFilter").TierFilter;
var ParticipantFilter = require("lib/ParticipantFilter").ParticipantFilter;
var PatternFilter = require("lib/PatternFilter").PatternFilter;
var PatternType = require("lib/PatternFilter").PatternType;
var PNTC = require("lib/PNTC").PNTC;
var PNTCOptions = require("lib/PNTC").PNTCOptions;
var ResultType = require("lib/PhonScriptConstants").ResultType;
var SyllableFilter = require("lib/SyllableFilter").SyllableFilter;
var SearchByOptions = require("lib/SearchByOptions").SearchByOptions;

/********************************
 * Setup params
 *******************************/
var filters = {
	"pntc": new PNTCOptions("filters.pntc"),
	"searchBy": new SearchByOptions("filters.searchBy"),
	"group": new GroupFilter("filters.group"),
	"groupTiers": new TierList("filters.groupTiers"),
	"groupPattern": new PatternFilter("filters.groupPattern"),
	"alignedGroup": new AlignedGroupFilter("filters.alignedGroup"),
	"word": new WordFilter("filters.word"),
	"wordTiers": new TierList("filters.wordTiers"),
	"wordPattern": new PatternFilter("filters.wordPattern"),
	"alignedWord": new AlignedWordFilter("filters.alignedWord"),
	"syllable": new SyllableFilter("filters.syllable"),
	"speaker": new ParticipantFilter("filters.speaker")
};

var reportTitleParamInfo = {
	"id": "reportTitle",
	"title": "Report Title",
	"def": "Percent Number Tones Correct (PNTC)",
	"prompt": "Enter report title"
};
var reportTitleParam;
var reportTitle = reportTitleParamInfo.def;

var combineParticipantsParamInfo = {
	"id": "combineParticipants",
	"title": "Combine results",
	"desc": "Combine results for all selected participants",
	"def": false
};
var combineParticipantsParam;
var combineParticipants = combineParticipantsParamInfo.def;

function setup_params(params) {

	reportTitleParam = new StringScriptParam(
			reportTitleParamInfo.id,
			reportTitleParamInfo.title,
			reportTitleParamInfo.def);
		 reportTitleParam.setPrompt(reportTitleParamInfo.prompt);
	params.add(reportTitleParam);

	combineParticipantsParam = new BooleanScriptParam(
		combineParticipantsParamInfo.id,
		combineParticipantsParamInfo.desc,
		combineParticipantsParamInfo.title,
		combineParticipantsParamInfo.def);
	params.add(combineParticipantsParam);

	var optionsSep = new SeparatorScriptParam("Options", false);
	params.add(optionsSep);

	filters.pntc.param_setup(params);
	var insertIdx = params.size();

	filters.group.param_setup(params);
	filters.groupPattern.param_setup(params);
	
	var sep2 = new LabelScriptParam("", "<html><b>Aligned Group Filter</b></html>");
	params.add(sep2);
	filters.alignedGroup.param_setup(params);

	filters.word.searchByWordEnabled = false;
	filters.word.param_setup(params);
	filters.wordPattern.param_setup(params);
	
	var wordsep2 = new LabelScriptParam("", "<html><b>Aligned Word Filter</b></html>");
	params.add(wordsep2);
	filters.alignedWord.param_setup(params);
	var searchByWordListener = new java.beans.PropertyChangeListener {
		propertyChange: function (e) {
			var enabled = e.source.getValue(e.source.paramId);
			filters.wordPattern.setEnabled(enabled);
			filters.alignedWord.setEnabled(enabled);
			filters.wordTiers.setEnabled(enabled);
		}
	};
	filters.word.searchByWordParam.addPropertyChangeListener(filters.word.searchByWordParam.paramId, searchByWordListener);
	var enabled = filters.word.searchByWordParam.getValue(filters.word.searchByWordParam.paramId);
	filters.wordPattern.setEnabled(enabled);
	filters.alignedWord.setEnabled(enabled);

	filters.syllable.param_setup(params);

	filters.searchBy.includeSyllableOption = true;
	filters.searchBy.param_setup(params, filters.word.searchByWordParam, filters.syllable.searchBySyllableParam, insertIdx);

	var otherDataHeader = new SeparatorScriptParam("otherDataHeader", "Additional Tier Data", true);
	params.add(otherDataHeader);
	var sep = new LabelScriptParam("", "<html><b>Add aligned groups</b></html>");
	params.add(sep);
	filters.groupTiers.param_setup(params);
	var wordsep = new LabelScriptParam("", "<html><b>Add aligned words</b></html>");
	params.add(wordsep);
	filters.wordTiers.param_setup(params);
	filters.wordTiers.setEnabled(enabled);

	filters.speaker.param_setup(params);
}]]></oga:property>
                </oga:settings>
                <oga:meta x="25" y="696"/>
            </extensions>
        </node>
        <opqry:queryNode id="1f2a5721" name="Query : Aligned IPA Domains" type="ca.phon.app.opgraph.nodes.query.QueryNode">
            <qry:query xmlns="http://phon.ling.mun.ca/ns/query" date="2021-03-25T08:11:48.874-02:30" name="Aligned IPA Domains" uuid="ee44b898-fa31-4d6a-9c55-07447cc662d5">
                <script>
                    <url ref="Aligned IPA Domains" rel="stock"/>
                    <param id="filters.actualResultFilter.filterType">Phonex</param>
                    <param id="filters.alignedGroup.patternFilter.filterType">Plain text</param>
                    <param id="filters.alignedWord.patternFilter.filterType">Plain text</param>
                    <param id="filters.groupPattern.filterType">Plain text</param>
                    <param id="filters.searchBy.searchBy">Word</param>
                    <param id="filters.speaker.age1Comparator">equal to</param>
                    <param id="filters.speaker.age2Comparator">equal to</param>
                    <param id="filters.speaker.ageOperator">(select operator)</param>
                    <param id="filters.speaker.participantRole">(select role)</param>
                    <param id="filters.syllable.otherSyllTypePattern.filterType">Plain text</param>
                    <param id="filters.syllable.syllableType">Any syllable</param>
                    <param id="filters.targetResultFilter.filterType">Phonex</param>
                    <param id="filters.wordPattern.filterType">Plain text</param>
                    <param id="filters.wordTiers.tiers">Orthography,IPA Target,IPA Actual</param>
                    <param id="searchTier">IPA Target</param>
                </script>
            </qry:query>
            <extensions>
                <oga:settings/>
                <oga:meta x="441" y="136"/>
            </extensions>
        </opqry:queryNode>
        <ogcn:macro id="7486fc0611ca4abb" name="Get Report Title" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="409ba460">
                <node id="a9eac15f05d9404a" name="String#&lt;init&gt;(String)" type="class:ca.phon.opgraph.nodes.reflect.ConstructorNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.classMember"><![CDATA[<init>(java.lang.String)]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.declaredClass"><![CDATA[java.lang.String]]></oga:property>
                        </oga:settings>
                        <oga:meta x="15" y="15">
                            <oga:default for="arg1" type="java.lang.String">reportTitle</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="de9b7e61072844f3" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="215" y="15"/>
                    </extensions>
                </node>
                <node id="1771c90d512d494f" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                        </oga:settings>
                        <oga:meta x="392" y="15"/>
                    </extensions>
                </node>
                <link dest="de9b7e61072844f3" destField="arg1" source="a9eac15f05d9404a" sourceField="value"/>
                <link dest="1771c90d512d494f" destField="obj" source="de9b7e61072844f3" sourceField="value"/>
            </graph>
            <ogcn:published_input field="obj" name="parameters" ref="de9b7e61072844f3"/>
            <ogcn:published_output field="value" name="reportTitle" ref="1771c90d512d494f"/>
            <extensions>
                <oga:meta x="257" y="662"/>
            </extensions>
        </ogcn:macro>
        <ogcn:macro id="73d5137add6043a6" name="combineParticipants" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="2140ad4b">
                <node id="b08db04d89424752" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="271" y="993"/>
                    </extensions>
                </node>
                <node id="53373bd5311a48f2" type="class:ca.phon.opgraph.nodes.general.TextNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.general.TextNode.text"/>
                        </oga:settings>
                        <oga:meta x="482" y="1110"/>
                    </extensions>
                </node>
                <node id="490adfe76c05464e" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="481" y="1010"/>
                    </extensions>
                </node>
                <node id="3a35d7f7bd7d4b56" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[get(java.lang.Object)]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[java.util.Map]]></oga:property>
                        </oga:settings>
                        <oga:meta x="701" y="1029"/>
                    </extensions>
                </node>
                <node id="5be5ed6f68e6456a" name="Object" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[java.lang.Object]]></oga:property>
                        </oga:settings>
                        <oga:meta x="897" y="1038"/>
                    </extensions>
                </node>
                <node id="62992725f3b04c1a" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass"><![CDATA[java.lang.Boolean]]></oga:property>
                        </oga:settings>
                        <oga:meta x="1089" y="1051"/>
                    </extensions>
                </node>
                <link dest="3a35d7f7bd7d4b56" destField="obj" source="490adfe76c05464e" sourceField="obj"/>
                <link dest="5be5ed6f68e6456a" destField="obj" source="3a35d7f7bd7d4b56" sourceField="value"/>
                <link dest="62992725f3b04c1a" destField="obj" source="5be5ed6f68e6456a" sourceField="obj"/>
                <link dest="490adfe76c05464e" destField="obj" source="b08db04d89424752" sourceField="obj"/>
                <link dest="3a35d7f7bd7d4b56" destField="arg1" source="53373bd5311a48f2" sourceField="value"/>
                <extensions>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <ogcn:published_input field="obj" name="obj" ref="b08db04d89424752"/>
            <ogcn:published_input field="format" name="format" ref="53373bd5311a48f2"/>
            <ogcn:published_output field="obj" name="value" ref="62992725f3b04c1a"/>
            <extensions>
                <oga:meta x="280" y="742">
                    <oga:default for="format" type="java.lang.String">combineParticipants</oga:default>
                </oga:meta>
            </extensions>
        </ogcn:macro>
        <node id="bf49a282c8f84d90" name="Get Listing Title" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <output name="title" type="java.lang.String"/>
            <extensions>
                <oga:settings>
                    <oga:property key="filters.syllable.otherSyllTypePattern.filterType"><![CDATA[Plain text]]></oga:property>
                    <oga:property key="filters.syllable.syllableType"><![CDATA[Any syllable]]></oga:property>
                    <oga:property key="__script"><![CDATA[var GroupFilter = require("lib/GroupFilter").GroupFilter;
var WordFilter = require("lib/WordFilter").WordFilter;
var SyllableFilter = require("lib/SyllableFilter").SyllableFilter;

var filters = {
	"group": new GroupFilter("filters.group"),
	"word": new WordFilter("filters.word"),
	"syllable": new SyllableFilter("filters.syllable")
};

function init(intput, outputs) {
	outputs.add("title", "", false, java.lang.String);
}

function setup_params(params) {
	filters.group.param_setup(params);
	filters.word.param_setup(params);
	filters.syllable.param_setup(params);
}

function run(context) {
	var title = "PNTC by ";
	var domain = "Group";

	if(filters.word.isUseFilter()) {
		domain = "Word";
	}

	context.put("title", title + domain);
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="366" y="887"/>
            </extensions>
        </node>
        <node id="4d1cdaa729e34875" type="class:ca.phon.app.opgraph.nodes.table.ResultsToTableNode">
            <extensions>
                <oga:settings>
                    <oga:property key="includeSessionInfo"><![CDATA[true]]></oga:property>
                    <oga:property key="includeSpeakerInfo"><![CDATA[true]]></oga:property>
                    <oga:property key="includeMetadata"><![CDATA[true]]></oga:property>
                    <oga:property key="includeTierInfo"><![CDATA[true]]></oga:property>
                </oga:settings>
                <oga:meta x="712" y="119"/>
            </extensions>
        </node>
        <node id="2aabeb3d063f4e07" type="class:ca.phon.app.opgraph.nodes.SelectedParticipantsNode">
            <extensions>
                <oga:meta x="23" y="436">
                    <oga:default for="combine" type="java.lang.Boolean">false</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="ad540f2c84c343cc" type="class:ca.phon.app.opgraph.nodes.report.NewReportNode">
            <extensions>
                <oga:settings/>
                <oga:meta x="502" y="662"/>
            </extensions>
        </node>
        <node id="d16cfa45b97548d0" name="PNTC" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <output name="pntc" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <output name="resultsBySyll" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[importPackage(Packages.ca.phon.ipa.alignment)

var PNTC = require("lib/PNTC").PNTC;
var PNTCOptions = require("lib/PNTC").PNTCOptions;

var filters = {
	"pntc": new PNTCOptions("filters.pntc")
};

function init(inputs, outputs) {
	inputs.add("table", "", false,  false);
	
	outputs.add("pntc", "", false, DefaultTableDataSource);
	outputs.add("resultsBySyll", "", false, DefaultTableDataSource);
}

function setup_params(params) {
	filters.pntc.param_setup(params);
}

function setupColumns(table, inputTable) {
	var col = 0;

	for(var ic = 0; ic < inputTable.columnCount; ic++) {
		table.setColumnTitle(col++, inputTable.getColumnTitle(ic));
	}

	table.setColumnTitle(col++, "# Target");
	table.setColumnTitle(col++, "# Actual");
	table.setColumnTitle(col++, "Syllables Deleted");
	table.setColumnTitle(col++, "Syllables Epenthesized");
	table.setColumnTitle(col++, "# Correct");
	table.setColumnTitle(col++, "# Substituted");
	table.setColumnTitle(col++, "# Deleted");
	table.setColumnTitle(col++, "PNTC");
}

function copyRow(inputTable, rowIdx) {
	var row = new Array();
	var col = 0;
	for(var cidx = 0; cidx < inputTable.columnCount; cidx++) {
		row[col++] = inputTable.getValueAt(rowIdx, cidx);
	}
	return row;
}

function run(context) {
	var table = context.get("table");

	var pntc = new DefaultTableDataSource();
	var resultsBySyll = new DefaultTableDataSource();
	
	// setup pdc columns
	setupColumns(pntc, table);
	
	var expCol = 0;
	resultsBySyll.setColumnTitle(expCol++, "Session");
	resultsBySyll.setColumnTitle(expCol++, "Date");
	resultsBySyll.setColumnTitle(expCol++, "Speaker");
	resultsBySyll.setColumnTitle(expCol++, "Age");
	resultsBySyll.setColumnTitle(expCol++, "Record #");
	resultsBySyll.setColumnTitle(expCol++, "Group #");
	resultsBySyll.setColumnTitle(expCol++, "IPA Target");
	resultsBySyll.setColumnTitle(expCol++, "Target Tone");
	resultsBySyll.setColumnTitle(expCol++, "IPA Actual");
	resultsBySyll.setColumnTitle(expCol++, "Actual Tone");
	resultsBySyll.setColumnTitle(expCol++, "Syllable deleted");
	resultsBySyll.setColumnTitle(expCol++, "Syllable epenthesized");
	resultsBySyll.setColumnTitle(expCol++, "# Correct");
	resultsBySyll.setColumnTitle(expCol++, "# Substituted");
	resultsBySyll.setColumnTitle(expCol++, "# Deleted");

	for(var row = 0; row < table.rowCount; row++) {
		var ipaT = table.getValueAt(row, "IPA Target");
		var ipaA = table.getValueAt(row, "IPA Actual");
		var alignment = table.getValueAt(row, "Alignment");

		if(ipaT == null || ipaA == null || alignment == null) continue;
		if(alignment.length() == 0) continue;

		var phoneMap = PhoneMap.fromString(ipaT.audiblePhones(), 
			ipaA.audiblePhones(), alignment);

		var group = {
			getIPATarget: function() { return ipaT; },
			getIPAActual: function() { return ipaA; },
			getPhoneAlignment: function() { return phoneMap; }
		};

		var pntcData = PNTC.calc_pntc(group);

		var pntcRow = copyRow(table, row);
		pntcRow.push(pntcData.target);
		pntcRow.push(pntcData.actual);
		pntcRow.push(pntcData.syllDeleted);
		pntcRow.push(pntcData.epen);
		pntcRow.push(pntcData.correct);
		pntcRow.push(pntcData.substituted);
		pntcRow.push(pntcData.deleted);

		if(pntcData.correct + pntcData.substituted 
		  + pntcData.deleted + pntcData.epen > 0) {
			var pntcVal = (pntcData.correct) /
				(pntcData.correct + pntcData.substituted 
		 			 + pntcData.deleted + pntcData.epen);
		 	pntcRow.push(java.lang.Float.valueOf(pntcVal * 100.0));
		} else {
			pntcRow.push(java.lang.Float.valueOf(0.0));
		}
		
		pntc.addRow(pntcRow);

		for(var i = 0; i < pntcData.expanded_results.length; i++) {
			var expResult = pntcData.expanded_results[i];
			var expRow = new Array();
			expCol = 0;
			expRow[expCol++] = table.getValueAt(row, "Session");
			expRow[expCol++] = table.getValueAt(row, "Date");
			expRow[expCol++] = table.getValueAt(row, "Speaker");
			expRow[expCol++] = table.getValueAt(row, "Age");
			expRow[expCol++] = table.getValueAt(row, "Record #");
			expRow[expCol++] = table.getValueAt(row, "Group #");
			expRow[expCol++] = expResult.target;
			expRow[expCol++] = (expResult.target != null && expResult.target.length() > 0 
				? expResult.target.elementAt(0).getExtension(SyllabificationInfo).toneNumber
				: "");
			expRow[expCol++] = expResult.actual;
			expRow[expCol++] = (expResult.actual != null && expResult.actual.length() > 0 
				? expResult.actual.elementAt(0).getExtension(SyllabificationInfo).toneNumber
				: "");
			expRow[expCol++] = expResult.syllDeleted;
			expRow[expCol++] = expResult.epen;
			expRow[expCol++] = expResult.correct;
			expRow[expCol++] = expResult.substituted;
			expRow[expCol++] = expResult.deleted;
			
			resultsBySyll.addRow(expRow);
		}
	}

	context.put("pntc", pntc);
	context.put("resultsBySyll", resultsBySyll);
}]]></oga:property>
                </oga:settings>
                <oga:meta x="725" y="400"/>
            </extensions>
        </node>
        <node id="16390602" name="Summary Section Header" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
            <extensions>
                <oga:meta x="1072" y="649">
                    <oga:default for="sectionName" type="java.lang.String">All participants</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <ogcn:macro id="424c6a59" type="ca.phon.app.opgraph.nodes.ForEachParticipant">
            <graph id="4e1c898a">
                <node id="3759a36a" name="Current Speaker" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key"><![CDATA[_currentSpeaker]]></oga:property>
                        </oga:settings>
                        <oga:meta x="50" y="66"/>
                    </extensions>
                </node>
                <node id="459f9ec" name="Speaker tables" type="class:ca.phon.app.opgraph.nodes.ForEachParticipant$ParticipantTableNode">
                    <output name="_tableExists1" type="java.lang.Boolean">Does Table #1 have data</output>
                    <output name="_speakerTable1" type="ca.phon.query.report.datasource.TableDataSource">Table #1</output>
                    <output name="_tableExists2" type="java.lang.Boolean">Does Table #2 have data</output>
                    <output name="_speakerTable2" type="ca.phon.query.report.datasource.TableDataSource">Table #2</output>
                    <extensions>
                        <oga:meta x="53" y="352"/>
                    </extensions>
                </node>
                <node id="2bf28104" name="ReportTreeNode" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]></oga:property>
                        </oga:settings>
                        <oga:meta x="66" y="535"/>
                    </extensions>
                </node>
                <node id="829de2bad10b453f" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                        </oga:settings>
                        <oga:meta x="63" y="736"/>
                    </extensions>
                </node>
                <ogcn:macro id="945e057185e74864" name="If Speaker Has Results" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="568731e">
                        <node id="65b6213415b545ba" name="globalSummary" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                                </oga:settings>
                                <oga:meta x="15" y="15"/>
                            </extensions>
                        </node>
                        <node id="32b5ac269534e70" name="parent" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]></oga:property>
                                </oga:settings>
                                <oga:meta x="15" y="176"/>
                            </extensions>
                        </node>
                        <node id="37f25ba4" name="Participant" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                </oga:settings>
                                <oga:meta x="37" y="475"/>
                            </extensions>
                        </node>
                        <node id="397ebcf1" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.TableDataSource]]></oga:property>
                                </oga:settings>
                                <oga:meta x="27" y="790"/>
                            </extensions>
                        </node>
                        <node id="f9ec8c518ce419d" name="table by syll" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.TableDataSource]]></oga:property>
                                </oga:settings>
                                <oga:meta x="32" y="942"/>
                            </extensions>
                        </node>
                        <node id="7097238191cc406b" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                            <extensions>
                                <opqry:inventoryoptions>
                                    <opqry:automaticConfiguration configureAutomatically="false">
                                        <opqry:autoGrouping column="Session" grouping="true"/>
                                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                    </opqry:automaticConfiguration>
                                    <opqry:groupBy caseSensitive="true" column="Session"/>
                                    <opqry:column caseSensitive="true" column="IPA Target"/>
                                    <opqry:column caseSensitive="true" column="IPA Actual"/>
                                    <opqry:sumColumns>
                                        <opqry:columnName># Correct</opqry:columnName>
                                        <opqry:columnName># Substituted</opqry:columnName>
                                        <opqry:columnName># Deleted</opqry:columnName>
                                    </opqry:sumColumns>
                                </opqry:inventoryoptions>
                                <oga:settings/>
                                <oga:meta x="620" y="444"/>
                            </extensions>
                        </node>
                        <node id="1cf0102c" name="Participant#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember"><![CDATA[toString()]]></oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass"><![CDATA[ca.phon.session.Participant]]></oga:property>
                                </oga:settings>
                                <oga:meta x="285" y="488"/>
                            </extensions>
                        </node>
                        <node id="bf91f855b0c44e7b" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                            <extensions>
                                <opqry:inventoryoptions>
                                    <opqry:automaticConfiguration configureAutomatically="false">
                                        <opqry:autoGrouping column="Session" grouping="true"/>
                                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                    </opqry:automaticConfiguration>
                                    <opqry:groupBy caseSensitive="true" column="Session"/>
                                    <opqry:column caseSensitive="true" column="Target Tone"/>
                                    <opqry:column caseSensitive="true" column="Actual Tone"/>
                                    <opqry:sumColumns>
                                        <opqry:columnName># Correct</opqry:columnName>
                                        <opqry:columnName># Substituted</opqry:columnName>
                                        <opqry:columnName># Deleted</opqry:columnName>
                                    </opqry:sumColumns>
                                </opqry:inventoryoptions>
                                <oga:settings/>
                                <oga:meta x="620" y="565"/>
                            </extensions>
                        </node>
                        <node id="9cb801a1e39443e7" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                            <extensions>
                                <opqry:inventoryoptions>
                                    <opqry:automaticConfiguration configureAutomatically="false">
                                        <opqry:autoGrouping column="Session" grouping="true"/>
                                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                    </opqry:automaticConfiguration>
                                    <opqry:column caseSensitive="true" column="Session"/>
                                    <opqry:sumColumns>
                                        <opqry:columnName># Target</opqry:columnName>
                                        <opqry:columnName># Actual</opqry:columnName>
                                        <opqry:columnName>Syllables Deleted</opqry:columnName>
                                        <opqry:columnName>Syllables Epenthesized</opqry:columnName>
                                        <opqry:columnName># Correct</opqry:columnName>
                                        <opqry:columnName># Substituted</opqry:columnName>
                                        <opqry:columnName># Deleted</opqry:columnName>
                                    </opqry:sumColumns>
                                </opqry:inventoryoptions>
                                <oga:settings/>
                                <oga:meta x="407" y="807"/>
                            </extensions>
                        </node>
                        <node id="330f3b313e7240b4" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                            <extensions>
                                <oga:meta x="1241" y="99"/>
                            </extensions>
                        </node>
                        <node id="fcb3e9a99f704e31" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                            <extensions>
                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false" likeOnTop="true">
                                    <opqry:sortBy column="IPA Target" order="ascending" type="ipa"/>
                                    <opqry:sortBy column="IPA Actual" order="ascending" type="ipa"/>
                                </opqry:sortoptions>
                                <oga:settings/>
                                <oga:meta x="817" y="444"/>
                            </extensions>
                        </node>
                        <node id="3b0f9f4cd83e4d69" name="Sort by Tone Numbers" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                            <input name="table" optional="false"/>
                            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("table", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}


function run(context) {
	var table = context.get("table");
	var rowData = table.getRowData();

	var targetIdx = table.getColumnIndex("Target Tone");
	var actualIdx = table.getColumnIndex("Actual Tone");
	
	var comparator = new java.util.Comparator() {
		compare: function (row1, row2) {
			var row1Target = row1[targetIdx];
			var row1TargetTone = 
				(row1Target != null && row1Target.length() > 0
					? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row1Target))
					: java.lang.Integer.valueOf(0));

			var row2Target = row2[targetIdx];
			var row2TargetTone = 
				(row1Target != null && row2Target.length() > 0
					? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row2Target))
					: java.lang.Integer.valueOf(0));
			var targetCmp = row1TargetTone.compareTo(row2TargetTone);

			if(targetCmp == 0) {
				var row1Actual = row1[actualIdx];
				var row1ActualTone = 
					(row1Actual != null && row1Actual.length() > 0
						? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row1Actual))
						: java.lang.Integer.valueOf(0));

				var row2Actual = row2[actualIdx];
				var row2ActualTone = 
					(row2Actual != null && row2Actual.length() > 0
						? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row2Actual))
						: java.lang.Integer.valueOf(0));

				if(row1ActualTone == row2ActualTone) {
					return 0;
				} else {
					if(row1ActualTone == row1TargetTone) {
						return java.lang.Integer.MIN_VALUE;
					} else if(row2ActualTone == row2TargetTone) {
						return java.lang.Integer.MAX_VALUE;
					} else {
						return row1ActualTone.compareTo(row2ActualTone);
					}
				}
			} else {
				return targetCmp;
			}
		}
	};
	java.util.Collections.sort(rowData, comparator);	
}
]]></oga:property>
                                </oga:settings>
                                <oga:meta x="817" y="565"/>
                            </extensions>
                        </node>
                        <node id="25619fcf2da34e39" type="class:ca.phon.app.opgraph.nodes.table.ColumnSumNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="columns"><![CDATA[# Target
# Actual
Syllables Deleted
Syllables Epenthesized
# Correct
# Substituted
# Deleted]]></oga:property>
                                </oga:settings>
                                <oga:meta x="604" y="806"/>
                            </extensions>
                        </node>
                        <node id="fedd30a922bd4fe4" type="class:ca.phon.app.opgraph.nodes.table.AddColumnNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="column"><![CDATA[PNTC]]></oga:property>
                                    <oga:property key="columnIndex"><![CDATA[-1]]></oga:property>
                                    <oga:property key="__script"><![CDATA[/*
params = {label, "Add a new column to the input table using javascript.", "<html><b>Add column to table</b></html>"}
;
*/

function getRowValue(table, row) {
	var correct = table.getValueAt(row, "# Correct").floatValue();
	var sub = table.getValueAt(row, "# Substituted").floatValue();
	var del = table.getValueAt(row, "# Deleted").floatValue();

	var ptnc = (correct) / (correct + sub + del);
	ptnc *= 100.0;
	return java.lang.Float.valueOf(ptnc);
}
]]></oga:property>
                                </oga:settings>
                                <oga:meta x="801" y="807"/>
                            </extensions>
                        </node>
                        <node id="8bc2b22d540c4238" name="Summary Table" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[false]]></oga:property>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"><![CDATA[Total]]></oga:property>
                                </oga:settings>
                                <oga:meta x="1241" y="240">
                                    <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                                </oga:meta>
                            </extensions>
                        </node>
                        <node id="2a52dcc4c5ea4f17" name="Add to Global Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                            <input name="speaker" optional="false"/>
                            <input name="globalSummary" optional="false"/>
                            <input name="speakerSummary" optional="false"/>
                            <output name="globalSummary" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("speaker", "", false, false);
	inputs.add("globalSummary", "", false, false);
	inputs.add("speakerSummary", "", false, false);

	outputs.add("globalSummary", "", false, DefaultTableDataSource);
}

function run(context) {
	var speaker = context.get("speaker");
	var globalSummary = context.get("globalSummary");
	var speakerSummary = context.get("speakerSummary");
	var speakerRow = speakerSummary.rowCount-1;

	var rowData = [];
	var col = 0;
	rowData[col++] = speaker;
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Target");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Actual");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "Syllables Deleted");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "Syllables Epenthesized");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Correct");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Substituted");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Deleted");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "PNTC");
	globalSummary.addRow(rowData);
}
]]></oga:property>
                                </oga:settings>
                                <oga:meta x="1238" y="986"/>
                            </extensions>
                        </node>
                        <node id="d5e3cc4bdf5b4556" name="IPA Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                </oga:settings>
                                <oga:meta x="1241" y="401">
                                    <oga:default for="sectionName" type="java.lang.String">IPA Patterns</oga:default>
                                </oga:meta>
                            </extensions>
                        </node>
                        <node id="79b00403d5af49dc" name="Tonal Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                </oga:settings>
                                <oga:meta x="1241" y="562">
                                    <oga:default for="sectionName" type="java.lang.String">Tonal Patterns</oga:default>
                                </oga:meta>
                            </extensions>
                        </node>
                        <link dest="330f3b313e7240b4" destField="parent" source="32b5ac269534e70" sourceField="obj"/>
                        <link dest="8bc2b22d540c4238" destField="table" source="fedd30a922bd4fe4" sourceField="table"/>
                        <link dest="8bc2b22d540c4238" destField="parent" source="330f3b313e7240b4" sourceField="section"/>
                        <link dest="d5e3cc4bdf5b4556" destField="parent" source="8bc2b22d540c4238" sourceField="parent"/>
                        <link dest="2a52dcc4c5ea4f17" destField="globalSummary" source="65b6213415b545ba" sourceField="obj"/>
                        <link dest="25619fcf2da34e39" destField="table" source="9cb801a1e39443e7" sourceField="table"/>
                        <link dest="3b0f9f4cd83e4d69" destField="table" source="bf91f855b0c44e7b" sourceField="table"/>
                        <link dest="79b00403d5af49dc" destField="table" source="3b0f9f4cd83e4d69" sourceField="table"/>
                        <link dest="79b00403d5af49dc" destField="parent" source="d5e3cc4bdf5b4556" sourceField="parent"/>
                        <link dest="d5e3cc4bdf5b4556" destField="table" source="fcb3e9a99f704e31" sourceField="table"/>
                        <link dest="fedd30a922bd4fe4" destField="table" source="25619fcf2da34e39" sourceField="table"/>
                        <link dest="2a52dcc4c5ea4f17" destField="speakerSummary" source="fedd30a922bd4fe4" sourceField="table"/>
                        <link dest="fcb3e9a99f704e31" destField="table" source="7097238191cc406b" sourceField="table"/>
                        <link dest="9cb801a1e39443e7" destField="table" source="397ebcf1" sourceField="obj"/>
                        <link dest="7097238191cc406b" destField="table" source="f9ec8c518ce419d" sourceField="obj"/>
                        <link dest="bf91f855b0c44e7b" destField="table" source="f9ec8c518ce419d" sourceField="obj"/>
                        <link dest="1cf0102c" destField="obj" source="37f25ba4" sourceField="obj"/>
                        <link dest="330f3b313e7240b4" destField="sectionName" source="1cf0102c" sourceField="value"/>
                        <link dest="2a52dcc4c5ea4f17" destField="speaker" source="37f25ba4" sourceField="obj"/>
                        <extensions>
                            <oga:notes>
                                <oga:note color="0xffc864" height="937" title="Report" width="399" x="1158" y="29"/>
                            </oga:notes>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="parent" ref="32b5ac269534e70"/>
                    <ogcn:published_input field="obj" name="globalSummary" ref="65b6213415b545ba"/>
                    <ogcn:published_input field="obj" name="speaker" ref="37f25ba4"/>
                    <ogcn:published_input field="obj" name="table" ref="397ebcf1"/>
                    <ogcn:published_input field="obj" name="tableBySyll" ref="f9ec8c518ce419d"/>
                    <extensions>
                        <oga:meta x="739" y="133"/>
                    </extensions>
                </ogcn:macro>
                <node id="77804fac050f4940" type="class:ca.phon.opgraph.nodes.logic.LogicalNotNode">
                    <extensions>
                        <oga:meta x="484" y="361"/>
                    </extensions>
                </node>
                <node id="eaa2144f36734388" name="Global Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass"><![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]></oga:property>
                        </oga:settings>
                        <oga:meta x="900" y="714"/>
                    </extensions>
                </node>
                <node id="715fdf6cb0e4c06" name="Add to Global Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                    <input name="speaker" optional="false"/>
                    <input name="globalSummary" optional="false"/>
                    <output name="globalSummary" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                    <extensions>
                        <oga:settings>
                            <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("speaker", "", false, false);
	inputs.add("globalSummary", "", false, false);

	outputs.add("globalSummary", "", false, DefaultTableDataSource);
}

function run(context) {
	var speaker = context.get("speaker");
	var globalSummary = context.get("globalSummary");

	var rowData = [];
	var col = 0;
	rowData[col++] = speaker;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0;
	rowData[col++] = 0.0;
	globalSummary.addRow(rowData);
}
]]></oga:property>
                        </oga:settings>
                        <oga:meta x="739" y="387"/>
                    </extensions>
                </node>
                <link dest="945e057185e74864" destField="globalSummary" source="829de2bad10b453f" sourceField="obj"/>
                <link dest="715fdf6cb0e4c06" destField="globalSummary" source="829de2bad10b453f" sourceField="obj"/>
                <link dest="eaa2144f36734388" destField="obj" source="829de2bad10b453f" sourceField="obj"/>
                <link dest="715fdf6cb0e4c06" destField="enabled" source="77804fac050f4940" sourceField="result"/>
                <link dest="945e057185e74864" destField="parent" source="2bf28104" sourceField="obj"/>
                <link dest="77804fac050f4940" destField="x" source="459f9ec" sourceField="_tableExists1"/>
                <link dest="945e057185e74864" destField="enabled" source="459f9ec" sourceField="_tableExists1"/>
                <link dest="945e057185e74864" destField="speaker" source="3759a36a" sourceField="obj"/>
                <link dest="715fdf6cb0e4c06" destField="speaker" source="3759a36a" sourceField="obj"/>
                <link dest="945e057185e74864" destField="table" source="459f9ec" sourceField="_speakerTable1"/>
                <link dest="945e057185e74864" destField="tableBySyll" source="459f9ec" sourceField="_speakerTable2"/>
                <extensions>
                    <oga:notes>
                        <oga:note color="0xffff96" height="460" title="Iteration" width="311" x="33" y="25"/>
                        <oga:note color="0xffff96" height="260" title="Output" width="319" x="833" y="655"/>
                        <oga:note color="0xffff96" height="401" title="Inputs" width="328" x="23" y="514"/>
                    </oga:notes>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <input name="_inputTable1" optional="true">Input table # 1</input>
            <input name="_inputTable2" optional="true">Input table # 2</input>
            <ogcn:published_input field="obj" name="reportNode" ref="2bf28104"/>
            <ogcn:published_input field="obj" name="summaryTable" ref="829de2bad10b453f"/>
            <ogcn:published_output field="obj" name="obj" ref="eaa2144f36734388"/>
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.ForEachParticipant.numTables"><![CDATA[2]]></oga:property>
                </oga:settings>
                <oga:meta x="1357" y="177"/>
            </extensions>
        </ogcn:macro>
        <node id="8c69a6a9b71d496c" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
            <extensions>
                <opqry:inventoryoptions>
                    <opqry:automaticConfiguration configureAutomatically="false">
                        <opqry:autoGrouping column="Session" grouping="true"/>
                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                    </opqry:automaticConfiguration>
                    <opqry:groupBy caseSensitive="true" column="Session"/>
                    <opqry:column caseSensitive="true" column="IPA Target"/>
                    <opqry:column caseSensitive="true" column="IPA Actual"/>
                    <opqry:sumColumns>
                        <opqry:columnName># Correct</opqry:columnName>
                        <opqry:columnName># Substituted</opqry:columnName>
                        <opqry:columnName># Deleted</opqry:columnName>
                    </opqry:sumColumns>
                </opqry:inventoryoptions>
                <oga:settings/>
                <oga:meta x="850" y="968"/>
            </extensions>
        </node>
        <node id="b8bf243401de41c5" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
            <extensions>
                <opqry:inventoryoptions>
                    <opqry:automaticConfiguration configureAutomatically="false">
                        <opqry:autoGrouping column="Session" grouping="true"/>
                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                    </opqry:automaticConfiguration>
                    <opqry:groupBy caseSensitive="true" column="Session"/>
                    <opqry:column caseSensitive="true" column="Target Tone"/>
                    <opqry:column caseSensitive="true" column="Actual Tone"/>
                    <opqry:sumColumns>
                        <opqry:columnName># Correct</opqry:columnName>
                        <opqry:columnName># Substituted</opqry:columnName>
                        <opqry:columnName># Deleted</opqry:columnName>
                    </opqry:sumColumns>
                </opqry:inventoryoptions>
                <oga:settings/>
                <oga:meta x="868" y="1123"/>
            </extensions>
        </node>
        <node id="fae6aaad3ecc48ce" type="class:ca.phon.app.opgraph.nodes.table.ColumnSumNode">
            <extensions>
                <oga:settings>
                    <oga:property key="columns"><![CDATA[# Target
# Actual
Syllables Deleted
Syllables Epenthesized
# Correct
# Substituted
# Deleted]]></oga:property>
                </oga:settings>
                <oga:meta x="893" y="797"/>
            </extensions>
        </node>
        <node id="5f491e1e4ce940b8" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
            <extensions>
                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false" likeOnTop="true">
                    <opqry:sortBy column="IPA Target" order="ascending" type="ipa"/>
                    <opqry:sortBy column="IPA Actual" order="ascending" type="ipa"/>
                </opqry:sortoptions>
                <oga:settings/>
                <oga:meta x="1157" y="968"/>
            </extensions>
        </node>
        <node id="e9b185df520e499e" name="Sort by Tone Numbers" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("table", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}


function run(context) {
	var table = context.get("table");
	var rowData = table.getRowData();

	var targetIdx = table.getColumnIndex("Target Tone");
	var actualIdx = table.getColumnIndex("Actual Tone");
	
	var comparator = new java.util.Comparator() {
		compare: function (row1, row2) {
			var row1Target = row1[targetIdx];
			var row1TargetTone = 
				(row1Target != null && row1Target.length() > 0
					? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row1Target))
					: java.lang.Integer.valueOf(0));

			var row2Target = row2[targetIdx];
			var row2TargetTone = 
				(row1Target != null && row2Target.length() > 0
					? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row2Target))
					: java.lang.Integer.valueOf(0));
			var targetCmp = row1TargetTone.compareTo(row2TargetTone);

			if(targetCmp == 0) {
				var row1Actual = row1[actualIdx];
				var row1ActualTone = 
					(row1Actual != null && row1Actual.length() > 0
						? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row1Actual))
						: java.lang.Integer.valueOf(0));

				var row2Actual = row2[actualIdx];
				var row2ActualTone = 
					(row2Actual != null && row2Actual.length() > 0
						? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row2Actual))
						: java.lang.Integer.valueOf(0));

				if(row1ActualTone == row2ActualTone) {
					return 0;
				} else {
					if(row1ActualTone == row1TargetTone) {
						return java.lang.Integer.MIN_VALUE;
					} else if(row2ActualTone == row2TargetTone) {
						return java.lang.Integer.MAX_VALUE;
					} else {
						return row1ActualTone.compareTo(row2ActualTone);
					}
				}
			} else {
				return targetCmp;
			}
		}
	};
	java.util.Collections.sort(rowData, comparator);	
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="1157" y="1123"/>
            </extensions>
        </node>
        <node id="58d4dda" name="Listing" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[false]]></oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"><![CDATA[Date
Tier
Range
Result
Alignment]]></oga:property>
                </oga:settings>
                <oga:meta x="853" y="1317">
                    <oga:default for="sectionName" type="java.lang.String">Listing</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="4243819a" name="Calc PNTC" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script"><![CDATA[function init(inputs, outputs) {
	inputs.add("table", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = context.get("table");
	var row = table.rowCount -1;

	if(row >= 0) {
		var correct = table.getValueAt(row, "# Correct");
		var sub = table.getValueAt(row, "# Substituted");
		var del = table.getValueAt(row, "# Deleted");

		if(correct + sub + del > 0) {
			var pntc = (correct) / (correct + sub + del);
			table.setValueAt(row, table.columnCount - 1, java.lang.Float.valueOf(pntc * 100.0));
		} else {
			table.setValueAt(row, table.columnCount - 1, java.lang.Float.valueOf(0.0));
		}
	}
}
]]></oga:property>
                </oga:settings>
                <oga:meta x="1085" y="797"/>
            </extensions>
        </node>
        <node id="114dba02" name="Summary Table" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1413" y="649">
                    <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="f5b01fd99f564618" name="IPA Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1414" y="968">
                    <oga:default for="sectionName" type="java.lang.String">IPA Patterns</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="62f9d5c7" name="Tonal Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns"><![CDATA[true]]></oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1413" y="1123">
                    <oga:default for="sectionName" type="java.lang.String">Tonal Patterns</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <link dest="7486fc0611ca4abb" destField="parameters" source="41c2d52c05f54592" sourceField="parameters"/>
        <link dest="ad540f2c84c343cc" destField="reportName" source="7486fc0611ca4abb" sourceField="reportTitle"/>
        <link dest="16390602" destField="parent" source="ad540f2c84c343cc" sourceField="root"/>
        <link dest="114dba02" destField="parent" source="16390602" sourceField="section"/>
        <link dest="e9b185df520e499e" destField="table" source="b8bf243401de41c5" sourceField="table"/>
        <link dest="62f9d5c7" destField="table" source="e9b185df520e499e" sourceField="table"/>
        <link dest="5f491e1e4ce940b8" destField="table" source="8c69a6a9b71d496c" sourceField="table"/>
        <link dest="f5b01fd99f564618" destField="table" source="5f491e1e4ce940b8" sourceField="table"/>
        <link dest="f5b01fd99f564618" destField="parent" source="114dba02" sourceField="parent"/>
        <link dest="62f9d5c7" destField="parent" source="f5b01fd99f564618" sourceField="parent"/>
        <link dest="4243819a" destField="table" source="fae6aaad3ecc48ce" sourceField="table"/>
        <link dest="114dba02" destField="table" source="4243819a" sourceField="table"/>
        <link dest="d16cfa45b97548d0" destField="table" source="4d1cdaa729e34875" sourceField="table"/>
        <link dest="8c69a6a9b71d496c" destField="table" source="d16cfa45b97548d0" sourceField="resultsBySyll"/>
        <link dest="b8bf243401de41c5" destField="table" source="d16cfa45b97548d0" sourceField="resultsBySyll"/>
        <link dest="58d4dda" destField="table" source="d16cfa45b97548d0" sourceField="pntc"/>
        <link dest="58d4dda" destField="parent" source="ad540f2c84c343cc" sourceField="root"/>
        <link dest="bf49a282c8f84d90" destField="parameters" source="41c2d52c05f54592" sourceField="parameters"/>
        <link dest="58d4dda" destField="sectionName" source="bf49a282c8f84d90" sourceField="title"/>
        <link dest="1f2a5721" destField="sessions" source="23502a3bdf76403f" sourceField="obj"/>
        <link dest="1f2a5721" destField="project" source="7328a40688194f0f" sourceField="obj"/>
        <link dest="1f2a5721" destField="parameters" source="41c2d52c05f54592" sourceField="parameters"/>
        <link dest="4d1cdaa729e34875" destField="project" source="1f2a5721" sourceField="project"/>
        <link dest="4d1cdaa729e34875" destField="results" source="1f2a5721" sourceField="results"/>
        <link dest="424c6a59" destField="_inputTable1" source="d16cfa45b97548d0" sourceField="pntc"/>
        <link dest="424c6a59" destField="_inputTable2" source="d16cfa45b97548d0" sourceField="resultsBySyll"/>
        <link dest="2aabeb3d063f4e07" destField="combine" source="73d5137add6043a6" sourceField="value"/>
        <link dest="73d5137add6043a6" destField="obj" source="41c2d52c05f54592" sourceField="parameters"/>
        <link dest="424c6a59" destField="participants" source="2aabeb3d063f4e07" sourceField="participants"/>
        <link dest="fae6aaad3ecc48ce" destField="table" source="424c6a59" sourceField="obj"/>
        <link dest="58d4dda" destField="enabled" source="424c6a59" sourceField="finished"/>
        <link dest="114dba02" destField="enabled" source="424c6a59" sourceField="finished"/>
        <link dest="424c6a59" destField="reportNode" source="ad540f2c84c343cc" sourceField="root"/>
        <link dest="424c6a59" destField="summaryTable" source="687692fc" sourceField="table"/>
        <extensions>
            <opqry:nodewizard type="ca.phon.app.opgraph.analysis.AnalysisWizardExtension">
                <opqry:info format="html" title="Percent Number Tones Correct">
                    <opqry:message/>
                </opqry:info>
                <opqry:node ref="41c2d52c05f54592" showAsStep="true">
                    <opqry:info format="html" title="Parameters">
                        <opqry:message/>
                    </opqry:info>
                </opqry:node>
            </opqry:nodewizard>
            <oga:notes>
                <oga:note color="0xffff96" height="576" title="Analysis Inputs" width="382" x="10" y="10">These inputs are provided to all analyses.</oga:note>
                <oga:note color="0xffc864" height="508" title="Start Report" width="715" x="10" y="597">Reports are created in a tree structure. When combined using the Analysis Composer the report tree created by the 'New Report' node will be added as a subtree to the larger report.</oga:note>
                <oga:note color="0x9696ff" height="581" title="Query" width="580" x="404" y="6"/>
                <oga:note color="0xffc864" height="928" title="Summary Report" width="1026" x="748" y="597"/>
                <oga:note color="0x96ff96" height="579" title="Analysis by Participant" width="759" x="990" y="11"/>
            </oga:notes>
            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
        </extensions>
    </graph>
</opgraph>
