<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<opgraph xmlns="https://www.phon.ca/ns/opgraph" xmlns:nes="https://www.phon.ca/ns/node_editor" xmlns:oga="https://www.phon.ca/ns/opgraph-app" xmlns:ogcn="https://www.phon.ca/ns/opgraph-common-nodes" xmlns:opqry="https://phon.ca/ns/opgraph_query" xmlns:qry="http://phon.ling.mun.ca/ns/query">
    <graph id="root">
        <node id="7328a40688194f0f" name="Project" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_project]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[ca.phon.project.Project]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="20" y="60"/>
            </extensions>
        </node>
        <node id="23502a3bdf76403f" name="Selected Sessions" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_selectedSessions]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="20" y="341"/>
            </extensions>
        </node>
        <node id="6933cb7db3c14099" name="Selected Participants" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_selectedParticipants]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="20" y="442"/>
            </extensions>
        </node>
        <node id="687692fc" name="Setup Summary Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script">
                        <![CDATA[function init(inputs, outputs) {
	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = new DefaultTableDataSource();
	var col = 0;
	table.setColumnTitle(col++, "Speaker");
	table.setColumnTitle(col++, "# Target");
	table.setColumnTitle(col++, "# Actual");
	table.setColumnTitle(col++, "Syllables deleted");
	table.setColumnTitle(col++, "Syllables epenthesized");
	table.setColumnTitle(col++, "# Correct");
	table.setColumnTitle(col++, "# Substituted");
	table.setColumnTitle(col++, "# Deleted");
	table.setColumnTitle(col++, "PNTC");

	context.put("table", table);
}
]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="835" y="649"/>
            </extensions>
        </node>
        <node id="41c2d52c05f54592" name="Parameters" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <extensions>
                <oga:settings>
                    <oga:property key="filters.searchBy.searchBy">
                        <![CDATA[Word]]>
                    </oga:property>
                    <oga:property key="reportTitle">
                        <![CDATA[Percent Number Tones Correct (PNTC)]]>
                    </oga:property>
                    <oga:property key="__script">
                        <![CDATA[var GroupFilter = require("lib/GroupFilter").GroupFilter;
var AlignedGroupFilter = require("lib/TierFilter").TierFilter;
var WordFilter = require("lib/WordFilter").WordFilter;
var TierList = require("lib/TierList").TierList;
var AlignedWordFilter = require("lib/TierFilter").TierFilter;
var ParticipantFilter = require("lib/ParticipantFilter").ParticipantFilter;
var PatternFilter = require("lib/PatternFilter").PatternFilter;
var PatternType = require("lib/PatternFilter").PatternType;
var PNTC = require("lib/PNTC").PNTC;
var PNTCOptions = require("lib/PNTC").PNTCOptions;
var ResultType = require("lib/PhonScriptConstants").ResultType;
var SyllableFilter = require("lib/SyllableFilter").SyllableFilter;
var SearchByOptions = require("lib/SearchByOptions").SearchByOptions;

/********************************
 * Setup params
 *******************************/
var filters = {
	"pntc": new PNTCOptions("filters.pntc"),
	"searchBy": new SearchByOptions("filters.searchBy"),
	"group": new GroupFilter("filters.group"),
	"groupTiers": new TierList("filters.groupTiers"),
	"groupPattern": new PatternFilter("filters.groupPattern"),
	"alignedGroup": new AlignedGroupFilter("filters.alignedGroup"),
	"word": new WordFilter("filters.word"),
	"wordTiers": new TierList("filters.wordTiers"),
	"wordPattern": new PatternFilter("filters.wordPattern"),
	"alignedWord": new AlignedWordFilter("filters.alignedWord"),
	"syllable": new SyllableFilter("filters.syllable"),
	"speaker": new ParticipantFilter("filters.speaker")
};

var reportTitleParamInfo = {
	"id": "reportTitle",
	"title": "Report Title",
	"def": "Report",
	"prompt": "Enter report title"
};
var reportTitleParam;
var reportTitle = reportTitleParamInfo.def;

function setup_params(params) {

	reportTitleParam = new StringScriptParam(
			reportTitleParamInfo.id,
			reportTitleParamInfo.title,
			reportTitleParamInfo.def);
		 reportTitleParam.setPrompt(reportTitleParamInfo.prompt);
	params.add(reportTitleParam);

	filters.pntc.param_setup(params);
	var insertIdx = params.size();

	filters.group.param_setup(params);
	filters.groupPattern.param_setup(params);

	var sep = new LabelScriptParam("", "<html><b>Add Aligned Groups</b></html>");
	params.add(sep);
	filters.groupTiers.param_setup(params);
	var sep2 = new LabelScriptParam("", "<html><b>Aligned Group Filter</b></html>");
	params.add(sep2);
	filters.alignedGroup.param_setup(params);

	filters.word.searchByWordEnabled = false;
	filters.word.param_setup(params);
	filters.wordPattern.param_setup(params);

	var wordsep = new LabelScriptParam("", "<html><b>Add Aligned Words</b></html>");
	params.add(wordsep);
	filters.wordTiers.param_setup(params);

	var wordsep2 = new LabelScriptParam("", "<html><b>Aligned Word Filter</b></html>");
	params.add(wordsep2);
	filters.alignedWord.param_setup(params);
	var searchByWordListener = new java.beans.PropertyChangeListener {
		propertyChange: function (e) {
			var enabled = e.source.getValue(e.source.paramId);
			filters.wordPattern.setEnabled(enabled);
			filters.alignedWord.setEnabled(enabled);
		}
	};
	filters.word.searchByWordParam.addPropertyChangeListener(filters.word.searchByWordParam.paramId, searchByWordListener);
	var enabled = filters.word.searchByWordParam.getValue(filters.word.searchByWordParam.paramId);
	filters.wordPattern.setEnabled(enabled);
	filters.alignedWord.setEnabled(enabled);

	filters.syllable.param_setup(params);

	filters.searchBy.includeSyllableOption = true;
	filters.searchBy.param_setup(params, filters.word.searchByWordParam, filters.syllable.searchBySyllableParam, insertIdx);
}]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="20" y="662"/>
            </extensions>
        </node>
        <node id="4c88d38e" name="Add Required Tiers" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="paramMap" optional="false"/>
            <output name="paramMap" type="java.util.Map"/>
            <output name="groupSuffix" type="java.lang.String"/>
            <output name="bySyllable" type="java.lang.Boolean"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script">
                        <![CDATA[function init(inputs, outputs) {
	inputs.add("paramMap", "", false, false);

	outputs.add("paramMap", "", false, java.util.Map);
	outputs.add("groupSuffix", "", false, java.lang.String);
	outputs.add("bySyllable", "", false, java.lang.Boolean);
}

function run(context) {
	var params = context.get("paramMap");

	var searchBy = params.get("filters.searchBy.searchBy");
	var paramName = "filters.groupTiers.tiers";
	var groupSuffix = " (Group)";
	if(searchBy == "Word") {
		paramName = "filters.wordTiers.tiers";
		groupSuffix = " (Word)";
	}
	var val = params.get(paramName);

	if(val == null) {
		val = new java.lang.String();
	}
	var buffer = new java.lang.StringBuffer();
	buffer.append(val);

	if(!buffer.toString().contains("Target Syllabification")) {
		buffer.append((buffer.length() > 0 ? ", " : "") + 
			"Target Syllabification");
	}
	if(!buffer.toString().contains("Actual Syllabification")) {
		buffer.append((buffer.length() > 0 ? ", " : "") + 
			"Actual Syllabification");
	}
	if(!buffer.toString().contains("Alignment")) {
		buffer.append((buffer.length() > 0 ? ", " : "") +
			"Alignment");
	}

	params.put(paramName, buffer.toString());

	context.put("groupSuffix", groupSuffix);
	context.put("bySyllable", params.get("filters.syllable.searchBySyllable"));
}
]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="452" y="371"/>
            </extensions>
        </node>
        <ogcn:macro id="7486fc0611ca4abb" name="Get Report Title" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="7b370b14">
                <node id="a9eac15f05d9404a" name="String#&lt;init&gt;(String)" type="class:ca.phon.opgraph.nodes.reflect.ConstructorNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.classMember">
                                <![CDATA[<init>(java.lang.String)]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.declaredClass">
                                <![CDATA[java.lang.String]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="15" y="15">
                            <oga:default for="arg1" type="java.lang.String">reportTitle</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="de9b7e61072844f3" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[get(java.lang.Object)]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.util.Map]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="215" y="15"/>
                    </extensions>
                </node>
                <node id="1771c90d512d494f" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[toString()]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="392" y="15"/>
                    </extensions>
                </node>
                <link dest="de9b7e61072844f3" destField="arg1" source="a9eac15f05d9404a" sourceField="value"/>
                <link dest="1771c90d512d494f" destField="obj" source="de9b7e61072844f3" sourceField="value"/>
            </graph>
            <ogcn:published_input field="obj" name="parameters" ref="de9b7e61072844f3"/>
            <ogcn:published_output field="value" name="reportTitle" ref="1771c90d512d494f"/>
            <extensions>
                <oga:meta x="257" y="662"/>
            </extensions>
        </ogcn:macro>
        <opqry:queryNode id="511cd23" name="Query : PNTC" type="ca.phon.app.opgraph.nodes.query.QueryNode">
            <qry:query xmlns="http://phon.ling.mun.ca/ns/query" date="2020-07-16T15:48:42.298-02:30" name="PNTC" uuid="7c012705-9430-47df-94a2-80f464c3b4cb">
                <script>
                    <url ref="PNTC" rel="stock"/>
                    <param id="filters.alignedGroup.patternFilter.filterType">Plain text</param>
                    <param id="filters.alignedWord.patternFilter.filterType">Plain text</param>
                    <param id="filters.groupPattern.filterType">Plain text</param>
                    <param id="filters.searchBy.searchBy">Word</param>
                    <param id="filters.syllable.otherSyllTypePattern.filterType">Plain text</param>
                    <param id="filters.syllable.syllableType">Any syllable</param>
                    <param id="filters.wordPattern.filterType">Plain text</param>
                    <param id="filters.wordTiers.tiers">Target Syllabification, Actual Syllabification, Alignment</param>
                </script>
            </qry:query>
            <extensions>
                <oga:settings/>
                <oga:meta x="445" y="126"/>
            </extensions>
        </opqry:queryNode>
        <node id="ad540f2c84c343cc" type="class:ca.phon.app.opgraph.nodes.report.NewReportNode">
            <extensions>
                <oga:settings/>
                <oga:meta x="502" y="662"/>
            </extensions>
        </node>
        <node id="4d1cdaa729e34875" type="class:ca.phon.app.opgraph.nodes.table.ResultsToTableNode">
            <extensions>
                <oga:settings>
                    <oga:property key="includeSessionInfo">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeSpeakerInfo">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeMetadata">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeTierInfo">
                        <![CDATA[true]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="726" y="117"/>
            </extensions>
        </node>
        <node id="16390602" name="Summary Section Header" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
            <extensions>
                <oga:meta x="1072" y="649">
                    <oga:default for="sectionName" type="java.lang.String">All participants</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="74498387" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
            <extensions>
                <oga:settings>
                    <oga:property key="__scriptName">
                        <![CDATA[Split Table]]>
                    </oga:property>
                    <oga:property key="columnName">
                        <![CDATA[Speaker]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="1118" y="147"/>
            </extensions>
        </node>
        <node id="5bf1378b" name="Shape Data" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <input name="groupSuffix" optional="false"/>
            <input name="bySyllable" optional="false"/>
            <output name="sylltable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script">
                        <![CDATA[importPackage(Packages.ca.phon.ipa.alignment)
importClass(Packages.ca.phon.syllable.SyllabificationInfo)

function init(inputs, outputs) {
	inputs.add("table", "", false, false);
	inputs.add("groupSuffix", "", false, false);
	inputs.add("bySyllable", "", false, false);

	outputs.add("sylltable", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = context.get("table");
	var groupSuffix = context.get("groupSuffix");
	var bySyllable = context.get("bySyllable");

	var sylltable = new DefaultTableDataSource();
	context.put("sylltable", sylltable);

	var col = 0;
	sylltable.setColumnTitle(col++, "Session");
	sylltable.setColumnTitle(col++, "Speaker");
	sylltable.setColumnTitle(col++, "Age");
	sylltable.setColumnTitle(col++, "IPA Target");
	sylltable.setColumnTitle(col++, "IPA Actual");
	sylltable.setColumnTitle(col++, "# Target");
	sylltable.setColumnTitle(col++, "# Actual");
	sylltable.setColumnTitle(col++, "Syllables deleted");
	sylltable.setColumnTitle(col++, "Syllables epenthesized");
	sylltable.setColumnTitle(col++, "# Correct");
	sylltable.setColumnTitle(col++, "# Substituted");
	sylltable.setColumnTitle(col++, "# Deleted");
	sylltable.setColumnTitle(col++, "Target Tone");
	sylltable.setColumnTitle(col++, "Actual Tone");
	
	var syllableAligner = new SyllableAligner();

	for(var row = 0; row < table.rowCount; row++) {
		var targetData = table.getValueAt(row, "Target Syllabification" + groupSuffix);
		var actualData = table.getValueAt(row, "Actual Syllabification" + groupSuffix);
		var alignmentData = table.getValueAt(row, "Alignment" + groupSuffix);

		var ipaT = IPATranscript.parseIPATranscript(targetData);
		SyllabificationInfo.setupSyllabificationInfo(ipaT);
		var ipaA = IPATranscript.parseIPATranscript(actualData);
		SyllabificationInfo.setupSyllabificationInfo(ipaA);
		var alignment = PhoneMap.fromString(ipaT, ipaA, alignmentData);
		var syllAlignment = syllableAligner.calculateSyllableAlignment(ipaT, ipaA, alignment);

		if(bySyllable == false) {
			for(var alignIdx = 0; alignIdx < syllAlignment.alignmentLength; alignIdx++) {
				var alignedEles = syllAlignment.getAlignedElements(alignIdx);

				var targetSyll = alignedEles.get(0);
				var targetToneNumber = (targetSyll != null && targetSyll.length() > 0 ? 
					targetSyll.elementAt(0).getExtension(SyllabificationInfo).toneNumber : new java.lang.String());
				var actualSyll = alignedEles.get(1);
				var actualToneNumber = (actualSyll != null && actualSyll.length() > 0 ? 
					actualSyll.elementAt(0).getExtension(SyllabificationInfo).toneNumber : new java.lang.String());
				
				// create row
				var rowData = [];
				col = 0;
				rowData[col++] = table.getValueAt(row, "Session");
				rowData[col++] = table.getValueAt(row, "Speaker");
				rowData[col++] = table.getValueAt(row, "Age");
				rowData[col++] = targetSyll;
				rowData[col++] = actualSyll;
				rowData[col++] = (targetSyll == null ? 0 : 1);
				rowData[col++] = (actualSyll == null ? 0 : 1);
				rowData[col++] = (actualSyll == null ? 1 : 0);
				rowData[col++] = (targetSyll == null ? 1 : 0);
				rowData[col++] = (targetToneNumber.equals(actualToneNumber) ? 1 : 0);
				rowData[col++] = (targetToneNumber.length() > 0 && actualToneNumber.length() > 0 && !targetToneNumber.equals(actualToneNumber) ? 1 : 0);
				rowData[col++] = (targetToneNumber.length() > 0 && actualToneNumber.length() == 0 ? 1 : 0);
				rowData[col++] = targetToneNumber;
				rowData[col++] = actualToneNumber;
				sylltable.addRow(rowData);
			}
		} else {
			var targetToneNumber = (ipaT != null && ipaT.length() > 0 ? 
				ipaT.elementAt(0).getExtension(SyllabificationInfo).toneNumber : new java.lang.String());
			var actualToneNumber = (ipaA != null && ipaA.length() > 0 ? 
				ipaA.elementAt(0).getExtension(SyllabificationInfo).toneNumber : new java.lang.String());

			var rowData = [];
			col = 0;
			rowData[col++] = table.getValueAt(row, "Session");
			rowData[col++] = table.getValueAt(row, "Speaker");
			rowData[col++] = table.getValueAt(row, "Age");
			rowData[col++] = table.getValueAt(row, "IPA Target");
			rowData[col++] = table.getValueAt(row, "IPA Actual");
			rowData[col++] = table.getValueAt(row, "# Target");
			rowData[col++] = table.getValueAt(row, "# Actual");
			rowData[col++] = table.getValueAt(row, "Syllables deleted");
			rowData[col++] = table.getValueAt(row, "Syllables epenthesized");
			rowData[col++] = table.getValueAt(row, "# Correct");
			rowData[col++] = table.getValueAt(row, "# Substituted");
			rowData[col++] = table.getValueAt(row, "# Deleted");
			rowData[col++] = targetToneNumber;
			rowData[col++] = actualToneNumber;
			sylltable.addRow(rowData);
		}
	}
}
]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="724" y="381"/>
            </extensions>
        </node>
        <node id="e610bf8b98aa4f44" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
            <extensions>
                <oga:settings>
                    <oga:property key="__scriptName">
                        <![CDATA[Split Table]]>
                    </oga:property>
                    <oga:property key="columnName">
                        <![CDATA[Speaker]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="1102" y="324"/>
            </extensions>
        </node>
        <node id="8c69a6a9b71d496c" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
            <extensions>
                <opqry:inventoryoptions>
                    <opqry:automaticConfiguration configureAutomatically="false">
                        <opqry:autoGrouping column="Session" grouping="true"/>
                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                    </opqry:automaticConfiguration>
                    <opqry:groupBy caseSensitive="true" column="Session"/>
                    <opqry:column caseSensitive="true" column="IPA Target"/>
                    <opqry:column caseSensitive="true" column="IPA Actual"/>
                    <opqry:sumColumns>
                        <opqry:columnName># Correct</opqry:columnName>
                        <opqry:columnName># Substituted</opqry:columnName>
                        <opqry:columnName># Deleted</opqry:columnName>
                    </opqry:sumColumns>
                </opqry:inventoryoptions>
                <oga:settings/>
                <oga:meta x="850" y="968"/>
            </extensions>
        </node>
        <node id="b8bf243401de41c5" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
            <extensions>
                <opqry:inventoryoptions>
                    <opqry:automaticConfiguration configureAutomatically="false">
                        <opqry:autoGrouping column="Session" grouping="true"/>
                        <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                    </opqry:automaticConfiguration>
                    <opqry:groupBy caseSensitive="true" column="Session"/>
                    <opqry:column caseSensitive="true" column="Target Tone"/>
                    <opqry:column caseSensitive="true" column="Actual Tone"/>
                    <opqry:sumColumns>
                        <opqry:columnName># Correct</opqry:columnName>
                        <opqry:columnName># Substituted</opqry:columnName>
                        <opqry:columnName># Deleted</opqry:columnName>
                    </opqry:sumColumns>
                </opqry:inventoryoptions>
                <oga:settings/>
                <oga:meta x="868" y="1123"/>
            </extensions>
        </node>
        <ogcn:macro id="74d6979e" name="For Each Participant" type="ca.phon.opgraph.nodes.reflect.IterableClassNode">
            <graph id="fd186db">
                <node id="c1f475d" name="Current  Speaker" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key">
                                <![CDATA[currentValue]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="20" y="27"/>
                    </extensions>
                </node>
                <node id="bcac3bee051f447b" name="Word Table Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[java.util.Map]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="50" y="207"/>
                    </extensions>
                </node>
                <node id="7bb5cd1986884741" name="Syllable Table Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[java.util.Map]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="50" y="316"/>
                    </extensions>
                </node>
                <ogcn:macro id="66021052a34740c5" name="Report Node" type="ca.phon.opgraph.nodes.reflect.IterableClassNode">
                    <graph id="33477fa7">
                        <node id="64dae43e16a54dff" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass">
                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                    </oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key">
                                        <![CDATA[currentValue]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="772" y="535"/>
                            </extensions>
                        </node>
                    </graph>
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.IterableClassNode.className">
                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="50" y="433"/>
                    </extensions>
                </ogcn:macro>
                <node id="80f2c53fd6f44d3d" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="81" y="678"/>
                    </extensions>
                </node>
                <node id="aab2c54" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[toString()]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="205" y="27"/>
                    </extensions>
                </node>
                <node id="34caf719d61a48ef" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                    <extensions>
                        <oga:meta x="1382" y="152"/>
                    </extensions>
                </node>
                <ogcn:macro id="d2d46dfe6fb4caa" name="Get Table For Speaker (Word)" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="60ff09ad">
                        <node id="64d0f2b7ceb2476b" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="132" y="116"/>
                            </extensions>
                        </node>
                        <node id="ef176e053f544a59" name="arg1" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.lang.Object]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="129" y="241"/>
                            </extensions>
                        </node>
                        <node id="4162111c6c374df5" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="452" y="143"/>
                            </extensions>
                        </node>
                        <node id="6f895775cbea4dfa" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                        <![CDATA[get(java.lang.Object)]]>
                                    </oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="656" y="139"/>
                            </extensions>
                        </node>
                        <node id="84b2737b6c6d42d6" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="874" y="148"/>
                            </extensions>
                        </node>
                        <link dest="6f895775cbea4dfa" destField="arg1" source="ef176e053f544a59" sourceField="obj"/>
                        <link dest="4162111c6c374df5" destField="obj" source="64d0f2b7ceb2476b" sourceField="obj"/>
                        <link dest="84b2737b6c6d42d6" destField="obj" source="6f895775cbea4dfa" sourceField="value"/>
                        <link dest="6f895775cbea4dfa" destField="obj" source="4162111c6c374df5" sourceField="obj"/>
                        <extensions>
                            <oga:notes>
                                <oga:note color="0xffff96" height="351" title="Inputs" width="340" x="47" y="55"/>
                            </oga:notes>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="speaker" ref="ef176e053f544a59"/>
                    <ogcn:published_input field="obj" name="tableMap" ref="64d0f2b7ceb2476b"/>
                    <ogcn:published_output field="obj" name="table" ref="84b2737b6c6d42d6"/>
                    <extensions>
                        <oga:meta x="423" y="204"/>
                    </extensions>
                </ogcn:macro>
                <ogcn:macro id="4c64b990d45249bf" name="Get Table For Speaker (Syll)" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="2a428f1">
                        <node id="74a8f842467f4bcc" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="132" y="116"/>
                            </extensions>
                        </node>
                        <node id="d89642eea7fe4272" name="arg1" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.lang.Object]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="129" y="241"/>
                            </extensions>
                        </node>
                        <node id="6ea731616e8643d6" name="Map" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="452" y="143"/>
                            </extensions>
                        </node>
                        <node id="30298c62e28341ac" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                        <![CDATA[get(java.lang.Object)]]>
                                    </oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="656" y="139"/>
                            </extensions>
                        </node>
                        <node id="48a25e4c02ff479b" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="874" y="148"/>
                            </extensions>
                        </node>
                        <link dest="30298c62e28341ac" destField="arg1" source="d89642eea7fe4272" sourceField="obj"/>
                        <link dest="6ea731616e8643d6" destField="obj" source="74a8f842467f4bcc" sourceField="obj"/>
                        <link dest="48a25e4c02ff479b" destField="obj" source="30298c62e28341ac" sourceField="value"/>
                        <link dest="30298c62e28341ac" destField="obj" source="6ea731616e8643d6" sourceField="obj"/>
                        <extensions>
                            <oga:notes>
                                <oga:note color="0xffff96" height="351" title="Inputs" width="340" x="47" y="55"/>
                            </oga:notes>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="speaker" ref="d89642eea7fe4272"/>
                    <ogcn:published_input field="obj" name="tableMap" ref="74a8f842467f4bcc"/>
                    <ogcn:published_output field="obj" name="table" ref="48a25e4c02ff479b"/>
                    <extensions>
                        <oga:meta x="473" y="592"/>
                    </extensions>
                </ogcn:macro>
                <node id="e782a973f1fb415f" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                    <extensions>
                        <opqry:inventoryoptions>
                            <opqry:automaticConfiguration configureAutomatically="false">
                                <opqry:autoGrouping column="Session" grouping="true"/>
                                <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                            </opqry:automaticConfiguration>
                            <opqry:column caseSensitive="true" column="Session"/>
                            <opqry:sumColumns>
                                <opqry:columnName># Target</opqry:columnName>
                                <opqry:columnName># Actual</opqry:columnName>
                                <opqry:columnName>Syllables deleted</opqry:columnName>
                                <opqry:columnName>Syllables epenthesized</opqry:columnName>
                                <opqry:columnName># Correct</opqry:columnName>
                                <opqry:columnName># Substituted</opqry:columnName>
                                <opqry:columnName># Deleted</opqry:columnName>
                            </opqry:sumColumns>
                        </opqry:inventoryoptions>
                        <oga:settings/>
                        <oga:meta x="660" y="204"/>
                    </extensions>
                </node>
                <node id="de98c903409d41a2" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                    <extensions>
                        <opqry:inventoryoptions>
                            <opqry:automaticConfiguration configureAutomatically="false">
                                <opqry:autoGrouping column="Session" grouping="true"/>
                                <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                            </opqry:automaticConfiguration>
                            <opqry:groupBy caseSensitive="true" column="Session"/>
                            <opqry:column caseSensitive="true" column="IPA Target"/>
                            <opqry:column caseSensitive="true" column="IPA Actual"/>
                            <opqry:sumColumns>
                                <opqry:columnName># Correct</opqry:columnName>
                                <opqry:columnName># Substituted</opqry:columnName>
                                <opqry:columnName># Deleted</opqry:columnName>
                            </opqry:sumColumns>
                        </opqry:inventoryoptions>
                        <oga:settings/>
                        <oga:meta x="754" y="592"/>
                    </extensions>
                </node>
                <node id="5f95c49f933141ea" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                    <extensions>
                        <opqry:inventoryoptions>
                            <opqry:automaticConfiguration configureAutomatically="false">
                                <opqry:autoGrouping column="Session" grouping="true"/>
                                <opqry:autoColumns caseSensitive="true" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                            </opqry:automaticConfiguration>
                            <opqry:groupBy caseSensitive="true" column="Session"/>
                            <opqry:column caseSensitive="true" column="Target Tone"/>
                            <opqry:column caseSensitive="true" column="Actual Tone"/>
                            <opqry:sumColumns>
                                <opqry:columnName># Correct</opqry:columnName>
                                <opqry:columnName># Substituted</opqry:columnName>
                                <opqry:columnName># Deleted</opqry:columnName>
                            </opqry:sumColumns>
                        </opqry:inventoryoptions>
                        <oga:settings/>
                        <oga:meta x="748" y="771"/>
                    </extensions>
                </node>
                <node id="975f6e505ea44884" type="class:ca.phon.app.opgraph.nodes.table.ColumnSumNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="columns">
                                <![CDATA[# Target
# Actual
Syllables deleted
Syllables epenthesized
# Correct
# Substituted
# Deleted]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="875" y="204"/>
                    </extensions>
                </node>
                <node id="eee2eebc8dbe4012" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                    <extensions>
                        <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                            <opqry:sortBy column="IPA Target" order="ascending" type="ipa"/>
                            <opqry:sortBy column="IPA Actual" order="ascending" type="ipa"/>
                        </opqry:sortoptions>
                        <oga:settings/>
                        <oga:meta x="979" y="592"/>
                    </extensions>
                </node>
                <node id="6e39af68" name="Sort by Tone Numbers" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                    <input name="table" optional="false"/>
                    <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                    <extensions>
                        <oga:settings>
                            <oga:property key="__script">
                                <![CDATA[function init(inputs, outputs) {
	inputs.add("table", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}


function run(context) {
	var table = context.get("table");
	var rowData = table.getRowData();

	var targetIdx = table.getColumnIndex("Target Tone");
	var actualIdx = table.getColumnIndex("Actual Tone");
	
	var comparator = new java.util.Comparator() {
		compare: function (row1, row2) {
			var row1Target = row1[targetIdx];
			var row1TargetTone = 
				(row1Target != null && row1Target.length() > 0
					? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row1Target))
					: java.lang.Integer.valueOf(0));

			var row2Target = row2[targetIdx];
			var row2TargetTone = 
				(row1Target != null && row2Target.length() > 0
					? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row2Target))
					: java.lang.Integer.valueOf(0));
			var targetCmp = row1TargetTone.compareTo(row2TargetTone);

			if(targetCmp == 0) {
				var row1Actual = row1[actualIdx];
				var row1ActualTone = 
					(row1Actual != null && row1Actual.length() > 0
						? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row1Actual))
						: java.lang.Integer.valueOf(0));

				var row2Actual = row2[actualIdx];
				var row2ActualTone = 
					(row2Actual != null && row2Actual.length() > 0
						? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row2Actual))
						: java.lang.Integer.valueOf(0));

				if(row1ActualTone == row2ActualTone) {
					return 0;
				} else {
					if(row1ActualTone == row1TargetTone) {
						return java.lang.Integer.MIN_VALUE;
					} else if(row2ActualTone == row2TargetTone) {
						return java.lang.Integer.MAX_VALUE;
					} else {
						return row1ActualTone.compareTo(row2ActualTone);
					}
				}
			} else {
				return targetCmp;
			}
		}
	};
	java.util.Collections.sort(rowData, comparator);	
}
]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="1005" y="736"/>
                    </extensions>
                </node>
                <node id="d2e0d095639b426a" type="class:ca.phon.app.opgraph.nodes.table.AddColumnNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="column">
                                <![CDATA[PNTC]]>
                            </oga:property>
                            <oga:property key="columnIndex">
                                <![CDATA[-1]]>
                            </oga:property>
                            <oga:property key="__script">
                                <![CDATA[/*
params = {label, "Add a new column to the input table using javascript.", "<html><b>Add column to table</b></html>"}
;
*/

function getRowValue(table, row) {
	var correct = table.getValueAt(row, "# Correct").floatValue();
	var sub = table.getValueAt(row, "# Substituted").floatValue();
	var del = table.getValueAt(row, "# Deleted").floatValue();

	var ptnc = (correct) / (correct + sub + del);
	ptnc *= 100.0;
	return java.lang.Float.valueOf(ptnc);
}
]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="1090" y="196"/>
                    </extensions>
                </node>
                <node id="a57b4ed9d904ad3" name="Summary Table" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[false]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                <![CDATA[Total]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="1383" y="293">
                            <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="6a00e557" name="Add to Global Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                    <input name="speaker" optional="false"/>
                    <input name="globalSummary" optional="false"/>
                    <input name="speakerSummary" optional="false"/>
                    <output name="globalSummary" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                    <extensions>
                        <oga:settings>
                            <oga:property key="__script">
                                <![CDATA[function init(inputs, outputs) {
	inputs.add("speaker", "", false, false);
	inputs.add("globalSummary", "", false, false);
	inputs.add("speakerSummary", "", false, false);

	outputs.add("globalSummary", "", false, DefaultTableDataSource);
}

function run(context) {
	var speaker = context.get("speaker");
	var globalSummary = context.get("globalSummary");
	var speakerSummary = context.get("speakerSummary");
	var speakerRow = speakerSummary.rowCount-1;

	var rowData = [];
	var col = 0;
	rowData[col++] = speaker;
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Target");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Actual");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "Syllables deleted");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "Syllables epenthesized");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Correct");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Substituted");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "# Deleted");
	rowData[col++] = speakerSummary.getValueAt(speakerRow, "PNTC");
	globalSummary.addRow(rowData);
}
]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="1026" y="331"/>
                    </extensions>
                </node>
                <node id="ad9fb81f2a2949a4" name="IPA Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                        </oga:settings>
                        <oga:meta x="1381" y="454">
                            <oga:default for="sectionName" type="java.lang.String">IPA Patterns</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="886e857" name="Global Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="1403" y="1021"/>
                    </extensions>
                </node>
                <node id="f3d627e8e19b4013" name="Tonal Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                        </oga:settings>
                        <oga:meta x="1381" y="615">
                            <oga:default for="sectionName" type="java.lang.String">Tonal Patterns</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="e1675f636b144fda" name="LIsting (by word)" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[false]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                <![CDATA[Date
Speaker
Tier
Range
Result
Target Syllabification (Group)
Actual Syllabification (Group)
Alignment (Group)
Target Syllabification (Word)
Actual Syllabification (Word)
Alignment (Word)]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="1377" y="776">
                            <oga:default for="sectionName" type="java.lang.String">Listing</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <link dest="d2d46dfe6fb4caa" destField="tableMap" source="bcac3bee051f447b" sourceField="obj"/>
                <link dest="34caf719d61a48ef" destField="parent" source="66021052a34740c5" sourceField="collection"/>
                <link dest="4c64b990d45249bf" destField="tableMap" source="7bb5cd1986884741" sourceField="obj"/>
                <link dest="e782a973f1fb415f" destField="table" source="d2d46dfe6fb4caa" sourceField="table"/>
                <link dest="e1675f636b144fda" destField="table" source="d2d46dfe6fb4caa" sourceField="table"/>
                <link dest="5f95c49f933141ea" destField="table" source="4c64b990d45249bf" sourceField="table"/>
                <link dest="de98c903409d41a2" destField="table" source="4c64b990d45249bf" sourceField="table"/>
                <link dest="975f6e505ea44884" destField="table" source="e782a973f1fb415f" sourceField="table"/>
                <link dest="eee2eebc8dbe4012" destField="table" source="de98c903409d41a2" sourceField="table"/>
                <link dest="a57b4ed9d904ad3" destField="parent" source="34caf719d61a48ef" sourceField="section"/>
                <link dest="ad9fb81f2a2949a4" destField="table" source="eee2eebc8dbe4012" sourceField="table"/>
                <link dest="a57b4ed9d904ad3" destField="table" source="d2e0d095639b426a" sourceField="table"/>
                <link dest="ad9fb81f2a2949a4" destField="parent" source="a57b4ed9d904ad3" sourceField="parent"/>
                <link dest="f3d627e8e19b4013" destField="parent" source="ad9fb81f2a2949a4" sourceField="parent"/>
                <link dest="e1675f636b144fda" destField="parent" source="f3d627e8e19b4013" sourceField="parent"/>
                <link dest="aab2c54" destField="obj" source="c1f475d" sourceField="obj"/>
                <link dest="d2d46dfe6fb4caa" destField="speaker" source="aab2c54" sourceField="value"/>
                <link dest="4c64b990d45249bf" destField="speaker" source="aab2c54" sourceField="value"/>
                <link dest="34caf719d61a48ef" destField="sectionName" source="aab2c54" sourceField="value"/>
                <link dest="886e857" destField="obj" source="6a00e557" sourceField="globalSummary"/>
                <link dest="6a00e557" destField="speaker" source="c1f475d" sourceField="obj"/>
                <link dest="6a00e557" destField="globalSummary" source="80f2c53fd6f44d3d" sourceField="obj"/>
                <link dest="6a00e557" destField="speakerSummary" source="d2e0d095639b426a" sourceField="table"/>
                <link dest="6e39af68" destField="table" source="5f95c49f933141ea" sourceField="table"/>
                <link dest="f3d627e8e19b4013" destField="table" source="6e39af68" sourceField="table"/>
                <link dest="d2e0d095639b426a" destField="table" source="975f6e505ea44884" sourceField="table"/>
                <extensions>
                    <oga:notes>
                        <oga:note color="0xffff96" height="791" title="Inputs" width="378" x="17" y="129"/>
                        <oga:note color="0xffc864" height="804" title="Report" width="312" x="1341" y="124"/>
                        <oga:note color="0xff96ff" height="378" title="Summary Table" width="932" x="401" y="128"/>
                        <oga:note color="0x9696ff" height="411" title="Aggregates" width="934" x="400" y="509"/>
                        <oga:note color="0xffff96" height="279" title="Outputs" width="304" x="1341" y="945"/>
                    </oga:notes>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <ogcn:published_input field="obj" name="wordTableMap" ref="bcac3bee051f447b"/>
            <ogcn:published_input field="collection" name="collection1" ref="66021052a34740c5"/>
            <ogcn:published_input field="obj" name="syllTableMap" ref="7bb5cd1986884741"/>
            <ogcn:published_input field="obj" name="obj" ref="80f2c53fd6f44d3d"/>
            <ogcn:published_output field="obj" name="obj" ref="886e857"/>
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.IterableClassNode.className">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="1413" y="226"/>
            </extensions>
        </ogcn:macro>
        <node id="5f491e1e4ce940b8" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
            <extensions>
                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                    <opqry:sortBy column="IPA Target" order="ascending" type="ipa"/>
                    <opqry:sortBy column="IPA Actual" order="ascending" type="ipa"/>
                </opqry:sortoptions>
                <oga:settings/>
                <oga:meta x="1157" y="968"/>
            </extensions>
        </node>
        <node id="e9b185df520e499e" name="Sort by Tone Numbers" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script">
                        <![CDATA[function init(inputs, outputs) {
	inputs.add("table", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}


function run(context) {
	var table = context.get("table");
	var rowData = table.getRowData();

	var targetIdx = table.getColumnIndex("Target Tone");
	var actualIdx = table.getColumnIndex("Actual Tone");
	
	var comparator = new java.util.Comparator() {
		compare: function (row1, row2) {
			var row1Target = row1[targetIdx];
			var row1TargetTone = 
				(row1Target != null && row1Target.length() > 0
					? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row1Target))
					: java.lang.Integer.valueOf(0));

			var row2Target = row2[targetIdx];
			var row2TargetTone = 
				(row1Target != null && row2Target.length() > 0
					? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row2Target))
					: java.lang.Integer.valueOf(0));
			var targetCmp = row1TargetTone.compareTo(row2TargetTone);

			if(targetCmp == 0) {
				var row1Actual = row1[actualIdx];
				var row1ActualTone = 
					(row1Actual != null && row1Actual.length() > 0
						? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row1Actual))
						: java.lang.Integer.valueOf(0));

				var row2Actual = row2[actualIdx];
				var row2ActualTone = 
					(row2Actual != null && row2Actual.length() > 0
						? java.lang.Integer.valueOf(java.lang.Integer.parseInt(row2Actual))
						: java.lang.Integer.valueOf(0));

				if(row1ActualTone == row2ActualTone) {
					return 0;
				} else {
					if(row1ActualTone == row1TargetTone) {
						return java.lang.Integer.MIN_VALUE;
					} else if(row2ActualTone == row2TargetTone) {
						return java.lang.Integer.MAX_VALUE;
					} else {
						return row1ActualTone.compareTo(row2ActualTone);
					}
				}
			} else {
				return targetCmp;
			}
		}
	};
	java.util.Collections.sort(rowData, comparator);	
}
]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="1157" y="1123"/>
            </extensions>
        </node>
        <node id="fae6aaad3ecc48ce" type="class:ca.phon.app.opgraph.nodes.table.ColumnSumNode">
            <extensions>
                <oga:settings>
                    <oga:property key="columns">
                        <![CDATA[# Target
# Actual
Syllables deleted
Syllables epenthesized
# Correct
# Substituted
# Deleted]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="893" y="797"/>
            </extensions>
        </node>
        <node id="4243819a" name="Calc PNTC" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="table" optional="false"/>
            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script">
                        <![CDATA[function init(inputs, outputs) {
	inputs.add("table", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = context.get("table");
	var row = table.rowCount -1;

	if(row >= 0) {
		var correct = table.getValueAt(row, "# Correct");
		var sub = table.getValueAt(row, "# Substituted");
		var del = table.getValueAt(row, "# Deleted");

		if(correct + sub + del > 0) {
			var pntc = (correct) / (correct + sub + del);
			table.setValueAt(row, table.columnCount - 1, java.lang.Float.valueOf(pntc * 100.0));
		}
	}
}
]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="1085" y="797"/>
            </extensions>
        </node>
        <node id="114dba02" name="Summary Table" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1413" y="649">
                    <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="f5b01fd99f564618" name="IPA Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1414" y="968">
                    <oga:default for="sectionName" type="java.lang.String">IPA Patterns</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <node id="62f9d5c7" name="Tonal Patterns" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                </oga:settings>
                <oga:meta x="1413" y="1123">
                    <oga:default for="sectionName" type="java.lang.String">Tonal Patterns</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <link dest="7486fc0611ca4abb" destField="parameters" source="41c2d52c05f54592" sourceField="parameters"/>
        <link dest="ad540f2c84c343cc" destField="reportName" source="7486fc0611ca4abb" sourceField="reportTitle"/>
        <link dest="74498387" destField="table" source="4d1cdaa729e34875" sourceField="table"/>
        <link dest="511cd23" destField="project" source="7328a40688194f0f" sourceField="obj"/>
        <link dest="511cd23" destField="sessions" source="23502a3bdf76403f" sourceField="obj"/>
        <link dest="4d1cdaa729e34875" destField="project" source="511cd23" sourceField="project"/>
        <link dest="4d1cdaa729e34875" destField="results" source="511cd23" sourceField="results"/>
        <link dest="74d6979e" destField="collection" source="6933cb7db3c14099" sourceField="obj"/>
        <link dest="74d6979e" destField="wordTableMap" source="74498387" sourceField="tableMap"/>
        <link dest="74d6979e" destField="syllTableMap" source="e610bf8b98aa4f44" sourceField="tableMap"/>
        <link dest="16390602" destField="parent" source="ad540f2c84c343cc" sourceField="root"/>
        <link dest="114dba02" destField="parent" source="16390602" sourceField="section"/>
        <link dest="114dba02" destField="enabled" source="74d6979e" sourceField="finished"/>
        <link dest="74d6979e" destField="obj" source="687692fc" sourceField="table"/>
        <link dest="e9b185df520e499e" destField="table" source="b8bf243401de41c5" sourceField="table"/>
        <link dest="62f9d5c7" destField="table" source="e9b185df520e499e" sourceField="table"/>
        <link dest="5f491e1e4ce940b8" destField="table" source="8c69a6a9b71d496c" sourceField="table"/>
        <link dest="f5b01fd99f564618" destField="table" source="5f491e1e4ce940b8" sourceField="table"/>
        <link dest="f5b01fd99f564618" destField="parent" source="114dba02" sourceField="parent"/>
        <link dest="62f9d5c7" destField="parent" source="f5b01fd99f564618" sourceField="parent"/>
        <link dest="fae6aaad3ecc48ce" destField="table" source="74d6979e" sourceField="obj"/>
        <link dest="4243819a" destField="table" source="fae6aaad3ecc48ce" sourceField="table"/>
        <link dest="114dba02" destField="table" source="4243819a" sourceField="table"/>
        <link dest="74d6979e" destField="collection1" source="ad540f2c84c343cc" sourceField="root"/>
        <link dest="5bf1378b" destField="table" source="4d1cdaa729e34875" sourceField="table"/>
        <link dest="511cd23" destField="parameters" source="4c88d38e" sourceField="paramMap"/>
        <link dest="4c88d38e" destField="paramMap" source="41c2d52c05f54592" sourceField="parameters"/>
        <link dest="e610bf8b98aa4f44" destField="table" source="5bf1378b" sourceField="sylltable"/>
        <link dest="8c69a6a9b71d496c" destField="table" source="5bf1378b" sourceField="sylltable"/>
        <link dest="b8bf243401de41c5" destField="table" source="5bf1378b" sourceField="sylltable"/>
        <link dest="5bf1378b" destField="groupSuffix" source="4c88d38e" sourceField="groupSuffix"/>
        <link dest="5bf1378b" destField="bySyllable" source="4c88d38e" sourceField="bySyllable"/>
        <extensions>
            <opqry:nodewizard type="ca.phon.app.opgraph.analysis.AnalysisWizardExtension">
                <opqry:info format="html" title="PNTC">
                    <opqry:message/>
                </opqry:info>
                <opqry:node ref="41c2d52c05f54592" showAsStep="true">
                    <opqry:info format="html" title="Parameters">
                        <opqry:message/>
                    </opqry:info>
                </opqry:node>
            </opqry:nodewizard>
            <oga:notes>
                <oga:note color="0xffff96" height="576" title="Analysis Inputs" width="382" x="10" y="10">These inputs are provided to all analyses.</oga:note>
                <oga:note color="0xffc864" height="198" title="Start Report" width="734" x="10" y="597">Reports are created in a tree structure. When combined using the Analysis Composer the report tree created by the 'New Report' node will be added as a subtree to the larger report.</oga:note>
                <oga:note color="0x9696ff" height="581" title="Query" width="580" x="404" y="6"/>
                <oga:note color="0xffc864" height="706" title="Summary Report" width="1006" x="748" y="597"/>
                <oga:note color="0x96ff96" height="579" title="Analysis by Participant" width="759" x="992" y="11"/>
            </oga:notes>
            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
        </extensions>
    </graph>
</opgraph>
