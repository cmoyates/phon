<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<opgraph xmlns="http://gedge.ca/ns/opgraph" xmlns:nes="https://www.phon.ca/ns/node_editor" xmlns:oga="http://gedge.ca/ns/opgraph-app" xmlns:ogcn="http://gedge.ca/ns/opgraph-common-nodes" xmlns:opqry="https://phon.ca/ns/opgraph_query" xmlns:qry="http://phon.ling.mun.ca/ns/query">
    <graph id="root">
        <node id="1d6fc11b" name="Project" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_project]]>
                    </oga:property>
                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[ca.phon.project.Project]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="62" y="69"/>
            </extensions>
        </node>
        <node id="5e629711" name="Selected Sessions" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_selectedSessions]]>
                    </oga:property>
                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="62" y="350"/>
            </extensions>
        </node>
        <node id="6b8dfd59" name="Selected Participants" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_selectedParticipants]]>
                    </oga:property>
                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="62" y="451"/>
            </extensions>
        </node>
        <node id="dc4dad38c60648c1" name="Parameters" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <extensions>
                <oga:settings>
                    <oga:property key="filters.searchBy.searchBy">
                        <![CDATA[Word]]>
                    </oga:property>
                    <oga:property key="filters.ppc.ppcType">
                        <![CDATA[Percent Consonants Correct (PCC)]]>
                    </oga:property>
                    <oga:property key="filters.ppc.pattern.filter">
                        <![CDATA[\c]]>
                    </oga:property>
                    <oga:property key="reportTitle">
                        <![CDATA[PCC]]>
                    </oga:property>
                    <oga:property key="__script">
                        <![CDATA[var GroupFilter = require("lib/GroupFilter").GroupFilter;
var AlignedGroupFilter = require("lib/TierFilter").TierFilter;
var WordFilter = require("lib/WordFilter").WordFilter;
var TierList = require("lib/TierList").TierList;
var AlignedWordFilter = require("lib/TierFilter").TierFilter;
var PatternFilter = require("lib/PatternFilter").PatternFilter;
var PatternType = require("lib/PatternFilter").PatternType;
var PPC = require("lib/PPC").PPC;
var PPCOptions = require("lib/PPC").PPCOptions;
var ResultType = require("lib/PhonScriptConstants").ResultType;
var SyllableFilter = require("lib/SyllableFilter").SyllableFilter;
var SearchByOptions = require("lib/SearchByOptions").SearchByOptions;


/********************************
 * Setup params
 *******************************/
var filters = {
	"ppc": new PPCOptions("filters.ppc"),
	"searchBy": new SearchByOptions("filters.searchBy"),
	"group": new GroupFilter("filters.group"),
	"groupTiers": new TierList("filters.groupTiers"),
	"groupPattern": new PatternFilter("filters.groupPattern"),
	"alignedGroup": new AlignedGroupFilter("filters.alignedGroup"),
	"word": new WordFilter("filters.word"),
	"wordTiers": new TierList("filters.wordTiers"),
	"wordPattern": new PatternFilter("filters.wordPattern"),
	"alignedWord": new AlignedWordFilter("filters.alignedWord"),
	"syllable": new SyllableFilter("filters.syllable")
};

var reportTitleParamInfo = {
	"id": "reportTitle",
	"title": "Report Title",
	"def": "PPC",
	"prompt": "Enter report title"
};
var reportTitleParam;
var reportTitle = reportTitleParamInfo.def;

function setup_params(params) {
	reportTitleParam = new StringScriptParam(
			reportTitleParamInfo.id,
			reportTitleParamInfo.title,
			reportTitleParamInfo.def);
	reportTitleParam.setPrompt(reportTitleParamInfo.prompt);
	params.add(reportTitleParam);

	filters.ppc.param_setup(params);
	filters.ppc.ppcTypeParameter.addPropertyChangeListener(filters.ppc.ppcTypeParameter.paramId, new java.beans.PropertyChangeListener() {
		propertyChange: function(e) {
			reportTitleParam.setValue(reportTitleParamInfo.id, filters.ppc.getColumnName());

		}
	});

	
	var insertIdx = params.size();

	filters.group.param_setup(params);
	filters.groupPattern.param_setup(params);

	var sep = new LabelScriptParam("", "<html><b>Add Aligned Groups</b></html>");
	params.add(sep);
	filters.groupTiers.param_setup(params);
	var sep2 = new LabelScriptParam("", "<html><b>Aligned Group Filter</b></html>");
	params.add(sep2);
	filters.alignedGroup.param_setup(params);

	filters.word.searchByWordEnabled = true;
	filters.word.param_setup(params);
	filters.wordPattern.param_setup(params);

	var wordsep = new LabelScriptParam("", "<html><b>Add Aligned Words</b></html>");
	params.add(wordsep);
	filters.wordTiers.param_setup(params);

	var wordsep2 = new LabelScriptParam("", "<html><b>Aligned Word Filter</b></html>");
	params.add(wordsep2);
	filters.alignedWord.param_setup(params);
	var searchByWordListener = new java.beans.PropertyChangeListener {
		propertyChange: function (e) {
			var enabled = e.source.getValue(e.source.paramId);
			filters.wordPattern.setEnabled(enabled);
			filters.alignedWord.setEnabled(enabled);
		}
	};
	filters.word.searchByWordParam.addPropertyChangeListener(filters.word.searchByWordParam.paramId, searchByWordListener);
	var enabled = filters.word.searchByWordParam.getValue(filters.word.searchByWordParam.paramId);
	filters.wordPattern.setEnabled(enabled);
	filters.alignedWord.setEnabled(enabled);

	filters.syllable.param_setup(params);

	filters.searchBy.includeSyllableOption = true;
	filters.searchBy.param_setup(params, filters.word.searchByWordParam, filters.syllable.searchBySyllableParam, insertIdx);
}]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="62" y="570"/>
            </extensions>
        </node>
        <opqry:queryNode id="7e0169fb" name="Query : PPC" type="ca.phon.app.opgraph.nodes.query.QueryNode">
            <qry:query xmlns="http://phon.ling.mun.ca/ns/query" date="2018-04-19T08:21:23.899-02:30" name="PPC" uuid="36256a7f-c3a7-466c-a0b1-60a11a3c66cf">
                <script>
                    <url ref="PPC" rel="stock"/>
                    <param id="filters.alignedGroup.patternFilter.filterType">Plain text</param>
                    <param id="filters.alignedWord.patternFilter.filterType">Plain text</param>
                    <param id="filters.groupPattern.filterType">Plain text</param>
                    <param id="filters.ppc.clusterType">All clusters</param>
                    <param id="filters.ppc.pattern.filter">\c</param>
                    <param id="filters.ppc.ppcType">Percent Consonants Correct (PCC)</param>
                    <param id="filters.ppc.singletonType">All singleton consonants</param>
                    <param id="filters.searchBy.searchBy">Word</param>
                    <param id="filters.speaker.age1Comparator">equal to</param>
                    <param id="filters.speaker.age2Comparator">equal to</param>
                    <param id="filters.speaker.ageOperator">(select operator)</param>
                    <param id="filters.speaker.participantRole">(select role)</param>
                    <param id="filters.syllable.otherSyllTypePattern.filterType">Plain text</param>
                    <param id="filters.syllable.syllableType">Any syllable</param>
                    <param id="filters.wordPattern.filterType">Plain text</param>
                </script>
            </qry:query>
            <extensions>
                <oga:settings/>
                <oga:meta x="464" y="106"/>
            </extensions>
        </opqry:queryNode>
        <node id="10ac3417" name="Report Type" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <input name="params" optional="false"/>
            <output name="pcType" type="java.lang.String"/>
            <extensions>
                <oga:settings>
                    <oga:property key="__script">
                        <![CDATA[function init(inputs, outputs) {
	inputs.add("params", "", false, false);

	outputs.add("pcType", "", false, java.lang.String);
}

function run(context) {
	var paramMap = context.get("params");

	var ppcType = paramMap.get("filters.ppc.ppcType");

	var pcType = "PC";
	if(ppcType.index >= 0 && ppcType.index <= 2) {
		pcType = "PCC";
	} else if(ppcType.index == 3) {
		pcType = "PVC";
	} else if(ppcType.index == 4) {
		pcType = "PPC";
	}

	context.put("pcType", pcType);
}
]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="457" y="365"/>
            </extensions>
        </node>
        <ogcn:macro id="4b18886ea00b48b3" name="Report" type="ca.gedge.opgraph.nodes.general.MacroNode">
            <graph id="571f74b8">
                <node id="e6d45b5e5a1847a0" name="reportTitle" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[java.lang.String]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="42" y="57"/>
                    </extensions>
                </node>
                <node id="1f17ec8476fc478a" name="project" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[ca.phon.project.Project]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="42" y="178"/>
                    </extensions>
                </node>
                <node id="e6f07f6f7dc34e29" name="results" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[[Lca.phon.query.db.ResultSet;]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="42" y="459"/>
                    </extensions>
                </node>
                <node id="2ee97062ccbd4ee1" name="selectedSessions" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[java.util.ArrayList]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="42" y="560"/>
                    </extensions>
                </node>
                <node id="5f8fe0460f3f4fd8" name="selected participants" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[java.util.ArrayList]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="42" y="661"/>
                    </extensions>
                </node>
                <node id="419c72194f554b81" name="script" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[ca.phon.query.script.QueryScript]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="42" y="762"/>
                    </extensions>
                </node>
                <node id="9ad0f5182254d47" name="parameters" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[java.util.Map]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="42" y="1023"/>
                    </extensions>
                </node>
                <node id="51a10b46c3124671" type="class:ca.phon.app.opgraph.nodes.table.ResultsToTableNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="includeSessionInfo">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="includeSpeakerInfo">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="includeMetadata">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="includeTierInfo">
                                <![CDATA[true]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="444" y="182"/>
                    </extensions>
                </node>
                <node id="3e25314b" name="Setup Summary Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                    <input name="title" optional="false"/>
                    <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                    <extensions>
                        <oga:settings>
                            <oga:property key="__script">
                                <![CDATA[importClass(Packages.ca.phon.query.report.datasource.DefaultTableDataSource)

function init(inputs, outputs) {
	inputs.add("title", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = new DefaultTableDataSource();
	var rowIdx = 0;

	table.setColumnTitle(rowIdx++, "Speaker");
	table.setColumnTitle(rowIdx++, "Role");
	table.setColumnTitle(rowIdx++, "# Target");
	table.setColumnTitle(rowIdx++, "# Correct");
	table.setColumnTitle(rowIdx++, "# Substituted");
	table.setColumnTitle(rowIdx++, "# Deleted");
	table.setColumnTitle(rowIdx++, "# Epenthesized");
	table.setColumnTitle(rowIdx++, context.get("title"));

	context.put("table", table);
}
]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="641" y="182"/>
                    </extensions>
                </node>
                <node id="e0941e01966243d8" type="class:ca.phon.app.opgraph.nodes.log.PrintScriptParameters">
                    <extensions>
                        <oga:settings>
                            <oga:property key="excludes">
                                <![CDATA[@Participant Filter
filters.ppc.singletonType
filters.ppc.clusterType]]>
                            </oga:property>
                            <oga:property key="printOnlyChanged">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="includes">
                                <![CDATA[@General]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="474" y="616"/>
                    </extensions>
                </node>
                <node id="86073f19002b43f4" name="Report Title" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                    <input name="params" optional="false"/>
                    <output name="title" type="java.lang.String"/>
                    <extensions>
                        <oga:settings>
                            <oga:property key="__script">
                                <![CDATA[function init(inputs, outputs) {
	inputs.add("params", "", false, false);

	outputs.add("title", "", false, java.lang.String);
}

function run(context) {
	var paramMap = context.get("params");

	var ppcType = paramMap.get("filters.ppc.ppcType");
	context.put("title", ppcType + "");
}
]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="704" y="616"/>
                    </extensions>
                </node>
                <node id="ff306d8463c54561" name="Split Table by Speaker" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                    <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                    <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                    <extensions>
                        <oga:settings>
                            <oga:property key="__script">
                                <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                            </oga:property>
                            <oga:property key="columnName">
                                <![CDATA[Speaker]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="641" y="323"/>
                    </extensions>
                </node>
                <node id="e34cd0e" type="class:ca.phon.app.opgraph.nodes.report.NewReportNode">
                    <extensions>
                        <oga:settings/>
                        <oga:meta x="941" y="616"/>
                    </extensions>
                </node>
                <node id="657a041f" name="Print Parameters" type="class:ca.phon.app.opgraph.nodes.report.TextSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TextSectionNode.text"/>
                        </oga:settings>
                        <oga:meta x="1177" y="616">
                            <oga:default for="sectionName" type="java.lang.String">Parameters</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="c17d62c2730f4c16" name="Summary Section Header" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                    <extensions>
                        <oga:meta x="1177" y="777">
                            <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="bc89329aad0454e" name="Listing Section Header" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                    <extensions>
                        <oga:meta x="1177" y="918">
                            <oga:default for="sectionName" type="java.lang.String">Listing by Participant</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <ogcn:macro id="9be63edf7454f48" name="For Each Participant" type="ca.gedge.opgraph.nodes.reflect.IterableClassNode">
                    <graph id="72d2f866">
                        <node id="f07c16119afe452e" name="Current Object" type="class:ca.gedge.opgraph.nodes.reflect.ContextualItemClassNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ContextualItemClassNode.key">
                                        <![CDATA[currentValue]]>
                                    </oga:property>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass">
                                        <![CDATA[java.lang.Object]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="48" y="48"/>
                            </extensions>
                        </node>
                        <node id="cd7f2adfba34488c" name="Table Map" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.util.Map]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="47" y="189"/>
                            </extensions>
                        </node>
                        <node id="28e03ab509b94a85" name="Selected Sessions" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="contextKey">
                                        <![CDATA[_selectedSessions]]>
                                    </oga:property>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.util.ArrayList]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="47" y="290"/>
                            </extensions>
                        </node>
                        <node id="6b15e246103847d5" name="reportTitle" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[java.lang.String]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="47" y="391"/>
                            </extensions>
                        </node>
                        <node id="54074bf3" name="Global Summary" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="47" y="512"/>
                            </extensions>
                        </node>
                        <node id="6316d6df" name="Summary Node" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="47" y="653"/>
                            </extensions>
                        </node>
                        <node id="1f1ab26ecd424afe" name="Breakdown Node" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="47" y="874"/>
                            </extensions>
                        </node>
                        <node id="6e7dac5ad324dd0" name="To Participant Object" type="class:ca.gedge.opgraph.nodes.reflect.ObjectCastNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectCastNode.declaredClass">
                                        <![CDATA[ca.phon.session.Participant]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="245" y="48"/>
                            </extensions>
                        </node>
                        <node id="9b2d2164212b4b84" name="Setup Summary Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                            <input name="title" optional="false"/>
                            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script">
                                        <![CDATA[importClass(Packages.ca.phon.query.report.datasource.DefaultTableDataSource)

function init(inputs, outputs) {
	inputs.add("title", "", false, false);

	outputs.add("table", "", false, DefaultTableDataSource);
}

function run(context) {
	var table = new DefaultTableDataSource();
	var rowIdx = 0;

	table.setColumnTitle(rowIdx++, "Session");
	table.setColumnTitle(rowIdx++, "Role");
	table.setColumnTitle(rowIdx++, "Age");
	table.setColumnTitle(rowIdx++, "# Target");
	table.setColumnTitle(rowIdx++, "# Correct");
	table.setColumnTitle(rowIdx++, "# Substituted");
	table.setColumnTitle(rowIdx++, "# Deleted");
	table.setColumnTitle(rowIdx++, "# Epenthesized");
	table.setColumnTitle(rowIdx++, context.get("title"));

	context.put("table", table);
}
]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="442" y="177"/>
                            </extensions>
                        </node>
                        <node id="56745e76" name="TableDataSource" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="1403" y="551"/>
                            </extensions>
                        </node>
                        <ogcn:macro id="cb86895b929e40c4" name="Get Table of Results For Speaker" type="ca.gedge.opgraph.nodes.general.MacroNode">
                            <graph id="38909bfa">
                                <node id="709f2e57dcf44ec5" name="Object#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember">
                                                <![CDATA[toString()]]>
                                            </oga:property>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                <![CDATA[java.lang.Object]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="105" y="70"/>
                                    </extensions>
                                </node>
                                <node id="d091a8618f89491c" name="Map#get(Object)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember">
                                                <![CDATA[get(java.lang.Object)]]>
                                            </oga:property>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                <![CDATA[java.util.Map]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="296" y="73"/>
                                    </extensions>
                                </node>
                                <node id="b058aa205ed8417b" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                    <output name="exists" type="java.lang.Boolean">does table exist</output>
                                    <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource">table if exists, undefined otherwise</output>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="__script">
                                                <![CDATA[
// setup input/output fields
function init(inputFields, outputFields) {
	inputFields.add("table", "");
	outputFields.add("exists", "does table exist", false, java.lang.Boolean);
	outputFields.add("table", "table if exists, undefined otherwise", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableExists =
		(context.containsKey("table") && context.get("table") != null);
	context.put("exists", tableExists);
	context.put("table", context.get("table"));
}
]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="514" y="94"/>
                                    </extensions>
                                </node>
                                <link dest="d091a8618f89491c" destField="arg1" source="709f2e57dcf44ec5" sourceField="value"/>
                                <link dest="b058aa205ed8417b" destField="table" source="d091a8618f89491c" sourceField="value"/>
                                <extensions>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="speaker" ref="709f2e57dcf44ec5"/>
                            <ogcn:published_input field="obj" name="tableMap" ref="d091a8618f89491c"/>
                            <ogcn:published_output field="exists" name="exists" ref="b058aa205ed8417b"/>
                            <ogcn:published_output field="table" name="table" ref="b058aa205ed8417b"/>
                            <extensions>
                                <oga:meta x="442" y="318"/>
                            </extensions>
                        </ogcn:macro>
                        <ogcn:macro id="f597c5aaf39b442f" name="If Speaker has Results" type="ca.gedge.opgraph.nodes.general.MacroNode">
                            <graph id="60fc89c">
                                <node id="d779e16362c04d76" name="Table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="100" y="212"/>
                                    </extensions>
                                </node>
                                <node id="73c243ff96eb4831" name="Selected Sessions" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="contextKey">
                                                <![CDATA[_selectedSessions]]>
                                            </oga:property>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[java.util.ArrayList]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="109" y="353"/>
                                    </extensions>
                                </node>
                                <node id="649d8eae5b4744b8" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.session.Participant]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="102" y="454"/>
                                    </extensions>
                                </node>
                                <node id="4fc833bd97444fd0" name="Summary Table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="102" y="775"/>
                                    </extensions>
                                </node>
                                <node id="d29e473601c74d07" name="Split Table by Session" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                    <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                    <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="__script">
                                                <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                            </oga:property>
                                            <oga:property key="columnName">
                                                <![CDATA[Session]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="505" y="399"/>
                                    </extensions>
                                </node>
                                <ogcn:macro id="44ede451a63843e8" name="For Each Session" type="ca.gedge.opgraph.nodes.reflect.IterableClassNode">
                                    <graph id="47495b1d">
                                        <node id="f87a720cdb874d57" name="Current Object" type="class:ca.gedge.opgraph.nodes.reflect.ContextualItemClassNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ContextualItemClassNode.key">
                                                        <![CDATA[currentValue]]>
                                                    </oga:property>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass">
                                                        <![CDATA[java.lang.Object]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="37" y="43"/>
                                            </extensions>
                                        </node>
                                        <node id="ad55e9b9a5874167" name="Table Map" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[java.util.Map]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="64" y="267"/>
                                            </extensions>
                                        </node>
                                        <node id="d3d3798922cc4b34" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.session.Participant]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="59" y="372"/>
                                            </extensions>
                                        </node>
                                        <node id="2a7937ee37704241" name="Summary Table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="72" y="674"/>
                                            </extensions>
                                        </node>
                                        <node id="15af4b21486c49ee" name="Object#toString()" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember">
                                                        <![CDATA[toString()]]>
                                                    </oga:property>
                                                    <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                        <![CDATA[java.lang.Object]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="220" y="71"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="71b15afc5b9d47f5" name="Get Table for Session" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="6c894271">
                                                <node id="257ee0628b94c4f" name="Map" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[java.util.Map]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="244" y="68"/>
                                                    </extensions>
                                                </node>
                                                <node id="2e1f6fe75c6242f9" name="Map#get(Object)" type="class:ca.gedge.opgraph.nodes.reflect.MethodNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.classMember">
                                                                <![CDATA[get(java.lang.Object)]]>
                                                            </oga:property>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                                <![CDATA[java.util.Map]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="401" y="69"/>
                                                    </extensions>
                                                </node>
                                                <node id="2ee1606c76ae4be8" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                                    <output name="exists" type="java.lang.Boolean">does table exist</output>
                                                    <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource">table if exists, undefined otherwise</output>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[
// setup input/output fields
function init(inputFields, outputFields) {
	inputFields.add("table", "");
	outputFields.add("exists", "does table exist", false, java.lang.Boolean);
	outputFields.add("table", "table if exists, undefined otherwise", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableExists =
		(context.containsKey("table") && context.get("table") != null);
	context.put("exists", tableExists);
	context.put("table", context.get("table"));
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="555" y="73"/>
                                                    </extensions>
                                                </node>
                                                <link dest="2e1f6fe75c6242f9" destField="obj" source="257ee0628b94c4f" sourceField="obj"/>
                                                <link dest="2ee1606c76ae4be8" destField="table" source="2e1f6fe75c6242f9" sourceField="value"/>
                                            </graph>
                                            <ogcn:published_input field="arg1" name="sessionName" ref="2e1f6fe75c6242f9"/>
                                            <ogcn:published_input field="obj" name="tableMap" ref="257ee0628b94c4f"/>
                                            <ogcn:published_output field="exists" name="exists" ref="2ee1606c76ae4be8"/>
                                            <ogcn:published_output field="table" name="table" ref="2ee1606c76ae4be8"/>
                                            <extensions>
                                                <oga:meta x="413" y="110"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="73704a9fac14603" name="If Speaker has Results for Session" type="ca.gedge.opgraph.nodes.general.MacroNode">
                                            <graph id="204d2d78">
                                                <node id="c15eafc9d07d4fa3" name="DefaultTableDataSource" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="57" y="208"/>
                                                    </extensions>
                                                </node>
                                                <node id="306bcfa090b84bff" name="Participant" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.session.Participant]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="56" y="349"/>
                                                    </extensions>
                                                </node>
                                                <node id="c54d27d196374d69" name="Session Name" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[java.lang.Object]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="65" y="670"/>
                                                    </extensions>
                                                </node>
                                                <node id="69075d7f53bc45c9" name="Summary Table" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="60" y="771"/>
                                                    </extensions>
                                                </node>
                                                <node id="73cb1a76b3ae4818" name="Add row to Participant Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="speaker" optional="false">speaker</input>
                                                    <input name="sessionPath" optional="false">session</input>
                                                    <input name="resultTable" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(java.lang.Integer)
importClass(java.lang.Float)

function init(inputs, outputs) {
	inputs.add("speaker", "speaker", false, false);
	inputs.add("sessionPath", "session", false, false);
	inputs.add("resultTable", "", false, false);
}

function tableOp(context, table) {
	var row = [];

	var speaker = context.get("speaker");
	var sessionPath = context.get("sessionPath");
	var resultTable = context.get("resultTable");
	var history = speaker.getExtension(Packages.ca.phon.project.ParticipantHistory);

	var idx = 0;
	row[idx++] = sessionPath;
	row[idx++] = speaker.role;
	row[idx++] = history.getAgeForSession(sessionPath);

	// [target, correct, sub, del, epen]
	var pc = [0, 0, 0, 0, 0];
	for(var i = 0; i < resultTable.rowCount; i++) {
		pc[0] += Integer.parseInt(resultTable.getValueAt(i, "# Target"));
		pc[1] += Integer.parseInt(resultTable.getValueAt(i, "# Correct"));
		pc[2] += Integer.parseInt(resultTable.getValueAt(i, "# Substituted"));
		pc[3] += Integer.parseInt(resultTable.getValueAt(i, "# Deleted"));
		pc[4] += Integer.parseInt(resultTable.getValueAt(i, "# Epenthesized"));
	}

	var pcc = (pc[0] > 0 ? (pc[1] / (pc[1]+pc[2]+pc[3]+pc[4])) : 0) * 100.0;

	row[idx++] = new Integer(pc[0]);
	row[idx++] = new Integer(pc[1]);
	row[idx++] = new Integer(pc[2]);
	row[idx++] = new Integer(pc[3]);
	row[idx++] = new Integer(pc[4]);
	row[idx++] = new Float(pcc);

	table.addRow(row);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="441" y="363"/>
                                                    </extensions>
                                                </node>
                                                <link dest="73cb1a76b3ae4818" destField="sessionPath" source="c54d27d196374d69" sourceField="obj"/>
                                                <link dest="73cb1a76b3ae4818" destField="table" source="69075d7f53bc45c9" sourceField="obj"/>
                                                <link dest="73cb1a76b3ae4818" destField="speaker" source="306bcfa090b84bff" sourceField="obj"/>
                                                <link dest="73cb1a76b3ae4818" destField="resultTable" source="c15eafc9d07d4fa3" sourceField="obj"/>
                                                <extensions>
                                                    <oga:notes>
                                                        <oga:note color="0xffff96" height="766" title="Published Inputs" width="295" x="36" y="150"/>
                                                    </oga:notes>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="c15eafc9d07d4fa3"/>
                                            <ogcn:published_input field="obj" name="speaker" ref="306bcfa090b84bff"/>
                                            <ogcn:published_input field="obj" name="sessionName" ref="c54d27d196374d69"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="69075d7f53bc45c9"/>
                                            <extensions>
                                                <oga:meta x="706" y="93"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="71b15afc5b9d47f5" destField="tableMap" source="ad55e9b9a5874167" sourceField="obj"/>
                                        <link dest="73704a9fac14603" destField="table" source="71b15afc5b9d47f5" sourceField="table"/>
                                        <link dest="73704a9fac14603" destField="speaker" source="d3d3798922cc4b34" sourceField="obj"/>
                                        <link dest="73704a9fac14603" destField="sessionName" source="f87a720cdb874d57" sourceField="obj"/>
                                        <link dest="73704a9fac14603" destField="enabled" source="71b15afc5b9d47f5" sourceField="exists"/>
                                        <link dest="15af4b21486c49ee" destField="obj" source="f87a720cdb874d57" sourceField="obj"/>
                                        <link dest="71b15afc5b9d47f5" destField="sessionName" source="15af4b21486c49ee" sourceField="value"/>
                                        <link dest="73704a9fac14603" destField="summaryTable" source="2a7937ee37704241" sourceField="obj"/>
                                        <extensions>
                                            <oga:notes>
                                                <oga:note color="0xffff96" height="620" title="Published Inputs" width="274" x="33" y="200"/>
                                            </oga:notes>
                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                        </extensions>
                                    </graph>
                                    <ogcn:published_input field="obj" name="tableMap" ref="ad55e9b9a5874167"/>
                                    <ogcn:published_input field="obj" name="speaker" ref="d3d3798922cc4b34"/>
                                    <ogcn:published_input field="obj" name="summaryTable" ref="2a7937ee37704241"/>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.IterableClassNode.className">
                                                <![CDATA[java.util.ArrayList]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="756" y="401"/>
                                    </extensions>
                                </ogcn:macro>
                                <link dest="d29e473601c74d07" destField="table" source="d779e16362c04d76" sourceField="obj"/>
                                <link dest="44ede451a63843e8" destField="collection" source="73c243ff96eb4831" sourceField="obj"/>
                                <link dest="44ede451a63843e8" destField="tableMap" source="d29e473601c74d07" sourceField="tableMap"/>
                                <link dest="44ede451a63843e8" destField="speaker" source="649d8eae5b4744b8" sourceField="obj"/>
                                <link dest="44ede451a63843e8" destField="summaryTable" source="4fc833bd97444fd0" sourceField="obj"/>
                                <extensions>
                                    <oga:notes>
                                        <oga:note color="0xffff96" height="766" title="Published Inputs" width="294" x="54" y="167"/>
                                    </oga:notes>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="table" ref="d779e16362c04d76"/>
                            <ogcn:published_input field="obj" name="selectedSessions" ref="73c243ff96eb4831"/>
                            <ogcn:published_input field="obj" name="speaker" ref="649d8eae5b4744b8"/>
                            <ogcn:published_input field="obj" name="summaryTable" ref="4fc833bd97444fd0"/>
                            <ogcn:published_output field="collection" name="collection" ref="44ede451a63843e8"/>
                            <ogcn:published_output field="obj" name="summaryTable" ref="4fc833bd97444fd0"/>
                            <extensions>
                                <oga:meta x="720" y="177"/>
                            </extensions>
                        </ogcn:macro>
                        <ogcn:macro id="6e89d296" name="Print Participant Listing" type="ca.gedge.opgraph.nodes.general.MacroNode">
                            <graph id="a510fc4">
                                <node id="1908a532" name="data" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="15" y="15"/>
                                    </extensions>
                                </node>
                                <node id="2cf51b9a" name="object1" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.session.Participant]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="15" y="176"/>
                                    </extensions>
                                </node>
                                <node id="2f1f5bfb" name="parent" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="15" y="497"/>
                                    </extensions>
                                </node>
                                <node id="561c7ffb" type="class:ca.gedge.opgraph.nodes.general.ArrayNode">
                                    <input name="object1" optional="false">object in array</input>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.general.ArrayNode.numObjects">
                                                <![CDATA[1]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="310" y="275"/>
                                    </extensions>
                                </node>
                                <node id="b889c3977074a54" type="class:ca.gedge.opgraph.nodes.general.TextNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.general.TextNode.text">
                                                <![CDATA[%s]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="505" y="275"/>
                                    </extensions>
                                </node>
                                <node id="46e69140" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                <![CDATA[false]]>
                                            </oga:property>
                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                                <![CDATA[Date
Speaker
Age
Group #
Tier
Range
Result]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="700" y="275"/>
                                    </extensions>
                                </node>
                                <link dest="46e69140" destField="sectionName" source="b889c3977074a54" sourceField="value"/>
                                <link dest="561c7ffb" destField="object1" source="2cf51b9a" sourceField="obj"/>
                                <link dest="b889c3977074a54" destField="objects" source="561c7ffb" sourceField="array"/>
                                <link dest="46e69140" destField="parent" source="2f1f5bfb" sourceField="obj"/>
                                <link dest="46e69140" destField="table" source="1908a532" sourceField="obj"/>
                                <extensions>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="object1" ref="2cf51b9a"/>
                            <ogcn:published_input field="obj" name="parent" ref="2f1f5bfb"/>
                            <ogcn:published_input field="obj" name="data" ref="1908a532"/>
                            <extensions>
                                <oga:meta x="1077" y="477"/>
                            </extensions>
                        </ogcn:macro>
                        <node id="3a7f826d" name="Add to Global Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                            <input name="speaker" optional="false"/>
                            <input name="globalSummary" optional="false"/>
                            <input name="summary" optional="false"/>
                            <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script">
                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("speaker", "", false, false);
	inputs.add("globalSummary", "", false, false);
	inputs.add("summary", "", false, false);

	outputs.add("table", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var speaker = context.get("speaker");
	var globalSummary = context.get("globalSummary");
	var summary = context.get("summary");

	var target = 0;
	var correct = 0;
	var substituted = 0;
	var deleted = 0;
	var epenthesized = 0;

	if(summary.rowCount > 0) {
		for(var rowIdx = 0; rowIdx < summary.rowCount; rowIdx++) {
			target += summary.getValueAt(rowIdx, "# Target").intValue();
			correct += summary.getValueAt(rowIdx, "# Correct").intValue();
			substituted += summary.getValueAt(rowIdx, "# Substituted").intValue();
			deleted += summary.getValueAt(rowIdx, "# Deleted").intValue();
			epenthesized += summary.getValueAt(rowIdx, "# Epenthesized").intValue();
		}

		var pc = (correct / (correct+substituted+deleted+epenthesized)) * 100.0;

		var idx = 0;
		var rowData = [];

		rowData[idx++] = speaker;
		rowData[idx++] = speaker.role;
		rowData[idx++] = new java.lang.Integer(target);
		rowData[idx++] = new java.lang.Integer(correct);
		rowData[idx++] = new java.lang.Integer(substituted);
		rowData[idx++] = new java.lang.Integer(deleted);
		rowData[idx++] = new java.lang.Integer(epenthesized);
		rowData[idx++] = new java.lang.Float(pc);

		globalSummary.addRow(rowData);
	}

	context.put("table", globalSummary);
}
]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="1077" y="177"/>
                            </extensions>
                        </node>
                        <ogcn:macro id="495563a1" name="Print Participant Summary" type="ca.gedge.opgraph.nodes.general.MacroNode">
                            <graph id="19dc6ba0">
                                <node id="4f3f942d" name="parent" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="15" y="15"/>
                                    </extensions>
                                </node>
                                <node id="5e637044" name="data" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="15" y="236"/>
                                    </extensions>
                                </node>
                                <node id="752511b7" name="object1" type="class:ca.gedge.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.session.Participant]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="15" y="397"/>
                                    </extensions>
                                </node>
                                <node id="30dbe5b6" type="class:ca.gedge.opgraph.nodes.general.ArrayNode">
                                    <input name="object1" optional="false">object in array</input>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.general.ArrayNode.numObjects">
                                                <![CDATA[1]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="297" y="260"/>
                                    </extensions>
                                </node>
                                <node id="ec0d54c72a8c4e38" type="class:ca.gedge.opgraph.nodes.general.TextNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.gedge.opgraph.nodes.general.TextNode.text">
                                                <![CDATA[%s]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="499" y="262"/>
                                    </extensions>
                                </node>
                                <node id="1095e5c7" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                <![CDATA[true]]>
                                            </oga:property>
                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                        </oga:settings>
                                        <oga:meta x="715" y="234"/>
                                    </extensions>
                                </node>
                                <link dest="ec0d54c72a8c4e38" destField="objects" source="30dbe5b6" sourceField="array"/>
                                <link dest="30dbe5b6" destField="object1" source="752511b7" sourceField="obj"/>
                                <link dest="1095e5c7" destField="parent" source="4f3f942d" sourceField="obj"/>
                                <link dest="1095e5c7" destField="sectionName" source="ec0d54c72a8c4e38" sourceField="value"/>
                                <link dest="1095e5c7" destField="table" source="5e637044" sourceField="obj"/>
                                <extensions>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="object1" ref="752511b7"/>
                            <ogcn:published_input field="obj" name="data" ref="5e637044"/>
                            <ogcn:published_input field="obj" name="parent" ref="4f3f942d"/>
                            <extensions>
                                <oga:meta x="1077" y="341"/>
                            </extensions>
                        </ogcn:macro>
                        <link dest="cb86895b929e40c4" destField="speaker" source="6e7dac5ad324dd0" sourceField="obj"/>
                        <link dest="6e7dac5ad324dd0" destField="obj" source="f07c16119afe452e" sourceField="obj"/>
                        <link dest="cb86895b929e40c4" destField="tableMap" source="cd7f2adfba34488c" sourceField="obj"/>
                        <link dest="f597c5aaf39b442f" destField="table" source="cb86895b929e40c4" sourceField="table"/>
                        <link dest="f597c5aaf39b442f" destField="enabled" source="cb86895b929e40c4" sourceField="exists"/>
                        <link dest="f597c5aaf39b442f" destField="selectedSessions" source="28e03ab509b94a85" sourceField="obj"/>
                        <link dest="f597c5aaf39b442f" destField="speaker" source="6e7dac5ad324dd0" sourceField="obj"/>
                        <link dest="3a7f826d" destField="speaker" source="6e7dac5ad324dd0" sourceField="obj"/>
                        <link dest="f597c5aaf39b442f" destField="summaryTable" source="9b2d2164212b4b84" sourceField="table"/>
                        <link dest="3a7f826d" destField="summary" source="f597c5aaf39b442f" sourceField="summaryTable"/>
                        <link dest="9b2d2164212b4b84" destField="title" source="6b15e246103847d5" sourceField="obj"/>
                        <link dest="495563a1" destField="parent" source="6316d6df" sourceField="obj"/>
                        <link dest="495563a1" destField="object1" source="6e7dac5ad324dd0" sourceField="obj"/>
                        <link dest="495563a1" destField="data" source="f597c5aaf39b442f" sourceField="summaryTable"/>
                        <link dest="6e89d296" destField="object1" source="6e7dac5ad324dd0" sourceField="obj"/>
                        <link dest="6e89d296" destField="parent" source="1f1ab26ecd424afe" sourceField="obj"/>
                        <link dest="6e89d296" destField="data" source="cb86895b929e40c4" sourceField="table"/>
                        <link dest="3a7f826d" destField="enabled" source="cb86895b929e40c4" sourceField="exists"/>
                        <link dest="6e89d296" destField="enabled" source="cb86895b929e40c4" sourceField="exists"/>
                        <link dest="495563a1" destField="enabled" source="cb86895b929e40c4" sourceField="exists"/>
                        <link dest="3a7f826d" destField="globalSummary" source="54074bf3" sourceField="obj"/>
                        <link dest="56745e76" destField="obj" source="54074bf3" sourceField="obj"/>
                        <extensions>
                            <oga:notes>
                                <oga:note color="0xffff96" height="988" title="Published Inputs" width="361" x="32" y="150"/>
                                <oga:note color="0xffff96" height="223" title="Outputs" width="288" x="1370" y="500"/>
                                <oga:note color="0x96ff96" height="483" title="Optional Nodes" width="289" x="1050" y="140"/>
                            </oga:notes>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="tableMap" ref="cd7f2adfba34488c"/>
                    <ogcn:published_input field="obj" name="selectedSessions" ref="28e03ab509b94a85"/>
                    <ogcn:published_input field="obj" name="reportTitle" ref="6b15e246103847d5"/>
                    <ogcn:published_input field="obj" name="globalSummary" ref="54074bf3"/>
                    <ogcn:published_input field="obj" name="summarySection" ref="6316d6df"/>
                    <ogcn:published_input field="obj" name="breakdownSection" ref="1f1ab26ecd424afe"/>
                    <ogcn:published_output field="obj" name="table" ref="56745e76"/>
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.gedge.opgraph.nodes.reflect.IterableClassNode.className">
                                <![CDATA[java.util.ArrayList]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="878" y="182"/>
                    </extensions>
                </ogcn:macro>
                <node id="665495385b9d47c4" name="Global Summary" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                        </oga:settings>
                        <oga:meta x="1426" y="777">
                            <oga:default for="sectionName" type="java.lang.String">All Participants</oga:default>
                            <oga:default for="addToBeginning" type="java.lang.Boolean">true</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <link dest="51a10b46c3124671" destField="results" source="e6f07f6f7dc34e29" sourceField="obj"/>
                <link dest="9be63edf7454f48" destField="tableMap" source="ff306d8463c54561" sourceField="tableMap"/>
                <link dest="51a10b46c3124671" destField="project" source="1f17ec8476fc478a" sourceField="obj"/>
                <link dest="9be63edf7454f48" destField="selectedSessions" source="2ee97062ccbd4ee1" sourceField="obj"/>
                <link dest="9be63edf7454f48" destField="collection" source="5f8fe0460f3f4fd8" sourceField="obj"/>
                <link dest="ff306d8463c54561" destField="table" source="51a10b46c3124671" sourceField="table"/>
                <link dest="9be63edf7454f48" destField="reportTitle" source="e6d45b5e5a1847a0" sourceField="obj"/>
                <link dest="9be63edf7454f48" destField="globalSummary" source="3e25314b" sourceField="table"/>
                <link dest="3e25314b" destField="title" source="e6d45b5e5a1847a0" sourceField="obj"/>
                <link dest="657a041f" destField="text" source="e0941e01966243d8" sourceField="text"/>
                <link dest="e0941e01966243d8" destField="script" source="419c72194f554b81" sourceField="obj"/>
                <link dest="c17d62c2730f4c16" destField="parent" source="657a041f" sourceField="parent"/>
                <link dest="9be63edf7454f48" destField="summarySection" source="c17d62c2730f4c16" sourceField="section"/>
                <link dest="bc89329aad0454e" destField="parent" source="c17d62c2730f4c16" sourceField="parent"/>
                <link dest="9be63edf7454f48" destField="breakdownSection" source="bc89329aad0454e" sourceField="section"/>
                <link dest="86073f19002b43f4" destField="params" source="9ad0f5182254d47" sourceField="obj"/>
                <link dest="657a041f" destField="parent" source="e34cd0e" sourceField="root"/>
                <link dest="665495385b9d47c4" destField="table" source="9be63edf7454f48" sourceField="table"/>
                <link dest="665495385b9d47c4" destField="parent" source="c17d62c2730f4c16" sourceField="section"/>
                <link dest="e34cd0e" destField="reportName" source="86073f19002b43f4" sourceField="title"/>
                <extensions>
                    <oga:notes>
                        <oga:note color="0xffff96" height="1148" title="Published Inputs" width="397" x="12" y="7"/>
                    </oga:notes>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <ogcn:published_input field="obj" name="reportTitle" ref="e6d45b5e5a1847a0"/>
            <ogcn:published_input field="obj" name="project" ref="1f17ec8476fc478a"/>
            <ogcn:published_input field="obj" name="results" ref="e6f07f6f7dc34e29"/>
            <ogcn:published_input field="obj" name="selected sessions" ref="2ee97062ccbd4ee1"/>
            <ogcn:published_input field="obj" name="selected participants" ref="5f8fe0460f3f4fd8"/>
            <ogcn:published_input field="obj" name="script" ref="419c72194f554b81"/>
            <ogcn:published_input field="obj" name="parameters" ref="9ad0f5182254d47"/>
            <ogcn:published_output field="reportTree" name="reportTree" ref="e34cd0e"/>
            <extensions>
                <oga:meta x="796" y="151">
                    <oga:default for="reportTitle" type="java.lang.String">PCC</oga:default>
                </oga:meta>
            </extensions>
        </ogcn:macro>
        <link dest="4b18886ea00b48b3" destField="selected sessions" source="5e629711" sourceField="obj"/>
        <link dest="4b18886ea00b48b3" destField="selected participants" source="6b8dfd59" sourceField="obj"/>
        <link dest="4b18886ea00b48b3" destField="reportTitle" source="10ac3417" sourceField="pcType"/>
        <link dest="4b18886ea00b48b3" destField="parameters" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="10ac3417" destField="params" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="7e0169fb" destField="project" source="1d6fc11b" sourceField="obj"/>
        <link dest="7e0169fb" destField="sessions" source="5e629711" sourceField="obj"/>
        <link dest="7e0169fb" destField="parameters" source="dc4dad38c60648c1" sourceField="parameters"/>
        <link dest="4b18886ea00b48b3" destField="project" source="7e0169fb" sourceField="project"/>
        <link dest="4b18886ea00b48b3" destField="results" source="7e0169fb" sourceField="results"/>
        <link dest="4b18886ea00b48b3" destField="script" source="7e0169fb" sourceField="script"/>
        <extensions>
            <opqry:nodewizard type="ca.phon.app.opgraph.analysis.AnalysisWizardExtension">
                <opqry:info format="html" title="PPC">
                    <opqry:message/>
                </opqry:info>
                <opqry:node ref="dc4dad38c60648c1" showAsStep="true">
                    <opqry:info format="html" title="Parameters">
                        <opqry:message/>
                    </opqry:info>
                </opqry:node>
                <opqry:report-template name="Report Prefix"/>
                <opqry:report-template name="Report Suffix"/>
            </opqry:nodewizard>
            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
            <oga:notes>
                <oga:note color="0xffff96" height="542" title="Inputs" width="365" x="26" y="11">Default inputs for all Analysis documents</oga:note>
                <oga:note color="0x9696ff" height="542" title="PPC Query" width="296" x="425" y="12">Creates a table of results, one for each word in the selected sessions, with the PCC calculations for each word.</oga:note>
                <oga:note color="0x96ff96" height="537" title="Report" width="345" x="750" y="14">Basic report with Summary and Breakdown sections.  Summary contains totals for the PCC columns created in Query stage</oga:note>
            </oga:notes>
        </extensions>
    </graph>
</opgraph>
