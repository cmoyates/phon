<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<opgraph xmlns="https://www.phon.ca/ns/opgraph" xmlns:nes="https://www.phon.ca/ns/node_editor" xmlns:oga="https://www.phon.ca/ns/opgraph-app" xmlns:ogcn="https://www.phon.ca/ns/opgraph-common-nodes" xmlns:opqry="https://phon.ca/ns/opgraph_query" xmlns:qry="http://phon.ling.mun.ca/ns/query">
    <graph id="root">
        <node id="55f4fba4" name="Project" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_project]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[ca.phon.project.Project]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="15" y="15"/>
            </extensions>
        </node>
        <node id="1ae2322c" name="Selected Sessions" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_selectedSessions]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="15" y="296"/>
            </extensions>
        </node>
        <node id="3da0e5db" name="Selected Participants" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_selectedParticipants]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="15" y="397"/>
            </extensions>
        </node>
        <node id="dc596f57c3774064" name="Parameters" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <extensions>
                <oga:settings>
                    <oga:property key="reportTitle">
                        <![CDATA[Vocalization Analysis]]>
                    </oga:property>
                    <oga:property key="__script">
                        <![CDATA[var reportTitleParamInfo = {
	"id": "reportTitle",
	"title": "Report Title",
	"def": "Report",
	"prompt": "Enter report title"
};
var reportTitleParam;
var reportTitle = reportTitleParamInfo.def;

function setup_params(params) {
	reportTitleParam = new StringScriptParam(
			reportTitleParamInfo.id,
			reportTitleParamInfo.title,
			reportTitleParamInfo.def);
     reportTitleParam.setPrompt(reportTitleParamInfo.prompt);
	params.add(reportTitleParam);
}
]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="15" y="498"/>
            </extensions>
        </node>
        <opqry:queryNode id="29ac654b" name="Query : Data Tiers" type="ca.phon.app.opgraph.nodes.query.QueryNode">
            <qry:query xmlns="http://phon.ling.mun.ca/ns/query" date="2018-04-26T07:59:27.483-02:30" name="Data Tiers" uuid="bcf6917f-5b67-44d2-b9a7-d7a138a66051">
                <script>
                    <url ref="Data Tiers" rel="stock"/>
                    <param id="filters.alignedWord.patternFilter.allowOverlap">false</param>
                    <param id="filters.alignedWord.patternFilter.caseSensitive">false</param>
                    <param id="filters.alignedWord.patternFilter.exactMatch">true</param>
                    <param id="filters.alignedWord.patternFilter.filter">.+</param>
                    <param id="filters.alignedWord.patternFilter.filterType">Regular expression</param>
                    <param id="filters.alignedWord.tier">IPA Actual</param>
                    <param id="filters.primary.patternFilter.filter">.+</param>
                    <param id="filters.primary.patternFilter.filterType">Regular expression</param>
                    <param id="filters.primary.tier">Orthography</param>
                    <param id="filters.searchBy.searchBy">Word</param>
                    <param id="filters.word.searchByWord">true</param>
                    <param id="filters.wordTiers.tiers">Actual Syllabification</param>
                </script>
            </qry:query>
            <extensions>
                <oga:settings/>
                <oga:meta x="352" y="15"/>
            </extensions>
        </opqry:queryNode>
        <ogcn:macro id="2f5a76e38b4b4c38" name="Get Report Title" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="fa1db06">
                <node id="cdfe6b17a1ca4b4d" name="String#&lt;init&gt;(String)" type="class:ca.phon.opgraph.nodes.reflect.ConstructorNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.classMember">
                                <![CDATA[<init>(java.lang.String)]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.declaredClass">
                                <![CDATA[java.lang.String]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="15" y="15">
                            <oga:default for="arg1" type="java.lang.String">reportTitle</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="cad0a57030854326" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[get(java.lang.Object)]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.util.Map]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="218" y="16"/>
                    </extensions>
                </node>
                <node id="678c3d022771475d" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[toString()]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="392" y="15"/>
                    </extensions>
                </node>
                <link dest="cad0a57030854326" destField="arg1" source="cdfe6b17a1ca4b4d" sourceField="value"/>
                <link dest="678c3d022771475d" destField="obj" source="cad0a57030854326" sourceField="value"/>
            </graph>
            <ogcn:published_input field="obj" name="parameters" ref="cad0a57030854326"/>
            <ogcn:published_output field="value" name="reportTitle" ref="678c3d022771475d"/>
            <extensions>
                <oga:meta x="252" y="498"/>
            </extensions>
        </ogcn:macro>
        <node id="61e6ae5ee8ed4084" type="class:ca.phon.app.opgraph.nodes.table.ResultsToTableNode">
            <extensions>
                <oga:settings>
                    <oga:property key="includeSessionInfo">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeSpeakerInfo">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeMetadata">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeTierInfo">
                        <![CDATA[true]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="589" y="15"/>
            </extensions>
        </node>
        <node id="e041a49" type="class:ca.phon.app.opgraph.nodes.report.NewReportNode">
            <extensions>
                <oga:settings/>
                <oga:meta x="485" y="498"/>
            </extensions>
        </node>
        <node id="763b6571" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
            <extensions>
                <oga:meta x="728" y="504">
                    <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <ogcn:macro id="61208600" name="For Each Participant" type="ca.phon.opgraph.nodes.reflect.IterableClassNode">
            <graph id="26119246">
                <node id="282a70f9" name="Current Object" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key">
                                <![CDATA[currentValue]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="24" y="23"/>
                    </extensions>
                </node>
                <ogcn:macro id="55aaa72dc82b4f91" name="Create Summary Table" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="65af3c0">
                        <node id="2346342eeb134cfe" name="DefaultTableDataSource#&lt;init&gt;()" type="class:ca.phon.opgraph.nodes.reflect.ConstructorNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.classMember">
                                        <![CDATA[<init>()]]>
                                    </oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="576" y="555"/>
                            </extensions>
                        </node>
                        <node id="60acbaa7700b42af" name="Setup Table Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script">
                                        <![CDATA[
function init(inputs, outputs) {
	
}

function tableOp(context, table) {
	var colIdx = 0;

	table.setColumnTitle(colIdx++, "Category");
	table.setColumnTitle(colIdx++, "Item");
	table.setColumnTitle(colIdx++, "Value");
}
]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="855" y="541"/>
                            </extensions>
                        </node>
                        <link dest="60acbaa7700b42af" destField="table" source="2346342eeb134cfe" sourceField="value"/>
                        <extensions>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_output field="table" name="table" ref="60acbaa7700b42af"/>
                    <extensions>
                        <oga:meta x="444" y="58"/>
                    </extensions>
                </ogcn:macro>
                <node id="cbab76efb3454ab5" name="Result Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="46" y="188"/>
                    </extensions>
                </node>
                <node id="c2a4bb4702264bae" name="Summary Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="39" y="323"/>
                    </extensions>
                </node>
                <node id="deb9a5f4203e48c1" name="Root Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="39" y="549"/>
                    </extensions>
                </node>
                <node id="5fc29abaa09040c1" name="To Participant Object" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass">
                                <![CDATA[ca.phon.session.Participant]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="221" y="23"/>
                    </extensions>
                </node>
                <node id="e60ae088c39c4be1" name="Partition Table (Vocalizations vs Words)" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                    <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                    <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                    <extensions>
                        <oga:settings>
                            <oga:property key="filters.column.filter">
                                <![CDATA[yyy]]>
                            </oga:property>
                            <oga:property key="filters.column.filterType">
                                <![CDATA[Plain text]]>
                            </oga:property>
                            <oga:property key="filters.column.allowOverlap">
                                <![CDATA[false]]>
                            </oga:property>
                            <oga:property key="filters.column.exactMatch">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="__script">
                                <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                            </oga:property>
                            <oga:property key="filters.column.caseSensitive">
                                <![CDATA[false]]>
                            </oga:property>
                            <oga:property key="columnName">
                                <![CDATA[Orthography]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="336" y="154"/>
                    </extensions>
                </node>
                <node id="fb1827b" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[toString()]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="342" y="407"/>
                    </extensions>
                </node>
                <node id="7efa92f7" name="Add Participant Section" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                    <extensions>
                        <oga:meta x="367" y="575"/>
                    </extensions>
                </node>
                <ogcn:macro id="607a331e" name="Vocalizations" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="642b6dbe">
                        <node id="28737cd4" name="speaker" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.session.Participant]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="35"/>
                            </extensions>
                        </node>
                        <node id="3303e4cd" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="356"/>
                            </extensions>
                        </node>
                        <node id="b559e3f830b34106" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="517"/>
                            </extensions>
                        </node>
                        <node id="a8b85ca0e5b34a92" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="658"/>
                            </extensions>
                        </node>
                        <node id="bfbf3172e44b4532" name="Split Table by Speaker" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script">
                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                    </oga:property>
                                    <oga:property key="columnName">
                                        <![CDATA[Speaker]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="242" y="477"/>
                            </extensions>
                        </node>
                        <ogcn:macro id="bbf482c5a66541f7" name="Get Table of Results For Speaker" type="ca.phon.opgraph.nodes.general.MacroNode">
                            <graph id="745c18a0">
                                <node id="5642bea05e5c4b06" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                                <![CDATA[toString()]]>
                                            </oga:property>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                <![CDATA[java.lang.Object]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="105" y="70"/>
                                    </extensions>
                                </node>
                                <node id="57334ef9ad744f65" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                                <![CDATA[get(java.lang.Object)]]>
                                            </oga:property>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                <![CDATA[java.util.Map]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="296" y="73"/>
                                    </extensions>
                                </node>
                                <node id="4df6ff3399a848c7" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                    <output name="exists" type="java.lang.Boolean">does table exist</output>
                                    <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource">table if exists, undefined otherwise</output>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="__script">
                                                <![CDATA[
// setup input/output fields
function init(inputFields, outputFields) {
	inputFields.add("table", "");
	outputFields.add("exists", "does table exist", false, java.lang.Boolean);
	outputFields.add("table", "table if exists, undefined otherwise", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableExists =
		(context.containsKey("table") && context.get("table") != null);
	context.put("exists", tableExists);
	context.put("table", context.get("table"));
}
]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="514" y="94"/>
                                    </extensions>
                                </node>
                                <link dest="57334ef9ad744f65" destField="arg1" source="5642bea05e5c4b06" sourceField="value"/>
                                <link dest="4df6ff3399a848c7" destField="table" source="57334ef9ad744f65" sourceField="value"/>
                                <extensions>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="speaker" ref="5642bea05e5c4b06"/>
                            <ogcn:published_input field="obj" name="tableMap" ref="57334ef9ad744f65"/>
                            <ogcn:published_output field="exists" name="exists" ref="4df6ff3399a848c7"/>
                            <ogcn:published_output field="table" name="table" ref="4df6ff3399a848c7"/>
                            <extensions>
                                <oga:meta x="345" y="166"/>
                            </extensions>
                        </ogcn:macro>
                        <ogcn:macro id="350c5a14" name="If Speaker Has Results" type="ca.phon.opgraph.nodes.general.MacroNode">
                            <graph id="7a8c0ba3">
                                <node id="60a76f15" name="Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="55"/>
                                    </extensions>
                                </node>
                                <node id="68d90fd6bd914ea2" name="Participant" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.session.Participant]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="216"/>
                                    </extensions>
                                </node>
                                <node id="95cfaf8923b44bb7" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="537"/>
                                    </extensions>
                                </node>
                                <node id="69ab305476bc42d9" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="678"/>
                                    </extensions>
                                </node>
                                <node id="7f149b7d" name="Split Table by Session" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                    <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                    <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="__script">
                                                <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                            </oga:property>
                                            <oga:property key="columnName">
                                                <![CDATA[Session]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="350" y="67"/>
                                    </extensions>
                                </node>
                                <node id="540f0fe8" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                                    <extensions>
                                        <oga:meta x="357" y="684">
                                            <oga:default for="sectionName" type="java.lang.String">Vocalizations</oga:default>
                                        </oga:meta>
                                    </extensions>
                                </node>
                                <ogcn:macro id="5aee518f" name="Vocalization Analysis" type="ca.phon.opgraph.nodes.general.MacroNode">
                                    <graph id="45982ecd">
                                        <node id="c81dda4" name="result total" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[java.lang.Integer]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="15"/>
                                            </extensions>
                                        </node>
                                        <node id="45508fae" name="speaker" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.session.Participant]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="116"/>
                                            </extensions>
                                        </node>
                                        <node id="578fcaef" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="437"/>
                                            </extensions>
                                        </node>
                                        <node id="7cbf1d09" name="tableMap" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[java.util.Map]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="598"/>
                                            </extensions>
                                        </node>
                                        <node id="fe996f4347094d31" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="699"/>
                                            </extensions>
                                        </node>
                                        <node id="ae45a3e8c6864a08" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="contextKey"/>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="14" y="834"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="71606628" name="All Vocalizations" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="44eec6ea">
                                                <node id="4413c5e1" name="tableMap" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[java.util.Map]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="40" y="77"/>
                                                    </extensions>
                                                </node>
                                                <node id="a1606265db404383" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="40" y="178"/>
                                                    </extensions>
                                                </node>
                                                <node id="a7f7aa2024924ad7" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="37" y="319"/>
                                                    </extensions>
                                                </node>
                                                <node id="4584344a" name="Create Totals Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                                    <input name="tableMap" optional="false"/>
                                                    <output name="totalsTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("totalsTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableMap = context.get("tableMap");
	var totalsTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	totalsTable.setColumnTitle(0, "Session");
	totalsTable.setColumnTitle(1, "Count");

	var keySet = tableMap.keySet();
	var itr = keySet.iterator();
	var total = 0;
	while(itr.hasNext()) {
		var session = itr.next();
		var count = tableMap.get(session).rowCount;
		total += count;

		var rowData = [];
		rowData[0] = session;
		rowData[1] = new java.lang.Integer(count);

		totalsTable.addRow(rowData);
	}

	var rowData = [ "Total", new java.lang.Integer(total) ];
	totalsTable.addRow(rowData);

	context.put("totalsTable", totalsTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="386" y="324"/>
                                                    </extensions>
                                                </node>
                                                <node id="350382d5" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="620" y="134">
                                                            <oga:default for="sectionName" type="java.lang.String">Total</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="5d862a89" name="Add #Voc/Session" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("totalsTable", "");
}

function tableOp(context, table) {
	var totalsTable = context.get("totalsTable");

	var totalVocalizations = totalsTable.getValueAt(totalsTable.rowCount-1, totalsTable.columnCount-1);
	var numSessions = totalsTable.rowCount-1;

	var freq = new java.lang.Float(totalVocalizations/numSessions);
	
	var colIdx = 0;
	var rowData = [];
	rowData[colIdx++] = "Vocalizations";
	rowData[colIdx++] = "# of vocalizations / session";
	rowData[colIdx++] = freq;

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="623" y="324"/>
                                                    </extensions>
                                                </node>
                                                <link dest="4584344a" destField="tableMap" source="4413c5e1" sourceField="obj"/>
                                                <link dest="5d862a89" destField="table" source="a1606265db404383" sourceField="obj"/>
                                                <link dest="5d862a89" destField="totalsTable" source="4584344a" sourceField="totalsTable"/>
                                                <link dest="350382d5" destField="parent" source="a7f7aa2024924ad7" sourceField="obj"/>
                                                <link dest="350382d5" destField="table" source="4584344a" sourceField="totalsTable"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                    <oga:notes>
                                                        <oga:note color="0xffff96" height="506" title="Published Inputs" width="308" x="20" y="40"/>
                                                    </oga:notes>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="tableMap" ref="4413c5e1"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="a1606265db404383"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="a7f7aa2024924ad7"/>
                                            <extensions>
                                                <oga:meta x="275" y="12"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="5c298b00" name="Listing" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="6b98dcd7">
                                                <node id="77fcdc08" name="data" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="9d1f0c988b3b4026" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="176"/>
                                                    </extensions>
                                                </node>
                                                <node id="44316d80" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="344" y="103">
                                                            <oga:default for="sectionName" type="java.lang.String">Listing</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <link dest="44316d80" destField="table" source="77fcdc08" sourceField="obj"/>
                                                <link dest="44316d80" destField="parent" source="9d1f0c988b3b4026" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="data" ref="77fcdc08"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="9d1f0c988b3b4026"/>
                                            <extensions>
                                                <oga:meta x="515" y="12"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="39f91ef7" name="Initial Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="3779007d">
                                                <node id="4ceebc1" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="28"/>
                                                    </extensions>
                                                </node>
                                                <node id="bf992c580e0040f7" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="189"/>
                                                    </extensions>
                                                </node>
                                                <node id="d156c18598774c51" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="330"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="3fd5be49" name="Initial Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="4a0ccd3">
                                                        <node id="4582b1f9" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="804ab32e282412a" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="19" y="647"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1e4b8d36" name="Add Initial Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Initial C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var initialC = "";
		if(ipa.matches("^\\c.*")) {
			initialC = (new IPATranscriptBuilder()).append(ipa.elementAt(0)).toIPATranscript();
		}

		rowData[colIdx] = initialC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="26edcb08" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Initial C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="503" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d66aa6a" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="738" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="157e22dd" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Initial C" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="965" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="5142a794" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="246" y="494"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="397afdf3" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Initial C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="481" y="494"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="310e1bb2" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="762" y="520">
                                                                    <oga:default for="sectionName" type="java.lang.String">Initial Consonants</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="26edcb08" destField="table" source="1e4b8d36" sourceField="table"/>
                                                        <link dest="1e4b8d36" destField="table" source="4582b1f9" sourceField="obj"/>
                                                        <link dest="5142a794" destField="table" source="157e22dd" sourceField="table"/>
                                                        <link dest="397afdf3" destField="table" source="5142a794" sourceField="table"/>
                                                        <link dest="d66aa6a" destField="obj" source="26edcb08" sourceField="trueTable"/>
                                                        <link dest="157e22dd" destField="table" source="d66aa6a" sourceField="obj"/>
                                                        <link dest="5142a794" destField="total" source="d66aa6a" sourceField="rowCount"/>
                                                        <link dest="310e1bb2" destField="parent" source="804ab32e282412a" sourceField="obj"/>
                                                        <link dest="310e1bb2" destField="table" source="397afdf3" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="4582b1f9"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="804ab32e282412a"/>
                                                    <ogcn:published_output field="table" name="table" ref="157e22dd"/>
                                                    <extensions>
                                                        <oga:meta x="300" y="27"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="37993d4121c64985" name="Initial Consonants (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="6b0f7c62">
                                                        <node id="1fe296e468a143cc" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1e538c2e44b14aa5" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="16" y="530"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="575dcc9dac31425d" name="Add Initial Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Initial C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var initialC = "";
		if(ipa.matches("^\\c.*")) {
			initialC = (new IPATranscriptBuilder()).append(ipa.elementAt(0)).toIPATranscript();
		}

		rowData[colIdx] = initialC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d2d0e4adf72b455b" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Initial C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="503" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e4b60d5da7634e1c" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Initial C" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="738" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="41dceaee2c4a46ae" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	//inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	//var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	// calculate column totals
	var columnTotals = [];
	for(var col = 1; col < table.columnCount; col++) {
		var sessionName = table.getColumnTitle(col);
		var total = 0;
		for(var row = 0; row < table.rowCount; row++) {
			total += table.getValueAt(row, col).intValue();
		}

		columnTotals[sessionName] = total;
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = columnTotals[table.getColumnTitle(col)];
			
			
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="913" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="da71e3439700466e" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Initial C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1148" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1ce1298c" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="932" y="527">
                                                                    <oga:default for="sectionName" type="java.lang.String">Initial Consonants (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="d2d0e4adf72b455b" destField="table" source="575dcc9dac31425d" sourceField="table"/>
                                                        <link dest="575dcc9dac31425d" destField="table" source="1fe296e468a143cc" sourceField="obj"/>
                                                        <link dest="e4b60d5da7634e1c" destField="table" source="d2d0e4adf72b455b" sourceField="trueTable"/>
                                                        <link dest="41dceaee2c4a46ae" destField="table" source="e4b60d5da7634e1c" sourceField="table"/>
                                                        <link dest="da71e3439700466e" destField="table" source="41dceaee2c4a46ae" sourceField="freqTable"/>
                                                        <link dest="1ce1298c" destField="table" source="da71e3439700466e" sourceField="table"/>
                                                        <link dest="1ce1298c" destField="parent" source="1e538c2e44b14aa5" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="1fe296e468a143cc"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="1e538c2e44b14aa5"/>
                                                    <extensions>
                                                        <oga:meta x="296" y="208"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="38a662c4" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique initial consonants";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="673" y="104"/>
                                                    </extensions>
                                                </node>
                                                <link dest="3fd5be49" destField="table" source="4ceebc1" sourceField="obj"/>
                                                <link dest="37993d4121c64985" destField="table" source="4ceebc1" sourceField="obj"/>
                                                <link dest="38a662c4" destField="table" source="bf992c580e0040f7" sourceField="obj"/>
                                                <link dest="38a662c4" destField="inventory" source="3fd5be49" sourceField="table"/>
                                                <link dest="37993d4121c64985" destField="reportNode" source="d156c18598774c51" sourceField="obj"/>
                                                <link dest="3fd5be49" destField="reportNode" source="d156c18598774c51" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="4ceebc1"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="bf992c580e0040f7"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="d156c18598774c51"/>
                                            <extensions>
                                                <oga:meta x="275" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="9bee85a827324705" name="Final Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="49b2d7e3">
                                                <node id="be648f920a40a0" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="35" y="41"/>
                                                    </extensions>
                                                </node>
                                                <node id="426e192785444d8e" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="35" y="202"/>
                                                    </extensions>
                                                </node>
                                                <node id="2ef964c1e3954cff" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="41" y="347"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="47ab9f734c8d4a3b" name="Final Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="33234f2e">
                                                        <node id="390d058f9a044b28" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="346ab7dbf17c4f4c" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="31" y="615"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="83392f37c32b4f47" name="Add Final Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Final C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var finalC = "";
		if(ipa.matches(".*\\c$")) {
			finalC = (new IPATranscriptBuilder()).append(ipa.elementAt(ipa.length()-1)).toIPATranscript();
		}

		rowData[colIdx] = finalC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="c8d9bf6512514970" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.allowOverlap">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.exactMatch">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.caseSensitive">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Final C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="497" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="19c21fe28f584032" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Final C" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="719" y="313"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="43edc518" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="709" y="485"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="140e94fe8d404799" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="907" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="af085cd0ea414e90" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Final C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1138" y="373"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="47a3712d" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="703" y="667">
                                                                    <oga:default for="sectionName" type="java.lang.String">Final Consonants</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="83392f37c32b4f47" destField="table" source="390d058f9a044b28" sourceField="obj"/>
                                                        <link dest="140e94fe8d404799" destField="table" source="19c21fe28f584032" sourceField="table"/>
                                                        <link dest="af085cd0ea414e90" destField="table" source="140e94fe8d404799" sourceField="table"/>
                                                        <link dest="c8d9bf6512514970" destField="table" source="83392f37c32b4f47" sourceField="table"/>
                                                        <link dest="19c21fe28f584032" destField="table" source="c8d9bf6512514970" sourceField="trueTable"/>
                                                        <link dest="43edc518" destField="obj" source="c8d9bf6512514970" sourceField="trueTable"/>
                                                        <link dest="140e94fe8d404799" destField="total" source="43edc518" sourceField="rowCount"/>
                                                        <link dest="47a3712d" destField="table" source="af085cd0ea414e90" sourceField="table"/>
                                                        <link dest="47a3712d" destField="parent" source="346ab7dbf17c4f4c" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="390d058f9a044b28"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="346ab7dbf17c4f4c"/>
                                                    <ogcn:published_output field="table" name="table" ref="19c21fe28f584032"/>
                                                    <extensions>
                                                        <oga:meta x="425" y="38"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="a2bb4201f25d43e2" name="Final Consonants (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="359d6b85">
                                                        <node id="36f52067ce1f4419" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="cd56721b274a4678" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="25" y="226"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a2fc327ba656458f" name="Add Final Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Final C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var finalC = "";
		if(ipa.matches(".*\\c$")) {
			finalC = (new IPATranscriptBuilder()).append(ipa.elementAt(ipa.length()-1)).toIPATranscript();
		}

		rowData[colIdx] = finalC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="eb8416e76b304213" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.allowOverlap">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.exactMatch">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.caseSensitive">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Final C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="500" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="93d898e7d3974832" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Final C" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="737" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="2f70db5025ff4e1c" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
//	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
//	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	// calculate column totals
	var columnTotals = [];
	for(var col = 1; col < table.columnCount; col++) {
		var sessionName = table.getColumnTitle(col);
		var total = 0;
		for(var row = 0; row < table.rowCount; row++) {
			total += table.getValueAt(row, col).intValue();
		}

		columnTotals[sessionName] = total;
	}
	
	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = columnTotals[table.getColumnTitle(col)];
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="934" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a41037cab06c49d9" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Final C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1171" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="23e89dec" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="519" y="267">
                                                                    <oga:default for="sectionName" type="java.lang.String">Final Consonants (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="a2fc327ba656458f" destField="table" source="36f52067ce1f4419" sourceField="obj"/>
                                                        <link dest="2f70db5025ff4e1c" destField="table" source="93d898e7d3974832" sourceField="table"/>
                                                        <link dest="a41037cab06c49d9" destField="table" source="2f70db5025ff4e1c" sourceField="freqTable"/>
                                                        <link dest="eb8416e76b304213" destField="table" source="a2fc327ba656458f" sourceField="table"/>
                                                        <link dest="93d898e7d3974832" destField="table" source="eb8416e76b304213" sourceField="trueTable"/>
                                                        <link dest="23e89dec" destField="table" source="a41037cab06c49d9" sourceField="table"/>
                                                        <link dest="23e89dec" destField="parent" source="cd56721b274a4678" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="36f52067ce1f4419"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="cd56721b274a4678"/>
                                                    <extensions>
                                                        <oga:meta x="425" y="208"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="84fb765a142d40cd" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique final consonants";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="761" y="386"/>
                                                    </extensions>
                                                </node>
                                                <link dest="47ab9f734c8d4a3b" destField="table" source="be648f920a40a0" sourceField="obj"/>
                                                <link dest="a2bb4201f25d43e2" destField="table" source="be648f920a40a0" sourceField="obj"/>
                                                <link dest="84fb765a142d40cd" destField="inventory" source="47ab9f734c8d4a3b" sourceField="table"/>
                                                <link dest="84fb765a142d40cd" destField="table" source="426e192785444d8e" sourceField="obj"/>
                                                <link dest="47ab9f734c8d4a3b" destField="reportNode" source="2ef964c1e3954cff" sourceField="obj"/>
                                                <link dest="a2bb4201f25d43e2" destField="reportNode" source="2ef964c1e3954cff" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="be648f920a40a0"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="426e192785444d8e"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="2ef964c1e3954cff"/>
                                            <extensions>
                                                <oga:meta x="515" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="9dee81f2bd624468" name="Vowels" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="41fb932e">
                                                <node id="4286091421414cd3" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="9b01878056a943ce" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="176"/>
                                                    </extensions>
                                                </node>
                                                <node id="b3c94cedb46a45c7" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="30" y="401"/>
                                                    </extensions>
                                                </node>
                                                <node id="6ac5430e4a2a4274" name="Create Vowel Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="vowelTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	outputs.add("vowelTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var vowelTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	vowelTable.setColumnTitle(0, "Session");
	vowelTable.setColumnTitle(1, "Record");
	vowelTable.setColumnTitle(2, "Vowel");
	vowelTable.setColumnTitle(3, "Actual Syllabification (Word)");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var actualSyllabification = table.getValueAt(row, "Actual Syllabification (Word)");
		var ipa = (new IPATranscriptBuilder()).append(actualSyllabification).toIPATranscript();
		var sylls = ipa.syllables();

		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var syll = sylls.get(syllIdx);
			var phonexPattern = Packages.ca.phon.phonex.PhonexPattern.compile(".:N+");
			var matcher = phonexPattern.matcher(syll);
			if(matcher.find()) {
				var nucleus = (new IPATranscriptBuilder()).append(matcher.group()).toIPATranscript();

				var rowData = [];
				rowData[0] = table.getValueAt(row, 0);
				rowData[1] = table.getValueAt(row, "Record #");
				rowData[2] = nucleus;
				rowData[3] = actualSyllabification;
				vowelTable.addRow(rowData);
			}
		}
	}

	context.put("vowelTable", vowelTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="302" y="41"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="b22af37adc0e4a9b" name="Vowels (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="12786cf1">
                                                        <node id="598e44aa449b4309" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="de59595fcce04d31" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="24" y="366"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="cd1c7130d14a4351" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Vowel" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="10ea9b12e8f049b9" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1232952ac10d4297" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ba92fb2d0d3844d9" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Vowel" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="356e96a4" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="716" y="344">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vowel Inventory</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="ba92fb2d0d3844d9" destField="table" source="1232952ac10d4297" sourceField="table"/>
                                                        <link dest="1232952ac10d4297" destField="total" source="10ea9b12e8f049b9" sourceField="rowCount"/>
                                                        <link dest="10ea9b12e8f049b9" destField="obj" source="598e44aa449b4309" sourceField="obj"/>
                                                        <link dest="1232952ac10d4297" destField="table" source="cd1c7130d14a4351" sourceField="table"/>
                                                        <link dest="cd1c7130d14a4351" destField="table" source="598e44aa449b4309" sourceField="obj"/>
                                                        <link dest="356e96a4" destField="parent" source="de59595fcce04d31" sourceField="obj"/>
                                                        <link dest="356e96a4" destField="table" source="ba92fb2d0d3844d9" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="598e44aa449b4309"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="de59595fcce04d31"/>
                                                    <ogcn:published_output field="table" name="table" ref="cd1c7130d14a4351"/>
                                                    <extensions>
                                                        <oga:meta x="559" y="27"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="65bf101fb2f14ead" name="Vowels (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="6e22c8a5">
                                                        <node id="76e8171f93824e4d" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="54c6948a3d6c4afd" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e8096b1c415d4b71" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Vowel" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="b65dd07081f94f95" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="176"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="35abd40b9b9f4fb0" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="441" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f25fd64007f74beb" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Vowel" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="678" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="5bc62d04" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="828" y="299">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vowel Inventory (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="e8096b1c415d4b71" destField="table" source="76e8171f93824e4d" sourceField="obj"/>
                                                        <link dest="b65dd07081f94f95" destField="table" source="76e8171f93824e4d" sourceField="obj"/>
                                                        <link dest="35abd40b9b9f4fb0" destField="tableMap" source="b65dd07081f94f95" sourceField="tableMap"/>
                                                        <link dest="35abd40b9b9f4fb0" destField="table" source="e8096b1c415d4b71" sourceField="table"/>
                                                        <link dest="f25fd64007f74beb" destField="table" source="35abd40b9b9f4fb0" sourceField="freqTable"/>
                                                        <link dest="5bc62d04" destField="table" source="f25fd64007f74beb" sourceField="table"/>
                                                        <link dest="5bc62d04" destField="parent" source="54c6948a3d6c4afd" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="76e8171f93824e4d"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="54c6948a3d6c4afd"/>
                                                    <extensions>
                                                        <oga:meta x="557" y="175"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="6abedfe79ca14089" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique vowels";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="788" y="323"/>
                                                    </extensions>
                                                </node>
                                                <link dest="6ac5430e4a2a4274" destField="table" source="4286091421414cd3" sourceField="obj"/>
                                                <link dest="65bf101fb2f14ead" destField="table" source="6ac5430e4a2a4274" sourceField="vowelTable"/>
                                                <link dest="b22af37adc0e4a9b" destField="table" source="6ac5430e4a2a4274" sourceField="vowelTable"/>
                                                <link dest="6abedfe79ca14089" destField="inventory" source="b22af37adc0e4a9b" sourceField="table"/>
                                                <link dest="6abedfe79ca14089" destField="table" source="b3c94cedb46a45c7" sourceField="obj"/>
                                                <link dest="b22af37adc0e4a9b" destField="reportNode" source="9b01878056a943ce" sourceField="obj"/>
                                                <link dest="65bf101fb2f14ead" destField="reportNode" source="9b01878056a943ce" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="4286091421414cd3"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="b3c94cedb46a45c7"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="9b01878056a943ce"/>
                                            <extensions>
                                                <oga:meta x="755" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="35376622" name="Syllable Structure" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="5ac3aa41">
                                                <node id="47c22615" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="3dc067559584ced" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="23" y="195"/>
                                                    </extensions>
                                                </node>
                                                <node id="2b8b8d7a0c554dc5" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="24" y="336"/>
                                                    </extensions>
                                                </node>
                                                <node id="45faec77" name="Create Syllable Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="syllTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	outputs.add("syllTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}


var symbolMap = "H={glottal}; G=\\g; C=\\c; V=\\v";

function tableOp(context, table) {
	var syllTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	syllTable.setColumnTitle(0, "Session");
	syllTable.setColumnTitle(1, "Record");
	syllTable.setColumnTitle(2, "Syllable");
	syllTable.setColumnTitle(3, "Structure");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "Actual Syllabification (Word)")).toIPATranscript();
		var sylls = ipa.syllables();


		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var syll = sylls.get(syllIdx);

			var rowData = [];
			rowData[0] = table.getValueAt(row, 0);
			rowData[1] = table.getValueAt(row, "Record #");
			rowData[2] = syll;
			rowData[3] = syll.cover(symbolMap);
			syllTable.addRow(rowData);
		}
	}

	context.put("syllTable", syllTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="275" y="21"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="3c1623ed" name="Syllable Strucutre (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="4b3b150d">
                                                        <node id="77c929c0" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e96b708b14e84704" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="197b49e3" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="false"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="241" y="24"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1a8e8504" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="151"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a8e35bac8bd74fce" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="784b6f83" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="26300656" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="762" y="308">
                                                                    <oga:default for="sectionName" type="java.lang.String">Syllable Structure</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="784b6f83" destField="table" source="a8e35bac8bd74fce" sourceField="table"/>
                                                        <link dest="a8e35bac8bd74fce" destField="total" source="1a8e8504" sourceField="rowCount"/>
                                                        <link dest="1a8e8504" destField="obj" source="77c929c0" sourceField="obj"/>
                                                        <link dest="a8e35bac8bd74fce" destField="table" source="197b49e3" sourceField="table"/>
                                                        <link dest="197b49e3" destField="table" source="77c929c0" sourceField="obj"/>
                                                        <link dest="26300656" destField="parent" source="e96b708b14e84704" sourceField="obj"/>
                                                        <link dest="26300656" destField="table" source="784b6f83" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="77c929c0"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="e96b708b14e84704"/>
                                                    <ogcn:published_output field="table" name="table" ref="197b49e3"/>
                                                    <extensions>
                                                        <oga:meta x="557" y="29"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="304f07bd533d4538" name="Syllable Strucutre (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="7e3fb5db">
                                                        <node id="4c22960fe18b4e7c" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1ac67c4ac34e43da" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9b7b38075b0b44fc" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="false"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="7c90b8bc" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="c37e4ce7fc204887" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9df2519ebf114209" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="2df31c75" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="688" y="322">
                                                                    <oga:default for="sectionName" type="java.lang.String">Syllable Structure (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="9b7b38075b0b44fc" destField="table" source="4c22960fe18b4e7c" sourceField="obj"/>
                                                        <link dest="7c90b8bc" destField="table" source="4c22960fe18b4e7c" sourceField="obj"/>
                                                        <link dest="c37e4ce7fc204887" destField="tableMap" source="7c90b8bc" sourceField="tableMap"/>
                                                        <link dest="c37e4ce7fc204887" destField="table" source="9b7b38075b0b44fc" sourceField="table"/>
                                                        <link dest="9df2519ebf114209" destField="table" source="c37e4ce7fc204887" sourceField="freqTable"/>
                                                        <link dest="2df31c75" destField="table" source="9df2519ebf114209" sourceField="table"/>
                                                        <link dest="2df31c75" destField="parent" source="1ac67c4ac34e43da" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="4c22960fe18b4e7c"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="1ac67c4ac34e43da"/>
                                                    <extensions>
                                                        <oga:meta x="555" y="184"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="480e7fca23084a07" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
	inputs.add("numVocs", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");
	var numVocs = context.get("numVocs");



	// add % vocalizations with CV or CVC
	var countCV = 0;
	var countFinalC = 0;
	var total = 0;
	for(var row = 0; row < inventory.rowCount; row++) {
		var pattern = inventory.getValueAt(row, 0);
		var c = inventory.getValueAt(row, 1);

		if(pattern.toString().contains("CV")) {
			countCV += c.intValue();
		}

		if(pattern.toString().endsWith("C")) {
			countFinalC += c.intValue();
		}
		
		total += c.intValue();
	}
	var freqCV = (countCV / total) * 100.0; 
	var freqFinalC = (countFinalC / total) * 100.0;

	var syllsPerVoc = total / numVocs;

	var rowData = [];
	var colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of syllables / vocalization";
	rowData[colIdx++] = new java.lang.Float(syllsPerVoc);
	table.addRow(rowData);
	
	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of syllables that include a CV sequence";
	rowData[colIdx++] = new java.lang.Float(freqCV);
	table.addRow(rowData);

	rowData = [];
	colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of syllables that end with a C";
	rowData[colIdx++] = new java.lang.Float(freqFinalC);
	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="900" y="332"/>
                                                    </extensions>
                                                </node>
                                                <link dest="45faec77" destField="table" source="47c22615" sourceField="obj"/>
                                                <link dest="3c1623ed" destField="table" source="45faec77" sourceField="syllTable"/>
                                                <link dest="304f07bd533d4538" destField="table" source="45faec77" sourceField="syllTable"/>
                                                <link dest="480e7fca23084a07" destField="inventory" source="3c1623ed" sourceField="table"/>
                                                <link dest="480e7fca23084a07" destField="table" source="3dc067559584ced" sourceField="obj"/>
                                                <link dest="480e7fca23084a07" destField="numVocs" source="47c22615" sourceField="rowCount"/>
                                                <link dest="3c1623ed" destField="reportNode" source="2b8b8d7a0c554dc5" sourceField="obj"/>
                                                <link dest="304f07bd533d4538" destField="reportNode" source="2b8b8d7a0c554dc5" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="47c22615"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="3dc067559584ced"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="2b8b8d7a0c554dc5"/>
                                            <extensions>
                                                <oga:meta x="275" y="340"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="fbb7c1ceae774d2a" name="Vocalization Structure" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="219cd9d9">
                                                <node id="db2fcf7cec6341e0" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="36"/>
                                                    </extensions>
                                                </node>
                                                <node id="85ac255934fb4b3d" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="177"/>
                                                    </extensions>
                                                </node>
                                                <node id="bb7663ffd8004214" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="318"/>
                                                    </extensions>
                                                </node>
                                                <node id="48ecf0a222045b2" name="Add IPA Cover Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
}

var symbolMap = "H={glottal}; G=\\g; C=\\c; V=\\v";

function tableOp(context, table) {
	var structureColIdx = table.columnCount;
	table.setColumnTitle(structureColIdx, "Structure");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var ipa = table.getValueAt(row, "IPA Actual (Word)");

		var builder = new IPATranscriptBuilder();
		builder.append(table.getValueAt(row, "Actual Syllabification (Word)"));
		var sylls = builder.toIPATranscript().syllables();

		builder = new IPATranscriptBuilder();
		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var coveredIPA = sylls.get(syllIdx).cover(symbolMap);
			if(builder.size() > 0 && !coveredIPA.matches("^\\s.*")) {
				builder.appendSyllableBoundary();
			}
			builder.append(coveredIPA);
		}
		tableData[structureColIdx] = builder.toIPATranscript();
	}
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="281" y="115"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="d6dcaea1e62046f7" name="Structures (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="6e51d9c6">
                                                        <node id="7d0ef2fe71254e04" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ebc39c54cc2f458a" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="31" y="212"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a12598f7c4e34dcc" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="false"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="8ecf968b16c24594" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="441" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="33ee13c79ef4cc3" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="678" y="30"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3990b544" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="690" y="225">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vocalization Structure</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="33ee13c79ef4cc3" destField="table" source="8ecf968b16c24594" sourceField="table"/>
                                                        <link dest="8ecf968b16c24594" destField="table" source="a12598f7c4e34dcc" sourceField="table"/>
                                                        <link dest="8ecf968b16c24594" destField="total" source="7d0ef2fe71254e04" sourceField="rowCount"/>
                                                        <link dest="a12598f7c4e34dcc" destField="table" source="7d0ef2fe71254e04" sourceField="obj"/>
                                                        <link dest="3990b544" destField="table" source="33ee13c79ef4cc3" sourceField="table"/>
                                                        <link dest="3990b544" destField="parent" source="ebc39c54cc2f458a" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="7d0ef2fe71254e04"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="ebc39c54cc2f458a"/>
                                                    <ogcn:published_output field="table" name="table" ref="a12598f7c4e34dcc"/>
                                                    <extensions>
                                                        <oga:meta x="564" y="26"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="458fd744de5a4a6a" name="Structures (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="1ffe9d2a">
                                                        <node id="b1a785f5231a4cf2" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1b63859dc6f94760" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d622557e1ee74372" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="false"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="cc5ba6cc895f4fec" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d579bb6fd1f1483a" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="c7bf51c1114b4074" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3e19d972" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="635" y="372">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vocalization Structure (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="d579bb6fd1f1483a" destField="tableMap" source="cc5ba6cc895f4fec" sourceField="tableMap"/>
                                                        <link dest="d579bb6fd1f1483a" destField="table" source="d622557e1ee74372" sourceField="table"/>
                                                        <link dest="c7bf51c1114b4074" destField="table" source="d579bb6fd1f1483a" sourceField="freqTable"/>
                                                        <link dest="d622557e1ee74372" destField="table" source="b1a785f5231a4cf2" sourceField="obj"/>
                                                        <link dest="cc5ba6cc895f4fec" destField="table" source="b1a785f5231a4cf2" sourceField="obj"/>
                                                        <link dest="3e19d972" destField="table" source="c7bf51c1114b4074" sourceField="table"/>
                                                        <link dest="3e19d972" destField="parent" source="1b63859dc6f94760" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="b1a785f5231a4cf2"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="1b63859dc6f94760"/>
                                                    <extensions>
                                                        <oga:meta x="564" y="167"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="eec3ffcea7204cf7" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	// add % vocalizations with CV or CVC
	var countCV = 0;
	var countCC = 0;
	var total = 0;
	for(var row = 0; row < inventory.rowCount; row++) {
		var pattern = inventory.getValueAt(row, 0);
		var c = inventory.getValueAt(row, 1);

		if(pattern.toString().contains("CV")) {
			countCV += c.intValue();
		}

		if(pattern.toString().contains("CC")) {
			countCC += c.intValue();
		}
		
		total += c.intValue();
	}
	var freqCV = (countCV / total) * 100.0; 
	var freqCC = (countCC / total) * 100.0;
	
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations that include a CV sequence";
	rowData[colIdx++] = new java.lang.Float(freqCV);
	table.addRow(rowData);

	rowData = [];
	colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations that include at least one CC sequence";
	rowData[colIdx++] = new java.lang.Float(freqCC);
	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="875" y="321"/>
                                                    </extensions>
                                                </node>
                                                <link dest="eec3ffcea7204cf7" destField="inventory" source="d6dcaea1e62046f7" sourceField="table"/>
                                                <link dest="eec3ffcea7204cf7" destField="table" source="85ac255934fb4b3d" sourceField="obj"/>
                                                <link dest="48ecf0a222045b2" destField="table" source="db2fcf7cec6341e0" sourceField="obj"/>
                                                <link dest="d6dcaea1e62046f7" destField="table" source="48ecf0a222045b2" sourceField="table"/>
                                                <link dest="458fd744de5a4a6a" destField="table" source="48ecf0a222045b2" sourceField="table"/>
                                                <link dest="d6dcaea1e62046f7" destField="reportNode" source="bb7663ffd8004214" sourceField="obj"/>
                                                <link dest="458fd744de5a4a6a" destField="reportNode" source="bb7663ffd8004214" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="db2fcf7cec6341e0"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="85ac255934fb4b3d"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="bb7663ffd8004214"/>
                                            <extensions>
                                                <oga:meta x="515" y="342"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="6a6f4dc4" name="Harmony" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="e79b1f6">
                                                <node id="f95439174b664eb4" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="25"/>
                                                    </extensions>
                                                </node>
                                                <node id="7b4f4c414fc04ad1" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="186"/>
                                                    </extensions>
                                                </node>
                                                <node id="d1727c8ca00147d7" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="327"/>
                                                    </extensions>
                                                </node>
                                                <node id="6e9b396c" name="Add Harmony to Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                                    <input name="inputTable" optional="false"/>
                                                    <input name="summaryTable" optional="false"/>
                                                    <output name="cHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <output name="vHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <output name="cvcHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[
function init(inputs, outputs) {
	inputs.add("inputTable", "", false, false);
	inputs.add("summaryTable", "", false, false);
	
	outputs.add("cHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
	outputs.add("vHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
	outputs.add("cvcHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function copyTableSchema(table, destTable) {
	for(var col = 0; col < table.columnCount; col++) {
		destTable.setColumnTitle(col, table.getColumnTitle(col));
	}
}

function run(context) {
	var inputTable = context.get("inputTable");
	var summaryTable = context.get("summaryTable");

	var cHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, cHarmonyTable);
	
	var vHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, vHarmonyTable);
	
	var cvcHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, cvcHarmonyTable);

	context.put("cHarmonyTable", cHarmonyTable);
	context.put("vHarmonyTable", vHarmonyTable);
	context.put("cvcHarmonyTable", cvcHarmonyTable);
	
	var num2PlusSylls = 0;
	var num2PlusSyllsWithCHarmony = 0;
	var num2PlusSyllsWithVHarmony = 0;
	var numCVC = 0;
	var numCVCWithHarmony = 0;

	var colIdx = inputTable.getColumnIndex("Actual Syllabification (Word)");
	
	var harmonyDetector = new Packages.ca.phon.query.detectors.FlatHarmonyDetector();
	for(var row = 0; row < inputTable.rowCount; row++) {
		var rowData = inputTable.getRow(row);

		try {
			var ipa = IPATranscript.parseIPATranscript(
				inputTable.getValueAt(row, colIdx));
			
			if(ipa.syllables().size() >= 2) {
				++num2PlusSylls;
				var harmonies = harmonyDetector.detectConsonantHarmony(ipa);
		
				if(harmonies.size() > 0) {
					++num2PlusSyllsWithCHarmony;
					cHarmonyTable.addRow(rowData);
				}
	
				harmonies = harmonyDetector.detectVowelHarmony(ipa);
				if(harmonies.size() > 0) {
					++num2PlusSyllsWithVHarmony;
					vHarmonyTable.addRow(rowData);
				}
			}
	
			if(ipa.matchesCVPattern("CVC")) {
				++numCVC;
				var harmonies = harmonyDetector.detectConsonantHarmony(ipa);
				
				if(harmonies.size() > 0) {
					++numCVCWithHarmony;
					cvcHarmonyTable.addRow(rowData);
				}
			}
		} catch (e) {
			// ignore errors in transcriptions
		}
	}

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of vocalizations with at least two syllables";
	rowData[colIdx++] = new java.lang.Integer(num2PlusSylls);
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations with at least two syllables and some consonant harmony";
	rowData[colIdx++] = (num2PlusSylls > 0 ? new java.lang.Float((num2PlusSyllsWithCHarmony/num2PlusSylls) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);
	
	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations with at least two syllables and some vowel harmony";
	rowData[colIdx++] = (num2PlusSylls > 0 ? new java.lang.Float((num2PlusSyllsWithVHarmony/num2PlusSylls) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of CVC vocalizations";
	rowData[colIdx++] = new java.lang.Integer(numCVC);
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of CVC vocalizations with consonant harmony";
	rowData[colIdx++] = (numCVC > 0 ? new java.lang.Float((numCVCWithHarmony/numCVC) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="321" y="119"/>
                                                    </extensions>
                                                </node>
                                                <node id="243ed068" name="Consonant Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="711" y="79">
                                                            <oga:default for="sectionName" type="java.lang.String">Multi-syllabic Consonant Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="778830f76def4cab" name="Vowel Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="710" y="236">
                                                            <oga:default for="sectionName" type="java.lang.String">Multi-syllabic Vowel Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="b6918b0053c749f4" name="CVC Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="708" y="391">
                                                            <oga:default for="sectionName" type="java.lang.String">CVC Consonant Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <link dest="6e9b396c" destField="inputTable" source="f95439174b664eb4" sourceField="obj"/>
                                                <link dest="6e9b396c" destField="summaryTable" source="7b4f4c414fc04ad1" sourceField="obj"/>
                                                <link dest="243ed068" destField="parent" source="d1727c8ca00147d7" sourceField="obj"/>
                                                <link dest="243ed068" destField="table" source="6e9b396c" sourceField="cHarmonyTable"/>
                                                <link dest="778830f76def4cab" destField="table" source="6e9b396c" sourceField="vHarmonyTable"/>
                                                <link dest="778830f76def4cab" destField="parent" source="d1727c8ca00147d7" sourceField="obj"/>
                                                <link dest="b6918b0053c749f4" destField="parent" source="d1727c8ca00147d7" sourceField="obj"/>
                                                <link dest="b6918b0053c749f4" destField="table" source="6e9b396c" sourceField="cvcHarmonyTable"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="f95439174b664eb4"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="7b4f4c414fc04ad1"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="d1727c8ca00147d7"/>
                                            <extensions>
                                                <oga:meta x="755" y="342"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="c3a5d71d15704c6f" name="Mean Babble Level" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="474b4805">
                                                <node id="f2b0e896f7884dea" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="17" y="25"/>
                                                    </extensions>
                                                </node>
                                                <node id="748fd15f9a984590" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="17" y="186"/>
                                                    </extensions>
                                                </node>
                                                <node id="9ecbaafe9f794505" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="contextKey"/>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="24" y="334"/>
                                                    </extensions>
                                                </node>
                                                <node id="117b1f6cbc42428c" name="Add Mean Babble Level" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

var placeFeatures = [
	"{labial, -dental}",
	"{labial, dental}",
	"{dental}",
	"{alveolar}",
	"{alveopalatal}",
	"{lateral}",
	"{retroflex}",
	"{palatal}",
	"{velar}",
	"{uvular}",
	"{pharyngeal}",
	"{laryngeal}"
];

var mannerFeatures = [
	"{stop, -nasal}",
	"{fricative}",
	"{affricate}",
	"{nasal}",
	"{liquid, lateral}",
	"{rhotic}",
	"{glide}",
	"{vowel}"
];

function init(inputs, outputs) {
}

function getFeatures(featureArray, ele) {
	var retVal = "\u2205";

	for(var i = 0; i < featureArray.length; i++) {
		var features = featureArray[i];
		var transcript = (new IPATranscriptBuilder()).append(ele).toIPATranscript();
		if(transcript.matches(features)) {
			retVal = features;
			break;
		}
	}

	return retVal;
}

// return a set of consonant types {place+manner}
function getConsonantTypes(ipa) {
	var retVal = new java.util.HashSet();
	var phonex = "[^\\v{glide}{glottal}]";
	var phones = ipa.removePunctuation();

	var phonexPattern = Packages.ca.phon.phonex.PhonexPattern.compile(phonex);
	var matcher = phonexPattern.matcher(phones);

	while(matcher.find()) {
		var match = (new IPATranscriptBuilder()).append(matcher.group()).toIPATranscript();

		if(match.length() > 0) {
			var ele = match.elementAt(0);

			var pf = getFeatures(placeFeatures, ele);
			var mf = getFeatures(mannerFeatures, ele);

			var type = pf + " + " + mf;
			retVal.add(type);
		}
	}

	return retVal;
}

function getMeanBabbleLevel(ipa) {
	var consonantTypes = getConsonantTypes(ipa);

	if(consonantTypes.size() == 0) {
		return 1;
	} else if(consonantTypes.size() == 1) {
		return 2;
	} else {
		return 3;
	}
}

function tableOp(context, table) {
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "Mean Babble Level");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var actualSyllabification = table.getValueAt(row, "Actual Syllabification (Word)");
		var ipa = (new IPATranscriptBuilder()).append(actualSyllabification).toIPATranscript();

		tableData[colIdx] = getMeanBabbleLevel(ipa);
	}
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="275" y="25"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="e59f22e93c0416a" name="Mean Babble Level (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="32870ef2">
                                                        <node id="536cd64980e047a7" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="fc42b8e7ba8247b0" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="17" y="327"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9c4f740ed27b4b8d" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Mean Babble Level" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f3b305518e5b4ac6" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="2ab4cd6392f7428b" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Mean Babble Level" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="4096f423" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="589" y="302">
                                                                    <oga:default for="sectionName" type="java.lang.String">Mean Babble Level</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="2ab4cd6392f7428b" destField="table" source="f3b305518e5b4ac6" sourceField="table"/>
                                                        <link dest="f3b305518e5b4ac6" destField="table" source="9c4f740ed27b4b8d" sourceField="table"/>
                                                        <link dest="f3b305518e5b4ac6" destField="total" source="536cd64980e047a7" sourceField="rowCount"/>
                                                        <link dest="9c4f740ed27b4b8d" destField="table" source="536cd64980e047a7" sourceField="obj"/>
                                                        <link dest="4096f423" destField="table" source="2ab4cd6392f7428b" sourceField="table"/>
                                                        <link dest="4096f423" destField="parent" source="fc42b8e7ba8247b0" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="536cd64980e047a7"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="fc42b8e7ba8247b0"/>
                                                    <ogcn:published_output field="table" name="table" ref="9c4f740ed27b4b8d"/>
                                                    <extensions>
                                                        <oga:meta x="540" y="25"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="455c63934e7b460c" name="Mean Babble Level (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="7167da61">
                                                        <node id="c5954c4c2e8242f3" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a5797fec9e54a41" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="contextKey"/>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="25" y="335"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="26d8074f11a4469e" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Mean Babble Level" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="8bf24634c804fef" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ec5c9a7ddce147ce" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="adb22cd51e934885" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Mean Babble Level" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1a7286ca" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="644" y="324">
                                                                    <oga:default for="sectionName" type="java.lang.String">Mean Babble Level (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="ec5c9a7ddce147ce" destField="tableMap" source="8bf24634c804fef" sourceField="tableMap"/>
                                                        <link dest="ec5c9a7ddce147ce" destField="table" source="26d8074f11a4469e" sourceField="table"/>
                                                        <link dest="adb22cd51e934885" destField="table" source="ec5c9a7ddce147ce" sourceField="freqTable"/>
                                                        <link dest="26d8074f11a4469e" destField="table" source="c5954c4c2e8242f3" sourceField="obj"/>
                                                        <link dest="8bf24634c804fef" destField="table" source="c5954c4c2e8242f3" sourceField="obj"/>
                                                        <link dest="1a7286ca" destField="table" source="adb22cd51e934885" sourceField="table"/>
                                                        <link dest="1a7286ca" destField="parent" source="a5797fec9e54a41" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="c5954c4c2e8242f3"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="a5797fec9e54a41"/>
                                                    <extensions>
                                                        <oga:meta x="540" y="166"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="b12705f4c9c84206" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
	inputs.add("numVocs", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");
	var numVocs = context.get("numVocs");

	var total = 0.0;
	for(var row = 0; row < inventory.rowCount; row++) {
		var mbl = inventory.getValueAt(row, 0);
		var cnt = inventory.getValueAt(row, 1);

		total += (mbl.floatValue() * cnt.intValue());
	}
	var meanBabbleLevel = total / numVocs;
	
	var rowData = [];
	var colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "mean babble level";
	rowData[colIdx++] = new java.lang.Float(meanBabbleLevel);
	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="836" y="300"/>
                                                    </extensions>
                                                </node>
                                                <link dest="117b1f6cbc42428c" destField="table" source="f2b0e896f7884dea" sourceField="obj"/>
                                                <link dest="e59f22e93c0416a" destField="table" source="117b1f6cbc42428c" sourceField="table"/>
                                                <link dest="455c63934e7b460c" destField="table" source="117b1f6cbc42428c" sourceField="table"/>
                                                <link dest="b12705f4c9c84206" destField="table" source="748fd15f9a984590" sourceField="obj"/>
                                                <link dest="b12705f4c9c84206" destField="inventory" source="e59f22e93c0416a" sourceField="table"/>
                                                <link dest="b12705f4c9c84206" destField="numVocs" source="f2b0e896f7884dea" sourceField="rowCount"/>
                                                <link dest="e59f22e93c0416a" destField="reportNode" source="9ecbaafe9f794505" sourceField="obj"/>
                                                <link dest="455c63934e7b460c" destField="reportNode" source="9ecbaafe9f794505" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="f2b0e896f7884dea"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="748fd15f9a984590"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="9ecbaafe9f794505"/>
                                            <extensions>
                                                <oga:meta x="275" y="512"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="71606628" destField="tableMap" source="7cbf1d09" sourceField="obj"/>
                                        <link dest="39f91ef7" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="35376622" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="5c298b00" destField="data" source="578fcaef" sourceField="obj"/>
                                        <link dest="9bee85a827324705" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="9dee81f2bd624468" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="c3a5d71d15704c6f" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="71606628" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="39f91ef7" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="9bee85a827324705" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="9dee81f2bd624468" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="fbb7c1ceae774d2a" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="fbb7c1ceae774d2a" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="35376622" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="c3a5d71d15704c6f" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="6a6f4dc4" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="6a6f4dc4" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="5c298b00" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="71606628" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="39f91ef7" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="9bee85a827324705" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="9dee81f2bd624468" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="35376622" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="fbb7c1ceae774d2a" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="6a6f4dc4" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="c3a5d71d15704c6f" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <extensions>
                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                        </extensions>
                                    </graph>
                                    <ogcn:published_input field="obj" name="speaker" ref="45508fae"/>
                                    <ogcn:published_input field="obj" name="table" ref="578fcaef"/>
                                    <ogcn:published_input field="obj" name="tableMap" ref="7cbf1d09"/>
                                    <ogcn:published_input field="obj" name="result total" ref="c81dda4"/>
                                    <ogcn:published_input field="obj" name="summaryTable" ref="fe996f4347094d31"/>
                                    <ogcn:published_input field="obj" name="reportNode" ref="ae45a3e8c6864a08"/>
                                    <extensions>
                                        <oga:meta x="601" y="65"/>
                                    </extensions>
                                </ogcn:macro>
                                <link dest="7f149b7d" destField="table" source="60a76f15" sourceField="obj"/>
                                <link dest="5aee518f" destField="tableMap" source="7f149b7d" sourceField="tableMap"/>
                                <link dest="5aee518f" destField="table" source="60a76f15" sourceField="obj"/>
                                <link dest="5aee518f" destField="speaker" source="68d90fd6bd914ea2" sourceField="obj"/>
                                <link dest="5aee518f" destField="result total" source="60a76f15" sourceField="rowCount"/>
                                <link dest="5aee518f" destField="summaryTable" source="95cfaf8923b44bb7" sourceField="obj"/>
                                <link dest="540f0fe8" destField="parent" source="69ab305476bc42d9" sourceField="obj"/>
                                <link dest="5aee518f" destField="reportNode" source="540f0fe8" sourceField="section"/>
                                <extensions>
                                    <oga:notes>
                                        <oga:note color="0xffff96" height="879" title="Inputs" width="323" x="9" y="19"/>
                                    </oga:notes>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="tableMap" ref="60a76f15"/>
                            <ogcn:published_input field="obj" name="speaker" ref="68d90fd6bd914ea2"/>
                            <ogcn:published_input field="obj" name="summaryTable" ref="95cfaf8923b44bb7"/>
                            <ogcn:published_input field="obj" name="reportNode" ref="69ab305476bc42d9"/>
                            <extensions>
                                <oga:meta x="630" y="168"/>
                            </extensions>
                        </ogcn:macro>
                        <link dest="350c5a14" destField="speaker" source="28737cd4" sourceField="obj"/>
                        <link dest="bfbf3172e44b4532" destField="table" source="3303e4cd" sourceField="obj"/>
                        <link dest="bbf482c5a66541f7" destField="tableMap" source="bfbf3172e44b4532" sourceField="tableMap"/>
                        <link dest="bbf482c5a66541f7" destField="speaker" source="28737cd4" sourceField="obj"/>
                        <link dest="350c5a14" destField="tableMap" source="bbf482c5a66541f7" sourceField="table"/>
                        <link dest="350c5a14" destField="enabled" source="bbf482c5a66541f7" sourceField="exists"/>
                        <link dest="350c5a14" destField="summaryTable" source="b559e3f830b34106" sourceField="obj"/>
                        <link dest="350c5a14" destField="reportNode" source="a8b85ca0e5b34a92" sourceField="obj"/>
                        <extensions>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="speaker" ref="28737cd4"/>
                    <ogcn:published_input field="obj" name="table" ref="3303e4cd"/>
                    <ogcn:published_input field="obj" name="summaryTable" ref="b559e3f830b34106"/>
                    <ogcn:published_input field="obj" name="reportNode" ref="a8b85ca0e5b34a92"/>
                    <ogcn:published_output field="obj" name="summaryTable" ref="b559e3f830b34106"/>
                    <extensions>
                        <oga:meta x="722" y="92"/>
                    </extensions>
                </ogcn:macro>
                <ogcn:macro id="24cc3792514a4884" name="Words" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="6d798d2d">
                        <node id="4e085fac89c7453a" name="speaker" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.session.Participant]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="35"/>
                            </extensions>
                        </node>
                        <node id="acf837a7c9a541af" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="356"/>
                            </extensions>
                        </node>
                        <node id="72d4552d61554733" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="517"/>
                            </extensions>
                        </node>
                        <node id="e8a366cafd4348d2" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="658"/>
                            </extensions>
                        </node>
                        <node id="79fd2a67f6a54478" name="Split Table by Speaker" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script">
                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                    </oga:property>
                                    <oga:property key="columnName">
                                        <![CDATA[Speaker]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="242" y="477"/>
                            </extensions>
                        </node>
                        <ogcn:macro id="9768fadf4b4446c3" name="Get Table of Results For Speaker" type="ca.phon.opgraph.nodes.general.MacroNode">
                            <graph id="1352ae4d">
                                <node id="dc31b8940c7541a6" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                                <![CDATA[toString()]]>
                                            </oga:property>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                <![CDATA[java.lang.Object]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="105" y="70"/>
                                    </extensions>
                                </node>
                                <node id="4d94381662c14335" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                                <![CDATA[get(java.lang.Object)]]>
                                            </oga:property>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                <![CDATA[java.util.Map]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="296" y="73"/>
                                    </extensions>
                                </node>
                                <node id="7796f8cd5ca4438e" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                    <output name="exists" type="java.lang.Boolean">does table exist</output>
                                    <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource">table if exists, undefined otherwise</output>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="__script">
                                                <![CDATA[
// setup input/output fields
function init(inputFields, outputFields) {
	inputFields.add("table", "");
	outputFields.add("exists", "does table exist", false, java.lang.Boolean);
	outputFields.add("table", "table if exists, undefined otherwise", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableExists =
		(context.containsKey("table") && context.get("table") != null);
	context.put("exists", tableExists);
	context.put("table", context.get("table"));
}
]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="514" y="94"/>
                                    </extensions>
                                </node>
                                <link dest="4d94381662c14335" destField="arg1" source="dc31b8940c7541a6" sourceField="value"/>
                                <link dest="7796f8cd5ca4438e" destField="table" source="4d94381662c14335" sourceField="value"/>
                                <extensions>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="speaker" ref="dc31b8940c7541a6"/>
                            <ogcn:published_input field="obj" name="tableMap" ref="4d94381662c14335"/>
                            <ogcn:published_output field="exists" name="exists" ref="7796f8cd5ca4438e"/>
                            <ogcn:published_output field="table" name="table" ref="7796f8cd5ca4438e"/>
                            <extensions>
                                <oga:meta x="345" y="166"/>
                            </extensions>
                        </ogcn:macro>
                        <ogcn:macro id="593dec6caa8346f6" name="If Speaker Has Results" type="ca.phon.opgraph.nodes.general.MacroNode">
                            <graph id="5c7b4d11">
                                <node id="92abe2e79a634318" name="Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="55"/>
                                    </extensions>
                                </node>
                                <node id="b8f87a4d2d5048fd" name="Participant" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.session.Participant]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="216"/>
                                    </extensions>
                                </node>
                                <node id="ee49724860294988" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="537"/>
                                    </extensions>
                                </node>
                                <node id="7a1b5b4439a74cd8" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="678"/>
                                    </extensions>
                                </node>
                                <node id="b03406a9987d4d00" name="Split Table by Session" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                    <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                    <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="__script">
                                                <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                            </oga:property>
                                            <oga:property key="columnName">
                                                <![CDATA[Session]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="350" y="67"/>
                                    </extensions>
                                </node>
                                <node id="2b9f8b15b9434857" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                                    <extensions>
                                        <oga:meta x="357" y="684">
                                            <oga:default for="sectionName" type="java.lang.String">Words</oga:default>
                                        </oga:meta>
                                    </extensions>
                                </node>
                                <ogcn:macro id="cacf5ec6c58847ac" name="Word Analysis" type="ca.phon.opgraph.nodes.general.MacroNode">
                                    <graph id="3e43fcd3">
                                        <node id="74e2b17062d64f38" name="result total" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[java.lang.Integer]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="15"/>
                                            </extensions>
                                        </node>
                                        <node id="ff01aa71a43f44a1" name="speaker" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.session.Participant]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="116"/>
                                            </extensions>
                                        </node>
                                        <node id="786d6aee41d24c4f" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="437"/>
                                            </extensions>
                                        </node>
                                        <node id="5b8a7f72e41c446b" name="tableMap" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[java.util.Map]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="598"/>
                                            </extensions>
                                        </node>
                                        <node id="5fdc21d9dbad42cd" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="699"/>
                                            </extensions>
                                        </node>
                                        <node id="772efcae035945ea" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="14" y="834"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="46690717afaf4e9f" name="All Words" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="234e33fe">
                                                <node id="e3bb630871d84342" name="tableMap" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[java.util.Map]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="40" y="77"/>
                                                    </extensions>
                                                </node>
                                                <node id="5db4242120894647" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="40" y="178"/>
                                                    </extensions>
                                                </node>
                                                <node id="c6308e16e8604194" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="37" y="319"/>
                                                    </extensions>
                                                </node>
                                                <node id="ee882023e85c466a" name="Create Totals Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                                    <input name="tableMap" optional="false"/>
                                                    <output name="totalsTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("totalsTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableMap = context.get("tableMap");
	var totalsTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	totalsTable.setColumnTitle(0, "Session");
	totalsTable.setColumnTitle(1, "Count");

	var keySet = tableMap.keySet();
	var itr = keySet.iterator();
	var total = 0;
	while(itr.hasNext()) {
		var session = itr.next();
		var count = tableMap.get(session).rowCount;
		total += count;

		var rowData = [];
		rowData[0] = session;
		rowData[1] = new java.lang.Integer(count);

		totalsTable.addRow(rowData);
	}

	var rowData = [ "Total", new java.lang.Integer(total) ];
	totalsTable.addRow(rowData);

	context.put("totalsTable", totalsTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="386" y="324"/>
                                                    </extensions>
                                                </node>
                                                <node id="ad5c3e6540ed4cbe" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="620" y="134">
                                                            <oga:default for="sectionName" type="java.lang.String">Total</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="43be2c80b21c4c31" name="Add #Voc/Session" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("totalsTable", "");
}

function tableOp(context, table) {
	var totalsTable = context.get("totalsTable");

	var totalVocalizations = totalsTable.getValueAt(totalsTable.rowCount-1, totalsTable.columnCount-1);
	var numSessions = totalsTable.rowCount-1;

	var freq = new java.lang.Float(totalVocalizations/numSessions);
	
	var colIdx = 0;
	var rowData = [];
	rowData[colIdx++] = "Vocalizations";
	rowData[colIdx++] = "# of vocalizations / session";
	rowData[colIdx++] = freq;

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="623" y="324"/>
                                                    </extensions>
                                                </node>
                                                <link dest="ee882023e85c466a" destField="tableMap" source="e3bb630871d84342" sourceField="obj"/>
                                                <link dest="43be2c80b21c4c31" destField="table" source="5db4242120894647" sourceField="obj"/>
                                                <link dest="43be2c80b21c4c31" destField="totalsTable" source="ee882023e85c466a" sourceField="totalsTable"/>
                                                <link dest="ad5c3e6540ed4cbe" destField="parent" source="c6308e16e8604194" sourceField="obj"/>
                                                <link dest="ad5c3e6540ed4cbe" destField="table" source="ee882023e85c466a" sourceField="totalsTable"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                    <oga:notes>
                                                        <oga:note color="0xffff96" height="506" title="Published Inputs" width="308" x="20" y="40"/>
                                                    </oga:notes>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="tableMap" ref="e3bb630871d84342"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="5db4242120894647"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="c6308e16e8604194"/>
                                            <extensions>
                                                <oga:meta x="275" y="12"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="6d0b70b66147448c" name="Listing" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="38014f7">
                                                <node id="83e989443f124168" name="data" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="85b396469a45439b" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="176"/>
                                                    </extensions>
                                                </node>
                                                <node id="6304bda422374662" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="344" y="103">
                                                            <oga:default for="sectionName" type="java.lang.String">Listing</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <link dest="6304bda422374662" destField="table" source="83e989443f124168" sourceField="obj"/>
                                                <link dest="6304bda422374662" destField="parent" source="85b396469a45439b" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="data" ref="83e989443f124168"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="85b396469a45439b"/>
                                            <extensions>
                                                <oga:meta x="515" y="12"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="1a51d08c97d04f95" name="Initial Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="6079554f">
                                                <node id="f7703fd843db40bb" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="28"/>
                                                    </extensions>
                                                </node>
                                                <node id="d14ba832fda14d19" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="189"/>
                                                    </extensions>
                                                </node>
                                                <node id="a60717bc00694dac" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="330"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="7dc769ed6d1c4ba2" name="Initial Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="178740a0">
                                                        <node id="4a15df3ba4bd4cd7" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="28fb131b5f874875" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="19" y="647"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="b074656dfceb4f8c" name="Add Initial Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Initial C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var initialC = "";
		if(ipa.matches("^\\c.*")) {
			initialC = (new IPATranscriptBuilder()).append(ipa.elementAt(0)).toIPATranscript();
		}

		rowData[colIdx] = initialC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f0fc5ae18d2d4d81" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Initial C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="503" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="481d9070f16444e" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="738" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="7b96880c1efb40d8" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Initial C" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="965" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="86a749a3df354d1f" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="246" y="494"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="115b486f2a9f452a" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Initial C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="481" y="494"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="785165f487e4466e" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="762" y="520">
                                                                    <oga:default for="sectionName" type="java.lang.String">Initial Consonants</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="f0fc5ae18d2d4d81" destField="table" source="b074656dfceb4f8c" sourceField="table"/>
                                                        <link dest="b074656dfceb4f8c" destField="table" source="4a15df3ba4bd4cd7" sourceField="obj"/>
                                                        <link dest="86a749a3df354d1f" destField="table" source="7b96880c1efb40d8" sourceField="table"/>
                                                        <link dest="115b486f2a9f452a" destField="table" source="86a749a3df354d1f" sourceField="table"/>
                                                        <link dest="481d9070f16444e" destField="obj" source="f0fc5ae18d2d4d81" sourceField="trueTable"/>
                                                        <link dest="7b96880c1efb40d8" destField="table" source="481d9070f16444e" sourceField="obj"/>
                                                        <link dest="86a749a3df354d1f" destField="total" source="481d9070f16444e" sourceField="rowCount"/>
                                                        <link dest="785165f487e4466e" destField="parent" source="28fb131b5f874875" sourceField="obj"/>
                                                        <link dest="785165f487e4466e" destField="table" source="115b486f2a9f452a" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="4a15df3ba4bd4cd7"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="28fb131b5f874875"/>
                                                    <ogcn:published_output field="table" name="table" ref="7b96880c1efb40d8"/>
                                                    <extensions>
                                                        <oga:meta x="300" y="27"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="ed9646fcad804af6" name="Initial Consonants (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="7fa6f16d">
                                                        <node id="a2e77ff4d7734145" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9d54a4cb844b4143" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="16" y="530"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="33c92832b4604960" name="Add Initial Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Initial C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var initialC = "";
		if(ipa.matches("^\\c.*")) {
			initialC = (new IPATranscriptBuilder()).append(ipa.elementAt(0)).toIPATranscript();
		}

		rowData[colIdx] = initialC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="62d8a560437a4a9e" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Initial C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="503" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="62cccb262aa94c47" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Initial C" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="738" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3bde3a56b4a84130" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	//inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	//var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	// calculate column totals
	var columnTotals = [];
	for(var col = 1; col < table.columnCount; col++) {
		var sessionName = table.getColumnTitle(col);
		var total = 0;
		for(var row = 0; row < table.rowCount; row++) {
			total += table.getValueAt(row, col).intValue();
		}

		columnTotals[sessionName] = total;
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = columnTotals[table.getColumnTitle(col)];
			
			
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="913" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="bf3eb447c4fd4a5f" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Initial C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1148" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d623c0ecb8f74a15" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="932" y="527">
                                                                    <oga:default for="sectionName" type="java.lang.String">Initial Consonants (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="62d8a560437a4a9e" destField="table" source="33c92832b4604960" sourceField="table"/>
                                                        <link dest="33c92832b4604960" destField="table" source="a2e77ff4d7734145" sourceField="obj"/>
                                                        <link dest="62cccb262aa94c47" destField="table" source="62d8a560437a4a9e" sourceField="trueTable"/>
                                                        <link dest="3bde3a56b4a84130" destField="table" source="62cccb262aa94c47" sourceField="table"/>
                                                        <link dest="bf3eb447c4fd4a5f" destField="table" source="3bde3a56b4a84130" sourceField="freqTable"/>
                                                        <link dest="d623c0ecb8f74a15" destField="table" source="bf3eb447c4fd4a5f" sourceField="table"/>
                                                        <link dest="d623c0ecb8f74a15" destField="parent" source="9d54a4cb844b4143" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="a2e77ff4d7734145"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="9d54a4cb844b4143"/>
                                                    <extensions>
                                                        <oga:meta x="296" y="208"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="b493c6bc3c3f43b5" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique initial consonants";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="673" y="104"/>
                                                    </extensions>
                                                </node>
                                                <link dest="7dc769ed6d1c4ba2" destField="table" source="f7703fd843db40bb" sourceField="obj"/>
                                                <link dest="ed9646fcad804af6" destField="table" source="f7703fd843db40bb" sourceField="obj"/>
                                                <link dest="b493c6bc3c3f43b5" destField="table" source="d14ba832fda14d19" sourceField="obj"/>
                                                <link dest="b493c6bc3c3f43b5" destField="inventory" source="7dc769ed6d1c4ba2" sourceField="table"/>
                                                <link dest="ed9646fcad804af6" destField="reportNode" source="a60717bc00694dac" sourceField="obj"/>
                                                <link dest="7dc769ed6d1c4ba2" destField="reportNode" source="a60717bc00694dac" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="f7703fd843db40bb"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="d14ba832fda14d19"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="a60717bc00694dac"/>
                                            <extensions>
                                                <oga:meta x="275" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="49c0119c46154297" name="Final Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="1fd6ded4">
                                                <node id="c4624169f1474b85" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="35" y="41"/>
                                                    </extensions>
                                                </node>
                                                <node id="1c0852a41564cd9" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="35" y="202"/>
                                                    </extensions>
                                                </node>
                                                <node id="d91c6abe9c91426d" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="41" y="347"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="73fd60c2eefb4cab" name="Final Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="5eadce1f">
                                                        <node id="db95d3bda89e4bc5" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="68d50bf1bac490e" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="31" y="615"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e9134d8f68124b81" name="Add Final Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Final C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var finalC = "";
		if(ipa.matches(".*\\c$")) {
			finalC = (new IPATranscriptBuilder()).append(ipa.elementAt(ipa.length()-1)).toIPATranscript();
		}

		rowData[colIdx] = finalC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="c609e1ea44354047" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.allowOverlap">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.exactMatch">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.caseSensitive">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Final C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="497" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="66cd4fda727f47a1" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Final C" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="719" y="313"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="47ebc3620ca64e36" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="709" y="485"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d169406f2b8b4d6c" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="907" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="534702c1a5c4015" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Final C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1138" y="373"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ed20b9d0ef904d7b" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="703" y="667">
                                                                    <oga:default for="sectionName" type="java.lang.String">Final Consonants</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="e9134d8f68124b81" destField="table" source="db95d3bda89e4bc5" sourceField="obj"/>
                                                        <link dest="d169406f2b8b4d6c" destField="table" source="66cd4fda727f47a1" sourceField="table"/>
                                                        <link dest="534702c1a5c4015" destField="table" source="d169406f2b8b4d6c" sourceField="table"/>
                                                        <link dest="c609e1ea44354047" destField="table" source="e9134d8f68124b81" sourceField="table"/>
                                                        <link dest="66cd4fda727f47a1" destField="table" source="c609e1ea44354047" sourceField="trueTable"/>
                                                        <link dest="47ebc3620ca64e36" destField="obj" source="c609e1ea44354047" sourceField="trueTable"/>
                                                        <link dest="d169406f2b8b4d6c" destField="total" source="47ebc3620ca64e36" sourceField="rowCount"/>
                                                        <link dest="ed20b9d0ef904d7b" destField="table" source="534702c1a5c4015" sourceField="table"/>
                                                        <link dest="ed20b9d0ef904d7b" destField="parent" source="68d50bf1bac490e" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="db95d3bda89e4bc5"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="68d50bf1bac490e"/>
                                                    <ogcn:published_output field="table" name="table" ref="66cd4fda727f47a1"/>
                                                    <extensions>
                                                        <oga:meta x="425" y="38"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="d873ed0e32314d70" name="Final Consonants (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="4fa61c37">
                                                        <node id="3f76c499994c49ef" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ce94c20a32864651" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="25" y="226"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f140402998742ef" name="Add Final Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Final C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var finalC = "";
		if(ipa.matches(".*\\c$")) {
			finalC = (new IPATranscriptBuilder()).append(ipa.elementAt(ipa.length()-1)).toIPATranscript();
		}

		rowData[colIdx] = finalC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="57bfb07368d44022" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.allowOverlap">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.exactMatch">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.caseSensitive">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Final C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="500" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="b3163c5ee7864877" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Final C" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="737" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a4aba5b5e4cd4b5f" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
//	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
//	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	// calculate column totals
	var columnTotals = [];
	for(var col = 1; col < table.columnCount; col++) {
		var sessionName = table.getColumnTitle(col);
		var total = 0;
		for(var row = 0; row < table.rowCount; row++) {
			total += table.getValueAt(row, col).intValue();
		}

		columnTotals[sessionName] = total;
	}
	
	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = columnTotals[table.getColumnTitle(col)];
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="934" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="84705c6b5c6847b6" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Final C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1171" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="58d700f8456b4a58" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="519" y="267">
                                                                    <oga:default for="sectionName" type="java.lang.String">Final Consonants (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="f140402998742ef" destField="table" source="3f76c499994c49ef" sourceField="obj"/>
                                                        <link dest="a4aba5b5e4cd4b5f" destField="table" source="b3163c5ee7864877" sourceField="table"/>
                                                        <link dest="84705c6b5c6847b6" destField="table" source="a4aba5b5e4cd4b5f" sourceField="freqTable"/>
                                                        <link dest="57bfb07368d44022" destField="table" source="f140402998742ef" sourceField="table"/>
                                                        <link dest="b3163c5ee7864877" destField="table" source="57bfb07368d44022" sourceField="trueTable"/>
                                                        <link dest="58d700f8456b4a58" destField="table" source="84705c6b5c6847b6" sourceField="table"/>
                                                        <link dest="58d700f8456b4a58" destField="parent" source="ce94c20a32864651" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="3f76c499994c49ef"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="ce94c20a32864651"/>
                                                    <extensions>
                                                        <oga:meta x="425" y="208"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="638c16f1244c4693" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique final consonants";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="761" y="386"/>
                                                    </extensions>
                                                </node>
                                                <link dest="73fd60c2eefb4cab" destField="table" source="c4624169f1474b85" sourceField="obj"/>
                                                <link dest="d873ed0e32314d70" destField="table" source="c4624169f1474b85" sourceField="obj"/>
                                                <link dest="638c16f1244c4693" destField="inventory" source="73fd60c2eefb4cab" sourceField="table"/>
                                                <link dest="638c16f1244c4693" destField="table" source="1c0852a41564cd9" sourceField="obj"/>
                                                <link dest="73fd60c2eefb4cab" destField="reportNode" source="d91c6abe9c91426d" sourceField="obj"/>
                                                <link dest="d873ed0e32314d70" destField="reportNode" source="d91c6abe9c91426d" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="c4624169f1474b85"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="1c0852a41564cd9"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="d91c6abe9c91426d"/>
                                            <extensions>
                                                <oga:meta x="515" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="e2a3c25df593452e" name="Vowels" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="6c072495">
                                                <node id="5b4e0b6988e745ce" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="8f4344c409e441f6" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="176"/>
                                                    </extensions>
                                                </node>
                                                <node id="79ae6acbc3d94343" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="30" y="401"/>
                                                    </extensions>
                                                </node>
                                                <node id="d4753f70ad6b4068" name="Create Vowel Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="vowelTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	outputs.add("vowelTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var vowelTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	vowelTable.setColumnTitle(0, "Session");
	vowelTable.setColumnTitle(1, "Record");
	vowelTable.setColumnTitle(2, "Vowel");
	vowelTable.setColumnTitle(3, "Actual Syllabification (Word)");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var actualSyllabification = table.getValueAt(row, "Actual Syllabification (Word)");
		var ipa = (new IPATranscriptBuilder()).append(actualSyllabification).toIPATranscript();
		var sylls = ipa.syllables();

		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var syll = sylls.get(syllIdx);
			var phonexPattern = Packages.ca.phon.phonex.PhonexPattern.compile(".:N+");
			var matcher = phonexPattern.matcher(syll);
			if(matcher.find()) {
				var nucleus = (new IPATranscriptBuilder()).append(matcher.group()).toIPATranscript();

				var rowData = [];
				rowData[0] = table.getValueAt(row, 0);
				rowData[1] = table.getValueAt(row, "Record #");
				rowData[2] = nucleus;
				rowData[3] = actualSyllabification;
				vowelTable.addRow(rowData);
			}
		}
	}

	context.put("vowelTable", vowelTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="302" y="41"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="7fcf9d33d8634359" name="Vowels (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="7d30f968">
                                                        <node id="abfe239869ad485b" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9cc8dd3ada8947e7" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="24" y="366"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="cd334eb9744a47e0" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Vowel" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="b6bc6fe5546e40eb" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="72f63f0651574414" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="6b86dd6499204869" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Vowel" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="94f1f5e14ee143fd" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="716" y="344">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vowel Inventory</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="6b86dd6499204869" destField="table" source="72f63f0651574414" sourceField="table"/>
                                                        <link dest="72f63f0651574414" destField="total" source="b6bc6fe5546e40eb" sourceField="rowCount"/>
                                                        <link dest="b6bc6fe5546e40eb" destField="obj" source="abfe239869ad485b" sourceField="obj"/>
                                                        <link dest="72f63f0651574414" destField="table" source="cd334eb9744a47e0" sourceField="table"/>
                                                        <link dest="cd334eb9744a47e0" destField="table" source="abfe239869ad485b" sourceField="obj"/>
                                                        <link dest="94f1f5e14ee143fd" destField="parent" source="9cc8dd3ada8947e7" sourceField="obj"/>
                                                        <link dest="94f1f5e14ee143fd" destField="table" source="6b86dd6499204869" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="abfe239869ad485b"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="9cc8dd3ada8947e7"/>
                                                    <ogcn:published_output field="table" name="table" ref="cd334eb9744a47e0"/>
                                                    <extensions>
                                                        <oga:meta x="559" y="27"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="39f38ce9e91248cd" name="Vowels (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="4f117c70">
                                                        <node id="aa752e8fcc94dae" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d91b99f6cbdf4390" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="646e63665da04c2e" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Vowel" ignoreDiacritics="true"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="38b4bd1d9f0f4e63" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="176"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="6252fe7b3ffe400f" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="441" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="8d2b182ac0f04e3c" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Vowel" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="678" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="26128b83b4474f43" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="828" y="299">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vowel Inventory (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="646e63665da04c2e" destField="table" source="aa752e8fcc94dae" sourceField="obj"/>
                                                        <link dest="38b4bd1d9f0f4e63" destField="table" source="aa752e8fcc94dae" sourceField="obj"/>
                                                        <link dest="6252fe7b3ffe400f" destField="tableMap" source="38b4bd1d9f0f4e63" sourceField="tableMap"/>
                                                        <link dest="6252fe7b3ffe400f" destField="table" source="646e63665da04c2e" sourceField="table"/>
                                                        <link dest="8d2b182ac0f04e3c" destField="table" source="6252fe7b3ffe400f" sourceField="freqTable"/>
                                                        <link dest="26128b83b4474f43" destField="table" source="8d2b182ac0f04e3c" sourceField="table"/>
                                                        <link dest="26128b83b4474f43" destField="parent" source="d91b99f6cbdf4390" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="aa752e8fcc94dae"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="d91b99f6cbdf4390"/>
                                                    <extensions>
                                                        <oga:meta x="557" y="175"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="9293492f3fdf4ab1" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique vowels";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="788" y="323"/>
                                                    </extensions>
                                                </node>
                                                <link dest="d4753f70ad6b4068" destField="table" source="5b4e0b6988e745ce" sourceField="obj"/>
                                                <link dest="39f38ce9e91248cd" destField="table" source="d4753f70ad6b4068" sourceField="vowelTable"/>
                                                <link dest="7fcf9d33d8634359" destField="table" source="d4753f70ad6b4068" sourceField="vowelTable"/>
                                                <link dest="9293492f3fdf4ab1" destField="inventory" source="7fcf9d33d8634359" sourceField="table"/>
                                                <link dest="9293492f3fdf4ab1" destField="table" source="79ae6acbc3d94343" sourceField="obj"/>
                                                <link dest="7fcf9d33d8634359" destField="reportNode" source="8f4344c409e441f6" sourceField="obj"/>
                                                <link dest="39f38ce9e91248cd" destField="reportNode" source="8f4344c409e441f6" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="5b4e0b6988e745ce"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="79ae6acbc3d94343"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="8f4344c409e441f6"/>
                                            <extensions>
                                                <oga:meta x="755" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="a015a01ac9194b94" name="Syllable Structure" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="18fb578a">
                                                <node id="858a90b668084cad" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="eeed419e828c46af" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="23" y="195"/>
                                                    </extensions>
                                                </node>
                                                <node id="af59121a90d4539" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="24" y="336"/>
                                                    </extensions>
                                                </node>
                                                <node id="58ed5a5c4fc74f9f" name="Create Syllable Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="syllTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	outputs.add("syllTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}


var symbolMap = "H={glottal}; G=\\g; C=\\c; V=\\v";

function tableOp(context, table) {
	var syllTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	syllTable.setColumnTitle(0, "Session");
	syllTable.setColumnTitle(1, "Record");
	syllTable.setColumnTitle(2, "Syllable");
	syllTable.setColumnTitle(3, "Structure");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "Actual Syllabification (Word)")).toIPATranscript();
		var sylls = ipa.syllables();


		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var syll = sylls.get(syllIdx);

			var rowData = [];
			rowData[0] = table.getValueAt(row, 0);
			rowData[1] = table.getValueAt(row, "Record #");
			rowData[2] = syll;
			rowData[3] = syll.cover(symbolMap);
			syllTable.addRow(rowData);
		}
	}

	context.put("syllTable", syllTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="275" y="21"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="c8dc84af382b4bd9" name="Syllable Strucutre (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="376850e6">
                                                        <node id="57e2603f06c54c64" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="89998625027a46c9" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a3b6b65634ff456f" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="false"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="241" y="24"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="98555f1780b14d16" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="151"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="aafa0cdea33a42b6" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e440d495b45a4ede" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3ca82455b2d04cef" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="762" y="308">
                                                                    <oga:default for="sectionName" type="java.lang.String">Syllable Structure</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="e440d495b45a4ede" destField="table" source="aafa0cdea33a42b6" sourceField="table"/>
                                                        <link dest="aafa0cdea33a42b6" destField="total" source="98555f1780b14d16" sourceField="rowCount"/>
                                                        <link dest="98555f1780b14d16" destField="obj" source="57e2603f06c54c64" sourceField="obj"/>
                                                        <link dest="aafa0cdea33a42b6" destField="table" source="a3b6b65634ff456f" sourceField="table"/>
                                                        <link dest="a3b6b65634ff456f" destField="table" source="57e2603f06c54c64" sourceField="obj"/>
                                                        <link dest="3ca82455b2d04cef" destField="parent" source="89998625027a46c9" sourceField="obj"/>
                                                        <link dest="3ca82455b2d04cef" destField="table" source="e440d495b45a4ede" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="57e2603f06c54c64"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="89998625027a46c9"/>
                                                    <ogcn:published_output field="table" name="table" ref="a3b6b65634ff456f"/>
                                                    <extensions>
                                                        <oga:meta x="557" y="29"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="d50774cf171451d" name="Syllable Strucutre (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="5c4ebeb">
                                                        <node id="3247efca60504d98" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="cba597b0ee7843b0" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a4bff33e612f415f" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="false"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e964c5cc8ff44cba" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="483281a563414044" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9b511c49ec3047be" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3cbf60c74e944802" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="688" y="322">
                                                                    <oga:default for="sectionName" type="java.lang.String">Syllable Structure (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="a4bff33e612f415f" destField="table" source="3247efca60504d98" sourceField="obj"/>
                                                        <link dest="e964c5cc8ff44cba" destField="table" source="3247efca60504d98" sourceField="obj"/>
                                                        <link dest="483281a563414044" destField="tableMap" source="e964c5cc8ff44cba" sourceField="tableMap"/>
                                                        <link dest="483281a563414044" destField="table" source="a4bff33e612f415f" sourceField="table"/>
                                                        <link dest="9b511c49ec3047be" destField="table" source="483281a563414044" sourceField="freqTable"/>
                                                        <link dest="3cbf60c74e944802" destField="table" source="9b511c49ec3047be" sourceField="table"/>
                                                        <link dest="3cbf60c74e944802" destField="parent" source="cba597b0ee7843b0" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="3247efca60504d98"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="cba597b0ee7843b0"/>
                                                    <extensions>
                                                        <oga:meta x="555" y="184"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="276d68115b1d4222" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
	inputs.add("numVocs", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");
	var numVocs = context.get("numVocs");



	// add % vocalizations with CV or CVC
	var countCV = 0;
	var countFinalC = 0;
	var total = 0;
	for(var row = 0; row < inventory.rowCount; row++) {
		var pattern = inventory.getValueAt(row, 0);
		var c = inventory.getValueAt(row, 1);

		if(pattern.toString().contains("CV")) {
			countCV += c.intValue();
		}

		if(pattern.toString().endsWith("C")) {
			countFinalC += c.intValue();
		}
		
		total += c.intValue();
	}
	var freqCV = (countCV / total) * 100.0; 
	var freqFinalC = (countFinalC / total) * 100.0;

	var syllsPerVoc = total / numVocs;

	var rowData = [];
	var colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of syllables / vocalization";
	rowData[colIdx++] = new java.lang.Float(syllsPerVoc);
	table.addRow(rowData);
	
	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of syllables that include a CV sequence";
	rowData[colIdx++] = new java.lang.Float(freqCV);
	table.addRow(rowData);

	rowData = [];
	colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of syllables that end with a C";
	rowData[colIdx++] = new java.lang.Float(freqFinalC);
	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="900" y="332"/>
                                                    </extensions>
                                                </node>
                                                <link dest="58ed5a5c4fc74f9f" destField="table" source="858a90b668084cad" sourceField="obj"/>
                                                <link dest="c8dc84af382b4bd9" destField="table" source="58ed5a5c4fc74f9f" sourceField="syllTable"/>
                                                <link dest="d50774cf171451d" destField="table" source="58ed5a5c4fc74f9f" sourceField="syllTable"/>
                                                <link dest="276d68115b1d4222" destField="inventory" source="c8dc84af382b4bd9" sourceField="table"/>
                                                <link dest="276d68115b1d4222" destField="table" source="eeed419e828c46af" sourceField="obj"/>
                                                <link dest="276d68115b1d4222" destField="numVocs" source="858a90b668084cad" sourceField="rowCount"/>
                                                <link dest="c8dc84af382b4bd9" destField="reportNode" source="af59121a90d4539" sourceField="obj"/>
                                                <link dest="d50774cf171451d" destField="reportNode" source="af59121a90d4539" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="858a90b668084cad"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="eeed419e828c46af"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="af59121a90d4539"/>
                                            <extensions>
                                                <oga:meta x="275" y="340"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="cf67f05cace0498d" name="Vocalization Structure" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="75327490">
                                                <node id="f5c5281c660f43d9" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="36"/>
                                                    </extensions>
                                                </node>
                                                <node id="85e35bd2f6734176" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="177"/>
                                                    </extensions>
                                                </node>
                                                <node id="9aec4d7dd2c24a28" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="318"/>
                                                    </extensions>
                                                </node>
                                                <node id="857f370e43b64a9b" name="Add IPA Cover Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
}

var symbolMap = "H={glottal}; G=\\g; C=\\c; V=\\v";

function tableOp(context, table) {
	var structureColIdx = table.columnCount;
	table.setColumnTitle(structureColIdx, "Structure");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var ipa = table.getValueAt(row, "IPA Actual (Word)");

		var builder = new IPATranscriptBuilder();
		builder.append(table.getValueAt(row, "Actual Syllabification (Word)"));
		var sylls = builder.toIPATranscript().syllables();

		builder = new IPATranscriptBuilder();
		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var coveredIPA = sylls.get(syllIdx).cover(symbolMap);
			if(builder.size() > 0 && !coveredIPA.matches("^\\s.*")) {
				builder.appendSyllableBoundary();
			}
			builder.append(coveredIPA);
		}
		tableData[structureColIdx] = builder.toIPATranscript();
	}
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="281" y="115"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="6982b3849efd409f" name="Structures (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="3e8cc3ef">
                                                        <node id="6a0d6428723c4218" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="84d85bf3fa345e8" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="31" y="212"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="25522e45cd6e4d92" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="false"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="29d6aed06aee4d49" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="441" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e2cf58afc6b3415c" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="678" y="30"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="235b9bd6339449ed" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="690" y="225">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vocalization Structure</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="e2cf58afc6b3415c" destField="table" source="29d6aed06aee4d49" sourceField="table"/>
                                                        <link dest="29d6aed06aee4d49" destField="table" source="25522e45cd6e4d92" sourceField="table"/>
                                                        <link dest="29d6aed06aee4d49" destField="total" source="6a0d6428723c4218" sourceField="rowCount"/>
                                                        <link dest="25522e45cd6e4d92" destField="table" source="6a0d6428723c4218" sourceField="obj"/>
                                                        <link dest="235b9bd6339449ed" destField="table" source="e2cf58afc6b3415c" sourceField="table"/>
                                                        <link dest="235b9bd6339449ed" destField="parent" source="84d85bf3fa345e8" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="6a0d6428723c4218"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="84d85bf3fa345e8"/>
                                                    <ogcn:published_output field="table" name="table" ref="25522e45cd6e4d92"/>
                                                    <extensions>
                                                        <oga:meta x="564" y="26"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="ce185f6296d54db3" name="Structures (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="5fdb4190">
                                                        <node id="87423f25180246ca" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="c669ae56f1544ea3" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ee6806b20cbc4984" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" ignoreDiacritics="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session" ignoreDiacritics="true"/>
                                                                    <opqry:column caseSensitive="false" column="Structure" ignoreDiacritics="false"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3975d0835bf4727" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="b5a895c5cae49ab" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a71b45f5ea7e4981" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1bb69ebaf47a4a90" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="635" y="372">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vocalization Structure (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="b5a895c5cae49ab" destField="tableMap" source="3975d0835bf4727" sourceField="tableMap"/>
                                                        <link dest="b5a895c5cae49ab" destField="table" source="ee6806b20cbc4984" sourceField="table"/>
                                                        <link dest="a71b45f5ea7e4981" destField="table" source="b5a895c5cae49ab" sourceField="freqTable"/>
                                                        <link dest="ee6806b20cbc4984" destField="table" source="87423f25180246ca" sourceField="obj"/>
                                                        <link dest="3975d0835bf4727" destField="table" source="87423f25180246ca" sourceField="obj"/>
                                                        <link dest="1bb69ebaf47a4a90" destField="table" source="a71b45f5ea7e4981" sourceField="table"/>
                                                        <link dest="1bb69ebaf47a4a90" destField="parent" source="c669ae56f1544ea3" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="87423f25180246ca"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="c669ae56f1544ea3"/>
                                                    <extensions>
                                                        <oga:meta x="564" y="167"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="984759119f104aa8" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	// add % vocalizations with CV or CVC
	var countCV = 0;
	var countCC = 0;
	var total = 0;
	for(var row = 0; row < inventory.rowCount; row++) {
		var pattern = inventory.getValueAt(row, 0);
		var c = inventory.getValueAt(row, 1);

		if(pattern.toString().contains("CV")) {
			countCV += c.intValue();
		}

		if(pattern.toString().contains("CC")) {
			countCC += c.intValue();
		}
		
		total += c.intValue();
	}
	var freqCV = (countCV / total) * 100.0; 
	var freqCC = (countCC / total) * 100.0;
	
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations that include a CV sequence";
	rowData[colIdx++] = new java.lang.Float(freqCV);
	table.addRow(rowData);

	rowData = [];
	colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations that include at least one CC sequence";
	rowData[colIdx++] = new java.lang.Float(freqCC);
	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="875" y="321"/>
                                                    </extensions>
                                                </node>
                                                <link dest="984759119f104aa8" destField="inventory" source="6982b3849efd409f" sourceField="table"/>
                                                <link dest="984759119f104aa8" destField="table" source="85e35bd2f6734176" sourceField="obj"/>
                                                <link dest="857f370e43b64a9b" destField="table" source="f5c5281c660f43d9" sourceField="obj"/>
                                                <link dest="6982b3849efd409f" destField="table" source="857f370e43b64a9b" sourceField="table"/>
                                                <link dest="ce185f6296d54db3" destField="table" source="857f370e43b64a9b" sourceField="table"/>
                                                <link dest="6982b3849efd409f" destField="reportNode" source="9aec4d7dd2c24a28" sourceField="obj"/>
                                                <link dest="ce185f6296d54db3" destField="reportNode" source="9aec4d7dd2c24a28" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="f5c5281c660f43d9"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="85e35bd2f6734176"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="9aec4d7dd2c24a28"/>
                                            <extensions>
                                                <oga:meta x="515" y="342"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="846f1879c6214e9d" name="Harmony" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="74a7838">
                                                <node id="36e7958581ea4f29" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="25"/>
                                                    </extensions>
                                                </node>
                                                <node id="455849e2b56f431e" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="186"/>
                                                    </extensions>
                                                </node>
                                                <node id="60a04844a03b4c47" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="327"/>
                                                    </extensions>
                                                </node>
                                                <node id="f9be762af4474aae" name="Add Harmony to Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                                    <input name="inputTable" optional="false"/>
                                                    <input name="summaryTable" optional="false"/>
                                                    <output name="cHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <output name="vHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <output name="cvcHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[
function init(inputs, outputs) {
	inputs.add("inputTable", "", false, false);
	inputs.add("summaryTable", "", false, false);
	
	outputs.add("cHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
	outputs.add("vHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
	outputs.add("cvcHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function copyTableSchema(table, destTable) {
	for(var col = 0; col < table.columnCount; col++) {
		destTable.setColumnTitle(col, table.getColumnTitle(col));
	}
}

function run(context) {
	var inputTable = context.get("inputTable");
	var summaryTable = context.get("summaryTable");

	var cHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, cHarmonyTable);
	
	var vHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, vHarmonyTable);
	
	var cvcHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, cvcHarmonyTable);

	context.put("cHarmonyTable", cHarmonyTable);
	context.put("vHarmonyTable", vHarmonyTable);
	context.put("cvcHarmonyTable", cvcHarmonyTable);
	
	var num2PlusSylls = 0;
	var num2PlusSyllsWithCHarmony = 0;
	var num2PlusSyllsWithVHarmony = 0;
	var numCVC = 0;
	var numCVCWithHarmony = 0;

	var colIdx = inputTable.getColumnIndex("Actual Syllabification (Word)");
	
	var harmonyDetector = new Packages.ca.phon.query.detectors.FlatHarmonyDetector();
	for(var row = 0; row < inputTable.rowCount; row++) {
		var rowData = inputTable.getRow(row);

		try {
			var ipa = IPATranscript.parseIPATranscript(
				inputTable.getValueAt(row, colIdx));
			
			if(ipa.syllables().size() >= 2) {
				++num2PlusSylls;
				var harmonies = harmonyDetector.detectConsonantHarmony(ipa);
		
				if(harmonies.size() > 0) {
					++num2PlusSyllsWithCHarmony;
					cHarmonyTable.addRow(rowData);
				}
	
				harmonies = harmonyDetector.detectVowelHarmony(ipa);
				if(harmonies.size() > 0) {
					++num2PlusSyllsWithVHarmony;
					vHarmonyTable.addRow(rowData);
				}
			}
	
			if(ipa.matchesCVPattern("CVC")) {
				++numCVC;
				var harmonies = harmonyDetector.detectConsonantHarmony(ipa);
				
				if(harmonies.size() > 0) {
					++numCVCWithHarmony;
					cvcHarmonyTable.addRow(rowData);
				}
			}
		} catch (e) {
			// ignore errors in transcriptions
		}
	}

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of vocalizations with at least two syllables";
	rowData[colIdx++] = new java.lang.Integer(num2PlusSylls);
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations with at least two syllables and some consonant harmony";
	rowData[colIdx++] = (num2PlusSylls > 0 ? new java.lang.Float((num2PlusSyllsWithCHarmony/num2PlusSylls) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);
	
	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations with at least two syllables and some vowel harmony";
	rowData[colIdx++] = (num2PlusSylls > 0 ? new java.lang.Float((num2PlusSyllsWithVHarmony/num2PlusSylls) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of CVC vocalizations";
	rowData[colIdx++] = new java.lang.Integer(numCVC);
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of CVC vocalizations with consonant harmony";
	rowData[colIdx++] = (numCVC > 0 ? new java.lang.Float((numCVCWithHarmony/numCVC) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="321" y="119"/>
                                                    </extensions>
                                                </node>
                                                <node id="aee27ee21473442e" name="Consonant Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="711" y="79">
                                                            <oga:default for="sectionName" type="java.lang.String">Multi-syllabic Consonant Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="aea34ce903ce4dbd" name="Vowel Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="710" y="236">
                                                            <oga:default for="sectionName" type="java.lang.String">Multi-syllabic Vowel Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="a87c5f50b3ef4594" name="CVC Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="708" y="391">
                                                            <oga:default for="sectionName" type="java.lang.String">CVC Consonant Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <link dest="f9be762af4474aae" destField="inputTable" source="36e7958581ea4f29" sourceField="obj"/>
                                                <link dest="f9be762af4474aae" destField="summaryTable" source="455849e2b56f431e" sourceField="obj"/>
                                                <link dest="aee27ee21473442e" destField="parent" source="60a04844a03b4c47" sourceField="obj"/>
                                                <link dest="aee27ee21473442e" destField="table" source="f9be762af4474aae" sourceField="cHarmonyTable"/>
                                                <link dest="aea34ce903ce4dbd" destField="table" source="f9be762af4474aae" sourceField="vHarmonyTable"/>
                                                <link dest="aea34ce903ce4dbd" destField="parent" source="60a04844a03b4c47" sourceField="obj"/>
                                                <link dest="a87c5f50b3ef4594" destField="parent" source="60a04844a03b4c47" sourceField="obj"/>
                                                <link dest="a87c5f50b3ef4594" destField="table" source="f9be762af4474aae" sourceField="cvcHarmonyTable"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="36e7958581ea4f29"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="455849e2b56f431e"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="60a04844a03b4c47"/>
                                            <extensions>
                                                <oga:meta x="755" y="342"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="46690717afaf4e9f" destField="tableMap" source="5b8a7f72e41c446b" sourceField="obj"/>
                                        <link dest="1a51d08c97d04f95" destField="table" source="786d6aee41d24c4f" sourceField="obj"/>
                                        <link dest="a015a01ac9194b94" destField="table" source="786d6aee41d24c4f" sourceField="obj"/>
                                        <link dest="6d0b70b66147448c" destField="data" source="786d6aee41d24c4f" sourceField="obj"/>
                                        <link dest="49c0119c46154297" destField="table" source="786d6aee41d24c4f" sourceField="obj"/>
                                        <link dest="e2a3c25df593452e" destField="table" source="786d6aee41d24c4f" sourceField="obj"/>
                                        <link dest="46690717afaf4e9f" destField="summaryTable" source="5fdc21d9dbad42cd" sourceField="obj"/>
                                        <link dest="1a51d08c97d04f95" destField="summaryTable" source="5fdc21d9dbad42cd" sourceField="obj"/>
                                        <link dest="49c0119c46154297" destField="summaryTable" source="5fdc21d9dbad42cd" sourceField="obj"/>
                                        <link dest="e2a3c25df593452e" destField="summaryTable" source="5fdc21d9dbad42cd" sourceField="obj"/>
                                        <link dest="cf67f05cace0498d" destField="table" source="786d6aee41d24c4f" sourceField="obj"/>
                                        <link dest="cf67f05cace0498d" destField="summaryTable" source="5fdc21d9dbad42cd" sourceField="obj"/>
                                        <link dest="a015a01ac9194b94" destField="summaryTable" source="5fdc21d9dbad42cd" sourceField="obj"/>
                                        <link dest="846f1879c6214e9d" destField="summaryTable" source="5fdc21d9dbad42cd" sourceField="obj"/>
                                        <link dest="846f1879c6214e9d" destField="table" source="786d6aee41d24c4f" sourceField="obj"/>
                                        <link dest="6d0b70b66147448c" destField="reportNode" source="772efcae035945ea" sourceField="obj"/>
                                        <link dest="46690717afaf4e9f" destField="reportNode" source="772efcae035945ea" sourceField="obj"/>
                                        <link dest="1a51d08c97d04f95" destField="reportNode" source="772efcae035945ea" sourceField="obj"/>
                                        <link dest="49c0119c46154297" destField="reportNode" source="772efcae035945ea" sourceField="obj"/>
                                        <link dest="e2a3c25df593452e" destField="reportNode" source="772efcae035945ea" sourceField="obj"/>
                                        <link dest="a015a01ac9194b94" destField="reportNode" source="772efcae035945ea" sourceField="obj"/>
                                        <link dest="cf67f05cace0498d" destField="reportNode" source="772efcae035945ea" sourceField="obj"/>
                                        <link dest="846f1879c6214e9d" destField="reportNode" source="772efcae035945ea" sourceField="obj"/>
                                        <extensions>
                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                        </extensions>
                                    </graph>
                                    <ogcn:published_input field="obj" name="speaker" ref="ff01aa71a43f44a1"/>
                                    <ogcn:published_input field="obj" name="table" ref="786d6aee41d24c4f"/>
                                    <ogcn:published_input field="obj" name="tableMap" ref="5b8a7f72e41c446b"/>
                                    <ogcn:published_input field="obj" name="result total" ref="74e2b17062d64f38"/>
                                    <ogcn:published_input field="obj" name="summaryTable" ref="5fdc21d9dbad42cd"/>
                                    <ogcn:published_input field="obj" name="reportNode" ref="772efcae035945ea"/>
                                    <extensions>
                                        <oga:meta x="601" y="65"/>
                                    </extensions>
                                </ogcn:macro>
                                <link dest="b03406a9987d4d00" destField="table" source="92abe2e79a634318" sourceField="obj"/>
                                <link dest="cacf5ec6c58847ac" destField="tableMap" source="b03406a9987d4d00" sourceField="tableMap"/>
                                <link dest="cacf5ec6c58847ac" destField="table" source="92abe2e79a634318" sourceField="obj"/>
                                <link dest="cacf5ec6c58847ac" destField="speaker" source="b8f87a4d2d5048fd" sourceField="obj"/>
                                <link dest="cacf5ec6c58847ac" destField="result total" source="92abe2e79a634318" sourceField="rowCount"/>
                                <link dest="cacf5ec6c58847ac" destField="summaryTable" source="ee49724860294988" sourceField="obj"/>
                                <link dest="2b9f8b15b9434857" destField="parent" source="7a1b5b4439a74cd8" sourceField="obj"/>
                                <link dest="cacf5ec6c58847ac" destField="reportNode" source="2b9f8b15b9434857" sourceField="section"/>
                                <extensions>
                                    <oga:notes>
                                        <oga:note color="0xffff96" height="879" title="Inputs" width="323" x="9" y="19"/>
                                    </oga:notes>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="tableMap" ref="92abe2e79a634318"/>
                            <ogcn:published_input field="obj" name="speaker" ref="b8f87a4d2d5048fd"/>
                            <ogcn:published_input field="obj" name="summaryTable" ref="ee49724860294988"/>
                            <ogcn:published_input field="obj" name="reportNode" ref="7a1b5b4439a74cd8"/>
                            <extensions>
                                <oga:meta x="630" y="168"/>
                            </extensions>
                        </ogcn:macro>
                        <link dest="593dec6caa8346f6" destField="speaker" source="4e085fac89c7453a" sourceField="obj"/>
                        <link dest="79fd2a67f6a54478" destField="table" source="acf837a7c9a541af" sourceField="obj"/>
                        <link dest="9768fadf4b4446c3" destField="tableMap" source="79fd2a67f6a54478" sourceField="tableMap"/>
                        <link dest="9768fadf4b4446c3" destField="speaker" source="4e085fac89c7453a" sourceField="obj"/>
                        <link dest="593dec6caa8346f6" destField="tableMap" source="9768fadf4b4446c3" sourceField="table"/>
                        <link dest="593dec6caa8346f6" destField="enabled" source="9768fadf4b4446c3" sourceField="exists"/>
                        <link dest="593dec6caa8346f6" destField="summaryTable" source="72d4552d61554733" sourceField="obj"/>
                        <link dest="593dec6caa8346f6" destField="reportNode" source="e8a366cafd4348d2" sourceField="obj"/>
                        <extensions>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="speaker" ref="4e085fac89c7453a"/>
                    <ogcn:published_input field="obj" name="table" ref="acf837a7c9a541af"/>
                    <ogcn:published_input field="obj" name="summaryTable" ref="72d4552d61554733"/>
                    <ogcn:published_input field="obj" name="reportNode" ref="e8a366cafd4348d2"/>
                    <ogcn:published_output field="obj" name="summaryTable" ref="72d4552d61554733"/>
                    <extensions>
                        <oga:meta x="722" y="265"/>
                    </extensions>
                </ogcn:macro>
                <node id="5c8dd523" name="Add Summary Table" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                        </oga:settings>
                        <oga:meta x="1018" y="265"/>
                    </extensions>
                </node>
                <link dest="5fc29abaa09040c1" destField="obj" source="282a70f9" sourceField="obj"/>
                <link dest="e60ae088c39c4be1" destField="table" source="cbab76efb3454ab5" sourceField="obj"/>
                <link dest="607a331e" destField="speaker" source="5fc29abaa09040c1" sourceField="obj"/>
                <link dest="607a331e" destField="table" source="e60ae088c39c4be1" sourceField="trueTable"/>
                <link dest="607a331e" destField="summaryTable" source="55aaa72dc82b4f91" sourceField="table"/>
                <link dest="fb1827b" destField="obj" source="5fc29abaa09040c1" sourceField="obj"/>
                <link dest="5c8dd523" destField="sectionName" source="fb1827b" sourceField="value"/>
                <link dest="5c8dd523" destField="parent" source="c2a4bb4702264bae" sourceField="obj"/>
                <link dest="7efa92f7" destField="sectionName" source="fb1827b" sourceField="value"/>
                <link dest="7efa92f7" destField="parent" source="deb9a5f4203e48c1" sourceField="obj"/>
                <link dest="607a331e" destField="reportNode" source="7efa92f7" sourceField="section"/>
                <link dest="24cc3792514a4884" destField="summaryTable" source="607a331e" sourceField="summaryTable"/>
                <link dest="5c8dd523" destField="table" source="24cc3792514a4884" sourceField="summaryTable"/>
                <link dest="24cc3792514a4884" destField="speaker" source="5fc29abaa09040c1" sourceField="obj"/>
                <link dest="24cc3792514a4884" destField="table" source="e60ae088c39c4be1" sourceField="falseTable"/>
                <link dest="24cc3792514a4884" destField="reportNode" source="7efa92f7" sourceField="section"/>
                <extensions>
                    <oga:notes>
                        <oga:note color="0xffff96" height="660" title="Inputs" width="296" x="22" y="139"/>
                    </oga:notes>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <ogcn:published_input field="obj" name="resultTable" ref="cbab76efb3454ab5"/>
            <ogcn:published_input field="obj" name="summaryNode" ref="c2a4bb4702264bae"/>
            <ogcn:published_input field="obj" name="rootNode" ref="deb9a5f4203e48c1"/>
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.IterableClassNode.className">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="786" y="16"/>
            </extensions>
        </ogcn:macro>
        <link dest="29ac654b" destField="project" source="55f4fba4" sourceField="obj"/>
        <link dest="29ac654b" destField="sessions" source="1ae2322c" sourceField="obj"/>
        <link dest="61e6ae5ee8ed4084" destField="project" source="29ac654b" sourceField="project"/>
        <link dest="61208600" destField="collection" source="3da0e5db" sourceField="obj"/>
        <link dest="61e6ae5ee8ed4084" destField="results" source="29ac654b" sourceField="results"/>
        <link dest="61208600" destField="resultTable" source="61e6ae5ee8ed4084" sourceField="table"/>
        <link dest="2f5a76e38b4b4c38" destField="parameters" source="dc596f57c3774064" sourceField="parameters"/>
        <link dest="e041a49" destField="reportName" source="2f5a76e38b4b4c38" sourceField="reportTitle"/>
        <link dest="763b6571" destField="parent" source="e041a49" sourceField="root"/>
        <link dest="61208600" destField="summaryNode" source="763b6571" sourceField="section"/>
        <link dest="61208600" destField="rootNode" source="e041a49" sourceField="root"/>
        <extensions>
            <opqry:nodewizard type="ca.phon.app.opgraph.analysis.AnalysisWizardExtension">
                <opqry:info format="html" title="Vocalization">
                    <opqry:message/>
                </opqry:info>
                <opqry:report-template name="Report Prefix"/>
                <opqry:report-template name="Report Suffix"/>
            </opqry:nodewizard>
            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
        </extensions>
    </graph>
</opgraph>
