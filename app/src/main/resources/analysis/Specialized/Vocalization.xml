<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<opgraph xmlns="https://www.phon.ca/ns/opgraph" xmlns:nes="https://www.phon.ca/ns/node_editor" xmlns:oga="https://www.phon.ca/ns/opgraph-app" xmlns:ogcn="https://www.phon.ca/ns/opgraph-common-nodes" xmlns:opqry="https://phon.ca/ns/opgraph_query" xmlns:qry="http://phon.ling.mun.ca/ns/query">
    <graph id="root">
        <node id="55f4fba4" name="Project" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_project]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[ca.phon.project.Project]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="15" y="15"/>
            </extensions>
        </node>
        <node id="1ae2322c" name="Selected Sessions" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_selectedSessions]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="15" y="296"/>
            </extensions>
        </node>
        <node id="3da0e5db" name="Selected Participants" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
            <extensions>
                <oga:settings>
                    <oga:property key="contextKey">
                        <![CDATA[_selectedParticipants]]>
                    </oga:property>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="15" y="397"/>
            </extensions>
        </node>
        <node id="dc596f57c3774064" name="Parameters" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
            <extensions>
                <oga:settings>
                    <oga:property key="reportTitle">
                        <![CDATA[Vocalization Analysis]]>
                    </oga:property>
                    <oga:property key="__script">
                        <![CDATA[var reportTitleParamInfo = {
	"id": "reportTitle",
	"title": "Report Title",
	"def": "Report",
	"prompt": "Enter report title"
};
var reportTitleParam;
var reportTitle = reportTitleParamInfo.def;

function setup_params(params) {
	reportTitleParam = new StringScriptParam(
			reportTitleParamInfo.id,
			reportTitleParamInfo.title,
			reportTitleParamInfo.def);
     reportTitleParam.setPrompt(reportTitleParamInfo.prompt);
	params.add(reportTitleParam);
}
]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="15" y="498"/>
            </extensions>
        </node>
        <opqry:queryNode id="29ac654b" name="Query : Data Tiers" type="ca.phon.app.opgraph.nodes.query.QueryNode">
            <qry:query xmlns="http://phon.ling.mun.ca/ns/query" date="2020-08-19T12:33:57.071-02:30" name="Data Tiers" uuid="833ae60a-c8d3-4908-83fa-298fd4e71771">
                <script>
                    <url ref="Data Tiers" rel="stock"/>
                    <param id="filters.alignedWord.patternFilter.caseSensitive">false</param>
                    <param id="filters.alignedWord.patternFilter.exactMatch">true</param>
                    <param id="filters.alignedWord.patternFilter.filter">.+</param>
                    <param id="filters.alignedWord.patternFilter.filterType">Regular expression</param>
                    <param id="filters.alignedWord.tier">IPA Actual</param>
                    <param id="filters.primary.patternFilter.filter">.+</param>
                    <param id="filters.primary.patternFilter.filterType">Regular expression</param>
                    <param id="filters.primary.tier">Orthography</param>
                    <param id="filters.searchBy.searchBy">Word</param>
                    <param id="filters.word.searchByWord">true</param>
                    <param id="filters.word.sectionHeader.collapsed">false</param>
                    <param id="filters.wordTiers.tiers">Actual Syllabification</param>
                </script>
            </qry:query>
            <extensions>
                <oga:settings/>
                <oga:meta x="352" y="15"/>
            </extensions>
        </opqry:queryNode>
        <ogcn:macro id="2f5a76e38b4b4c38" name="Get Report Title" type="ca.phon.opgraph.nodes.general.MacroNode">
            <graph id="1aa30fd5">
                <node id="cdfe6b17a1ca4b4d" name="String#&lt;init&gt;(String)" type="class:ca.phon.opgraph.nodes.reflect.ConstructorNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.classMember">
                                <![CDATA[<init>(java.lang.String)]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.declaredClass">
                                <![CDATA[java.lang.String]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="15" y="15">
                            <oga:default for="arg1" type="java.lang.String">reportTitle</oga:default>
                        </oga:meta>
                    </extensions>
                </node>
                <node id="cad0a57030854326" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[get(java.lang.Object)]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.util.Map]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="218" y="16"/>
                    </extensions>
                </node>
                <node id="678c3d022771475d" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[toString()]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="392" y="15"/>
                    </extensions>
                </node>
                <link dest="cad0a57030854326" destField="arg1" source="cdfe6b17a1ca4b4d" sourceField="value"/>
                <link dest="678c3d022771475d" destField="obj" source="cad0a57030854326" sourceField="value"/>
            </graph>
            <ogcn:published_input field="obj" name="parameters" ref="cad0a57030854326"/>
            <ogcn:published_output field="value" name="reportTitle" ref="678c3d022771475d"/>
            <extensions>
                <oga:meta x="252" y="498"/>
            </extensions>
        </ogcn:macro>
        <node id="61e6ae5ee8ed4084" type="class:ca.phon.app.opgraph.nodes.table.ResultsToTableNode">
            <extensions>
                <oga:settings>
                    <oga:property key="includeSessionInfo">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeSpeakerInfo">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeMetadata">
                        <![CDATA[true]]>
                    </oga:property>
                    <oga:property key="includeTierInfo">
                        <![CDATA[true]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="589" y="15"/>
            </extensions>
        </node>
        <node id="e041a49" type="class:ca.phon.app.opgraph.nodes.report.NewReportNode">
            <extensions>
                <oga:settings/>
                <oga:meta x="485" y="498"/>
            </extensions>
        </node>
        <node id="763b6571" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
            <extensions>
                <oga:meta x="728" y="504">
                    <oga:default for="sectionName" type="java.lang.String">Summary</oga:default>
                </oga:meta>
            </extensions>
        </node>
        <ogcn:macro id="61208600" name="For Each Participant" type="ca.phon.opgraph.nodes.reflect.IterableClassNode">
            <graph id="40a39fc6">
                <node id="282a70f9" name="Current Object" type="class:ca.phon.opgraph.nodes.reflect.ContextualItemClassNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ContextualItemClassNode.key">
                                <![CDATA[currentValue]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="24" y="23"/>
                    </extensions>
                </node>
                <ogcn:macro id="55aaa72dc82b4f91" name="Create Summary Table" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="77de28f1">
                        <node id="2346342eeb134cfe" name="DefaultTableDataSource#&lt;init&gt;()" type="class:ca.phon.opgraph.nodes.reflect.ConstructorNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.classMember">
                                        <![CDATA[<init>()]]>
                                    </oga:property>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ConstructorNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="576" y="555"/>
                            </extensions>
                        </node>
                        <node id="60acbaa7700b42af" name="Setup Table Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script">
                                        <![CDATA[
function init(inputs, outputs) {
	
}

function tableOp(context, table) {
	var colIdx = 0;

	table.setColumnTitle(colIdx++, "Category");
	table.setColumnTitle(colIdx++, "Item");
	table.setColumnTitle(colIdx++, "Value");
}
]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="855" y="541"/>
                            </extensions>
                        </node>
                        <link dest="60acbaa7700b42af" destField="table" source="2346342eeb134cfe" sourceField="value"/>
                        <extensions>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_output field="table" name="table" ref="60acbaa7700b42af"/>
                    <extensions>
                        <oga:meta x="444" y="58"/>
                    </extensions>
                </ogcn:macro>
                <node id="cbab76efb3454ab5" name="Result Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="46" y="188"/>
                    </extensions>
                </node>
                <node id="c2a4bb4702264bae" name="Summary Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="39" y="323"/>
                    </extensions>
                </node>
                <node id="deb9a5f4203e48c1" name="Root Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="39" y="549"/>
                    </extensions>
                </node>
                <node id="5fc29abaa09040c1" name="To Participant Object" type="class:ca.phon.opgraph.nodes.reflect.ObjectCastNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectCastNode.declaredClass">
                                <![CDATA[ca.phon.session.Participant]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="221" y="23"/>
                    </extensions>
                </node>
                <node id="e60ae088c39c4be1" name="Partition Table (Vocalizations vs Words)" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                    <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                    <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                    <extensions>
                        <oga:settings>
                            <oga:property key="filters.column.filter">
                                <![CDATA[yyy]]>
                            </oga:property>
                            <oga:property key="filters.column.filterType">
                                <![CDATA[Plain text]]>
                            </oga:property>
                            <oga:property key="filters.column.exactMatch">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="__script">
                                <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                            </oga:property>
                            <oga:property key="filters.column.caseSensitive">
                                <![CDATA[false]]>
                            </oga:property>
                            <oga:property key="columnName">
                                <![CDATA[Orthography]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="336" y="154"/>
                    </extensions>
                </node>
                <node id="fb1827b" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                <![CDATA[toString()]]>
                            </oga:property>
                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                <![CDATA[java.lang.Object]]>
                            </oga:property>
                        </oga:settings>
                        <oga:meta x="342" y="407"/>
                    </extensions>
                </node>
                <node id="7efa92f7" name="Add Participant Section" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                    <extensions>
                        <oga:meta x="367" y="575"/>
                    </extensions>
                </node>
                <ogcn:macro id="607a331e" name="Vocalizations" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="c1bc1eb">
                        <node id="28737cd4" name="speaker" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.session.Participant]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="35"/>
                            </extensions>
                        </node>
                        <node id="3303e4cd" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="356"/>
                            </extensions>
                        </node>
                        <node id="b559e3f830b34106" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="517"/>
                            </extensions>
                        </node>
                        <node id="a8b85ca0e5b34a92" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="658"/>
                            </extensions>
                        </node>
                        <node id="bfbf3172e44b4532" name="Split Table by Speaker" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script">
                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                    </oga:property>
                                    <oga:property key="columnName">
                                        <![CDATA[Speaker]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="242" y="477"/>
                            </extensions>
                        </node>
                        <ogcn:macro id="bbf482c5a66541f7" name="Get Table of Results For Speaker" type="ca.phon.opgraph.nodes.general.MacroNode">
                            <graph id="254d8ba">
                                <node id="5642bea05e5c4b06" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                                <![CDATA[toString()]]>
                                            </oga:property>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                <![CDATA[java.lang.Object]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="105" y="70"/>
                                    </extensions>
                                </node>
                                <node id="57334ef9ad744f65" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                                <![CDATA[get(java.lang.Object)]]>
                                            </oga:property>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                <![CDATA[java.util.Map]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="296" y="73"/>
                                    </extensions>
                                </node>
                                <node id="4df6ff3399a848c7" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                    <input name="table" optional="false"/>
                                    <output name="exists" type="java.lang.Boolean">does table exist</output>
                                    <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource">table if exists, undefined otherwise</output>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="__script">
                                                <![CDATA[
// setup input/output fields
function init(inputFields, outputFields) {
	inputFields.add("table", "");
	outputFields.add("exists", "does table exist", false, java.lang.Boolean);
	outputFields.add("table", "table if exists, undefined otherwise", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableExists =
		(context.containsKey("table") && context.get("table") != null);
	context.put("exists", tableExists);
	context.put("table", context.get("table"));
}
]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="514" y="94"/>
                                    </extensions>
                                </node>
                                <link dest="57334ef9ad744f65" destField="arg1" source="5642bea05e5c4b06" sourceField="value"/>
                                <link dest="4df6ff3399a848c7" destField="table" source="57334ef9ad744f65" sourceField="value"/>
                                <extensions>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="speaker" ref="5642bea05e5c4b06"/>
                            <ogcn:published_input field="obj" name="tableMap" ref="57334ef9ad744f65"/>
                            <ogcn:published_output field="exists" name="exists" ref="4df6ff3399a848c7"/>
                            <ogcn:published_output field="table" name="table" ref="4df6ff3399a848c7"/>
                            <extensions>
                                <oga:meta x="345" y="166"/>
                            </extensions>
                        </ogcn:macro>
                        <ogcn:macro id="350c5a14" name="If Speaker Has Results" type="ca.phon.opgraph.nodes.general.MacroNode">
                            <graph id="69fcf64">
                                <node id="60a76f15" name="Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="55"/>
                                    </extensions>
                                </node>
                                <node id="68d90fd6bd914ea2" name="Participant" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.session.Participant]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="216"/>
                                    </extensions>
                                </node>
                                <node id="95cfaf8923b44bb7" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="537"/>
                                    </extensions>
                                </node>
                                <node id="69ab305476bc42d9" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="678"/>
                                    </extensions>
                                </node>
                                <node id="7f149b7d" name="Split Table by Session" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                    <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                    <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="__script">
                                                <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                            </oga:property>
                                            <oga:property key="columnName">
                                                <![CDATA[Session]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="350" y="67"/>
                                    </extensions>
                                </node>
                                <node id="540f0fe8" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                                    <extensions>
                                        <oga:meta x="357" y="684">
                                            <oga:default for="sectionName" type="java.lang.String">Vocalizations</oga:default>
                                        </oga:meta>
                                    </extensions>
                                </node>
                                <ogcn:macro id="5aee518f" name="Vocalization Analysis" type="ca.phon.opgraph.nodes.general.MacroNode">
                                    <graph id="7aed8530">
                                        <node id="c81dda4" name="result total" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[java.lang.Integer]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="15"/>
                                            </extensions>
                                        </node>
                                        <node id="45508fae" name="speaker" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.session.Participant]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="116"/>
                                            </extensions>
                                        </node>
                                        <node id="578fcaef" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="437"/>
                                            </extensions>
                                        </node>
                                        <node id="7cbf1d09" name="tableMap" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[java.util.Map]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="598"/>
                                            </extensions>
                                        </node>
                                        <node id="fe996f4347094d31" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="699"/>
                                            </extensions>
                                        </node>
                                        <node id="ae45a3e8c6864a08" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="14" y="834"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="71606628" name="All Vocalizations" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="4521b5ae">
                                                <node id="4413c5e1" name="tableMap" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[java.util.Map]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="40" y="77"/>
                                                    </extensions>
                                                </node>
                                                <node id="a1606265db404383" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="40" y="178"/>
                                                    </extensions>
                                                </node>
                                                <node id="a7f7aa2024924ad7" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="37" y="319"/>
                                                    </extensions>
                                                </node>
                                                <node id="4584344a" name="Create Totals Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                                    <input name="tableMap" optional="false"/>
                                                    <output name="totalsTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("totalsTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableMap = context.get("tableMap");
	var totalsTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	totalsTable.setColumnTitle(0, "Session");
	totalsTable.setColumnTitle(1, "Count");

	var keySet = tableMap.keySet();
	var itr = keySet.iterator();
	var total = 0;
	while(itr.hasNext()) {
		var session = itr.next();
		var count = tableMap.get(session).rowCount;
		total += count;

		var rowData = [];
		rowData[0] = session;
		rowData[1] = new java.lang.Integer(count);

		totalsTable.addRow(rowData);
	}

	var rowData = [ "Total", new java.lang.Integer(total) ];
	totalsTable.addRow(rowData);

	context.put("totalsTable", totalsTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="386" y="324"/>
                                                    </extensions>
                                                </node>
                                                <node id="350382d5" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="620" y="134">
                                                            <oga:default for="sectionName" type="java.lang.String">Total</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="5d862a89" name="Add #Voc/Session" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="totalsTable" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("totalsTable", "");
}

function tableOp(context, table) {
	var totalsTable = context.get("totalsTable");

	var totalVocalizations = totalsTable.getValueAt(totalsTable.rowCount-1, totalsTable.columnCount-1);
	var numSessions = totalsTable.rowCount-1;

	var freq = new java.lang.Float(totalVocalizations/numSessions);
	
	var colIdx = 0;
	var rowData = [];
	rowData[colIdx++] = "Vocalizations";
	rowData[colIdx++] = "# of vocalizations / session";
	rowData[colIdx++] = freq;

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="623" y="324"/>
                                                    </extensions>
                                                </node>
                                                <link dest="4584344a" destField="tableMap" source="4413c5e1" sourceField="obj"/>
                                                <link dest="5d862a89" destField="table" source="a1606265db404383" sourceField="obj"/>
                                                <link dest="5d862a89" destField="totalsTable" source="4584344a" sourceField="totalsTable"/>
                                                <link dest="350382d5" destField="parent" source="a7f7aa2024924ad7" sourceField="obj"/>
                                                <link dest="350382d5" destField="table" source="4584344a" sourceField="totalsTable"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                    <oga:notes>
                                                        <oga:note color="0xffff96" height="506" title="Published Inputs" width="308" x="20" y="40"/>
                                                    </oga:notes>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="tableMap" ref="4413c5e1"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="a1606265db404383"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="a7f7aa2024924ad7"/>
                                            <extensions>
                                                <oga:meta x="275" y="12"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="5c298b00" name="Listing" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="29b30066">
                                                <node id="77fcdc08" name="data" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="9d1f0c988b3b4026" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="176"/>
                                                    </extensions>
                                                </node>
                                                <node id="d3b2770a45d34444" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[false]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                                                <![CDATA[Date
Group #
Tier
Range
Result
Initial C
Final C
Actual Syllabification (Word)]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="382" y="110">
                                                            <oga:default for="sectionName" type="java.lang.String">Listing</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <link dest="d3b2770a45d34444" destField="table" source="77fcdc08" sourceField="obj"/>
                                                <link dest="d3b2770a45d34444" destField="parent" source="9d1f0c988b3b4026" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="data" ref="77fcdc08"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="9d1f0c988b3b4026"/>
                                            <extensions>
                                                <oga:meta x="515" y="12"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="39f91ef7" name="Initial Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="1c0dece0">
                                                <node id="4ceebc1" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="28"/>
                                                    </extensions>
                                                </node>
                                                <node id="bf992c580e0040f7" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="189"/>
                                                    </extensions>
                                                </node>
                                                <node id="d156c18598774c51" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="330"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="3fd5be49" name="Initial Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="dea7068">
                                                        <node id="4582b1f9" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="804ab32e282412a" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="19" y="647"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1e4b8d36" name="Add Initial Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Initial C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var initialC = "";
		if(ipa.matches("^{c,-syllabic}.*")) {
			initialC = (new IPATranscriptBuilder()).append(ipa.elementAt(0)).toIPATranscript();
		}

		rowData[colIdx] = initialC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="335"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="26edcb08" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Initial C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="503" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d66aa6a" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="738" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="157e22dd" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Initial C">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="965" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="5142a794" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="246" y="494"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="397afdf3" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Initial C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="481" y="494"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="310e1bb2" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="762" y="520">
                                                                    <oga:default for="sectionName" type="java.lang.String">Initial Consonants</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="26edcb08" destField="table" source="1e4b8d36" sourceField="table"/>
                                                        <link dest="1e4b8d36" destField="table" source="4582b1f9" sourceField="obj"/>
                                                        <link dest="5142a794" destField="table" source="157e22dd" sourceField="table"/>
                                                        <link dest="397afdf3" destField="table" source="5142a794" sourceField="table"/>
                                                        <link dest="d66aa6a" destField="obj" source="26edcb08" sourceField="trueTable"/>
                                                        <link dest="157e22dd" destField="table" source="d66aa6a" sourceField="obj"/>
                                                        <link dest="5142a794" destField="total" source="d66aa6a" sourceField="rowCount"/>
                                                        <link dest="310e1bb2" destField="parent" source="804ab32e282412a" sourceField="obj"/>
                                                        <link dest="310e1bb2" destField="table" source="397afdf3" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="4582b1f9"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="804ab32e282412a"/>
                                                    <ogcn:published_output field="table" name="table" ref="157e22dd"/>
                                                    <extensions>
                                                        <oga:meta x="300" y="27"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="37993d4121c64985" name="Initial Consonants (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="6efefaa9">
                                                        <node id="1fe296e468a143cc" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1e538c2e44b14aa5" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="16" y="530"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="575dcc9dac31425d" name="Add Initial Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Initial C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var initialC = "";
		if(ipa.matches("^{c,-syllabic}.*")) {
			initialC = (new IPATranscriptBuilder()).append(ipa.elementAt(0)).toIPATranscript();
		}

		rowData[colIdx] = initialC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d2d0e4adf72b455b" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Initial C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="503" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e4b60d5da7634e1c" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Initial C">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="738" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="41dceaee2c4a46ae" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	//inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	//var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	// calculate column totals
	var columnTotals = [];
	for(var col = 1; col < table.columnCount; col++) {
		var sessionName = table.getColumnTitle(col);
		var total = 0;
		for(var row = 0; row < table.rowCount; row++) {
			total += table.getValueAt(row, col).intValue();
		}

		columnTotals[sessionName] = total;
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = columnTotals[table.getColumnTitle(col)];
			
			
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="913" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="da71e3439700466e" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Initial C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1148" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1ce1298c" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="932" y="527">
                                                                    <oga:default for="sectionName" type="java.lang.String">Initial Consonants (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="d2d0e4adf72b455b" destField="table" source="575dcc9dac31425d" sourceField="table"/>
                                                        <link dest="575dcc9dac31425d" destField="table" source="1fe296e468a143cc" sourceField="obj"/>
                                                        <link dest="e4b60d5da7634e1c" destField="table" source="d2d0e4adf72b455b" sourceField="trueTable"/>
                                                        <link dest="41dceaee2c4a46ae" destField="table" source="e4b60d5da7634e1c" sourceField="table"/>
                                                        <link dest="da71e3439700466e" destField="table" source="41dceaee2c4a46ae" sourceField="freqTable"/>
                                                        <link dest="1ce1298c" destField="table" source="da71e3439700466e" sourceField="table"/>
                                                        <link dest="1ce1298c" destField="parent" source="1e538c2e44b14aa5" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="1fe296e468a143cc"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="1e538c2e44b14aa5"/>
                                                    <extensions>
                                                        <oga:meta x="296" y="208"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="38a662c4" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique initial consonants";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="673" y="104"/>
                                                    </extensions>
                                                </node>
                                                <link dest="3fd5be49" destField="table" source="4ceebc1" sourceField="obj"/>
                                                <link dest="37993d4121c64985" destField="table" source="4ceebc1" sourceField="obj"/>
                                                <link dest="38a662c4" destField="table" source="bf992c580e0040f7" sourceField="obj"/>
                                                <link dest="38a662c4" destField="inventory" source="3fd5be49" sourceField="table"/>
                                                <link dest="37993d4121c64985" destField="reportNode" source="d156c18598774c51" sourceField="obj"/>
                                                <link dest="3fd5be49" destField="reportNode" source="d156c18598774c51" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="4ceebc1"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="bf992c580e0040f7"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="d156c18598774c51"/>
                                            <extensions>
                                                <oga:meta x="275" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="9bee85a827324705" name="Final Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="45bf4c55">
                                                <node id="be648f920a40a0" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="35" y="41"/>
                                                    </extensions>
                                                </node>
                                                <node id="426e192785444d8e" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="35" y="202"/>
                                                    </extensions>
                                                </node>
                                                <node id="2ef964c1e3954cff" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="41" y="347"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="47ab9f734c8d4a3b" name="Final Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="34f7f943">
                                                        <node id="390d058f9a044b28" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="346ab7dbf17c4f4c" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="31" y="615"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="83392f37c32b4f47" name="Add Final Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Final C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var finalC = "";
		if(ipa.matches(".*{c,-syllabic}$")) {
			finalC = (new IPATranscriptBuilder()).append(ipa.elementAt(ipa.length()-1)).toIPATranscript();
		}

		rowData[colIdx] = finalC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="c8d9bf6512514970" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.exactMatch">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.caseSensitive">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Final C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="497" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="19c21fe28f584032" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Final C">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="719" y="313"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="43edc518" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="709" y="485"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="140e94fe8d404799" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="907" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="af085cd0ea414e90" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Final C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1138" y="373"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="47a3712d" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="703" y="667">
                                                                    <oga:default for="sectionName" type="java.lang.String">Final Consonants</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="83392f37c32b4f47" destField="table" source="390d058f9a044b28" sourceField="obj"/>
                                                        <link dest="140e94fe8d404799" destField="table" source="19c21fe28f584032" sourceField="table"/>
                                                        <link dest="af085cd0ea414e90" destField="table" source="140e94fe8d404799" sourceField="table"/>
                                                        <link dest="c8d9bf6512514970" destField="table" source="83392f37c32b4f47" sourceField="table"/>
                                                        <link dest="19c21fe28f584032" destField="table" source="c8d9bf6512514970" sourceField="trueTable"/>
                                                        <link dest="43edc518" destField="obj" source="c8d9bf6512514970" sourceField="trueTable"/>
                                                        <link dest="140e94fe8d404799" destField="total" source="43edc518" sourceField="rowCount"/>
                                                        <link dest="47a3712d" destField="table" source="af085cd0ea414e90" sourceField="table"/>
                                                        <link dest="47a3712d" destField="parent" source="346ab7dbf17c4f4c" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="390d058f9a044b28"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="346ab7dbf17c4f4c"/>
                                                    <ogcn:published_output field="table" name="table" ref="19c21fe28f584032"/>
                                                    <extensions>
                                                        <oga:meta x="425" y="38"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="a2bb4201f25d43e2" name="Final Consonants (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="6c804449">
                                                        <node id="36f52067ce1f4419" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="cd56721b274a4678" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="25" y="226"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a2fc327ba656458f" name="Add Final Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Final C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var finalC = "";
		if(ipa.matches(".*{c,-syllabic}$")) {
			finalC = (new IPATranscriptBuilder()).append(ipa.elementAt(ipa.length()-1)).toIPATranscript();
		}

		rowData[colIdx] = finalC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="eb8416e76b304213" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.exactMatch">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.caseSensitive">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Final C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="500" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="93d898e7d3974832" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Final C">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="737" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="2f70db5025ff4e1c" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
//	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
//	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	// calculate column totals
	var columnTotals = [];
	for(var col = 1; col < table.columnCount; col++) {
		var sessionName = table.getColumnTitle(col);
		var total = 0;
		for(var row = 0; row < table.rowCount; row++) {
			total += table.getValueAt(row, col).intValue();
		}

		columnTotals[sessionName] = total;
	}
	
	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = columnTotals[table.getColumnTitle(col)];
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="934" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a41037cab06c49d9" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Final C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1171" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="23e89dec" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="519" y="267">
                                                                    <oga:default for="sectionName" type="java.lang.String">Final Consonants (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="a2fc327ba656458f" destField="table" source="36f52067ce1f4419" sourceField="obj"/>
                                                        <link dest="2f70db5025ff4e1c" destField="table" source="93d898e7d3974832" sourceField="table"/>
                                                        <link dest="a41037cab06c49d9" destField="table" source="2f70db5025ff4e1c" sourceField="freqTable"/>
                                                        <link dest="eb8416e76b304213" destField="table" source="a2fc327ba656458f" sourceField="table"/>
                                                        <link dest="93d898e7d3974832" destField="table" source="eb8416e76b304213" sourceField="trueTable"/>
                                                        <link dest="23e89dec" destField="table" source="a41037cab06c49d9" sourceField="table"/>
                                                        <link dest="23e89dec" destField="parent" source="cd56721b274a4678" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="36f52067ce1f4419"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="cd56721b274a4678"/>
                                                    <extensions>
                                                        <oga:meta x="425" y="208"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="84fb765a142d40cd" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique final consonants";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="761" y="386"/>
                                                    </extensions>
                                                </node>
                                                <link dest="47ab9f734c8d4a3b" destField="table" source="be648f920a40a0" sourceField="obj"/>
                                                <link dest="a2bb4201f25d43e2" destField="table" source="be648f920a40a0" sourceField="obj"/>
                                                <link dest="84fb765a142d40cd" destField="inventory" source="47ab9f734c8d4a3b" sourceField="table"/>
                                                <link dest="84fb765a142d40cd" destField="table" source="426e192785444d8e" sourceField="obj"/>
                                                <link dest="47ab9f734c8d4a3b" destField="reportNode" source="2ef964c1e3954cff" sourceField="obj"/>
                                                <link dest="a2bb4201f25d43e2" destField="reportNode" source="2ef964c1e3954cff" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="be648f920a40a0"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="426e192785444d8e"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="2ef964c1e3954cff"/>
                                            <extensions>
                                                <oga:meta x="515" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="9dee81f2bd624468" name="Vowels" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="79367650">
                                                <node id="4286091421414cd3" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="9b01878056a943ce" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="176"/>
                                                    </extensions>
                                                </node>
                                                <node id="b3c94cedb46a45c7" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="30" y="401"/>
                                                    </extensions>
                                                </node>
                                                <node id="6ac5430e4a2a4274" name="Create Vowel Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="vowelTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	outputs.add("vowelTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var vowelTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	vowelTable.setColumnTitle(0, "Session");
	vowelTable.setColumnTitle(1, "Record");
	vowelTable.setColumnTitle(2, "Vowel");
	vowelTable.setColumnTitle(3, "Actual Syllabification (Word)");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var actualSyllabification = table.getValueAt(row, "Actual Syllabification (Word)");
		var ipa = (new IPATranscriptBuilder()).append(actualSyllabification).toIPATranscript();
		var sylls = ipa.syllables();

		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var syll = sylls.get(syllIdx);
			var phonexPattern = Packages.ca.phon.phonex.PhonexPattern.compile(".:N+");
			var matcher = phonexPattern.matcher(syll);
			if(matcher.find()) {
				var nucleus = (new IPATranscriptBuilder()).append(matcher.group()).toIPATranscript();

				var rowData = [];
				rowData[0] = table.getValueAt(row, 0);
				rowData[1] = table.getValueAt(row, "Record #");
				rowData[2] = nucleus;
				rowData[3] = actualSyllabification;
				vowelTable.addRow(rowData);
			}
		}
	}

	context.put("vowelTable", vowelTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="302" y="41"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="b22af37adc0e4a9b" name="Vowels (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="428e8f70">
                                                        <node id="598e44aa449b4309" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="de59595fcce04d31" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="24" y="366"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="cd1c7130d14a4351" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Vowel">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="10ea9b12e8f049b9" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1232952ac10d4297" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ba92fb2d0d3844d9" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Vowel" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="356e96a4" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="716" y="344">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vowel Inventory</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="ba92fb2d0d3844d9" destField="table" source="1232952ac10d4297" sourceField="table"/>
                                                        <link dest="1232952ac10d4297" destField="total" source="10ea9b12e8f049b9" sourceField="rowCount"/>
                                                        <link dest="10ea9b12e8f049b9" destField="obj" source="598e44aa449b4309" sourceField="obj"/>
                                                        <link dest="1232952ac10d4297" destField="table" source="cd1c7130d14a4351" sourceField="table"/>
                                                        <link dest="cd1c7130d14a4351" destField="table" source="598e44aa449b4309" sourceField="obj"/>
                                                        <link dest="356e96a4" destField="parent" source="de59595fcce04d31" sourceField="obj"/>
                                                        <link dest="356e96a4" destField="table" source="ba92fb2d0d3844d9" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="598e44aa449b4309"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="de59595fcce04d31"/>
                                                    <ogcn:published_output field="table" name="table" ref="cd1c7130d14a4351"/>
                                                    <extensions>
                                                        <oga:meta x="559" y="27"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="65bf101fb2f14ead" name="Vowels (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="2be2d1bc">
                                                        <node id="76e8171f93824e4d" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="54c6948a3d6c4afd" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e8096b1c415d4b71" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Vowel">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="b65dd07081f94f95" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="176"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="35abd40b9b9f4fb0" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="441" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f25fd64007f74beb" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Vowel" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="678" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="5bc62d04" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="828" y="299">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vowel Inventory (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="e8096b1c415d4b71" destField="table" source="76e8171f93824e4d" sourceField="obj"/>
                                                        <link dest="b65dd07081f94f95" destField="table" source="76e8171f93824e4d" sourceField="obj"/>
                                                        <link dest="35abd40b9b9f4fb0" destField="tableMap" source="b65dd07081f94f95" sourceField="tableMap"/>
                                                        <link dest="35abd40b9b9f4fb0" destField="table" source="e8096b1c415d4b71" sourceField="table"/>
                                                        <link dest="f25fd64007f74beb" destField="table" source="35abd40b9b9f4fb0" sourceField="freqTable"/>
                                                        <link dest="5bc62d04" destField="table" source="f25fd64007f74beb" sourceField="table"/>
                                                        <link dest="5bc62d04" destField="parent" source="54c6948a3d6c4afd" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="76e8171f93824e4d"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="54c6948a3d6c4afd"/>
                                                    <extensions>
                                                        <oga:meta x="557" y="175"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="6abedfe79ca14089" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique vowels";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="788" y="323"/>
                                                    </extensions>
                                                </node>
                                                <link dest="6ac5430e4a2a4274" destField="table" source="4286091421414cd3" sourceField="obj"/>
                                                <link dest="65bf101fb2f14ead" destField="table" source="6ac5430e4a2a4274" sourceField="vowelTable"/>
                                                <link dest="b22af37adc0e4a9b" destField="table" source="6ac5430e4a2a4274" sourceField="vowelTable"/>
                                                <link dest="6abedfe79ca14089" destField="inventory" source="b22af37adc0e4a9b" sourceField="table"/>
                                                <link dest="6abedfe79ca14089" destField="table" source="b3c94cedb46a45c7" sourceField="obj"/>
                                                <link dest="b22af37adc0e4a9b" destField="reportNode" source="9b01878056a943ce" sourceField="obj"/>
                                                <link dest="65bf101fb2f14ead" destField="reportNode" source="9b01878056a943ce" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="4286091421414cd3"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="b3c94cedb46a45c7"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="9b01878056a943ce"/>
                                            <extensions>
                                                <oga:meta x="755" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="35376622" name="Syllable Structure" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="30a0b367">
                                                <node id="47c22615" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="3dc067559584ced" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="23" y="195"/>
                                                    </extensions>
                                                </node>
                                                <node id="2b8b8d7a0c554dc5" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="24" y="336"/>
                                                    </extensions>
                                                </node>
                                                <node id="45faec77" name="Create Syllable Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="syllTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	outputs.add("syllTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}


var symbolMap = "H={glottal}; G=\\g; C=\\c; V=\\v";

function tableOp(context, table) {
	var syllTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	syllTable.setColumnTitle(0, "Session");
	syllTable.setColumnTitle(1, "Record");
	syllTable.setColumnTitle(2, "Syllable");
	syllTable.setColumnTitle(3, "Structure");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "Actual Syllabification (Word)")).toIPATranscript();
		var sylls = ipa.syllables();


		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var syll = sylls.get(syllIdx);

			var rowData = [];
			rowData[0] = table.getValueAt(row, 0);
			rowData[1] = table.getValueAt(row, "Record #");
			rowData[2] = syll;
			rowData[3] = syll.cover(symbolMap);
			syllTable.addRow(rowData);
		}
	}

	context.put("syllTable", syllTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="275" y="21"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="3c1623ed" name="Syllable Strucutre (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="1ae9b607">
                                                        <node id="77c929c0" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e96b708b14e84704" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="197b49e3" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Structure"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="241" y="24"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1a8e8504" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="151"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a8e35bac8bd74fce" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="784b6f83" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="26300656" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="762" y="308">
                                                                    <oga:default for="sectionName" type="java.lang.String">Syllable Structure</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="784b6f83" destField="table" source="a8e35bac8bd74fce" sourceField="table"/>
                                                        <link dest="a8e35bac8bd74fce" destField="total" source="1a8e8504" sourceField="rowCount"/>
                                                        <link dest="1a8e8504" destField="obj" source="77c929c0" sourceField="obj"/>
                                                        <link dest="a8e35bac8bd74fce" destField="table" source="197b49e3" sourceField="table"/>
                                                        <link dest="197b49e3" destField="table" source="77c929c0" sourceField="obj"/>
                                                        <link dest="26300656" destField="parent" source="e96b708b14e84704" sourceField="obj"/>
                                                        <link dest="26300656" destField="table" source="784b6f83" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="77c929c0"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="e96b708b14e84704"/>
                                                    <ogcn:published_output field="table" name="table" ref="197b49e3"/>
                                                    <extensions>
                                                        <oga:meta x="557" y="29"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="304f07bd533d4538" name="Syllable Strucutre (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="44007539">
                                                        <node id="4c22960fe18b4e7c" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1ac67c4ac34e43da" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9b7b38075b0b44fc" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Structure"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="7c90b8bc" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="c37e4ce7fc204887" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9df2519ebf114209" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="2df31c75" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="688" y="322">
                                                                    <oga:default for="sectionName" type="java.lang.String">Syllable Structure (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="9b7b38075b0b44fc" destField="table" source="4c22960fe18b4e7c" sourceField="obj"/>
                                                        <link dest="7c90b8bc" destField="table" source="4c22960fe18b4e7c" sourceField="obj"/>
                                                        <link dest="c37e4ce7fc204887" destField="tableMap" source="7c90b8bc" sourceField="tableMap"/>
                                                        <link dest="c37e4ce7fc204887" destField="table" source="9b7b38075b0b44fc" sourceField="table"/>
                                                        <link dest="9df2519ebf114209" destField="table" source="c37e4ce7fc204887" sourceField="freqTable"/>
                                                        <link dest="2df31c75" destField="table" source="9df2519ebf114209" sourceField="table"/>
                                                        <link dest="2df31c75" destField="parent" source="1ac67c4ac34e43da" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="4c22960fe18b4e7c"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="1ac67c4ac34e43da"/>
                                                    <extensions>
                                                        <oga:meta x="555" y="184"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="480e7fca23084a07" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <input name="numVocs" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
	inputs.add("numVocs", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");
	var numVocs = context.get("numVocs");



	// add % vocalizations with CV or CVC
	var countCV = 0;
	var countFinalC = 0;
	var total = 0;
	for(var row = 0; row < inventory.rowCount; row++) {
		var pattern = inventory.getValueAt(row, 0);
		var c = inventory.getValueAt(row, 1);

		if(pattern.toString().contains("CV")) {
			countCV += c.intValue();
		}

		if(pattern.toString().endsWith("C")) {
			countFinalC += c.intValue();
		}
		
		total += c.intValue();
	}
	var freqCV = (countCV / total) * 100.0; 
	var freqFinalC = (countFinalC / total) * 100.0;

	var syllsPerVoc = total / numVocs;

	var rowData = [];
	var colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of syllables / vocalization";
	rowData[colIdx++] = new java.lang.Float(syllsPerVoc);
	table.addRow(rowData);
	
	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of syllables that include a CV sequence";
	rowData[colIdx++] = new java.lang.Float(freqCV);
	table.addRow(rowData);

	rowData = [];
	colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of syllables that end with a C";
	rowData[colIdx++] = new java.lang.Float(freqFinalC);
	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="900" y="332"/>
                                                    </extensions>
                                                </node>
                                                <link dest="45faec77" destField="table" source="47c22615" sourceField="obj"/>
                                                <link dest="3c1623ed" destField="table" source="45faec77" sourceField="syllTable"/>
                                                <link dest="304f07bd533d4538" destField="table" source="45faec77" sourceField="syllTable"/>
                                                <link dest="480e7fca23084a07" destField="inventory" source="3c1623ed" sourceField="table"/>
                                                <link dest="480e7fca23084a07" destField="table" source="3dc067559584ced" sourceField="obj"/>
                                                <link dest="480e7fca23084a07" destField="numVocs" source="47c22615" sourceField="rowCount"/>
                                                <link dest="3c1623ed" destField="reportNode" source="2b8b8d7a0c554dc5" sourceField="obj"/>
                                                <link dest="304f07bd533d4538" destField="reportNode" source="2b8b8d7a0c554dc5" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="47c22615"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="3dc067559584ced"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="2b8b8d7a0c554dc5"/>
                                            <extensions>
                                                <oga:meta x="275" y="340"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="fbb7c1ceae774d2a" name="Vocalization Structure" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="421c90e8">
                                                <node id="db2fcf7cec6341e0" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="36"/>
                                                    </extensions>
                                                </node>
                                                <node id="85ac255934fb4b3d" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="177"/>
                                                    </extensions>
                                                </node>
                                                <node id="bb7663ffd8004214" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="318"/>
                                                    </extensions>
                                                </node>
                                                <node id="48ecf0a222045b2" name="Add IPA Cover Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
}

var symbolMap = "H={glottal}; G=\\g; C=\\c; V=\\v";

function tableOp(context, table) {
	var structureColIdx = table.columnCount;
	table.setColumnTitle(structureColIdx, "Structure");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var ipa = table.getValueAt(row, "IPA Actual (Word)");

		var builder = new IPATranscriptBuilder();
		builder.append(table.getValueAt(row, "Actual Syllabification (Word)"));
		var sylls = builder.toIPATranscript().syllables();

		builder = new IPATranscriptBuilder();
		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var coveredIPA = sylls.get(syllIdx).cover(symbolMap);
			if(builder.size() > 0 && !coveredIPA.matches("^\\s.*")) {
				builder.appendSyllableBoundary();
			}
			builder.append(coveredIPA);
		}
		tableData[structureColIdx] = builder.toIPATranscript();
	}
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="281" y="115"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="d6dcaea1e62046f7" name="Structures (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="400fbfc">
                                                        <node id="7d0ef2fe71254e04" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ebc39c54cc2f458a" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="31" y="212"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a12598f7c4e34dcc" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Structure"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="8ecf968b16c24594" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="441" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="33ee13c79ef4cc3" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="678" y="30"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3990b544" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="690" y="225">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vocalization Structure</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="33ee13c79ef4cc3" destField="table" source="8ecf968b16c24594" sourceField="table"/>
                                                        <link dest="8ecf968b16c24594" destField="table" source="a12598f7c4e34dcc" sourceField="table"/>
                                                        <link dest="8ecf968b16c24594" destField="total" source="7d0ef2fe71254e04" sourceField="rowCount"/>
                                                        <link dest="a12598f7c4e34dcc" destField="table" source="7d0ef2fe71254e04" sourceField="obj"/>
                                                        <link dest="3990b544" destField="table" source="33ee13c79ef4cc3" sourceField="table"/>
                                                        <link dest="3990b544" destField="parent" source="ebc39c54cc2f458a" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="7d0ef2fe71254e04"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="ebc39c54cc2f458a"/>
                                                    <ogcn:published_output field="table" name="table" ref="a12598f7c4e34dcc"/>
                                                    <extensions>
                                                        <oga:meta x="564" y="26"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="458fd744de5a4a6a" name="Structures (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="229db2c9">
                                                        <node id="b1a785f5231a4cf2" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1b63859dc6f94760" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d622557e1ee74372" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Structure"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="cc5ba6cc895f4fec" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d579bb6fd1f1483a" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="c7bf51c1114b4074" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3e19d972" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="635" y="372">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vocalization Structure (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="d579bb6fd1f1483a" destField="tableMap" source="cc5ba6cc895f4fec" sourceField="tableMap"/>
                                                        <link dest="d579bb6fd1f1483a" destField="table" source="d622557e1ee74372" sourceField="table"/>
                                                        <link dest="c7bf51c1114b4074" destField="table" source="d579bb6fd1f1483a" sourceField="freqTable"/>
                                                        <link dest="d622557e1ee74372" destField="table" source="b1a785f5231a4cf2" sourceField="obj"/>
                                                        <link dest="cc5ba6cc895f4fec" destField="table" source="b1a785f5231a4cf2" sourceField="obj"/>
                                                        <link dest="3e19d972" destField="table" source="c7bf51c1114b4074" sourceField="table"/>
                                                        <link dest="3e19d972" destField="parent" source="1b63859dc6f94760" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="b1a785f5231a4cf2"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="1b63859dc6f94760"/>
                                                    <extensions>
                                                        <oga:meta x="564" y="167"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="eec3ffcea7204cf7" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	// add % vocalizations with CV or CVC
	var countCV = 0;
	var countCC = 0;
	var total = 0;
	for(var row = 0; row < inventory.rowCount; row++) {
		var pattern = inventory.getValueAt(row, 0);
		var c = inventory.getValueAt(row, 1);

		if(pattern.toString().contains("CV")) {
			countCV += c.intValue();
		}

		if(pattern.toString().contains("CC")) {
			countCC += c.intValue();
		}
		
		total += c.intValue();
	}
	var freqCV = (countCV / total) * 100.0; 
	var freqCC = (countCC / total) * 100.0;
	
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations that include a CV sequence";
	rowData[colIdx++] = new java.lang.Float(freqCV);
	table.addRow(rowData);

	rowData = [];
	colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations that include at least one CC sequence";
	rowData[colIdx++] = new java.lang.Float(freqCC);
	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="875" y="321"/>
                                                    </extensions>
                                                </node>
                                                <link dest="eec3ffcea7204cf7" destField="inventory" source="d6dcaea1e62046f7" sourceField="table"/>
                                                <link dest="eec3ffcea7204cf7" destField="table" source="85ac255934fb4b3d" sourceField="obj"/>
                                                <link dest="48ecf0a222045b2" destField="table" source="db2fcf7cec6341e0" sourceField="obj"/>
                                                <link dest="d6dcaea1e62046f7" destField="table" source="48ecf0a222045b2" sourceField="table"/>
                                                <link dest="458fd744de5a4a6a" destField="table" source="48ecf0a222045b2" sourceField="table"/>
                                                <link dest="d6dcaea1e62046f7" destField="reportNode" source="bb7663ffd8004214" sourceField="obj"/>
                                                <link dest="458fd744de5a4a6a" destField="reportNode" source="bb7663ffd8004214" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="db2fcf7cec6341e0"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="85ac255934fb4b3d"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="bb7663ffd8004214"/>
                                            <extensions>
                                                <oga:meta x="515" y="342"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="6a6f4dc4" name="Harmony" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="78d04294">
                                                <node id="f95439174b664eb4" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="25"/>
                                                    </extensions>
                                                </node>
                                                <node id="7b4f4c414fc04ad1" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="186"/>
                                                    </extensions>
                                                </node>
                                                <node id="d1727c8ca00147d7" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="327"/>
                                                    </extensions>
                                                </node>
                                                <node id="6e9b396c" name="Add Harmony to Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                                    <input name="inputTable" optional="false"/>
                                                    <input name="summaryTable" optional="false"/>
                                                    <output name="cHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <output name="vHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <output name="cvcHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[
function init(inputs, outputs) {
	inputs.add("inputTable", "", false, false);
	inputs.add("summaryTable", "", false, false);
	
	outputs.add("cHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
	outputs.add("vHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
	outputs.add("cvcHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function copyTableSchema(table, destTable) {
	for(var col = 0; col < table.columnCount; col++) {
		destTable.setColumnTitle(col, table.getColumnTitle(col));
	}
}

function run(context) {
	var inputTable = context.get("inputTable");
	var summaryTable = context.get("summaryTable");

	var cHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, cHarmonyTable);
	
	var vHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, vHarmonyTable);
	
	var cvcHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, cvcHarmonyTable);

	context.put("cHarmonyTable", cHarmonyTable);
	context.put("vHarmonyTable", vHarmonyTable);
	context.put("cvcHarmonyTable", cvcHarmonyTable);
	
	var num2PlusSylls = 0;
	var num2PlusSyllsWithCHarmony = 0;
	var num2PlusSyllsWithVHarmony = 0;
	var numCVC = 0;
	var numCVCWithHarmony = 0;

	var colIdx = inputTable.getColumnIndex("Actual Syllabification (Word)");
	
	var harmonyDetector = new Packages.ca.phon.query.detectors.FlatHarmonyDetector();
	for(var row = 0; row < inputTable.rowCount; row++) {
		var rowData = inputTable.getRow(row);

		try {
			var ipa = IPATranscript.parseIPATranscript(
				inputTable.getValueAt(row, colIdx));
			
			if(ipa.syllables().size() >= 2) {
				++num2PlusSylls;
				var harmonies = harmonyDetector.detectConsonantHarmony(ipa);
		
				if(harmonies.size() > 0) {
					++num2PlusSyllsWithCHarmony;
					cHarmonyTable.addRow(rowData);
				}
	
				harmonies = harmonyDetector.detectVowelHarmony(ipa);
				if(harmonies.size() > 0) {
					++num2PlusSyllsWithVHarmony;
					vHarmonyTable.addRow(rowData);
				}
			}
	
			if(ipa.matchesCVPattern("CVC")) {
				++numCVC;
				var harmonies = harmonyDetector.detectConsonantHarmony(ipa);
				
				if(harmonies.size() > 0) {
					++numCVCWithHarmony;
					cvcHarmonyTable.addRow(rowData);
				}
			}
		} catch (e) {
			// ignore errors in transcriptions
		}
	}

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of vocalizations with at least two syllables";
	rowData[colIdx++] = new java.lang.Integer(num2PlusSylls);
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations with at least two syllables and some consonant harmony";
	rowData[colIdx++] = (num2PlusSylls > 0 ? new java.lang.Float((num2PlusSyllsWithCHarmony/num2PlusSylls) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);
	
	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of vocalizations with at least two syllables and some vowel harmony";
	rowData[colIdx++] = (num2PlusSylls > 0 ? new java.lang.Float((num2PlusSyllsWithVHarmony/num2PlusSylls) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of CVC vocalizations";
	rowData[colIdx++] = new java.lang.Integer(numCVC);
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of CVC vocalizations with consonant harmony";
	rowData[colIdx++] = (numCVC > 0 ? new java.lang.Float((numCVCWithHarmony/numCVC) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="321" y="119"/>
                                                    </extensions>
                                                </node>
                                                <node id="23e44194ef2542ab" name="Consonant Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[false]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                                                <![CDATA[Date
Group #
Tier
Range
Result
Initial C
Final C
Structure
Actual Syllabification (Word)]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="707" y="78">
                                                            <oga:default for="sectionName" type="java.lang.String">Multi-syllabic Consonant Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="9025f2162d684911" name="Vowel Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[false]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                                                <![CDATA[Date
Group #
Tier
Range
Result
Initial C
Final C
Structure
Actual Syllabification (Word)]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="707" y="235">
                                                            <oga:default for="sectionName" type="java.lang.String">Multi-syllabic Vowel Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="17227434730b4ed4" name="CVC Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[false]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                                                <![CDATA[Date
Group #
Tier
Range
Result
Initial C
Final C
Structure
Actual Syllabification (Word)]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="712" y="401">
                                                            <oga:default for="sectionName" type="java.lang.String">CVC Consonant Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <link dest="6e9b396c" destField="inputTable" source="f95439174b664eb4" sourceField="obj"/>
                                                <link dest="6e9b396c" destField="summaryTable" source="7b4f4c414fc04ad1" sourceField="obj"/>
                                                <link dest="23e44194ef2542ab" destField="table" source="6e9b396c" sourceField="cHarmonyTable"/>
                                                <link dest="23e44194ef2542ab" destField="parent" source="d1727c8ca00147d7" sourceField="obj"/>
                                                <link dest="9025f2162d684911" destField="table" source="6e9b396c" sourceField="vHarmonyTable"/>
                                                <link dest="9025f2162d684911" destField="parent" source="d1727c8ca00147d7" sourceField="obj"/>
                                                <link dest="17227434730b4ed4" destField="table" source="6e9b396c" sourceField="cvcHarmonyTable"/>
                                                <link dest="17227434730b4ed4" destField="parent" source="d1727c8ca00147d7" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="f95439174b664eb4"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="7b4f4c414fc04ad1"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="d1727c8ca00147d7"/>
                                            <extensions>
                                                <oga:meta x="755" y="342"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="c3a5d71d15704c6f" name="Mean Babble Level" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="38eb0970">
                                                <node id="f2b0e896f7884dea" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="17" y="25"/>
                                                    </extensions>
                                                </node>
                                                <node id="748fd15f9a984590" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="17" y="186"/>
                                                    </extensions>
                                                </node>
                                                <node id="9ecbaafe9f794505" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="24" y="334"/>
                                                    </extensions>
                                                </node>
                                                <node id="117b1f6cbc42428c" name="Add Mean Babble Level" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

var placeFeatures = [
	"{labial, -dental}",
	"{labial, dental}",
	"{dental}",
	"{alveolar}",
	"{alveopalatal}",
	"{lateral}",
	"{retroflex}",
	"{palatal}",
	"{velar}",
	"{uvular}",
	"{pharyngeal}",
	"{laryngeal}"
];

var mannerFeatures = [
	"{stop, -nasal}",
	"{fricative}",
	"{affricate}",
	"{nasal}",
	"{liquid, lateral}",
	"{rhotic}",
	"{glide}",
	"{vowel}"
];

function init(inputs, outputs) {
}

function getFeatures(featureArray, ele) {
	var retVal = "\u2205";

	for(var i = 0; i < featureArray.length; i++) {
		var features = featureArray[i];
		var transcript = (new IPATranscriptBuilder()).append(ele).toIPATranscript();
		if(transcript.matches(features)) {
			retVal = features;
			break;
		}
	}

	return retVal;
}

// return a set of consonant types {place+manner}
function getConsonantTypes(ipa) {
	var retVal = new java.util.HashSet();
	var phonex = "[^\\v{glide}{glottal}]";
	var phones = ipa.removePunctuation();

	var phonexPattern = Packages.ca.phon.phonex.PhonexPattern.compile(phonex);
	var matcher = phonexPattern.matcher(phones);

	while(matcher.find()) {
		var match = (new IPATranscriptBuilder()).append(matcher.group()).toIPATranscript();

		if(match.length() > 0) {
			var ele = match.elementAt(0);

			var pf = getFeatures(placeFeatures, ele);
			var mf = getFeatures(mannerFeatures, ele);

			var type = pf + " + " + mf;
			retVal.add(type);
		}
	}

	return retVal;
}

function getMeanBabbleLevel(ipa) {
	var consonantTypes = getConsonantTypes(ipa);

	if(consonantTypes.size() == 0) {
		return 1;
	} else if(consonantTypes.size() == 1) {
		return 2;
	} else {
		return 3;
	}
}

function tableOp(context, table) {
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "Mean Babble Level");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var actualSyllabification = table.getValueAt(row, "Actual Syllabification (Word)");
		var ipa = (new IPATranscriptBuilder()).append(actualSyllabification).toIPATranscript();

		tableData[colIdx] = getMeanBabbleLevel(ipa);
	}
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="275" y="25"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="e59f22e93c0416a" name="Mean Babble Level (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="52eb9263">
                                                        <node id="536cd64980e047a7" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="fc42b8e7ba8247b0" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="17" y="327"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9c4f740ed27b4b8d" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Mean Babble Level">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f3b305518e5b4ac6" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="2ab4cd6392f7428b" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Mean Babble Level" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="4096f423" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="589" y="302">
                                                                    <oga:default for="sectionName" type="java.lang.String">Mean Babble Level</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="2ab4cd6392f7428b" destField="table" source="f3b305518e5b4ac6" sourceField="table"/>
                                                        <link dest="f3b305518e5b4ac6" destField="table" source="9c4f740ed27b4b8d" sourceField="table"/>
                                                        <link dest="f3b305518e5b4ac6" destField="total" source="536cd64980e047a7" sourceField="rowCount"/>
                                                        <link dest="9c4f740ed27b4b8d" destField="table" source="536cd64980e047a7" sourceField="obj"/>
                                                        <link dest="4096f423" destField="table" source="2ab4cd6392f7428b" sourceField="table"/>
                                                        <link dest="4096f423" destField="parent" source="fc42b8e7ba8247b0" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="536cd64980e047a7"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="fc42b8e7ba8247b0"/>
                                                    <ogcn:published_output field="table" name="table" ref="9c4f740ed27b4b8d"/>
                                                    <extensions>
                                                        <oga:meta x="540" y="25"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="455c63934e7b460c" name="Mean Babble Level (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="42cbb311">
                                                        <node id="c5954c4c2e8242f3" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a5797fec9e54a41" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="25" y="335"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="26d8074f11a4469e" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Mean Babble Level">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="8bf24634c804fef" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ec5c9a7ddce147ce" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="adb22cd51e934885" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Mean Babble Level" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1a7286ca" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="644" y="324">
                                                                    <oga:default for="sectionName" type="java.lang.String">Mean Babble Level (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="ec5c9a7ddce147ce" destField="tableMap" source="8bf24634c804fef" sourceField="tableMap"/>
                                                        <link dest="ec5c9a7ddce147ce" destField="table" source="26d8074f11a4469e" sourceField="table"/>
                                                        <link dest="adb22cd51e934885" destField="table" source="ec5c9a7ddce147ce" sourceField="freqTable"/>
                                                        <link dest="26d8074f11a4469e" destField="table" source="c5954c4c2e8242f3" sourceField="obj"/>
                                                        <link dest="8bf24634c804fef" destField="table" source="c5954c4c2e8242f3" sourceField="obj"/>
                                                        <link dest="1a7286ca" destField="table" source="adb22cd51e934885" sourceField="table"/>
                                                        <link dest="1a7286ca" destField="parent" source="a5797fec9e54a41" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="c5954c4c2e8242f3"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="a5797fec9e54a41"/>
                                                    <extensions>
                                                        <oga:meta x="540" y="165"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="b12705f4c9c84206" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <input name="numVocs" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
	inputs.add("numVocs", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");
	var numVocs = context.get("numVocs");

	var total = 0.0;
	for(var row = 0; row < inventory.rowCount; row++) {
		var mbl = java.lang.Float.parseFloat(inventory.getValueAt(row, 0));
		var cnt = inventory.getValueAt(row, 1);

		total += (mbl * cnt.intValue());
	}
	var meanBabbleLevel = total / numVocs;
	
	var rowData = [];
	var colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "mean babble level";
	rowData[colIdx++] = new java.lang.Float(meanBabbleLevel);
	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="836" y="300"/>
                                                    </extensions>
                                                </node>
                                                <link dest="117b1f6cbc42428c" destField="table" source="f2b0e896f7884dea" sourceField="obj"/>
                                                <link dest="e59f22e93c0416a" destField="table" source="117b1f6cbc42428c" sourceField="table"/>
                                                <link dest="455c63934e7b460c" destField="table" source="117b1f6cbc42428c" sourceField="table"/>
                                                <link dest="b12705f4c9c84206" destField="table" source="748fd15f9a984590" sourceField="obj"/>
                                                <link dest="b12705f4c9c84206" destField="inventory" source="e59f22e93c0416a" sourceField="table"/>
                                                <link dest="b12705f4c9c84206" destField="numVocs" source="f2b0e896f7884dea" sourceField="rowCount"/>
                                                <link dest="e59f22e93c0416a" destField="reportNode" source="9ecbaafe9f794505" sourceField="obj"/>
                                                <link dest="455c63934e7b460c" destField="reportNode" source="9ecbaafe9f794505" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="f2b0e896f7884dea"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="748fd15f9a984590"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="9ecbaafe9f794505"/>
                                            <extensions>
                                                <oga:meta x="276" y="512"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="71606628" destField="tableMap" source="7cbf1d09" sourceField="obj"/>
                                        <link dest="39f91ef7" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="35376622" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="5c298b00" destField="data" source="578fcaef" sourceField="obj"/>
                                        <link dest="9bee85a827324705" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="9dee81f2bd624468" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="c3a5d71d15704c6f" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="71606628" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="39f91ef7" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="9bee85a827324705" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="9dee81f2bd624468" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="fbb7c1ceae774d2a" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="fbb7c1ceae774d2a" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="35376622" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="c3a5d71d15704c6f" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="6a6f4dc4" destField="summaryTable" source="fe996f4347094d31" sourceField="obj"/>
                                        <link dest="6a6f4dc4" destField="table" source="578fcaef" sourceField="obj"/>
                                        <link dest="5c298b00" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="71606628" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="39f91ef7" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="9bee85a827324705" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="9dee81f2bd624468" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="35376622" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="fbb7c1ceae774d2a" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="6a6f4dc4" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <link dest="c3a5d71d15704c6f" destField="reportNode" source="ae45a3e8c6864a08" sourceField="obj"/>
                                        <extensions>
                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                        </extensions>
                                    </graph>
                                    <ogcn:published_input field="obj" name="speaker" ref="45508fae"/>
                                    <ogcn:published_input field="obj" name="table" ref="578fcaef"/>
                                    <ogcn:published_input field="obj" name="tableMap" ref="7cbf1d09"/>
                                    <ogcn:published_input field="obj" name="result total" ref="c81dda4"/>
                                    <ogcn:published_input field="obj" name="summaryTable" ref="fe996f4347094d31"/>
                                    <ogcn:published_input field="obj" name="reportNode" ref="ae45a3e8c6864a08"/>
                                    <extensions>
                                        <oga:meta x="605" y="66"/>
                                    </extensions>
                                </ogcn:macro>
                                <link dest="7f149b7d" destField="table" source="60a76f15" sourceField="obj"/>
                                <link dest="5aee518f" destField="tableMap" source="7f149b7d" sourceField="tableMap"/>
                                <link dest="5aee518f" destField="table" source="60a76f15" sourceField="obj"/>
                                <link dest="5aee518f" destField="speaker" source="68d90fd6bd914ea2" sourceField="obj"/>
                                <link dest="5aee518f" destField="result total" source="60a76f15" sourceField="rowCount"/>
                                <link dest="5aee518f" destField="summaryTable" source="95cfaf8923b44bb7" sourceField="obj"/>
                                <link dest="540f0fe8" destField="parent" source="69ab305476bc42d9" sourceField="obj"/>
                                <link dest="5aee518f" destField="reportNode" source="540f0fe8" sourceField="section"/>
                                <extensions>
                                    <oga:notes>
                                        <oga:note color="0xffff96" height="879" title="Inputs" width="323" x="9" y="19"/>
                                    </oga:notes>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="tableMap" ref="60a76f15"/>
                            <ogcn:published_input field="obj" name="speaker" ref="68d90fd6bd914ea2"/>
                            <ogcn:published_input field="obj" name="summaryTable" ref="95cfaf8923b44bb7"/>
                            <ogcn:published_input field="obj" name="reportNode" ref="69ab305476bc42d9"/>
                            <extensions>
                                <oga:meta x="630" y="168"/>
                            </extensions>
                        </ogcn:macro>
                        <link dest="350c5a14" destField="speaker" source="28737cd4" sourceField="obj"/>
                        <link dest="bfbf3172e44b4532" destField="table" source="3303e4cd" sourceField="obj"/>
                        <link dest="bbf482c5a66541f7" destField="tableMap" source="bfbf3172e44b4532" sourceField="tableMap"/>
                        <link dest="bbf482c5a66541f7" destField="speaker" source="28737cd4" sourceField="obj"/>
                        <link dest="350c5a14" destField="tableMap" source="bbf482c5a66541f7" sourceField="table"/>
                        <link dest="350c5a14" destField="enabled" source="bbf482c5a66541f7" sourceField="exists"/>
                        <link dest="350c5a14" destField="summaryTable" source="b559e3f830b34106" sourceField="obj"/>
                        <link dest="350c5a14" destField="reportNode" source="a8b85ca0e5b34a92" sourceField="obj"/>
                        <extensions>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="speaker" ref="28737cd4"/>
                    <ogcn:published_input field="obj" name="table" ref="3303e4cd"/>
                    <ogcn:published_input field="obj" name="summaryTable" ref="b559e3f830b34106"/>
                    <ogcn:published_input field="obj" name="reportNode" ref="a8b85ca0e5b34a92"/>
                    <ogcn:published_output field="obj" name="summaryTable" ref="b559e3f830b34106"/>
                    <extensions>
                        <oga:meta x="722" y="92"/>
                    </extensions>
                </ogcn:macro>
                <ogcn:macro id="7606c46e4d4a488e" name="Words" type="ca.phon.opgraph.nodes.general.MacroNode">
                    <graph id="4b2c70a0">
                        <node id="d3b316447a5c4962" name="speaker" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.session.Participant]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="35"/>
                            </extensions>
                        </node>
                        <node id="39169d809aa2478e" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="356"/>
                            </extensions>
                        </node>
                        <node id="29b6895f64494a6a" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="517"/>
                            </extensions>
                        </node>
                        <node id="1076f4c5c51a48fc" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                            <extensions>
                                <oga:settings>
                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="25" y="658"/>
                            </extensions>
                        </node>
                        <node id="5c49b48a59024c08" name="Split Table by Speaker" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                            <extensions>
                                <oga:settings>
                                    <oga:property key="__script">
                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                    </oga:property>
                                    <oga:property key="columnName">
                                        <![CDATA[Speaker]]>
                                    </oga:property>
                                </oga:settings>
                                <oga:meta x="242" y="477"/>
                            </extensions>
                        </node>
                        <ogcn:macro id="93c060eb54fd4e81" name="Get Table of Results For Speaker" type="ca.phon.opgraph.nodes.general.MacroNode">
                            <graph id="7c377624">
                                <node id="a0a0f6b9f24a4042" name="Object#toString()" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                                <![CDATA[toString()]]>
                                            </oga:property>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                <![CDATA[java.lang.Object]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="105" y="70"/>
                                    </extensions>
                                </node>
                                <node id="5cfdc8b27aa54caa" name="Map#get(Object)" type="class:ca.phon.opgraph.nodes.reflect.MethodNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.classMember">
                                                <![CDATA[get(java.lang.Object)]]>
                                            </oga:property>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.MethodNode.declaredClass">
                                                <![CDATA[java.util.Map]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="296" y="73"/>
                                    </extensions>
                                </node>
                                <node id="d7268e9ac02b40ff" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                    <input name="table" optional="false"/>
                                    <output name="exists" type="java.lang.Boolean">does table exist</output>
                                    <output name="table" type="ca.phon.query.report.datasource.DefaultTableDataSource">table if exists, undefined otherwise</output>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="__script">
                                                <![CDATA[
// setup input/output fields
function init(inputFields, outputFields) {
	inputFields.add("table", "");
	outputFields.add("exists", "does table exist", false, java.lang.Boolean);
	outputFields.add("table", "table if exists, undefined otherwise", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableExists =
		(context.containsKey("table") && context.get("table") != null);
	context.put("exists", tableExists);
	context.put("table", context.get("table"));
}
]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="514" y="94"/>
                                    </extensions>
                                </node>
                                <link dest="5cfdc8b27aa54caa" destField="arg1" source="a0a0f6b9f24a4042" sourceField="value"/>
                                <link dest="d7268e9ac02b40ff" destField="table" source="5cfdc8b27aa54caa" sourceField="value"/>
                                <extensions>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="speaker" ref="a0a0f6b9f24a4042"/>
                            <ogcn:published_input field="obj" name="tableMap" ref="5cfdc8b27aa54caa"/>
                            <ogcn:published_output field="exists" name="exists" ref="d7268e9ac02b40ff"/>
                            <ogcn:published_output field="table" name="table" ref="d7268e9ac02b40ff"/>
                            <extensions>
                                <oga:meta x="345" y="166"/>
                            </extensions>
                        </ogcn:macro>
                        <ogcn:macro id="14e8ff33cbaf43c9" name="If Speaker Has Results" type="ca.phon.opgraph.nodes.general.MacroNode">
                            <graph id="3ca29e78">
                                <node id="6893103afc764a97" name="Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="55"/>
                                    </extensions>
                                </node>
                                <node id="b81fe8a26e58401c" name="Participant" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.session.Participant]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="216"/>
                                    </extensions>
                                </node>
                                <node id="23d24c0285114af2" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="537"/>
                                    </extensions>
                                </node>
                                <node id="ebfdb91fa4a84761" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="38" y="678"/>
                                    </extensions>
                                </node>
                                <node id="9852428936354315" name="Split Table by Session" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                    <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                    <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                    <extensions>
                                        <oga:settings>
                                            <oga:property key="__script">
                                                <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                            </oga:property>
                                            <oga:property key="columnName">
                                                <![CDATA[Session]]>
                                            </oga:property>
                                        </oga:settings>
                                        <oga:meta x="350" y="67"/>
                                    </extensions>
                                </node>
                                <node id="506b8dbbf94c44fa" type="class:ca.phon.app.opgraph.nodes.report.ReportSectionHeaderNode">
                                    <extensions>
                                        <oga:meta x="357" y="684">
                                            <oga:default for="sectionName" type="java.lang.String">Words</oga:default>
                                        </oga:meta>
                                    </extensions>
                                </node>
                                <ogcn:macro id="413ec086002946e0" name="Word Analysis" type="ca.phon.opgraph.nodes.general.MacroNode">
                                    <graph id="26aab35e">
                                        <node id="c35f1e7dd60f4a94" name="result total" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[java.lang.Integer]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="15"/>
                                            </extensions>
                                        </node>
                                        <node id="6ee0036538e64a47" name="speaker" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.session.Participant]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="116"/>
                                            </extensions>
                                        </node>
                                        <node id="db131da6c3774b25" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="437"/>
                                            </extensions>
                                        </node>
                                        <node id="2466829eca3e4f41" name="tableMap" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[java.util.Map]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="598"/>
                                            </extensions>
                                        </node>
                                        <node id="b72ef136d4f34592" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="11" y="699"/>
                                            </extensions>
                                        </node>
                                        <node id="c4656e8a32a54314" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                            <extensions>
                                                <oga:settings>
                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                    </oga:property>
                                                </oga:settings>
                                                <oga:meta x="14" y="834"/>
                                            </extensions>
                                        </node>
                                        <ogcn:macro id="eb12aa21e53e480b" name="All Words" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="6c7c76c0">
                                                <node id="46c5466ef64340f0" name="tableMap" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[java.util.Map]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="40" y="77"/>
                                                    </extensions>
                                                </node>
                                                <node id="b695d9ddb1b445f4" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="40" y="178"/>
                                                    </extensions>
                                                </node>
                                                <node id="1395ba4f401416d" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="37" y="319"/>
                                                    </extensions>
                                                </node>
                                                <node id="7c92275ec1804964" name="Create Totals Table" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                                    <input name="tableMap" optional="false"/>
                                                    <output name="totalsTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("totalsTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function run(context) {
	var tableMap = context.get("tableMap");
	var totalsTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	totalsTable.setColumnTitle(0, "Session");
	totalsTable.setColumnTitle(1, "Count");

	var keySet = tableMap.keySet();
	var itr = keySet.iterator();
	var total = 0;
	while(itr.hasNext()) {
		var session = itr.next();
		var count = tableMap.get(session).rowCount;
		total += count;

		var rowData = [];
		rowData[0] = session;
		rowData[1] = new java.lang.Integer(count);

		totalsTable.addRow(rowData);
	}

	var rowData = [ "Total", new java.lang.Integer(total) ];
	totalsTable.addRow(rowData);

	context.put("totalsTable", totalsTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="386" y="324"/>
                                                    </extensions>
                                                </node>
                                                <node id="276b729130ce46c4" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                        </oga:settings>
                                                        <oga:meta x="620" y="134">
                                                            <oga:default for="sectionName" type="java.lang.String">Total</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="cc983c7b1d124871" name="Add #Words/Session" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="totalsTable" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("totalsTable", "");
}

function tableOp(context, table) {
	var totalsTable = context.get("totalsTable");

	var totalVocalizations = totalsTable.getValueAt(totalsTable.rowCount-1, totalsTable.columnCount-1);
	var numSessions = totalsTable.rowCount-1;

	var freq = new java.lang.Float(totalVocalizations/numSessions);
	
	var colIdx = 0;
	var rowData = [];
	rowData[colIdx++] = "Words";
	rowData[colIdx++] = "# of words / session";
	rowData[colIdx++] = freq;

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="622" y="324"/>
                                                    </extensions>
                                                </node>
                                                <link dest="7c92275ec1804964" destField="tableMap" source="46c5466ef64340f0" sourceField="obj"/>
                                                <link dest="cc983c7b1d124871" destField="table" source="b695d9ddb1b445f4" sourceField="obj"/>
                                                <link dest="cc983c7b1d124871" destField="totalsTable" source="7c92275ec1804964" sourceField="totalsTable"/>
                                                <link dest="276b729130ce46c4" destField="parent" source="1395ba4f401416d" sourceField="obj"/>
                                                <link dest="276b729130ce46c4" destField="table" source="7c92275ec1804964" sourceField="totalsTable"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                    <oga:notes>
                                                        <oga:note color="0xffff96" height="506" title="Published Inputs" width="308" x="20" y="40"/>
                                                    </oga:notes>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="tableMap" ref="46c5466ef64340f0"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="b695d9ddb1b445f4"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="1395ba4f401416d"/>
                                            <extensions>
                                                <oga:meta x="275" y="12"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="9d52041deaa7490c" name="Listing" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="170fe928">
                                                <node id="902aa7ca97474ef5" name="data" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="3599af500e84605" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="176"/>
                                                    </extensions>
                                                </node>
                                                <node id="2ff9288e27a48eb" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[false]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                                                <![CDATA[Date
Group #
Tier
Range
Result
Initial C
Final C
Actual Syllabification (Word)]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="382" y="110">
                                                            <oga:default for="sectionName" type="java.lang.String">Listing</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <link dest="2ff9288e27a48eb" destField="table" source="902aa7ca97474ef5" sourceField="obj"/>
                                                <link dest="2ff9288e27a48eb" destField="parent" source="3599af500e84605" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="data" ref="902aa7ca97474ef5"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="3599af500e84605"/>
                                            <extensions>
                                                <oga:meta x="515" y="12"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="23e91cc1e09845ca" name="Token Summary" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="22f784f2">
                                                <node id="63f5b25f9a474360" name="data" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="abcca3b6aa7c4815" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="176"/>
                                                    </extensions>
                                                </node>
                                                <node id="e2aaff43e3474471" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="24" y="403"/>
                                                    </extensions>
                                                </node>
                                                <node id="12f61ddb" type="class:ca.phon.app.opgraph.nodes.table.TokenSummaryNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="columnNames">
                                                                <![CDATA[IPA Actual (Word)]]>
                                                            </oga:property>
                                                            <oga:property key="ignoreDiacritics">
                                                                <![CDATA[true]]>
                                                            </oga:property>
                                                            <oga:property key="caseSensitive">
                                                                <![CDATA[false]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="312" y="59"/>
                                                    </extensions>
                                                </node>
                                                <node id="3e03936be36d410b" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[false]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                                                <![CDATA[Date
Group #
Tier
Range
Result
Initial C
Final C
Actual Syllabification (Word)]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="509" y="59">
                                                            <oga:default for="sectionName" type="java.lang.String">Phonetic Type-Token Ratio</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="33680c89" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                                    <input name="summaryTable" optional="false"/>
                                                    <input name="tokensTable" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("summaryTable", "");
     inputs.add("tokensTable", "");
}

function run(context) {
        var tokensTable = context.get("tokensTable");
        var table = context.get("summaryTable");

        var ratio = tokensTable.getValueAt(tokensTable.rowCount-1, tokensTable.columnCount-1);

        var freq = new java.lang.Float(ratio);

        var colIdx = 0;
        var rowData = [];
        rowData[colIdx++] = "";
        rowData[colIdx++] = "phonetic type-token ratio";
        rowData[colIdx++] = freq;

        table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="509" y="220"/>
                                                    </extensions>
                                                </node>
                                                <link dest="3e03936be36d410b" destField="parent" source="abcca3b6aa7c4815" sourceField="obj"/>
                                                <link dest="3e03936be36d410b" destField="table" source="12f61ddb" sourceField="table"/>
                                                <link dest="12f61ddb" destField="table" source="63f5b25f9a474360" sourceField="obj"/>
                                                <link dest="33680c89" destField="summaryTable" source="e2aaff43e3474471" sourceField="obj"/>
                                                <link dest="33680c89" destField="tokensTable" source="12f61ddb" sourceField="table"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="data" ref="63f5b25f9a474360"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="abcca3b6aa7c4815"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="e2aaff43e3474471"/>
                                            <extensions>
                                                <oga:meta x="734" y="12"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="7c813837d09b4c64" name="Initial Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="3a9e8a2f">
                                                <node id="1861d700377f4f8e" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="28"/>
                                                    </extensions>
                                                </node>
                                                <node id="b48614f7c02244f0" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="189"/>
                                                    </extensions>
                                                </node>
                                                <node id="ce7fcfeeba14425a" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="19" y="330"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="ab04aeb51d214f65" name="Initial Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="d8439f8">
                                                        <node id="58f8b0f649784346" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="847b6c84e4ae4db4" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="19" y="647"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="47c14395076e45b9" name="Add Initial Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Initial C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var initialC = "";
		if(ipa.matches("^\\c.*")) {
			initialC = (new IPATranscriptBuilder()).append(ipa.elementAt(0)).toIPATranscript();
		}

		rowData[colIdx] = initialC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1bf9f87967df405a" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Initial C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="503" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3281377755d54a11" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="738" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a34bd4de183144cf" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Initial C">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="965" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e27c17bd868542fc" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="246" y="494"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="5c2d8c1310d2451e" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Initial C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="481" y="494"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9440065d2f8042a0" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="762" y="520">
                                                                    <oga:default for="sectionName" type="java.lang.String">Initial Consonants</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="1bf9f87967df405a" destField="table" source="47c14395076e45b9" sourceField="table"/>
                                                        <link dest="47c14395076e45b9" destField="table" source="58f8b0f649784346" sourceField="obj"/>
                                                        <link dest="e27c17bd868542fc" destField="table" source="a34bd4de183144cf" sourceField="table"/>
                                                        <link dest="5c2d8c1310d2451e" destField="table" source="e27c17bd868542fc" sourceField="table"/>
                                                        <link dest="3281377755d54a11" destField="obj" source="1bf9f87967df405a" sourceField="trueTable"/>
                                                        <link dest="a34bd4de183144cf" destField="table" source="3281377755d54a11" sourceField="obj"/>
                                                        <link dest="e27c17bd868542fc" destField="total" source="3281377755d54a11" sourceField="rowCount"/>
                                                        <link dest="9440065d2f8042a0" destField="parent" source="847b6c84e4ae4db4" sourceField="obj"/>
                                                        <link dest="9440065d2f8042a0" destField="table" source="5c2d8c1310d2451e" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="58f8b0f649784346"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="847b6c84e4ae4db4"/>
                                                    <ogcn:published_output field="table" name="table" ref="a34bd4de183144cf"/>
                                                    <extensions>
                                                        <oga:meta x="301" y="27"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="e263bbc7e9744876" name="Initial Consonants (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="37dcc83a">
                                                        <node id="94d2f28bfb3465c" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="23999e98bb5b48b6" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="16" y="530"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="390e2008e45d4ed2" name="Add Initial Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Initial C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var initialC = "";
		if(ipa.matches("^\\c.*")) {
			initialC = (new IPATranscriptBuilder()).append(ipa.elementAt(0)).toIPATranscript();
		}

		rowData[colIdx] = initialC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f4d04a211fe1485f" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Initial C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="503" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="7543deec01ea43dc" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Initial C">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="738" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="2d01f5fa96ca46ef" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	//inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	//var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	// calculate column totals
	var columnTotals = [];
	for(var col = 1; col < table.columnCount; col++) {
		var sessionName = table.getColumnTitle(col);
		var total = 0;
		for(var row = 0; row < table.rowCount; row++) {
			total += table.getValueAt(row, col).intValue();
		}

		columnTotals[sessionName] = total;
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = columnTotals[table.getColumnTitle(col)];
			
			
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="913" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a9ff0993c4ef48d8" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Initial C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1148" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="7e152e7c662447b1" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="932" y="527">
                                                                    <oga:default for="sectionName" type="java.lang.String">Initial Consonants (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="f4d04a211fe1485f" destField="table" source="390e2008e45d4ed2" sourceField="table"/>
                                                        <link dest="390e2008e45d4ed2" destField="table" source="94d2f28bfb3465c" sourceField="obj"/>
                                                        <link dest="7543deec01ea43dc" destField="table" source="f4d04a211fe1485f" sourceField="trueTable"/>
                                                        <link dest="2d01f5fa96ca46ef" destField="table" source="7543deec01ea43dc" sourceField="table"/>
                                                        <link dest="a9ff0993c4ef48d8" destField="table" source="2d01f5fa96ca46ef" sourceField="freqTable"/>
                                                        <link dest="7e152e7c662447b1" destField="table" source="a9ff0993c4ef48d8" sourceField="table"/>
                                                        <link dest="7e152e7c662447b1" destField="parent" source="23999e98bb5b48b6" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="94d2f28bfb3465c"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="23999e98bb5b48b6"/>
                                                    <extensions>
                                                        <oga:meta x="296" y="208"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="4954e0f3d7a742cc" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique initial consonants";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="673" y="104"/>
                                                    </extensions>
                                                </node>
                                                <link dest="ab04aeb51d214f65" destField="table" source="1861d700377f4f8e" sourceField="obj"/>
                                                <link dest="e263bbc7e9744876" destField="table" source="1861d700377f4f8e" sourceField="obj"/>
                                                <link dest="4954e0f3d7a742cc" destField="table" source="b48614f7c02244f0" sourceField="obj"/>
                                                <link dest="4954e0f3d7a742cc" destField="inventory" source="ab04aeb51d214f65" sourceField="table"/>
                                                <link dest="e263bbc7e9744876" destField="reportNode" source="ce7fcfeeba14425a" sourceField="obj"/>
                                                <link dest="ab04aeb51d214f65" destField="reportNode" source="ce7fcfeeba14425a" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="1861d700377f4f8e"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="b48614f7c02244f0"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="ce7fcfeeba14425a"/>
                                            <extensions>
                                                <oga:meta x="275" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="d7b8cae633634373" name="Final Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="de1b3ba">
                                                <node id="1f5d33ecef304cb0" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="35" y="41"/>
                                                    </extensions>
                                                </node>
                                                <node id="a10e62c65ef249dc" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="35" y="202"/>
                                                    </extensions>
                                                </node>
                                                <node id="136b54badd344d2b" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="41" y="347"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="ba234bc06044493" name="Final Consonants" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="7451f603">
                                                        <node id="399d28dd46dd4335" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="49e515796d0f4a61" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="31" y="615"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e796e5e494c24fea" name="Add Final Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Final C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var finalC = "";
		if(ipa.matches(".*\\c$")) {
			finalC = (new IPATranscriptBuilder()).append(ipa.elementAt(ipa.length()-1)).toIPATranscript();
		}

		rowData[colIdx] = finalC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="cb45280d72994e7d" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.exactMatch">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.caseSensitive">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Final C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="497" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e7c646ba02ba4639" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Final C">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="719" y="313"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a42ce0d12f9f4c7c" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="709" y="485"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="3da1c8d31c6438d" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="907" y="336"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="bf1f40b23da04ebd" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Final C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1138" y="373"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="99089c613675447c" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="703" y="667">
                                                                    <oga:default for="sectionName" type="java.lang.String">Final Consonants</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="e796e5e494c24fea" destField="table" source="399d28dd46dd4335" sourceField="obj"/>
                                                        <link dest="3da1c8d31c6438d" destField="table" source="e7c646ba02ba4639" sourceField="table"/>
                                                        <link dest="bf1f40b23da04ebd" destField="table" source="3da1c8d31c6438d" sourceField="table"/>
                                                        <link dest="cb45280d72994e7d" destField="table" source="e796e5e494c24fea" sourceField="table"/>
                                                        <link dest="e7c646ba02ba4639" destField="table" source="cb45280d72994e7d" sourceField="trueTable"/>
                                                        <link dest="a42ce0d12f9f4c7c" destField="obj" source="cb45280d72994e7d" sourceField="trueTable"/>
                                                        <link dest="3da1c8d31c6438d" destField="total" source="a42ce0d12f9f4c7c" sourceField="rowCount"/>
                                                        <link dest="99089c613675447c" destField="table" source="bf1f40b23da04ebd" sourceField="table"/>
                                                        <link dest="99089c613675447c" destField="parent" source="49e515796d0f4a61" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="399d28dd46dd4335"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="49e515796d0f4a61"/>
                                                    <ogcn:published_output field="table" name="table" ref="e7c646ba02ba4639"/>
                                                    <extensions>
                                                        <oga:meta x="425" y="38"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="d6559a0ea6734630" name="Final Consonants (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="7e44a796">
                                                        <node id="be83489dc8d04f0b" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="8be7e632a364635" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="25" y="226"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d9a5008c9bd4d3d" name="Add Final Consonant Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {

}

function tableOp(context, table) {
	var colIdx = table.columnCount;

	table.setColumnTitle(colIdx, "Final C");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "IPA Actual (Word)")).toIPATranscript();
		ipa = ipa.removePunctuation();

		var finalC = "";
		if(ipa.matches(".*\\c$")) {
			finalC = (new IPATranscriptBuilder()).append(ipa.elementAt(ipa.length()-1)).toIPATranscript();
		}

		rowData[colIdx] = finalC;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="dafe5e027bf4fa0" name="Partition Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="trueTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from input table which match filter</output>
                                                            <output name="falseTable" type="ca.phon.query.report.datasource.DefaultTableDataSource">Table of rows from output table which do not match the filter</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="filters.column.filter">
                                                                        <![CDATA[.+]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.filterType">
                                                                        <![CDATA[Regular expression]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.exactMatch">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 201, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Partition Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Partition table using a standard query filter and column name.
  */
var PatternFilter = require("lib/PatternFilter").PatternFilter;

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

var filters = {
    "column": new PatternFilter("filters.column")
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);

	filters.column.param_setup(params);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("trueTable", "Table of rows from input table which match filter", false, DefaultTableDataSource);
	outputs.add("falseTable", "Table of rows from output table which do not match the filter", false, DefaultTableDataSource);
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);
	if(col < 0)
		return; // column not found

	// create output tables
	trueTable = new DefaultTableDataSource();
	falseTable = new DefaultTableDataSource();
	for(c = 0; c < table.columnCount; c++) {
	    var colTitle = table.getColumnTitle(c);
	    trueTable.setColumnTitle(c, colTitle);
	    falseTable.setColumnTitle(c, colTitle);
	}

	for(row = 0; row < table.rowCount; row++) {
		rowData = table.getRow(row);
		rowMatches = filterRow(table, row, col);

		if(rowMatches == true) {
			trueTable.addRow(rowData);
		} else {
			falseTable.addRow(rowData);
		}
	}

	context.put("trueTable", trueTable);
	context.put("falseTable", falseTable);
}

function filterRow(table, row, col) {
	var value = table.getValueAt(row, col);
	if(value == null) return false;

	return filters.column.check_filter(value);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="filters.column.caseSensitive">
                                                                        <![CDATA[false]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Final C]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="500" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ef4fb90e392c4cb6" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Final C">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="737" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="218889008dac40bf" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
//	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
//	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	// calculate column totals
	var columnTotals = [];
	for(var col = 1; col < table.columnCount; col++) {
		var sessionName = table.getColumnTitle(col);
		var total = 0;
		for(var row = 0; row < table.rowCount; row++) {
			total += table.getValueAt(row, col).intValue();
		}

		columnTotals[sessionName] = total;
	}
	
	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = columnTotals[table.getColumnTitle(col)];
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="934" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="adbd3ad0cb4b43d1" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Final C" order="ascending" type="ipa"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="1171" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="ebda74c2b79d4478" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="519" y="267">
                                                                    <oga:default for="sectionName" type="java.lang.String">Final Consonants (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="d9a5008c9bd4d3d" destField="table" source="be83489dc8d04f0b" sourceField="obj"/>
                                                        <link dest="218889008dac40bf" destField="table" source="ef4fb90e392c4cb6" sourceField="table"/>
                                                        <link dest="adbd3ad0cb4b43d1" destField="table" source="218889008dac40bf" sourceField="freqTable"/>
                                                        <link dest="dafe5e027bf4fa0" destField="table" source="d9a5008c9bd4d3d" sourceField="table"/>
                                                        <link dest="ef4fb90e392c4cb6" destField="table" source="dafe5e027bf4fa0" sourceField="trueTable"/>
                                                        <link dest="ebda74c2b79d4478" destField="table" source="adbd3ad0cb4b43d1" sourceField="table"/>
                                                        <link dest="ebda74c2b79d4478" destField="parent" source="8be7e632a364635" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="be83489dc8d04f0b"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="8be7e632a364635"/>
                                                    <extensions>
                                                        <oga:meta x="425" y="208"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="1671acd81a254deb" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique final consonants";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="761" y="386"/>
                                                    </extensions>
                                                </node>
                                                <link dest="ba234bc06044493" destField="table" source="1f5d33ecef304cb0" sourceField="obj"/>
                                                <link dest="d6559a0ea6734630" destField="table" source="1f5d33ecef304cb0" sourceField="obj"/>
                                                <link dest="1671acd81a254deb" destField="inventory" source="ba234bc06044493" sourceField="table"/>
                                                <link dest="1671acd81a254deb" destField="table" source="a10e62c65ef249dc" sourceField="obj"/>
                                                <link dest="ba234bc06044493" destField="reportNode" source="136b54badd344d2b" sourceField="obj"/>
                                                <link dest="d6559a0ea6734630" destField="reportNode" source="136b54badd344d2b" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="1f5d33ecef304cb0"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="a10e62c65ef249dc"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="136b54badd344d2b"/>
                                            <extensions>
                                                <oga:meta x="515" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="a58b0709ae354b92" name="Vowels" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="6da75228">
                                                <node id="83fd1073eaf34354" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="8ac8ab3a2c994a78" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="176"/>
                                                    </extensions>
                                                </node>
                                                <node id="7620df2c473448fb" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="30" y="401"/>
                                                    </extensions>
                                                </node>
                                                <node id="7f37c150dc774505" name="Create Vowel Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="vowelTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	outputs.add("vowelTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var vowelTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	vowelTable.setColumnTitle(0, "Session");
	vowelTable.setColumnTitle(1, "Record");
	vowelTable.setColumnTitle(2, "Vowel");
	vowelTable.setColumnTitle(3, "Actual Syllabification (Word)");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var actualSyllabification = table.getValueAt(row, "Actual Syllabification (Word)");
		var ipa = (new IPATranscriptBuilder()).append(actualSyllabification).toIPATranscript();
		var sylls = ipa.syllables();

		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var syll = sylls.get(syllIdx);
			var phonexPattern = Packages.ca.phon.phonex.PhonexPattern.compile(".:N+");
			var matcher = phonexPattern.matcher(syll);
			if(matcher.find()) {
				var nucleus = (new IPATranscriptBuilder()).append(matcher.group()).toIPATranscript();

				var rowData = [];
				rowData[0] = table.getValueAt(row, 0);
				rowData[1] = table.getValueAt(row, "Record #");
				rowData[2] = nucleus;
				rowData[3] = actualSyllabification;
				vowelTable.addRow(rowData);
			}
		}
	}

	context.put("vowelTable", vowelTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="302" y="41"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="fa2f01608ff54e43" name="Vowels (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="5e0b78d9">
                                                        <node id="978caefd74a04abd" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="fc2ba74805f541b0" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="24" y="366"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e39e2dc7f9eb4435" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Vowel">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="cce641b3962b447e" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="4f4ae54f3cb04e2a" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="68c5101b7e2d4f7f" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Vowel" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="4d370c80c19049e7" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="716" y="344">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vowel Inventory</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="68c5101b7e2d4f7f" destField="table" source="4f4ae54f3cb04e2a" sourceField="table"/>
                                                        <link dest="4f4ae54f3cb04e2a" destField="total" source="cce641b3962b447e" sourceField="rowCount"/>
                                                        <link dest="cce641b3962b447e" destField="obj" source="978caefd74a04abd" sourceField="obj"/>
                                                        <link dest="4f4ae54f3cb04e2a" destField="table" source="e39e2dc7f9eb4435" sourceField="table"/>
                                                        <link dest="e39e2dc7f9eb4435" destField="table" source="978caefd74a04abd" sourceField="obj"/>
                                                        <link dest="4d370c80c19049e7" destField="parent" source="fc2ba74805f541b0" sourceField="obj"/>
                                                        <link dest="4d370c80c19049e7" destField="table" source="68c5101b7e2d4f7f" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="978caefd74a04abd"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="fc2ba74805f541b0"/>
                                                    <ogcn:published_output field="table" name="table" ref="e39e2dc7f9eb4435"/>
                                                    <extensions>
                                                        <oga:meta x="559" y="27"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="8f91ec051e594212" name="Vowels (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="67f2b654">
                                                        <node id="b0c8ebc086c147a4" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d73116dc500e4a9f" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="fba5abbd5ca24170" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Vowel">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:column>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="516569ba02e7473f" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="176"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="2c0e8cd547594ca7" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="441" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="2ad787b3a73c4d8f" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Vowel" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="678" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f2b336ebc72c4cb6" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="828" y="299">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vowel Inventory (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="fba5abbd5ca24170" destField="table" source="b0c8ebc086c147a4" sourceField="obj"/>
                                                        <link dest="516569ba02e7473f" destField="table" source="b0c8ebc086c147a4" sourceField="obj"/>
                                                        <link dest="2c0e8cd547594ca7" destField="tableMap" source="516569ba02e7473f" sourceField="tableMap"/>
                                                        <link dest="2c0e8cd547594ca7" destField="table" source="fba5abbd5ca24170" sourceField="table"/>
                                                        <link dest="2ad787b3a73c4d8f" destField="table" source="2c0e8cd547594ca7" sourceField="freqTable"/>
                                                        <link dest="f2b336ebc72c4cb6" destField="table" source="2ad787b3a73c4d8f" sourceField="table"/>
                                                        <link dest="f2b336ebc72c4cb6" destField="parent" source="d73116dc500e4a9f" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="b0c8ebc086c147a4"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="d73116dc500e4a9f"/>
                                                    <extensions>
                                                        <oga:meta x="557" y="175"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="3c51e8c8b9014440" name="Add Row to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of unique vowels";
	rowData[colIdx++] = new java.lang.Integer(inventory.rowCount);

	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="788" y="323"/>
                                                    </extensions>
                                                </node>
                                                <link dest="7f37c150dc774505" destField="table" source="83fd1073eaf34354" sourceField="obj"/>
                                                <link dest="8f91ec051e594212" destField="table" source="7f37c150dc774505" sourceField="vowelTable"/>
                                                <link dest="fa2f01608ff54e43" destField="table" source="7f37c150dc774505" sourceField="vowelTable"/>
                                                <link dest="3c51e8c8b9014440" destField="inventory" source="fa2f01608ff54e43" sourceField="table"/>
                                                <link dest="3c51e8c8b9014440" destField="table" source="7620df2c473448fb" sourceField="obj"/>
                                                <link dest="fa2f01608ff54e43" destField="reportNode" source="8ac8ab3a2c994a78" sourceField="obj"/>
                                                <link dest="8f91ec051e594212" destField="reportNode" source="8ac8ab3a2c994a78" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="83fd1073eaf34354"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="7620df2c473448fb"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="8ac8ab3a2c994a78"/>
                                            <extensions>
                                                <oga:meta x="755" y="179"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="38af73dc0adf4dbc" name="Syllable Structure" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="29f18165">
                                                <node id="6cbdc9ae160241af" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="15" y="15"/>
                                                    </extensions>
                                                </node>
                                                <node id="95807a31325043a8" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="23" y="195"/>
                                                    </extensions>
                                                </node>
                                                <node id="30cc11b3871d4dca" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="24" y="336"/>
                                                    </extensions>
                                                </node>
                                                <node id="d6aa7f8444f04982" name="Create Syllable Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <output name="syllTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
	outputs.add("syllTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}


var symbolMap = "H={glottal}; G=\\g; C=\\c; V=\\v";

function tableOp(context, table) {
	var syllTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	syllTable.setColumnTitle(0, "Session");
	syllTable.setColumnTitle(1, "Record");
	syllTable.setColumnTitle(2, "Syllable");
	syllTable.setColumnTitle(3, "Structure");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var ipa = (new IPATranscriptBuilder()).append(table.getValueAt(row, "Actual Syllabification (Word)")).toIPATranscript();
		var sylls = ipa.syllables();


		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var syll = sylls.get(syllIdx);

			var rowData = [];
			rowData[0] = table.getValueAt(row, 0);
			rowData[1] = table.getValueAt(row, "Record #");
			rowData[2] = syll;
			rowData[3] = syll.cover(symbolMap);
			syllTable.addRow(rowData);
		}
	}

	context.put("syllTable", syllTable);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="275" y="21"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="e5c3213a94e2487d" name="Syllable Strucutre (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="3b9656f">
                                                        <node id="21f28ba9a66e48da" name="obj" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d69d599fb8ba48a6" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="201d7d94257343f2" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Structure"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="241" y="24"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f3662213ffd64093" name="DefaultTableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="244" y="151"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f895cc5f99d944ce" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="b349c06af0b24f2d" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="a863b46cf034bc5" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="762" y="308">
                                                                    <oga:default for="sectionName" type="java.lang.String">Syllable Structure</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="b349c06af0b24f2d" destField="table" source="f895cc5f99d944ce" sourceField="table"/>
                                                        <link dest="f895cc5f99d944ce" destField="total" source="f3662213ffd64093" sourceField="rowCount"/>
                                                        <link dest="f3662213ffd64093" destField="obj" source="21f28ba9a66e48da" sourceField="obj"/>
                                                        <link dest="f895cc5f99d944ce" destField="table" source="201d7d94257343f2" sourceField="table"/>
                                                        <link dest="201d7d94257343f2" destField="table" source="21f28ba9a66e48da" sourceField="obj"/>
                                                        <link dest="a863b46cf034bc5" destField="parent" source="d69d599fb8ba48a6" sourceField="obj"/>
                                                        <link dest="a863b46cf034bc5" destField="table" source="b349c06af0b24f2d" sourceField="table"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="21f28ba9a66e48da"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="d69d599fb8ba48a6"/>
                                                    <ogcn:published_output field="table" name="table" ref="201d7d94257343f2"/>
                                                    <extensions>
                                                        <oga:meta x="557" y="29"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="2a0c491e6e9247e4" name="Syllable Strucutre (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="481d57e7">
                                                        <node id="bed0c00554744209" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="f208c3cf18094325" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="c6e901a333664bc7" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Structure"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="7d8cb4da5e1547d0" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="917efa0a8c25432e" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="7cfa0cf457714408" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="bbcbc45d3dc642b4" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="688" y="322">
                                                                    <oga:default for="sectionName" type="java.lang.String">Syllable Structure (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="c6e901a333664bc7" destField="table" source="bed0c00554744209" sourceField="obj"/>
                                                        <link dest="7d8cb4da5e1547d0" destField="table" source="bed0c00554744209" sourceField="obj"/>
                                                        <link dest="917efa0a8c25432e" destField="tableMap" source="7d8cb4da5e1547d0" sourceField="tableMap"/>
                                                        <link dest="917efa0a8c25432e" destField="table" source="c6e901a333664bc7" sourceField="table"/>
                                                        <link dest="7cfa0cf457714408" destField="table" source="917efa0a8c25432e" sourceField="freqTable"/>
                                                        <link dest="bbcbc45d3dc642b4" destField="table" source="7cfa0cf457714408" sourceField="table"/>
                                                        <link dest="bbcbc45d3dc642b4" destField="parent" source="f208c3cf18094325" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="bed0c00554744209"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="f208c3cf18094325"/>
                                                    <extensions>
                                                        <oga:meta x="555" y="184"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="3432fc0393324f61" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <input name="numVocs" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
	inputs.add("numVocs", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");
	var numVocs = context.get("numVocs");



	// add % vocalizations with CV or CVC
	var countCV = 0;
	var countFinalC = 0;
	var total = 0;
	for(var row = 0; row < inventory.rowCount; row++) {
		var pattern = inventory.getValueAt(row, 0);
		var c = inventory.getValueAt(row, 1);

		if(pattern.toString().contains("CV")) {
			countCV += c.intValue();
		}

		if(pattern.toString().endsWith("C")) {
			countFinalC += c.intValue();
		}
		
		total += c.intValue();
	}
	var freqCV = (countCV / total) * 100.0; 
	var freqFinalC = (countFinalC / total) * 100.0;

	var syllsPerVoc = total / numVocs;

	var rowData = [];
	var colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of syllables / word";
	rowData[colIdx++] = new java.lang.Float(syllsPerVoc);
	table.addRow(rowData);
	
	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of syllables that include a CV sequence";
	rowData[colIdx++] = new java.lang.Float(freqCV);
	table.addRow(rowData);

	rowData = [];
	colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of syllables that end with a C";
	rowData[colIdx++] = new java.lang.Float(freqFinalC);
	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="900" y="332"/>
                                                    </extensions>
                                                </node>
                                                <link dest="d6aa7f8444f04982" destField="table" source="6cbdc9ae160241af" sourceField="obj"/>
                                                <link dest="e5c3213a94e2487d" destField="table" source="d6aa7f8444f04982" sourceField="syllTable"/>
                                                <link dest="2a0c491e6e9247e4" destField="table" source="d6aa7f8444f04982" sourceField="syllTable"/>
                                                <link dest="3432fc0393324f61" destField="inventory" source="e5c3213a94e2487d" sourceField="table"/>
                                                <link dest="3432fc0393324f61" destField="table" source="95807a31325043a8" sourceField="obj"/>
                                                <link dest="3432fc0393324f61" destField="numVocs" source="6cbdc9ae160241af" sourceField="rowCount"/>
                                                <link dest="e5c3213a94e2487d" destField="reportNode" source="30cc11b3871d4dca" sourceField="obj"/>
                                                <link dest="2a0c491e6e9247e4" destField="reportNode" source="30cc11b3871d4dca" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="6cbdc9ae160241af"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="95807a31325043a8"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="30cc11b3871d4dca"/>
                                            <extensions>
                                                <oga:meta x="275" y="340"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="9cf64e0a651444ff" name="Vocalization Structure" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="6e34ddb0">
                                                <node id="cdea75731ca84205" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="36"/>
                                                    </extensions>
                                                </node>
                                                <node id="6bb4e51191304e63" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="177"/>
                                                    </extensions>
                                                </node>
                                                <node id="9ee758cc17c04f65" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="29" y="318"/>
                                                    </extensions>
                                                </node>
                                                <node id="183054d95a184fc0" name="Add IPA Cover Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[importClass(Packages.ca.phon.ipa.IPATranscriptBuilder)

function init(inputs, outputs) {
}

var symbolMap = "H={glottal}; G=\\g; C=\\c; V=\\v";

function tableOp(context, table) {
	var structureColIdx = table.columnCount;
	table.setColumnTitle(structureColIdx, "Structure");

	for(var row = 0; row < table.rowCount; row++) {
		var tableData = table.getRow(row);

		var ipa = table.getValueAt(row, "IPA Actual (Word)");

		var builder = new IPATranscriptBuilder();
		builder.append(table.getValueAt(row, "Actual Syllabification (Word)"));
		var sylls = builder.toIPATranscript().syllables();

		builder = new IPATranscriptBuilder();
		for(var syllIdx = 0; syllIdx < sylls.size(); syllIdx++) {
			var coveredIPA = sylls.get(syllIdx).cover(symbolMap);
			if(builder.size() > 0 && !coveredIPA.matches("^\\s.*")) {
				builder.appendSyllableBoundary();
			}
			builder.append(coveredIPA);
		}
		tableData[structureColIdx] = builder.toIPATranscript();
	}
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="281" y="115"/>
                                                    </extensions>
                                                </node>
                                                <ogcn:macro id="97817053cb3e4baa" name="Structures (Total)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="7764ccc0">
                                                        <node id="f13d51c9362b4b66" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d57e5441621a4329" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="31" y="212"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9a1e28c87dea4d56" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:column caseSensitive="false" column="Structure"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="244" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="60b873c3c6c44892" name="Add Frequency Column" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="total" optional="false"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("total", "", false, false);
}

function tableOp(context, table) {
	var total = context.get("total");
	var colIdx = table.columnCount;
	table.setColumnTitle(colIdx, "%");

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = table.getRow(row);
		var count = rowData[1];
		var freq = (count / total) * 100.0;

		rowData[2] = freq;
	}
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="441" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="9f404c4498064219" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="678" y="30"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="78383fba7a134332" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="690" y="225">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vocalization Structure</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="9f404c4498064219" destField="table" source="60b873c3c6c44892" sourceField="table"/>
                                                        <link dest="60b873c3c6c44892" destField="table" source="9a1e28c87dea4d56" sourceField="table"/>
                                                        <link dest="60b873c3c6c44892" destField="total" source="f13d51c9362b4b66" sourceField="rowCount"/>
                                                        <link dest="9a1e28c87dea4d56" destField="table" source="f13d51c9362b4b66" sourceField="obj"/>
                                                        <link dest="78383fba7a134332" destField="table" source="9f404c4498064219" sourceField="table"/>
                                                        <link dest="78383fba7a134332" destField="parent" source="d57e5441621a4329" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="f13d51c9362b4b66"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="d57e5441621a4329"/>
                                                    <ogcn:published_output field="table" name="table" ref="9a1e28c87dea4d56"/>
                                                    <extensions>
                                                        <oga:meta x="564" y="26"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <ogcn:macro id="df4a061e176c42e1" name="Structures (by Session)" type="ca.phon.opgraph.nodes.general.MacroNode">
                                                    <graph id="3fd2a38c">
                                                        <node id="f63a9528a9de439f" name="TableDataSource" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="15" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="d553c8da6a8f4778" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                        <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="41" y="347"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="bc68d0c57f5d4cb9" type="class:ca.phon.app.opgraph.nodes.table.InventoryNode">
                                                            <extensions>
                                                                <opqry:inventoryoptions>
                                                                    <opqry:automaticConfiguration configureAutomatically="false">
                                                                        <opqry:autoGrouping column="Age" grouping="true"/>
                                                                        <opqry:autoColumns caseSensitive="false" includeAdditionalGroupData="false" includeAdditionalWordData="false" includeMetadata="true"/>
                                                                    </opqry:automaticConfiguration>
                                                                    <opqry:groupBy caseSensitive="false" column="Session">
                                                                        <opqry:ignoreDiacritics ignore="true" onlyOrExcept="except"/>
                                                                    </opqry:groupBy>
                                                                    <opqry:column caseSensitive="false" column="Structure"/>
                                                                </opqry:inventoryoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="242" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="e8b89923fd7543dd" name="Split Table" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <output name="keySet" type="java.util.Set">Unique values from given column name</output>
                                                            <output name="tableMap" type="java.util.Map">Map of key -&gt; table values</output>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[/*
 * Phon - An open source tool for research in phonology.
 * Copyright (C) 2005 - 2017, Gregory Hedlund <ghedlund@mun.ca> and Yvan Rose <yrose@mun.ca>
 * Dept of Linguistics, Memorial University <https://phon.ca>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

 /**
  * Split Table.js
  *
  * Script for use with ca.phon.app.opgraph.nodes.table.TableScriptNode
  *
  * Split table based on column name.  Two outputs
  * are produced, a set of keys from the column used in the filter  and a
  * map of key -> table values.
  */

var columnParamInfo = {
	"id": "columnName",
	"title": "Column Name",
	"def": "",
	"prompt": "Enter column name"
}

function setup_params(params) {
	var columnParam = new StringScriptParam(
		columnParamInfo.id,
		columnParamInfo.title,
		columnParamInfo.def);
	columnParam.setPrompt(columnParamInfo.prompt);
	params.add(columnParam);
}

// add custom inputs/outputs here
function init(inputs, outputs) {
	outputs.add("keySet", "Unique values from given column name", false, java.util.Set);
	outputs.add("tableMap", "Map of key -> table values", false, java.util.Map);
}

/*
 * Create a new table with the same schema as the inputTable
 */
function setupTable(inputTable) {
    var table = new DefaultTableDataSource();
    for(c = 0; c < inputTable.columnCount; c++) {
	    var colTitle = inputTable.getColumnTitle(c);
	    table.setColumnTitle(c, colTitle);
	}
	return table;
}

// run operation on table
function tableOp(context, table) {
	// find table column index
	col = table.getColumnIndex(columnName);

	if(col < 0)
		return; // column not found

	var tableMap = new java.util.LinkedHashMap();

	for(row = 0; row < table.rowCount; row++) {
	    // use string value as row key
		var rowKey = Packages.ca.phon.formatter.FormatterUtil.format(table.getValueAt(row, col));

		var keyTable = tableMap.get(rowKey);
		if(keyTable == null) {
		    keyTable = setupTable(table);
		    tableMap.put(rowKey, keyTable);
		}
		keyTable.addRow(table.getRow(row));
	}

	context.put("keySet", tableMap.keySet());
	context.put("tableMap", tableMap);
}
]]>
                                                                    </oga:property>
                                                                    <oga:property key="columnName">
                                                                        <![CDATA[Session]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="242" y="156"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="1b918956f553412d" name="Add Frequency Columns" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                            <input name="tableMap" optional="false"/>
                                                            <output name="freqTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="__script">
                                                                        <![CDATA[function init(inputs, outputs) {
	inputs.add("tableMap", "", false, false);

	outputs.add("freqTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function tableOp(context, table) {
	var tableMap = context.get("tableMap");
	var freqTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();

	// setup columns
	freqTable.setColumnTitle(0, table.getColumnTitle(0));

	var colIdx = 1;
	for(var col = 1; col < table.columnCount; col++) {
		freqTable.setColumnTitle(colIdx++, table.getColumnTitle(col));
		freqTable.setColumnTitle(colIdx++, "% " + table.getColumnTitle(col));
	}

	for(var row = 0; row < table.rowCount; row++) {
		var rowData = [];
		var tableData = table.getRow(row);

		rowData[0] = tableData[0];
		colIdx = 1;

		for(var col = 1; col < table.columnCount; col++) {
			var total = tableMap.get(table.getColumnTitle(col)).rowCount;
			var count = tableData[col];
			var freq = (count / total) * 100.0;

			rowData[colIdx++] = new java.lang.Integer(count);
			rowData[colIdx++] = freq;
		}

		freqTable.addRow(rowData);
	}

	context.put("freqTable", freqTable);
}
]]>
                                                                    </oga:property>
                                                                </oga:settings>
                                                                <oga:meta x="417" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="78d87a9dfa774d92" type="class:ca.phon.app.opgraph.nodes.table.SortNode">
                                                            <extensions>
                                                                <opqry:sortoptions autoSortOrder="ascending" configureAutomatically="false">
                                                                    <opqry:sortBy column="Structure" order="ascending" type="plain"/>
                                                                </opqry:sortoptions>
                                                                <oga:settings/>
                                                                <oga:meta x="652" y="15"/>
                                                            </extensions>
                                                        </node>
                                                        <node id="73838b1dab034271" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                            <extensions>
                                                                <oga:settings>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                        <![CDATA[true]]>
                                                                    </oga:property>
                                                                    <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                                                                </oga:settings>
                                                                <oga:meta x="635" y="372">
                                                                    <oga:default for="sectionName" type="java.lang.String">Vocalization Structure (by Session)</oga:default>
                                                                </oga:meta>
                                                            </extensions>
                                                        </node>
                                                        <link dest="1b918956f553412d" destField="tableMap" source="e8b89923fd7543dd" sourceField="tableMap"/>
                                                        <link dest="1b918956f553412d" destField="table" source="bc68d0c57f5d4cb9" sourceField="table"/>
                                                        <link dest="78d87a9dfa774d92" destField="table" source="1b918956f553412d" sourceField="freqTable"/>
                                                        <link dest="bc68d0c57f5d4cb9" destField="table" source="f63a9528a9de439f" sourceField="obj"/>
                                                        <link dest="e8b89923fd7543dd" destField="table" source="f63a9528a9de439f" sourceField="obj"/>
                                                        <link dest="73838b1dab034271" destField="table" source="78d87a9dfa774d92" sourceField="table"/>
                                                        <link dest="73838b1dab034271" destField="parent" source="d553c8da6a8f4778" sourceField="obj"/>
                                                        <extensions>
                                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                        </extensions>
                                                    </graph>
                                                    <ogcn:published_input field="obj" name="table" ref="f63a9528a9de439f"/>
                                                    <ogcn:published_input field="obj" name="reportNode" ref="d553c8da6a8f4778"/>
                                                    <extensions>
                                                        <oga:meta x="564" y="167"/>
                                                    </extensions>
                                                </ogcn:macro>
                                                <node id="cdaafb1fa8e2466d" name="Add to Summary" type="class:ca.phon.app.opgraph.nodes.table.TableScriptNode">
                                                    <input name="inventory" optional="false"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[function init(inputs, outputs) {
	inputs.add("inventory", "");
}

function tableOp(context, table) {
	var inventory = context.get("inventory");

	var rowData = [];
	var colIdx = 0;

	// add % vocalizations with CV or CVC
	var countCV = 0;
	var countCC = 0;
	var total = 0;
	for(var row = 0; row < inventory.rowCount; row++) {
		var pattern = inventory.getValueAt(row, 0);
		var c = inventory.getValueAt(row, 1);

		if(pattern.toString().contains("CV")) {
			countCV += c.intValue();
		}

		if(pattern.toString().contains("CC")) {
			countCC += c.intValue();
		}
		
		total += c.intValue();
	}
	var freqCV = (countCV / total) * 100.0; 
	var freqCC = (countCC / total) * 100.0;
	
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of words that include a CV sequence";
	rowData[colIdx++] = new java.lang.Float(freqCV);
	table.addRow(rowData);

	rowData = [];
	colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of words that include at least one CC sequence";
	rowData[colIdx++] = new java.lang.Float(freqCC);
	table.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="875" y="321"/>
                                                    </extensions>
                                                </node>
                                                <link dest="cdaafb1fa8e2466d" destField="inventory" source="97817053cb3e4baa" sourceField="table"/>
                                                <link dest="cdaafb1fa8e2466d" destField="table" source="6bb4e51191304e63" sourceField="obj"/>
                                                <link dest="183054d95a184fc0" destField="table" source="cdea75731ca84205" sourceField="obj"/>
                                                <link dest="97817053cb3e4baa" destField="table" source="183054d95a184fc0" sourceField="table"/>
                                                <link dest="df4a061e176c42e1" destField="table" source="183054d95a184fc0" sourceField="table"/>
                                                <link dest="97817053cb3e4baa" destField="reportNode" source="9ee758cc17c04f65" sourceField="obj"/>
                                                <link dest="df4a061e176c42e1" destField="reportNode" source="9ee758cc17c04f65" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="cdea75731ca84205"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="6bb4e51191304e63"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="9ee758cc17c04f65"/>
                                            <extensions>
                                                <oga:meta x="515" y="342"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <ogcn:macro id="c73c9bae46474e4d" name="Harmony" type="ca.phon.opgraph.nodes.general.MacroNode">
                                            <graph id="78221742">
                                                <node id="e9a2cc1a1d8f4df9" name="table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.DefaultTableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="25"/>
                                                    </extensions>
                                                </node>
                                                <node id="2beb8286fa145c0" name="Summary Table" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.query.report.datasource.TableDataSource]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="186"/>
                                                    </extensions>
                                                </node>
                                                <node id="6ca9f5232d3f4cc3" name="Report Node" type="class:ca.phon.opgraph.nodes.reflect.ObjectNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.opgraph.nodes.reflect.ObjectNode.declaredClass">
                                                                <![CDATA[ca.phon.app.opgraph.report.tree.ReportTreeNode]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="28" y="327"/>
                                                    </extensions>
                                                </node>
                                                <node id="808786ee0d464dad" name="Add Harmony to Summary" type="class:ca.phon.app.opgraph.nodes.PhonScriptNode">
                                                    <input name="inputTable" optional="false"/>
                                                    <input name="summaryTable" optional="false"/>
                                                    <output name="cHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <output name="vHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <output name="cvcHarmonyTable" type="ca.phon.query.report.datasource.DefaultTableDataSource"/>
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="__script">
                                                                <![CDATA[
function init(inputs, outputs) {
	inputs.add("inputTable", "", false, false);
	inputs.add("summaryTable", "", false, false);
	
	outputs.add("cHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
	outputs.add("vHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
	outputs.add("cvcHarmonyTable", "", false, Packages.ca.phon.query.report.datasource.DefaultTableDataSource);
}

function copyTableSchema(table, destTable) {
	for(var col = 0; col < table.columnCount; col++) {
		destTable.setColumnTitle(col, table.getColumnTitle(col));
	}
}

function run(context) {
	var inputTable = context.get("inputTable");
	var summaryTable = context.get("summaryTable");

	var cHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, cHarmonyTable);
	
	var vHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, vHarmonyTable);
	
	var cvcHarmonyTable = new Packages.ca.phon.query.report.datasource.DefaultTableDataSource();
	copyTableSchema(inputTable, cvcHarmonyTable);

	context.put("cHarmonyTable", cHarmonyTable);
	context.put("vHarmonyTable", vHarmonyTable);
	context.put("cvcHarmonyTable", cvcHarmonyTable);
	
	var num2PlusSylls = 0;
	var num2PlusSyllsWithCHarmony = 0;
	var num2PlusSyllsWithVHarmony = 0;
	var numCVC = 0;
	var numCVCWithHarmony = 0;

	var colIdx = inputTable.getColumnIndex("Actual Syllabification (Word)");
	
	var harmonyDetector = new Packages.ca.phon.query.detectors.FlatHarmonyDetector();
	for(var row = 0; row < inputTable.rowCount; row++) {
		var rowData = inputTable.getRow(row);

		try {
			var ipa = IPATranscript.parseIPATranscript(
				inputTable.getValueAt(row, colIdx));
			
			if(ipa.syllables().size() >= 2) {
				++num2PlusSylls;
				var harmonies = harmonyDetector.detectConsonantHarmony(ipa);
		
				if(harmonies.size() > 0) {
					++num2PlusSyllsWithCHarmony;
					cHarmonyTable.addRow(rowData);
				}
	
				harmonies = harmonyDetector.detectVowelHarmony(ipa);
				if(harmonies.size() > 0) {
					++num2PlusSyllsWithVHarmony;
					vHarmonyTable.addRow(rowData);
				}
			}
	
			if(ipa.matchesCVPattern("CVC")) {
				++numCVC;
				var harmonies = harmonyDetector.detectConsonantHarmony(ipa);
				
				if(harmonies.size() > 0) {
					++numCVCWithHarmony;
					cvcHarmonyTable.addRow(rowData);
				}
			}
		} catch (e) {
			// ignore errors in transcriptions
		}
	}

	var rowData = [];
	var colIdx = 0;

	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of words with at least two syllables";
	rowData[colIdx++] = new java.lang.Integer(num2PlusSylls);
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of words with at least two syllables and some consonant harmony";
	rowData[colIdx++] = (num2PlusSylls > 0 ? new java.lang.Float((num2PlusSyllsWithCHarmony/num2PlusSylls) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);
	
	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of words with at least two syllables and some vowel harmony";
	rowData[colIdx++] = (num2PlusSylls > 0 ? new java.lang.Float((num2PlusSyllsWithVHarmony/num2PlusSylls) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "# of CVC words";
	rowData[colIdx++] = new java.lang.Integer(numCVC);
	summaryTable.addRow(rowData);

	rowData = [];
	colIdx = 0;
	rowData[colIdx++] = "";
	rowData[colIdx++] = "% of CVC words with consonant harmony";
	rowData[colIdx++] = (numCVC > 0 ? new java.lang.Float((numCVCWithHarmony/numCVC) * 100.0) : new java.lang.Float(0.0));
	summaryTable.addRow(rowData);
}
]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="321" y="119"/>
                                                    </extensions>
                                                </node>
                                                <node id="f233b677f43a4865" name="Consonant Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[false]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                                                <![CDATA[Date
Group #
Tier
Range
Result
Initial C
Final C
Structure
Actual Syllabification (Word)]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="707" y="78">
                                                            <oga:default for="sectionName" type="java.lang.String">Multi-syllabic Consonant Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="33e67d28492489e" name="Vowel Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[false]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                                                <![CDATA[Date
Group #
Tier
Range
Result
Initial C
Final C
Structure
Actual Syllabification (Word)]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="707" y="235">
                                                            <oga:default for="sectionName" type="java.lang.String">Multi-syllabic Vowel Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <node id="665ffe881acb4317" name="CVC Harmony" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                                                    <extensions>
                                                        <oga:settings>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                                                <![CDATA[false]]>
                                                            </oga:property>
                                                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns">
                                                                <![CDATA[Date
Group #
Tier
Range
Result
Initial C
Final C
Structure
Actual Syllabification (Word)]]>
                                                            </oga:property>
                                                        </oga:settings>
                                                        <oga:meta x="712" y="401">
                                                            <oga:default for="sectionName" type="java.lang.String">CVC Consonant Harmony</oga:default>
                                                        </oga:meta>
                                                    </extensions>
                                                </node>
                                                <link dest="808786ee0d464dad" destField="inputTable" source="e9a2cc1a1d8f4df9" sourceField="obj"/>
                                                <link dest="808786ee0d464dad" destField="summaryTable" source="2beb8286fa145c0" sourceField="obj"/>
                                                <link dest="f233b677f43a4865" destField="table" source="808786ee0d464dad" sourceField="cHarmonyTable"/>
                                                <link dest="f233b677f43a4865" destField="parent" source="6ca9f5232d3f4cc3" sourceField="obj"/>
                                                <link dest="33e67d28492489e" destField="table" source="808786ee0d464dad" sourceField="vHarmonyTable"/>
                                                <link dest="33e67d28492489e" destField="parent" source="6ca9f5232d3f4cc3" sourceField="obj"/>
                                                <link dest="665ffe881acb4317" destField="table" source="808786ee0d464dad" sourceField="cvcHarmonyTable"/>
                                                <link dest="665ffe881acb4317" destField="parent" source="6ca9f5232d3f4cc3" sourceField="obj"/>
                                                <extensions>
                                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                                </extensions>
                                            </graph>
                                            <ogcn:published_input field="obj" name="table" ref="e9a2cc1a1d8f4df9"/>
                                            <ogcn:published_input field="obj" name="summaryTable" ref="2beb8286fa145c0"/>
                                            <ogcn:published_input field="obj" name="reportNode" ref="6ca9f5232d3f4cc3"/>
                                            <extensions>
                                                <oga:meta x="755" y="342"/>
                                            </extensions>
                                        </ogcn:macro>
                                        <link dest="eb12aa21e53e480b" destField="tableMap" source="2466829eca3e4f41" sourceField="obj"/>
                                        <link dest="7c813837d09b4c64" destField="table" source="db131da6c3774b25" sourceField="obj"/>
                                        <link dest="38af73dc0adf4dbc" destField="table" source="db131da6c3774b25" sourceField="obj"/>
                                        <link dest="9d52041deaa7490c" destField="data" source="db131da6c3774b25" sourceField="obj"/>
                                        <link dest="d7b8cae633634373" destField="table" source="db131da6c3774b25" sourceField="obj"/>
                                        <link dest="a58b0709ae354b92" destField="table" source="db131da6c3774b25" sourceField="obj"/>
                                        <link dest="eb12aa21e53e480b" destField="summaryTable" source="b72ef136d4f34592" sourceField="obj"/>
                                        <link dest="7c813837d09b4c64" destField="summaryTable" source="b72ef136d4f34592" sourceField="obj"/>
                                        <link dest="d7b8cae633634373" destField="summaryTable" source="b72ef136d4f34592" sourceField="obj"/>
                                        <link dest="a58b0709ae354b92" destField="summaryTable" source="b72ef136d4f34592" sourceField="obj"/>
                                        <link dest="9cf64e0a651444ff" destField="table" source="db131da6c3774b25" sourceField="obj"/>
                                        <link dest="9cf64e0a651444ff" destField="summaryTable" source="b72ef136d4f34592" sourceField="obj"/>
                                        <link dest="38af73dc0adf4dbc" destField="summaryTable" source="b72ef136d4f34592" sourceField="obj"/>
                                        <link dest="c73c9bae46474e4d" destField="summaryTable" source="b72ef136d4f34592" sourceField="obj"/>
                                        <link dest="c73c9bae46474e4d" destField="table" source="db131da6c3774b25" sourceField="obj"/>
                                        <link dest="9d52041deaa7490c" destField="reportNode" source="c4656e8a32a54314" sourceField="obj"/>
                                        <link dest="eb12aa21e53e480b" destField="reportNode" source="c4656e8a32a54314" sourceField="obj"/>
                                        <link dest="7c813837d09b4c64" destField="reportNode" source="c4656e8a32a54314" sourceField="obj"/>
                                        <link dest="d7b8cae633634373" destField="reportNode" source="c4656e8a32a54314" sourceField="obj"/>
                                        <link dest="a58b0709ae354b92" destField="reportNode" source="c4656e8a32a54314" sourceField="obj"/>
                                        <link dest="38af73dc0adf4dbc" destField="reportNode" source="c4656e8a32a54314" sourceField="obj"/>
                                        <link dest="9cf64e0a651444ff" destField="reportNode" source="c4656e8a32a54314" sourceField="obj"/>
                                        <link dest="c73c9bae46474e4d" destField="reportNode" source="c4656e8a32a54314" sourceField="obj"/>
                                        <link dest="23e91cc1e09845ca" destField="summaryTable" source="b72ef136d4f34592" sourceField="obj"/>
                                        <link dest="23e91cc1e09845ca" destField="data" source="db131da6c3774b25" sourceField="obj"/>
                                        <link dest="23e91cc1e09845ca" destField="reportNode" source="c4656e8a32a54314" sourceField="obj"/>
                                        <extensions>
                                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                        </extensions>
                                    </graph>
                                    <ogcn:published_input field="obj" name="speaker" ref="6ee0036538e64a47"/>
                                    <ogcn:published_input field="obj" name="table" ref="db131da6c3774b25"/>
                                    <ogcn:published_input field="obj" name="tableMap" ref="2466829eca3e4f41"/>
                                    <ogcn:published_input field="obj" name="result total" ref="c35f1e7dd60f4a94"/>
                                    <ogcn:published_input field="obj" name="summaryTable" ref="b72ef136d4f34592"/>
                                    <ogcn:published_input field="obj" name="reportNode" ref="c4656e8a32a54314"/>
                                    <extensions>
                                        <oga:meta x="605" y="66"/>
                                    </extensions>
                                </ogcn:macro>
                                <link dest="9852428936354315" destField="table" source="6893103afc764a97" sourceField="obj"/>
                                <link dest="413ec086002946e0" destField="tableMap" source="9852428936354315" sourceField="tableMap"/>
                                <link dest="413ec086002946e0" destField="table" source="6893103afc764a97" sourceField="obj"/>
                                <link dest="413ec086002946e0" destField="speaker" source="b81fe8a26e58401c" sourceField="obj"/>
                                <link dest="413ec086002946e0" destField="result total" source="6893103afc764a97" sourceField="rowCount"/>
                                <link dest="413ec086002946e0" destField="summaryTable" source="23d24c0285114af2" sourceField="obj"/>
                                <link dest="506b8dbbf94c44fa" destField="parent" source="ebfdb91fa4a84761" sourceField="obj"/>
                                <link dest="413ec086002946e0" destField="reportNode" source="506b8dbbf94c44fa" sourceField="section"/>
                                <extensions>
                                    <oga:notes>
                                        <oga:note color="0xffff96" height="879" title="Inputs" width="323" x="9" y="19"/>
                                    </oga:notes>
                                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                                </extensions>
                            </graph>
                            <ogcn:published_input field="obj" name="tableMap" ref="6893103afc764a97"/>
                            <ogcn:published_input field="obj" name="speaker" ref="b81fe8a26e58401c"/>
                            <ogcn:published_input field="obj" name="summaryTable" ref="23d24c0285114af2"/>
                            <ogcn:published_input field="obj" name="reportNode" ref="ebfdb91fa4a84761"/>
                            <extensions>
                                <oga:meta x="630" y="168"/>
                            </extensions>
                        </ogcn:macro>
                        <link dest="14e8ff33cbaf43c9" destField="speaker" source="d3b316447a5c4962" sourceField="obj"/>
                        <link dest="5c49b48a59024c08" destField="table" source="39169d809aa2478e" sourceField="obj"/>
                        <link dest="93c060eb54fd4e81" destField="tableMap" source="5c49b48a59024c08" sourceField="tableMap"/>
                        <link dest="93c060eb54fd4e81" destField="speaker" source="d3b316447a5c4962" sourceField="obj"/>
                        <link dest="14e8ff33cbaf43c9" destField="tableMap" source="93c060eb54fd4e81" sourceField="table"/>
                        <link dest="14e8ff33cbaf43c9" destField="enabled" source="93c060eb54fd4e81" sourceField="exists"/>
                        <link dest="14e8ff33cbaf43c9" destField="summaryTable" source="29b6895f64494a6a" sourceField="obj"/>
                        <link dest="14e8ff33cbaf43c9" destField="reportNode" source="1076f4c5c51a48fc" sourceField="obj"/>
                        <extensions>
                            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                        </extensions>
                    </graph>
                    <ogcn:published_input field="obj" name="speaker" ref="d3b316447a5c4962"/>
                    <ogcn:published_input field="obj" name="table" ref="39169d809aa2478e"/>
                    <ogcn:published_input field="obj" name="summaryTable" ref="29b6895f64494a6a"/>
                    <ogcn:published_input field="obj" name="reportNode" ref="1076f4c5c51a48fc"/>
                    <ogcn:published_output field="obj" name="summaryTable" ref="29b6895f64494a6a"/>
                    <extensions>
                        <oga:meta x="724" y="270"/>
                    </extensions>
                </ogcn:macro>
                <node id="5c8dd523" name="Add Summary Table" type="class:ca.phon.app.opgraph.nodes.report.TableSectionNode">
                    <extensions>
                        <oga:settings>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.includeColumns">
                                <![CDATA[true]]>
                            </oga:property>
                            <oga:property key="ca.phon.app.opgraph.nodes.report.TableSectionNode.columns"/>
                        </oga:settings>
                        <oga:meta x="1018" y="265"/>
                    </extensions>
                </node>
                <link dest="5fc29abaa09040c1" destField="obj" source="282a70f9" sourceField="obj"/>
                <link dest="e60ae088c39c4be1" destField="table" source="cbab76efb3454ab5" sourceField="obj"/>
                <link dest="607a331e" destField="speaker" source="5fc29abaa09040c1" sourceField="obj"/>
                <link dest="607a331e" destField="table" source="e60ae088c39c4be1" sourceField="trueTable"/>
                <link dest="607a331e" destField="summaryTable" source="55aaa72dc82b4f91" sourceField="table"/>
                <link dest="fb1827b" destField="obj" source="5fc29abaa09040c1" sourceField="obj"/>
                <link dest="5c8dd523" destField="sectionName" source="fb1827b" sourceField="value"/>
                <link dest="5c8dd523" destField="parent" source="c2a4bb4702264bae" sourceField="obj"/>
                <link dest="7efa92f7" destField="sectionName" source="fb1827b" sourceField="value"/>
                <link dest="7efa92f7" destField="parent" source="deb9a5f4203e48c1" sourceField="obj"/>
                <link dest="607a331e" destField="reportNode" source="7efa92f7" sourceField="section"/>
                <link dest="7606c46e4d4a488e" destField="summaryTable" source="607a331e" sourceField="summaryTable"/>
                <link dest="7606c46e4d4a488e" destField="table" source="e60ae088c39c4be1" sourceField="falseTable"/>
                <link dest="7606c46e4d4a488e" destField="speaker" source="5fc29abaa09040c1" sourceField="obj"/>
                <link dest="7606c46e4d4a488e" destField="reportNode" source="7efa92f7" sourceField="section"/>
                <link dest="5c8dd523" destField="table" source="7606c46e4d4a488e" sourceField="summaryTable"/>
                <extensions>
                    <oga:notes>
                        <oga:note color="0xffff96" height="660" title="Inputs" width="296" x="22" y="139"/>
                    </oga:notes>
                    <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
                </extensions>
            </graph>
            <ogcn:published_input field="obj" name="resultTable" ref="cbab76efb3454ab5"/>
            <ogcn:published_input field="obj" name="summaryNode" ref="c2a4bb4702264bae"/>
            <ogcn:published_input field="obj" name="rootNode" ref="deb9a5f4203e48c1"/>
            <extensions>
                <oga:settings>
                    <oga:property key="ca.phon.opgraph.nodes.reflect.IterableClassNode.className">
                        <![CDATA[java.util.ArrayList]]>
                    </oga:property>
                </oga:settings>
                <oga:meta x="785" y="14"/>
            </extensions>
        </ogcn:macro>
        <link dest="29ac654b" destField="project" source="55f4fba4" sourceField="obj"/>
        <link dest="29ac654b" destField="sessions" source="1ae2322c" sourceField="obj"/>
        <link dest="61e6ae5ee8ed4084" destField="project" source="29ac654b" sourceField="project"/>
        <link dest="61208600" destField="collection" source="3da0e5db" sourceField="obj"/>
        <link dest="61e6ae5ee8ed4084" destField="results" source="29ac654b" sourceField="results"/>
        <link dest="61208600" destField="resultTable" source="61e6ae5ee8ed4084" sourceField="table"/>
        <link dest="2f5a76e38b4b4c38" destField="parameters" source="dc596f57c3774064" sourceField="parameters"/>
        <link dest="e041a49" destField="reportName" source="2f5a76e38b4b4c38" sourceField="reportTitle"/>
        <link dest="763b6571" destField="parent" source="e041a49" sourceField="root"/>
        <link dest="61208600" destField="summaryNode" source="763b6571" sourceField="section"/>
        <link dest="61208600" destField="rootNode" source="e041a49" sourceField="root"/>
        <extensions>
            <opqry:nodewizard type="ca.phon.app.opgraph.analysis.AnalysisWizardExtension">
                <opqry:info format="html" title="Vocalization">
                    <opqry:message/>
                </opqry:info>
            </opqry:nodewizard>
            <nes:settings type="ca.phon.app.opgraph.analysis.AnalysisOpGraphEditorModel"/>
        </extensions>
    </graph>
</opgraph>
