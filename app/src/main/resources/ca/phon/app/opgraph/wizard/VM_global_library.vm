## Velocity global templates for opgraph wizard reports

#macro( h1 $title ) #set($H = '#')$H $title#end
#macro( h2 $title ) #set($H = '##')$H $title#end
#macro( h3 $title ) #set($H = '###')$H $title#end
#macro( h4 $title ) #set($H = '####')$H $title#end

#macro( printHeader $table $columnNames )
	#set($maxCol = $table.columnCount - 1)
	#if($maxCol >= 0)
	<tr>
		#foreach($col in [0..$maxCol])
			#set($columnName = $table.getColumnTitle($col))
			#if($columnNames.size() == 0 || $columnNames.contains($columnName))
				<th>$table.getColumnTitle($col)</th>
			#end
		#end
	</tr>
	#end
#end

#macro( printValue $v )
	#if( (! $v) && ("$!v" == "") ) <td/>
	#else
	#set($clazz = $v.class)
	#set($txt = $FormatterUtil.format($v))
	#set($number = $Class.forName("java.lang.Number"))
	#set($ipa = $Class.forName("ca.phon.ipa.IPATranscript"))
	#if($clazz == $ipa) #set($type = "ipa_value")
	#elseif($number.isAssignableFrom($clazz))
		#set($type = "number_value")
		#if($Class.forName("java.lang.Float").isAssignableFrom($clazz) ||
			$Class.forName("java.lang.Double").isAssignableFrom($clazz))
			#set($txt = $Math.roundTo(2, $v))
		#end
	#else #set($type = "text_value")#end
<td class='$type'>$txt</td>
	#end
#end

#macro( printBody $table $columnNames )
	#set($maxCol = $table.columnCount - 1)
	#set($maxRow = $table.rowCount - 1)
	#if($maxRow >= 0 && $maxCol >= 0)
		#foreach($row in [0..$maxRow])
			<tr>
			#foreach($col in [0..$maxCol])
				#set($columnName = $table.getColumnTitle($col))
				#if($columnNames.size() == 0 || $columnNames.contains($columnName))
					#printValue($table.getValueAt($row, $col))
				#end
			#end
			</tr>
		#end
	#end
#end

## Print table data as HTML
#macro( printTable $table $columnNames )
#if($table.columnCount > 0 && $table.rowCount > 0)
<table>
#printHeader( $table $columnNames )
#printBody( $table $columnNames )
</table>
#end
#end

#macro( printTableWithCaption $table $caption $columnNames )
#if($table.columnCount > 0 && $table.rowCount > 0)
<table>
<caption>$caption</caption>
#printHeader( $table $columnNames )
#printBody( $table $columnNames )
</table>
#end
#end

#macro( printTableWithCaptionExcludingColumns $table $caption $excludedColumns )
#set($columnNames = [])
#set($maxCol = $table.columnCount - 1)
#foreach($col in [0..$maxCol])
#set($colName = $table.getColumnTitle($col))
#if(!$excludedColumns.contains($colName))
#set( $swallow = $columnNames.add($colName))
#end
#end
#printTableWithCaption( $table $caption $columnNames )
#end
